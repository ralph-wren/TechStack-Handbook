# Java é«˜çº§ç‰¹æ€§ä¸æ ¸å¿ƒæ¦‚å¿µ

## ç›®å½•
- [Java é«˜çº§ç‰¹æ€§ä¸æ ¸å¿ƒæ¦‚å¿µ](#java-é«˜çº§ç‰¹æ€§ä¸æ ¸å¿ƒæ¦‚å¿µ)
  - [ç›®å½•](#ç›®å½•)
  - [Java åŸºç¡€æ ¸å¿ƒ](#java-åŸºç¡€æ ¸å¿ƒ)
    - [é¢å‘å¯¹è±¡ç¼–ç¨‹](#é¢å‘å¯¹è±¡ç¼–ç¨‹)
      - [å°è£…ï¼ˆEncapsulationï¼‰](#å°è£…encapsulation)
      - [ç»§æ‰¿ï¼ˆInheritanceï¼‰](#ç»§æ‰¿inheritance)
      - [å¤šæ€ï¼ˆPolymorphismï¼‰](#å¤šæ€polymorphism)
    - [å¼‚å¸¸å¤„ç†æœºåˆ¶](#å¼‚å¸¸å¤„ç†æœºåˆ¶)
      - [å¼‚å¸¸ä½“ç³»ç»“æ„](#å¼‚å¸¸ä½“ç³»ç»“æ„)
      - [å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ](#å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ)
    - [å­—ç¬¦ä¸²å¤„ç†](#å­—ç¬¦ä¸²å¤„ç†)
    - [æ³›å‹æœºåˆ¶](#æ³›å‹æœºåˆ¶)
      - [æ³›å‹åŸºç¡€ä½¿ç”¨](#æ³›å‹åŸºç¡€ä½¿ç”¨)
    - [æšä¸¾ç±»å‹](#æšä¸¾ç±»å‹)
      - [æšä¸¾é«˜çº§ç”¨æ³•](#æšä¸¾é«˜çº§ç”¨æ³•)
  - [JVM æ ¸å¿ƒæœºåˆ¶](#jvm-æ ¸å¿ƒæœºåˆ¶)
    - [ç±»åŠ è½½æœºåˆ¶è¯¦è§£](#ç±»åŠ è½½æœºåˆ¶è¯¦è§£)
      - [è¯¦ç»†è¯´æ˜](#è¯¦ç»†è¯´æ˜)
    - [JVM å†…å­˜æ¨¡å‹è¯¦è§£](#jvm-å†…å­˜æ¨¡å‹è¯¦è§£)
      - [å†…å­˜åŒºåŸŸè¯¦ç»†è¯´æ˜](#å†…å­˜åŒºåŸŸè¯¦ç»†è¯´æ˜)
    - [é”æœºåˆ¶è¯¦è§£](#é”æœºåˆ¶è¯¦è§£)
    - [å¹¶å‘å®¹å™¨](#å¹¶å‘å®¹å™¨)
      - [ConcurrentHashMapå®ç°åŸç†ä¸æœºåˆ¶](#concurrenthashmapå®ç°åŸç†ä¸æœºåˆ¶)
    - [åŸå­æ“ä½œç±»](#åŸå­æ“ä½œç±»)
  - [é›†åˆæ¡†æ¶](#é›†åˆæ¡†æ¶)
    - [é›†åˆæ¡†æ¶æ¦‚è§ˆ](#é›†åˆæ¡†æ¶æ¦‚è§ˆ)
    - [Listé›†åˆ](#listé›†åˆ)
      - [ArrayListå®ç°åŸç†ä¸æœºåˆ¶](#arraylistå®ç°åŸç†ä¸æœºåˆ¶)
      - [LinkedListå®ç°åŸç†ä¸æœºåˆ¶](#linkedlistå®ç°åŸç†ä¸æœºåˆ¶)
      - [çº¿ç¨‹å®‰å…¨çš„Listå®ç°](#çº¿ç¨‹å®‰å…¨çš„listå®ç°)
    - [Seté›†åˆ](#seté›†åˆ)
      - [HashSetå®ç°åŸç†ä¸æœºåˆ¶](#hashsetå®ç°åŸç†ä¸æœºåˆ¶)
      - [TreeSetå®ç°åŸç†ä¸æœºåˆ¶](#treesetå®ç°åŸç†ä¸æœºåˆ¶)
      - [ç‰¹æ®ŠSetå®ç°](#ç‰¹æ®Šsetå®ç°)
    - [Mapé›†åˆ](#mapé›†åˆ)
      - [HashMapå®ç°åŸç†ä¸æœºåˆ¶](#hashmapå®ç°åŸç†ä¸æœºåˆ¶)
      - [TreeMapå®ç°åŸç†ä¸æœºåˆ¶](#treemapå®ç°åŸç†ä¸æœºåˆ¶)
      - [ç‰¹æ®ŠMapå®ç°](#ç‰¹æ®Šmapå®ç°)
    - [Queueé›†åˆ](#queueé›†åˆ)
      - [åŸºæœ¬é˜Ÿåˆ—å®ç°](#åŸºæœ¬é˜Ÿåˆ—å®ç°)
      - [é˜»å¡é˜Ÿåˆ—å®ç°](#é˜»å¡é˜Ÿåˆ—å®ç°)
    - [é›†åˆæ€§èƒ½å¯¹æ¯”](#é›†åˆæ€§èƒ½å¯¹æ¯”)
      - [æ—¶é—´å¤æ‚åº¦å¯¹æ¯”è¡¨](#æ—¶é—´å¤æ‚åº¦å¯¹æ¯”è¡¨)
      - [è¯¦ç»†æ€§èƒ½åˆ†æ](#è¯¦ç»†æ€§èƒ½åˆ†æ)
      - [é›†åˆé€‰æ‹©å†³ç­–æ ‘](#é›†åˆé€‰æ‹©å†³ç­–æ ‘)
      - [åœºæ™¯åŒ–é€‰æ‹©æŒ‡å—](#åœºæ™¯åŒ–é€‰æ‹©æŒ‡å—)
      - [æ€§èƒ½è°ƒä¼˜å»ºè®®](#æ€§èƒ½è°ƒä¼˜å»ºè®®)
    - [é›†åˆä½¿ç”¨æœ€ä½³å®è·µ](#é›†åˆä½¿ç”¨æœ€ä½³å®è·µ)
  - [å‡½æ•°å¼ç¼–ç¨‹](#å‡½æ•°å¼ç¼–ç¨‹)
    - [Lambdaè¡¨è¾¾å¼](#lambdaè¡¨è¾¾å¼)
    - [Stream API](#stream-api)
    - [å‡½æ•°å¼æ¥å£](#å‡½æ•°å¼æ¥å£)
    - [æ–¹æ³•å¼•ç”¨](#æ–¹æ³•å¼•ç”¨)
  - [åå°„ä¸æ³¨è§£](#åå°„ä¸æ³¨è§£)
    - [åå°„æœºåˆ¶](#åå°„æœºåˆ¶)
    - [æ³¨è§£å¤„ç†](#æ³¨è§£å¤„ç†)
    - [åŠ¨æ€ä»£ç†](#åŠ¨æ€ä»£ç†)
      - [ç‰¹æ®ŠSetå®ç°](#ç‰¹æ®Šsetå®ç°-1)
    - [å‡½æ•°å¼ç¼–ç¨‹](#å‡½æ•°å¼ç¼–ç¨‹-1)
      - [Lambdaè¡¨è¾¾å¼](#lambdaè¡¨è¾¾å¼-1)
      - [Stream API](#stream-api-1)
    - [åå°„ä¸æ³¨è§£](#åå°„ä¸æ³¨è§£-1)
    - [åå°„æœºåˆ¶](#åå°„æœºåˆ¶-1)
    - [æ³¨è§£å¤„ç†](#æ³¨è§£å¤„ç†-1)
  - [åƒåœ¾å›æ”¶æœºåˆ¶](#åƒåœ¾å›æ”¶æœºåˆ¶)
    - [åƒåœ¾å›æ”¶åŸºæœ¬åŸç†](#åƒåœ¾å›æ”¶åŸºæœ¬åŸç†)
    - [åƒåœ¾å›æ”¶ç®—æ³•](#åƒåœ¾å›æ”¶ç®—æ³•)
      - [æ ‡è®°-æ¸…é™¤ç®—æ³•](#æ ‡è®°-æ¸…é™¤ç®—æ³•)
      - [æ ‡è®°-å¤åˆ¶ç®—æ³•](#æ ‡è®°-å¤åˆ¶ç®—æ³•)
      - [æ ‡è®°-æ•´ç†ç®—æ³•](#æ ‡è®°-æ•´ç†ç®—æ³•)
      - [åˆ†ä»£æ”¶é›†ç®—æ³•](#åˆ†ä»£æ”¶é›†ç®—æ³•)
    - [åƒåœ¾æ”¶é›†å™¨](#åƒåœ¾æ”¶é›†å™¨)
      - [æ–°ç”Ÿä»£æ”¶é›†å™¨](#æ–°ç”Ÿä»£æ”¶é›†å™¨)
      - [è€å¹´ä»£æ”¶é›†å™¨](#è€å¹´ä»£æ”¶é›†å™¨)
      - [æ··åˆæ”¶é›†å™¨](#æ··åˆæ”¶é›†å™¨)
    - [åƒåœ¾æ”¶é›†å™¨é€‰æ‹©](#åƒåœ¾æ”¶é›†å™¨é€‰æ‹©)
  - [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
    - [æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)
  - [å¤šçº¿ç¨‹ç¼–ç¨‹](#å¤šçº¿ç¨‹ç¼–ç¨‹)
    - [çº¿ç¨‹åŸºç¡€](#çº¿ç¨‹åŸºç¡€)
      - [çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ](#çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ)
      - [çº¿ç¨‹åˆ›å»ºä¸ä½¿ç”¨](#çº¿ç¨‹åˆ›å»ºä¸ä½¿ç”¨)
    - [çº¿ç¨‹æ± è¯¦è§£](#çº¿ç¨‹æ± è¯¦è§£)
      - [çº¿ç¨‹æ± å·¥ä½œæµç¨‹](#çº¿ç¨‹æ± å·¥ä½œæµç¨‹)
      - [çº¿ç¨‹æ± å®ç°](#çº¿ç¨‹æ± å®ç°)
    - [çº¿ç¨‹å®‰å…¨](#çº¿ç¨‹å®‰å…¨)
      - [åŒæ­¥æœºåˆ¶](#åŒæ­¥æœºåˆ¶)
      - [çº¿ç¨‹åä½œ](#çº¿ç¨‹åä½œ)
    - [çº¿ç¨‹æ± æœ€ä½³å®è·µ](#çº¿ç¨‹æ± æœ€ä½³å®è·µ)
  - [è®¾è®¡æ¨¡å¼](#è®¾è®¡æ¨¡å¼)
    - [åˆ›å»ºå‹æ¨¡å¼](#åˆ›å»ºå‹æ¨¡å¼)
      - [å•ä¾‹æ¨¡å¼](#å•ä¾‹æ¨¡å¼)
      - [å·¥å‚æ¨¡å¼](#å·¥å‚æ¨¡å¼)
      - [å»ºé€ è€…æ¨¡å¼](#å»ºé€ è€…æ¨¡å¼)
    - [ç»“æ„å‹æ¨¡å¼](#ç»“æ„å‹æ¨¡å¼)
      - [é€‚é…å™¨æ¨¡å¼](#é€‚é…å™¨æ¨¡å¼)
      - [è£…é¥°å™¨æ¨¡å¼](#è£…é¥°å™¨æ¨¡å¼)
    - [è¡Œä¸ºå‹æ¨¡å¼](#è¡Œä¸ºå‹æ¨¡å¼)
      - [è§‚å¯Ÿè€…æ¨¡å¼](#è§‚å¯Ÿè€…æ¨¡å¼)
      - [ç­–ç•¥æ¨¡å¼](#ç­–ç•¥æ¨¡å¼)
  - [å¸¸è§é¢è¯•é¢˜](#å¸¸è§é¢è¯•é¢˜)
    - [åŸºç¡€çŸ¥è¯†é¢è¯•é¢˜](#åŸºç¡€çŸ¥è¯†é¢è¯•é¢˜)
      - [1. JavaåŸºç¡€æ¦‚å¿µ](#1-javaåŸºç¡€æ¦‚å¿µ)
      - [2. å¼‚å¸¸å¤„ç†](#2-å¼‚å¸¸å¤„ç†)
      - [3. æ³›å‹æœºåˆ¶](#3-æ³›å‹æœºåˆ¶)
    - [JVMé¢è¯•é¢˜](#jvmé¢è¯•é¢˜)
      - [1. å†…å­˜æ¨¡å‹](#1-å†…å­˜æ¨¡å‹)
      - [2. åƒåœ¾å›æ”¶](#2-åƒåœ¾å›æ”¶)
      - [3. ç±»åŠ è½½](#3-ç±»åŠ è½½)
    - [é›†åˆæ¡†æ¶é¢è¯•é¢˜](#é›†åˆæ¡†æ¶é¢è¯•é¢˜)
      - [1. Listé›†åˆ](#1-listé›†åˆ)
      - [2. Mapé›†åˆ](#2-mapé›†åˆ)
    - [å¤šçº¿ç¨‹é¢è¯•é¢˜](#å¤šçº¿ç¨‹é¢è¯•é¢˜)
      - [1. çº¿ç¨‹åŸºç¡€](#1-çº¿ç¨‹åŸºç¡€)
      - [2. çº¿ç¨‹åŒæ­¥](#2-çº¿ç¨‹åŒæ­¥)
      - [3. çº¿ç¨‹æ± ](#3-çº¿ç¨‹æ± )
    - [è®¾è®¡æ¨¡å¼é¢è¯•é¢˜](#è®¾è®¡æ¨¡å¼é¢è¯•é¢˜)
      - [1. å•ä¾‹æ¨¡å¼](#1-å•ä¾‹æ¨¡å¼)
      - [2. å·¥å‚æ¨¡å¼](#2-å·¥å‚æ¨¡å¼)
    - [æ€§èƒ½ä¼˜åŒ–é¢è¯•é¢˜](#æ€§èƒ½ä¼˜åŒ–é¢è¯•é¢˜)
    - [é«˜çº§ç‰¹æ€§é¢è¯•é¢˜](#é«˜çº§ç‰¹æ€§é¢è¯•é¢˜)
      - [1. åå°„ä¸æ³¨è§£](#1-åå°„ä¸æ³¨è§£)
      - [2. å‡½æ•°å¼ç¼–ç¨‹](#2-å‡½æ•°å¼ç¼–ç¨‹)
      - [3. I/Oä¸NIO](#3-ioä¸nio)
    - [æ¡†æ¶ä¸ä¸­é—´ä»¶é¢è¯•é¢˜](#æ¡†æ¶ä¸ä¸­é—´ä»¶é¢è¯•é¢˜)
      - [1. Springæ¡†æ¶](#1-springæ¡†æ¶)
      - [2. MyBatis](#2-mybatis)
      - [3. Redis](#3-redis)
      - [4. æ¶ˆæ¯é˜Ÿåˆ—](#4-æ¶ˆæ¯é˜Ÿåˆ—)
    - [åˆ†å¸ƒå¼ç³»ç»Ÿé¢è¯•é¢˜](#åˆ†å¸ƒå¼ç³»ç»Ÿé¢è¯•é¢˜)
      - [1. åˆ†å¸ƒå¼ç†è®º](#1-åˆ†å¸ƒå¼ç†è®º)
      - [2. å¾®æœåŠ¡æ¶æ„](#2-å¾®æœåŠ¡æ¶æ„)
      - [3. åˆ†å¸ƒå¼äº‹åŠ¡](#3-åˆ†å¸ƒå¼äº‹åŠ¡)
    - [é¡¹ç›®å®æˆ˜é¢è¯•é¢˜](#é¡¹ç›®å®æˆ˜é¢è¯•é¢˜)
      - [1. ç³»ç»Ÿè®¾è®¡](#1-ç³»ç»Ÿè®¾è®¡)
      - [2. æ€§èƒ½ä¼˜åŒ–](#2-æ€§èƒ½ä¼˜åŒ–)
      - [3. æ•…éšœæ’æŸ¥](#3-æ•…éšœæ’æŸ¥)
  - [å®æˆ˜åº”ç”¨åœºæ™¯](#å®æˆ˜åº”ç”¨åœºæ™¯)
    - [é«˜å¹¶å‘ç³»ç»Ÿè®¾è®¡](#é«˜å¹¶å‘ç³»ç»Ÿè®¾è®¡)
      - [1. ç§’æ€ç³»ç»Ÿè®¾è®¡](#1-ç§’æ€ç³»ç»Ÿè®¾è®¡)
      - [2. é™æµç­–ç•¥å®ç°](#2-é™æµç­–ç•¥å®ç°)
    - [ç¼“å­˜è®¾è®¡ä¸å®ç°](#ç¼“å­˜è®¾è®¡ä¸å®ç°)
      - [1. å¤šçº§ç¼“å­˜æ¶æ„](#1-å¤šçº§ç¼“å­˜æ¶æ„)
      - [2. ç¼“å­˜ç©¿é€ã€å‡»ç©¿ã€é›ªå´©è§£å†³æ–¹æ¡ˆ](#2-ç¼“å­˜ç©¿é€å‡»ç©¿é›ªå´©è§£å†³æ–¹æ¡ˆ)
    - [åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘](#åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘)
      - [1. åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ](#1-åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ)
      - [2. åˆ†å¸ƒå¼é”å®ç°](#2-åˆ†å¸ƒå¼é”å®ç°)
  - [æ•…éšœæ’æŸ¥ä¸è°ƒè¯•](#æ•…éšœæ’æŸ¥ä¸è°ƒè¯•)
    - [å†…å­˜é—®é¢˜æ’æŸ¥](#å†…å­˜é—®é¢˜æ’æŸ¥)
      - [1. å†…å­˜æ³„æ¼æ’æŸ¥æ­¥éª¤](#1-å†…å­˜æ³„æ¼æ’æŸ¥æ­¥éª¤)
      - [2. å¸¸è§å†…å­˜æ³„æ¼åœºæ™¯](#2-å¸¸è§å†…å­˜æ³„æ¼åœºæ™¯)
    - [CPUé—®é¢˜æ’æŸ¥](#cpué—®é¢˜æ’æŸ¥)
      - [1. CPUä½¿ç”¨ç‡è¿‡é«˜æ’æŸ¥](#1-cpuä½¿ç”¨ç‡è¿‡é«˜æ’æŸ¥)
      - [2. CPUä½¿ç”¨ç‡è¿‡é«˜çš„å¸¸è§åŸå› ](#2-cpuä½¿ç”¨ç‡è¿‡é«˜çš„å¸¸è§åŸå› )
    - [çº¿ç¨‹é—®é¢˜æ’æŸ¥](#çº¿ç¨‹é—®é¢˜æ’æŸ¥)
      - [1. æ­»é”æ’æŸ¥](#1-æ­»é”æ’æŸ¥)
    - [GCè°ƒä¼˜å®è·µ](#gcè°ƒä¼˜å®è·µ)
      - [GCç›‘æ§ä¸åˆ†æ](#gcç›‘æ§ä¸åˆ†æ)
      - [GCè°ƒä¼˜æ–¹æ³•](#gcè°ƒä¼˜æ–¹æ³•)

## Java åŸºç¡€æ ¸å¿ƒ

### é¢å‘å¯¹è±¡ç¼–ç¨‹

é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰æ˜¯Javaçš„æ ¸å¿ƒç‰¹æ€§ï¼ŒåŒ…å«**å°è£…ã€ç»§æ‰¿ã€å¤šæ€**ä¸‰å¤§ç‰¹æ€§ã€‚

#### å°è£…ï¼ˆEncapsulationï¼‰
```java
/**
 * å°è£…ç¤ºä¾‹ï¼šå°†æ•°æ®å’Œæ“ä½œæ•°æ®çš„æ–¹æ³•ç»‘å®šåœ¨ä¸€èµ·
 * ä¼˜ç‚¹ï¼šæ•°æ®å®‰å…¨ã€ä»£ç å¤ç”¨ã€æ˜“äºç»´æŠ¤
 */
public class BankAccount {
    // ç§æœ‰å±æ€§ï¼Œå¤–éƒ¨æ— æ³•ç›´æ¥è®¿é—®
    private String accountNumber;
    private double balance;
    private String ownerName;
    
    // æ„é€ æ–¹æ³•
    public BankAccount(String accountNumber, String ownerName) {
        this.accountNumber = accountNumber;
        this.ownerName = ownerName;
        this.balance = 0.0;
    }
    
    // å…¬å…±æ–¹æ³•æä¾›å—æ§è®¿é—®
    public void deposit(double amount) {
        if (amount > 0) {
            balance += amount;
            System.out.println("å­˜æ¬¾æˆåŠŸï¼Œå½“å‰ä½™é¢ï¼š" + balance);
        } else {
            throw new IllegalArgumentException("å­˜æ¬¾é‡‘é¢å¿…é¡»å¤§äº0");
        }
    }
    
    public boolean withdraw(double amount) {
        if (amount > 0 && amount <= balance) {
            balance -= amount;
            System.out.println("å–æ¬¾æˆåŠŸï¼Œå½“å‰ä½™é¢ï¼š" + balance);
            return true;
        }
        return false;
    }
    
    // åªè¯»å±æ€§
    public double getBalance() {
        return balance;
    }
    
    public String getAccountNumber() {
        return accountNumber;
    }
}
```

#### ç»§æ‰¿ï¼ˆInheritanceï¼‰
```java
/**
 * ç»§æ‰¿ç¤ºä¾‹ï¼šå­ç±»ç»§æ‰¿çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•
 * å…³é”®å­—ï¼šextends, super
 * ç‰¹ç‚¹ï¼šä»£ç å¤ç”¨ã€å»ºç«‹ç±»å±‚æ¬¡ç»“æ„
 */

// çˆ¶ç±»ï¼ˆåŸºç±»ï¼‰
public abstract class Animal {
    protected String name;
    protected int age;
    
    public Animal(String name, int age) {
        this.name = name;
        this.age = age;
    }
    
    // å…·ä½“æ–¹æ³•
    public void eat() {
        System.out.println(name + " æ­£åœ¨åƒä¸œè¥¿");
    }
    
    // æŠ½è±¡æ–¹æ³•ï¼Œå­ç±»å¿…é¡»å®ç°
    public abstract void makeSound();
    
    // å¯è¢«é‡å†™çš„æ–¹æ³•
    public void sleep() {
        System.out.println(name + " æ­£åœ¨ç¡è§‰");
    }
}

// å­ç±»
public class Dog extends Animal {
    private String breed;
    
    public Dog(String name, int age, String breed) {
        super(name, age);  // è°ƒç”¨çˆ¶ç±»æ„é€ æ–¹æ³•
        this.breed = breed;
    }
    
    @Override
    public void makeSound() {
        System.out.println(name + " æ±ªæ±ªå«");
    }
    
    @Override
    public void sleep() {
        super.sleep();  // è°ƒç”¨çˆ¶ç±»æ–¹æ³•
        System.out.println("ç‹—ç‹—ç¡å¾—å¾ˆé¦™");
    }
    
    // å­ç±»ç‰¹æœ‰æ–¹æ³•
    public void wagTail() {
        System.out.println(name + " æ‘‡å°¾å·´");
    }
}

// ä½¿ç”¨ç¤ºä¾‹
public class InheritanceDemo {
    public static void main(String[] args) {
        Dog dog = new Dog("æ—ºè´¢", 3, "é‡‘æ¯›");
        dog.eat();        // ç»§æ‰¿è‡ªçˆ¶ç±»
        dog.makeSound();  // å­ç±»å®ç°
        dog.sleep();      // é‡å†™çˆ¶ç±»æ–¹æ³•
        dog.wagTail();    // å­ç±»ç‰¹æœ‰æ–¹æ³•
    }
}
```

#### å¤šæ€ï¼ˆPolymorphismï¼‰
```java
/**
 * å¤šæ€ç¤ºä¾‹ï¼šåŒä¸€æ¥å£çš„ä¸åŒå®ç°
 * å®ç°æ–¹å¼ï¼šæ–¹æ³•é‡è½½ã€æ–¹æ³•é‡å†™ã€æ¥å£å®ç°
 * ä¼˜ç‚¹ï¼šä»£ç çµæ´»ã€æ˜“æ‰©å±•ã€é™ä½è€¦åˆ
 */

// æ¥å£å®šä¹‰
public interface Shape {
    double calculateArea();
    double calculatePerimeter();
    void draw();
}

// ä¸åŒå®ç°ç±»
public class Circle implements Shape {
    private double radius;
    
    public Circle(double radius) {
        this.radius = radius;
    }
    
    @Override
    public double calculateArea() {
        return Math.PI * radius * radius;
    }
    
    @Override
    public double calculatePerimeter() {
        return 2 * Math.PI * radius;
    }
    
    @Override
    public void draw() {
        System.out.println("ç»˜åˆ¶åœ†å½¢ï¼ŒåŠå¾„ï¼š" + radius);
    }
}

public class Rectangle implements Shape {
    private double width;
    private double height;
    
    public Rectangle(double width, double height) {
        this.width = width;
        this.height = height;
    }
    
    @Override
    public double calculateArea() {
        return width * height;
    }
    
    @Override
    public double calculatePerimeter() {
        return 2 * (width + height);
    }
    
    @Override
    public void draw() {
        System.out.println("ç»˜åˆ¶çŸ©å½¢ï¼Œå®½ï¼š" + width + "ï¼Œé«˜ï¼š" + height);
    }
}

// å¤šæ€ä½¿ç”¨ç¤ºä¾‹
public class PolymorphismDemo {
    public static void main(String[] args) {
        // å¤šæ€ï¼šçˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡
        Shape[] shapes = {
            new Circle(5.0),
            new Rectangle(4.0, 6.0),
            new Circle(3.0)
        };
        
        // ç»Ÿä¸€å¤„ç†ä¸åŒç±»å‹çš„å¯¹è±¡
        for (Shape shape : shapes) {
            shape.draw();
            System.out.println("é¢ç§¯ï¼š" + shape.calculateArea());
            System.out.println("å‘¨é•¿ï¼š" + shape.calculatePerimeter());
            System.out.println("---");
        }
    }
    
    // æ–¹æ³•é‡è½½ç¤ºä¾‹
    public static void print(int value) {
        System.out.println("æ•´æ•°ï¼š" + value);
    }
    
    public static void print(double value) {
        System.out.println("æµ®ç‚¹æ•°ï¼š" + value);
    }
    
    public static void print(String value) {
        System.out.println("å­—ç¬¦ä¸²ï¼š" + value);
    }
}
```

### å¼‚å¸¸å¤„ç†æœºåˆ¶

Javaå¼‚å¸¸å¤„ç†æ˜¯ç¨‹åºå¥å£®æ€§çš„é‡è¦ä¿éšœï¼Œé‡‡ç”¨**try-catch-finally**æœºåˆ¶ã€‚

#### å¼‚å¸¸ä½“ç³»ç»“æ„
```mermaid
graph TD
    A[Throwable] --> B[Error]
    A --> C[Exception]
    
    B --> B1[OutOfMemoryError]
    B --> B2[StackOverflowError]
    B --> B3[VirtualMachineError]
    
    C --> C1[RuntimeException]
    C --> C2[IOException]
    C --> C3[SQLException]
    
    C1 --> C11[NullPointerException]
    C1 --> C12[ArrayIndexOutOfBoundsException]
    C1 --> C13[IllegalArgumentException]
```

#### å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ
```java
/**
 * å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ
 * 1. å…·ä½“å¼‚å¸¸å…·ä½“å¤„ç†
 * 2. ä¸è¦å¿½ç•¥å¼‚å¸¸
 * 3. åˆç†ä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸
 * 4. èµ„æºç®¡ç†ä½¿ç”¨try-with-resources
 */
public class ExceptionHandlingExample {
    
    // è‡ªå®šä¹‰å¼‚å¸¸
    public static class BusinessException extends Exception {
        private String errorCode;
        
        public BusinessException(String errorCode, String message) {
            super(message);
            this.errorCode = errorCode;
        }
        
        public String getErrorCode() {
            return errorCode;
        }
    }
    
    /**
     * å¼‚å¸¸å¤„ç†ç¤ºä¾‹
     */
    public void handleExceptions() {
        try {
            // å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ä»£ç 
            processData();
        } catch (BusinessException e) {
            // å¤„ç†ä¸šåŠ¡å¼‚å¸¸
            System.err.println("ä¸šåŠ¡å¼‚å¸¸ï¼š" + e.getErrorCode() + " - " + e.getMessage());
            // è®°å½•æ—¥å¿—
            logError(e);
        } catch (IOException e) {
            // å¤„ç†IOå¼‚å¸¸
            System.err.println("IOå¼‚å¸¸ï¼š" + e.getMessage());
            // é‡è¯•æœºåˆ¶
            retryOperation();
        } catch (Exception e) {
            // å¤„ç†å…¶ä»–å¼‚å¸¸
            System.err.println("æœªçŸ¥å¼‚å¸¸ï¼š" + e.getMessage());
            e.printStackTrace();
        } finally {
            // æ¸…ç†èµ„æº
            cleanup();
        }
    }
    
    /**
     * try-with-resources è‡ªåŠ¨èµ„æºç®¡ç†
     */
    public void resourceManagement() {
        // è‡ªåŠ¨å…³é—­èµ„æº
        try (FileInputStream fis = new FileInputStream("file.txt");
             BufferedReader reader = new BufferedReader(new InputStreamReader(fis))) {
            
            String line;
            while ((line = reader.readLine()) != null) {
                System.out.println(line);
            }
        } catch (IOException e) {
            System.err.println("æ–‡ä»¶è¯»å–å¼‚å¸¸ï¼š" + e.getMessage());
        }
        // èµ„æºä¼šè‡ªåŠ¨å…³é—­ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨close()
    }
    
    /**
     * å¼‚å¸¸é“¾å’Œå¼‚å¸¸è½¬æ¢
     */
    public void processData() throws BusinessException {
        try {
            // åº•å±‚æ“ä½œ
            lowLevelOperation();
        } catch (SQLException e) {
            // å¼‚å¸¸è½¬æ¢ï¼šå°†åº•å±‚å¼‚å¸¸è½¬æ¢ä¸ºä¸šåŠ¡å¼‚å¸¸
            throw new BusinessException("DB_ERROR", "æ•°æ®åº“æ“ä½œå¤±è´¥", e);
        }
    }
    
    /**
     * å¼‚å¸¸å¤„ç†çš„æ€§èƒ½è€ƒè™‘
     */
    public void performanceConsiderations() {
        // é¿å…åœ¨å¾ªç¯ä¸­ä½¿ç”¨å¼‚å¸¸æ§åˆ¶æµç¨‹
        List<String> numbers = Arrays.asList("1", "2", "abc", "4");
        
        // é”™è¯¯åšæ³•ï¼šä½¿ç”¨å¼‚å¸¸æ§åˆ¶æµç¨‹
        for (String num : numbers) {
            try {
                int value = Integer.parseInt(num);
                System.out.println(value);
            } catch (NumberFormatException e) {
                // å¼‚å¸¸å¤„ç†å¼€é”€å¤§
                continue;
            }
        }
        
        // æ­£ç¡®åšæ³•ï¼šé¢„å…ˆéªŒè¯
        for (String num : numbers) {
            if (num.matches("\\d+")) {
                int value = Integer.parseInt(num);
                System.out.println(value);
            }
        }
    }
}
```

### å­—ç¬¦ä¸²å¤„ç†

å­—ç¬¦ä¸²æ˜¯Javaä¸­æœ€å¸¸ç”¨çš„æ•°æ®ç±»å‹ï¼Œç†è§£å…¶å†…éƒ¨æœºåˆ¶å¯¹æ€§èƒ½ä¼˜åŒ–è‡³å…³é‡è¦ã€‚

```java
/**
 * å­—ç¬¦ä¸²ç±»å‹å¯¹æ¯”
 * Stringï¼šä¸å¯å˜ã€çº¿ç¨‹å®‰å…¨ã€é€‚åˆå°‘é‡æ“ä½œ
 * StringBuilderï¼šå¯å˜ã€éçº¿ç¨‹å®‰å…¨ã€é€‚åˆå•çº¿ç¨‹å¤§é‡æ“ä½œ
 * StringBufferï¼šå¯å˜ã€çº¿ç¨‹å®‰å…¨ã€é€‚åˆå¤šçº¿ç¨‹å¤§é‡æ“ä½œ
 */
public class StringComparisonExample {
    
    /**
     * æ€§èƒ½å¯¹æ¯”æµ‹è¯•
     */
    public void performanceComparison() {
        int iterations = 10000;
        
        // String æ‹¼æ¥ï¼ˆæ€§èƒ½æœ€å·®ï¼‰
        long startTime = System.currentTimeMillis();
        String str = "";
        for (int i = 0; i < iterations; i++) {
            str += "a";  // æ¯æ¬¡éƒ½åˆ›å»ºæ–°å¯¹è±¡
        }
        long stringTime = System.currentTimeMillis() - startTime;
        
        // StringBuilder æ‹¼æ¥ï¼ˆæ€§èƒ½æœ€å¥½ï¼‰
        startTime = System.currentTimeMillis();
        StringBuilder sb = new StringBuilder();
        for (int i = 0; i < iterations; i++) {
            sb.append("a");
        }
        String sbResult = sb.toString();
        long sbTime = System.currentTimeMillis() - startTime;
        
        // StringBuffer æ‹¼æ¥ï¼ˆæ€§èƒ½ä¸­ç­‰ï¼‰
        startTime = System.currentTimeMillis();
        StringBuffer sbf = new StringBuffer();
        for (int i = 0; i < iterations; i++) {
            sbf.append("a");
        }
        String sbfResult = sbf.toString();
        long sbfTime = System.currentTimeMillis() - startTime;
        
        System.out.println("Stringæ‹¼æ¥è€—æ—¶ï¼š" + stringTime + "ms");
        System.out.println("StringBuilderæ‹¼æ¥è€—æ—¶ï¼š" + sbTime + "ms");
        System.out.println("StringBufferæ‹¼æ¥è€—æ—¶ï¼š" + sbfTime + "ms");
    }
    
    /**
     * å­—ç¬¦ä¸²å¸¸é‡æ± ç¤ºä¾‹
     */
    public void stringPoolExample() {
        // å­—é¢é‡åˆ›å»ºï¼Œå­˜å‚¨åœ¨å¸¸é‡æ± 
        String s1 = "hello";
        String s2 = "hello";
        System.out.println(s1 == s2);  // trueï¼ŒæŒ‡å‘åŒä¸€å¯¹è±¡
        
        // newåˆ›å»ºï¼Œåœ¨å †ä¸­åˆ›å»ºæ–°å¯¹è±¡
        String s3 = new String("hello");
        System.out.println(s1 == s3);  // falseï¼Œä¸åŒå¯¹è±¡
        System.out.println(s1.equals(s3));  // trueï¼Œå†…å®¹ç›¸åŒ
        
        // intern()æ–¹æ³•ï¼šå°†å­—ç¬¦ä¸²åŠ å…¥å¸¸é‡æ± 
        String s4 = s3.intern();
        System.out.println(s1 == s4);  // trueï¼ŒæŒ‡å‘å¸¸é‡æ± ä¸­çš„å¯¹è±¡
    }
    
    /**
     * å­—ç¬¦ä¸²å¤„ç†æœ€ä½³å®è·µ
     */
    public void stringBestPractices() {
        // 1. ä½¿ç”¨StringBuilderè¿›è¡Œå¤§é‡å­—ç¬¦ä¸²æ“ä½œ
        StringBuilder result = new StringBuilder();
        for (int i = 0; i < 1000; i++) {
            result.append("item").append(i).append(",");
        }
        
        // 2. é¢„ä¼°å®¹é‡é¿å…æ‰©å®¹
        StringBuilder sb = new StringBuilder(1000);  // é¢„è®¾å®¹é‡
        
        // 3. ä½¿ç”¨String.formatæ ¼å¼åŒ–
        String formatted = String.format("ç”¨æˆ·%sçš„å¹´é¾„æ˜¯%då²", "å¼ ä¸‰", 25);
        
        // 4. å­—ç¬¦ä¸²åˆ†å‰²ä¼˜åŒ–
        String data = "a,b,c,d,e";
        String[] parts = data.split(",");  // ç®€å•åˆ†å‰²
        
        // å¯¹äºå›ºå®šåˆ†éš”ç¬¦ï¼Œä½¿ç”¨StringTokenizeræ›´é«˜æ•ˆ
        StringTokenizer tokenizer = new StringTokenizer(data, ",");
        while (tokenizer.hasMoreTokens()) {
            String token = tokenizer.nextToken();
            // å¤„ç†token
        }
        
        // 5. å­—ç¬¦ä¸²æ¯”è¾ƒ
        String input = getUserInput();
        if ("admin".equals(input)) {  // å¸¸é‡åœ¨å‰ï¼Œé¿å…NullPointerException
            // å¤„ç†ç®¡ç†å‘˜é€»è¾‘
        }
    }
}
```

### æ³›å‹æœºåˆ¶

æ³›å‹æä¾›äº†**ç¼–è¯‘æ—¶ç±»å‹å®‰å…¨**æ£€æŸ¥ï¼Œé¿å…äº†ç±»å‹è½¬æ¢å¼‚å¸¸ã€‚

#### æ³›å‹åŸºç¡€ä½¿ç”¨
```java
/**
 * æ³›å‹ä½¿ç”¨ç¤ºä¾‹
 * ä¼˜ç‚¹ï¼šç±»å‹å®‰å…¨ã€æ¶ˆé™¤ç±»å‹è½¬æ¢ã€æé«˜ä»£ç å¯è¯»æ€§
 */
public class GenericExample {
    
    /**
     * æ³›å‹ç±»å®šä¹‰
     */
    public static class Container<T> {
        private T item;
        
        public void setItem(T item) {
            this.item = item;
        }
        
        public T getItem() {
            return item;
        }
        
        // æ³›å‹æ–¹æ³•
        public <U> void processItem(U processor) {
            System.out.println("å¤„ç†é¡¹ç›®ï¼š" + processor);
        }
    }
    
    /**
     * æ³›å‹æ¥å£
     */
    public interface Processor<T> {
        void process(T item);
        T transform(T input);
    }
    
    /**
     * æ³›å‹æ–¹æ³•ç¤ºä¾‹
     */
    public static <T> void swap(T[] array, int i, int j) {
        T temp = array[i];
        array[i] = array[j];
        array[j] = temp;
    }
    
    /**
     * é€šé…ç¬¦ä½¿ç”¨
     */
    public void wildcardExample() {
        // ä¸Šç•Œé€šé…ç¬¦ï¼š? extends T
        List<? extends Number> numbers = new ArrayList<Integer>();
        // numbers.add(1);  // ç¼–è¯‘é”™è¯¯ï¼Œä¸èƒ½æ·»åŠ å…ƒç´ 
        Number num = numbers.get(0);  // å¯ä»¥è¯»å–
        
        // ä¸‹ç•Œé€šé…ç¬¦ï¼š? super T
        List<? super Integer> integers = new ArrayList<Number>();
        integers.add(1);  // å¯ä»¥æ·»åŠ IntegeråŠå…¶å­ç±»
        // Integer value = integers.get(0);  // ç¼–è¯‘é”™è¯¯ï¼Œä¸èƒ½ç¡®å®šç±»å‹
        
        // æ— ç•Œé€šé…ç¬¦ï¼š?
        List<?> unknowns = new ArrayList<String>();
        Object obj = unknowns.get(0);  // åªèƒ½å½“ä½œObjectå¤„ç†
    }
    
    /**
     * æ³›å‹æ“¦é™¤ç¤ºä¾‹
     */
    public void typeErasureExample() {
        List<String> stringList = new ArrayList<>();
        List<Integer> intList = new ArrayList<>();
        
        // è¿è¡Œæ—¶ç±»å‹ç›¸åŒï¼Œéƒ½æ˜¯ArrayList
        System.out.println(stringList.getClass() == intList.getClass());  // true
        
        // è·å–æ³›å‹ä¿¡æ¯éœ€è¦é€šè¿‡åå°„
        Type stringListType = new TypeToken<List<String>>(){}.getType();
        Type intListType = new TypeToken<List<Integer>>(){}.getType();
        System.out.println(stringListType.equals(intListType));  // false
    }
}
```

### æšä¸¾ç±»å‹

æšä¸¾æ˜¯Javaä¸­çš„ç‰¹æ®Šç±»å‹ï¼Œæä¾›äº†**ç±»å‹å®‰å…¨çš„å¸¸é‡å®šä¹‰**æ–¹å¼ã€‚

#### æšä¸¾é«˜çº§ç”¨æ³•
```java
/**
 * æšä¸¾é«˜çº§ç”¨æ³•ç¤ºä¾‹
 * ç‰¹ç‚¹ï¼šç±»å‹å®‰å…¨ã€å¯æ‰©å±•ã€æ”¯æŒæ–¹æ³•å’Œå­—æ®µ
 */
public enum OrderStatus {
    // æšä¸¾å¸¸é‡å®šä¹‰
    PENDING("å¾…å¤„ç†", 1) {
        @Override
        public boolean canTransitionTo(OrderStatus newStatus) {
            return newStatus == PROCESSING || newStatus == CANCELLED;
        }
    },
    
    PROCESSING("å¤„ç†ä¸­", 2) {
        @Override
        public boolean canTransitionTo(OrderStatus newStatus) {
            return newStatus == COMPLETED || newStatus == CANCELLED;
        }
    },
    
    COMPLETED("å·²å®Œæˆ", 3) {
        @Override
        public boolean canTransitionTo(OrderStatus newStatus) {
            return false;  // å®ŒæˆçŠ¶æ€ä¸èƒ½è½¬æ¢
        }
    },
    
    CANCELLED("å·²å–æ¶ˆ", -1) {
        @Override
        public boolean canTransitionTo(OrderStatus newStatus) {
            return false;  // å–æ¶ˆçŠ¶æ€ä¸èƒ½è½¬æ¢
        }
    };
    
    // æšä¸¾å­—æ®µ
    private final String description;
    private final int code;
    
    // æšä¸¾æ„é€ æ–¹æ³•
    OrderStatus(String description, int code) {
        this.description = description;
        this.code = code;
    }
    
    // æŠ½è±¡æ–¹æ³•ï¼Œæ¯ä¸ªæšä¸¾å¸¸é‡å¿…é¡»å®ç°
    public abstract boolean canTransitionTo(OrderStatus newStatus);
    
    // æ™®é€šæ–¹æ³•
    public String getDescription() {
        return description;
    }
    
    public int getCode() {
        return code;
    }
    
    // é™æ€æ–¹æ³•
    public static OrderStatus fromCode(int code) {
        for (OrderStatus status : values()) {
            if (status.code == code) {
                return status;
            }
        }
        throw new IllegalArgumentException("æ— æ•ˆçš„çŠ¶æ€ç ï¼š" + code);
    }
    
    // æšä¸¾åœ¨switchä¸­çš„ä½¿ç”¨
    public String getNextAction() {
        switch (this) {
            case PENDING:
                return "å¼€å§‹å¤„ç†";
            case PROCESSING:
                return "å®Œæˆå¤„ç†";
            case COMPLETED:
                return "æ— éœ€æ“ä½œ";
            case CANCELLED:
                return "æ— éœ€æ“ä½œ";
            default:
                return "æœªçŸ¥æ“ä½œ";
        }
    }
}

/**
 * æšä¸¾ä½¿ç”¨ç¤ºä¾‹
 */
public class EnumUsageExample {
    public static void main(String[] args) {
        // åŸºæœ¬ä½¿ç”¨
        OrderStatus status = OrderStatus.PENDING;
        System.out.println("çŠ¶æ€ï¼š" + status.getDescription());
        System.out.println("ä»£ç ï¼š" + status.getCode());
        
        // çŠ¶æ€è½¬æ¢æ£€æŸ¥
        if (status.canTransitionTo(OrderStatus.PROCESSING)) {
            System.out.println("å¯ä»¥è½¬æ¢åˆ°å¤„ç†ä¸­çŠ¶æ€");
        }
        
        // éå†æ‰€æœ‰æšä¸¾å€¼
        System.out.println("æ‰€æœ‰è®¢å•çŠ¶æ€ï¼š");
        for (OrderStatus s : OrderStatus.values()) {
            System.out.println(s.name() + " - " + s.getDescription());
        }
        
        // ä»å­—ç¬¦ä¸²åˆ›å»ºæšä¸¾
        OrderStatus fromString = OrderStatus.valueOf("COMPLETED");
        
        // ä»ä»£ç åˆ›å»ºæšä¸¾
        OrderStatus fromCode = OrderStatus.fromCode(2);
        
        // åœ¨é›†åˆä¸­ä½¿ç”¨
        EnumSet<OrderStatus> activeStatuses = EnumSet.of(
            OrderStatus.PENDING, 
            OrderStatus.PROCESSING
        );
        
        EnumMap<OrderStatus, String> statusMessages = new EnumMap<>(OrderStatus.class);
        statusMessages.put(OrderStatus.PENDING, "è®¢å•ç­‰å¾…å¤„ç†");
        statusMessages.put(OrderStatus.PROCESSING, "è®¢å•æ­£åœ¨å¤„ç†");
    }
}
```

## JVM æ ¸å¿ƒæœºåˆ¶

### ç±»åŠ è½½æœºåˆ¶è¯¦è§£

ç±»åŠ è½½æ˜¯ Java ç¨‹åºè¿è¡Œçš„ç¬¬ä¸€æ­¥ï¼Œå®ƒçš„è¿‡ç¨‹å¦‚ä¸‹ï¼š

```mermaid
flowchart TD
    subgraph "ğŸ“‚ ç±»åŠ è½½æœºåˆ¶æµç¨‹" ["ç±»åŠ è½½æœºåˆ¶æµç¨‹"]
        Start["ç±»åŠ è½½å¯åŠ¨"] -->|"è§¦å‘æ¡ä»¶: new/åå°„/é¦–æ¬¡ä½¿ç”¨é™æ€æˆå‘˜"| LoadPhase["ğŸ“¥ åŠ è½½é˜¶æ®µ"]
        
        LoadPhase -->|"è·å–äºŒè¿›åˆ¶æ•°æ®+ç”ŸæˆClasså¯¹è±¡+æ–¹æ³•åŒºå­˜å‚¨"| VerifyPhase["ğŸ” éªŒè¯é˜¶æ®µ"]
        
        VerifyPhase -->|"æ–‡ä»¶æ ¼å¼/å…ƒæ•°æ®/å­—èŠ‚ç /ç¬¦å·å¼•ç”¨éªŒè¯"| PreparePhase["ğŸ› ï¸ å‡†å¤‡é˜¶æ®µ"]
        
        PreparePhase -->|"é™æ€å˜é‡åˆ†é…å†…å­˜+è®¾ç½®é»˜è®¤åˆå§‹å€¼+finalå¸¸é‡ç›´æ¥èµ‹å€¼"| ResolvePhase["ğŸ”— è§£æé˜¶æ®µ"]
        
        ResolvePhase -->|"ç¬¦å·å¼•ç”¨â†’ç›´æ¥å¼•ç”¨+è§£æç±»/æ¥å£/å­—æ®µ/æ–¹æ³•"| InitPhase["ğŸš€ åˆå§‹åŒ–é˜¶æ®µ"]
        
        InitPhase -->|"æ‰§è¡Œ<clinit>æ–¹æ³•+é™æ€å˜é‡èµ‹å€¼+é™æ€ä»£ç å—æ‰§è¡Œ"| Complete["ç±»åŠ è½½å®Œæˆ"]
    end
    
    %% æ ·å¼è®¾ç½®
    style Start fill:#E3F2FD,stroke:#1976D2,stroke-width:2px
    style LoadPhase fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px
    style VerifyPhase fill:#FFF3E0,stroke:#F57C00,stroke-width:2px
    style PreparePhase fill:#E8F5E8,stroke:#388E3C,stroke-width:2px
    style ResolvePhase fill:#FCE4EC,stroke:#C2185B,stroke-width:2px
    style InitPhase fill:#E0F2F1,stroke:#00695C,stroke-width:2px
    style Complete fill:#FFEBEE,stroke:#D32F2F,stroke-width:2px
```

#### åˆ†ä»£æ”¶é›†ç®—æ³•

åˆ†ä»£æ”¶é›†ç®—æ³•ï¼ˆGenerational Collectionï¼‰æ˜¯åŸºäºå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„ç»Ÿè®¡è§„å¾‹ï¼Œå°†å †å†…å­˜åˆ’åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œé‡‡ç”¨ä¸åŒç®—æ³•é’ˆå¯¹ä¸åŒä»£çš„å¯¹è±¡ã€‚

```mermaid
flowchart TD
    subgraph "ğŸ¢ åˆ†ä»£æ”¶é›†ç®—æ³•æµç¨‹" ["åˆ†ä»£æ”¶é›†ç®—æ³•æµç¨‹"]
        Start["åˆ†ä»£æ”¶é›†å¯åŠ¨"] -->|"å †å†…å­˜åˆ’åˆ†: æ–°ç”Ÿä»£(1/3)+è€å¹´ä»£(2/3)"| MemoryLayout["ğŸ“‹ å†…å­˜å¸ƒå±€é˜¶æ®µ"]
        
        MemoryLayout -->|"æ–°å¯¹è±¡ä¼˜å…ˆEdenåˆ†é…+å¤§å¯¹è±¡ç›´æ¥è€å¹´ä»£"| ObjectAlloc["ğŸŒ± å¯¹è±¡åˆ†é…é˜¶æ®µ"]
        
        ObjectAlloc -->|"å°å¯¹è±¡Edenåˆ†é…+å¤§å¯¹è±¡è€å¹´ä»£åˆ†é…"| MinorGC["ğŸ”„ æ–°ç”Ÿä»£GCé˜¶æ®µ"]
        
        MinorGC -->|"æ ‡è®°-å¤åˆ¶ç®—æ³•+å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°Survivor+å¹´é¾„+1"| Promotion["ğŸ” å¯¹è±¡æ™‹å‡é˜¶æ®µ"]
        
        Promotion -->|"å¹´é¾„é˜ˆå€¼(é»˜è®¤15)+åŠ¨æ€å¹´é¾„åˆ¤å®š+ç©ºé—´æ‹…ä¿"| MajorGC["ğŸ  è€å¹´ä»£GCé˜¶æ®µ"]
        
        MajorGC -->|"æ ‡è®°-æ•´ç†ç®—æ³•+æ•´ä¸ªå †æ”¶é›†+ä½é¢‘ç‡æ‰§è¡Œ"| Complete["âœ… æ”¶é›†å®Œæˆ"]
    end
    
    subgraph "ğŸŒ± æ–°ç”Ÿä»£ç»†èŠ‚" ["æ–°ç”Ÿä»£ç»†èŠ‚"]
        MemoryLayout -->|"å†…å­˜ç»“æ„: Eden(80%) + Survivor(10%+10%)"| YoungDetails["ğŸŒ± æ–°ç”Ÿä»£ç»“æ„"]
        YoungDetails -->|"å¤åˆ¶ç®—æ³•+é«˜é¢‘ç‡æ‰§è¡Œ+STWæ—¶é—´çŸ­"| YoungGCFeatures["æ–°ç”Ÿä»£GCç‰¹ç‚¹"]
    end
    
    subgraph "ğŸ  è€å¹´ä»£ç»†èŠ‚" ["è€å¹´ä»£ç»†èŠ‚"]
        MajorGC -->|"å­˜å‚¨é•¿æœŸå­˜æ´»å¯¹è±¡+ç©ºé—´è¾ƒå¤§"| OldDetails["ğŸ  è€å¹´ä»£ç»“æ„"]
        OldDetails -->|"æ ‡è®°-æ•´ç†ç®—æ³•+ä½é¢‘ç‡æ‰§è¡Œ+STWæ—¶é—´é•¿"| OldGCFeatures["è€å¹´ä»£GCç‰¹ç‚¹"]
    end
    
    subgraph "ğŸ“ˆ æ€§èƒ½ä¼˜åŠ¿" ["æ€§èƒ½ä¼˜åŠ¿"]
        Complete -->|"ç»“åˆç®—æ³•ä¼˜ç‚¹+æé«˜æ•ˆç‡"| Performance["ğŸš€ æ€§èƒ½æå‡"]
        Performance -->|"å†…å­˜åˆ©ç”¨ç‡é«˜+ç¢ç‰‡å°‘+GCæ€§èƒ½ä¼˜åŒ–"| Benefits["ğŸ† ç»¼åˆæ•ˆç›Š"]
    end
    
    %% æ ·å¼è®¾ç½®
    style Start fill:#E3F2FD,stroke:#1976D2,stroke-width:2px
    style MemoryLayout fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px
    style ObjectAlloc fill:#FFF3E0,stroke:#F57C00,stroke-width:2px
    style MinorGC fill:#E8F5E8,stroke:#388E3C,stroke-width:2px
    style Promotion fill:#FCE4EC,stroke:#C2185B,stroke-width:2px
    style MajorGC fill:#E0F2F1,stroke:#00695C,stroke-width:2px
    style Complete fill:#FFEBEE,stroke:#D32F2F,stroke-width:2px
    style Performance fill:#E1F5FE,stroke:#0277BD,stroke-width:2px
```

#### è¯¦ç»†è¯´æ˜

1. **åŠ è½½é˜¶æ®µ**
   ```java
   public class ClassLoadingExample {
       // è‡ªå®šä¹‰ç±»åŠ è½½å™¨ç¤ºä¾‹
       public class CustomClassLoader extends ClassLoader {
           @Override
           protected Class<?> findClass(String name) throws ClassNotFoundException {
               // 1. åŠ è½½ç±»æ–‡ä»¶
               byte[] classData = loadClassData(name);
               // 2. ç”ŸæˆClasså¯¹è±¡
               return defineClass(name, classData, 0, classData.length);
           }
           
           private byte[] loadClassData(String name) {
               // å®ç°ä»ä¸åŒæ¥æºåŠ è½½ç±»æ–‡ä»¶çš„é€»è¾‘
               // å¯ä»¥æ˜¯æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œã€æ•°æ®åº“ç­‰
               return null;
           }
       }
   }
   ```

2. **éªŒè¯é˜¶æ®µ**
   - æ–‡ä»¶æ ¼å¼éªŒè¯ï¼šé­”æ•°æ£€æŸ¥ã€ç‰ˆæœ¬å·æ£€æŸ¥
   - å…ƒæ•°æ®éªŒè¯ï¼šç±»æ˜¯å¦æœ‰çˆ¶ç±»ã€æ˜¯å¦å®ç°äº†æ¥å£ç­‰
   - å­—èŠ‚ç éªŒè¯ï¼šæ–¹æ³•ä½“éªŒè¯ã€æ ˆå¸§æ•°æ®æµéªŒè¯
   - ç¬¦å·å¼•ç”¨éªŒè¯ï¼šç¬¦å·å¼•ç”¨è½¬ç›´æ¥å¼•ç”¨çš„å‡†å¤‡

3. **å‡†å¤‡é˜¶æ®µ**
   ```java
   public class PrepareExample {
       // å‡†å¤‡é˜¶æ®µä¸ºé™æ€å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®é»˜è®¤å€¼
       private static int value = 123;  // å‡†å¤‡é˜¶æ®µè®¾ç½®ä¸º0ï¼Œåˆå§‹åŒ–é˜¶æ®µæ‰è®¾ç½®ä¸º123
       private static final int CONSTANT = 456;  // å‡†å¤‡é˜¶æ®µç›´æ¥è®¾ç½®ä¸º456
   }
   ```

4. **è§£æé˜¶æ®µ**
   ```java
   public class ResolutionExample {
       private static class Parent {}
       private static class Child extends Parent {}
       
       public static void main(String[] args) {
           // ç±»è§£æ
           Parent p = new Child();
           // æ–¹æ³•è§£æ
           p.toString();
           // å­—æ®µè§£æ
           System.out.println(Child.class.getModifiers());
       }
   }
   ```

5. **åˆå§‹åŒ–é˜¶æ®µ**
   ```java
   public class InitializationExample {
       // é™æ€å˜é‡
       private static int staticVar = 100;
       
       // é™æ€ä»£ç å—
       static {
           System.out.println("é™æ€ä»£ç å—æ‰§è¡Œ");
           staticVar = 200;
       }
       
       // ç±»æ„é€ å™¨
       public InitializationExample() {
           System.out.println("æ„é€ å™¨æ‰§è¡Œ");
       }
   }
   ```

### JVM å†…å­˜æ¨¡å‹è¯¦è§£

JVM å†…å­˜æ¨¡å‹æ˜¯ Java è¿è¡Œæ—¶çš„æ ¸å¿ƒï¼Œå®ƒçš„ç»“æ„å¦‚ä¸‹ï¼š

```mermaid
flowchart TD
    subgraph "ğŸ  JVMå†…å­˜åŒºåŸŸç»“æ„" ["JVMå†…å­˜åŒºåŸŸç»“æ„"]
        JVMMemory["ğŸ’» JVMå†…å­˜åŒºåŸŸ"] -->|"å¯¹è±¡å®ä¾‹+æ•°ç»„+å­—ç¬¦ä¸²å¸¸é‡æ± "| Heap["ğŸ¢ å †å†…å­˜ Heap"]
        
        JVMMemory -->|"ç±»ä¿¡æ¯+å¸¸é‡+é™æ€å˜é‡+æ–¹æ³•å­—èŠ‚ç "| MethodArea["ğŸ“š æ–¹æ³•åŒº Method Area"]
        
        JVMMemory -->|"å±€éƒ¨å˜é‡è¡¨+æ“ä½œæ•°æ ˆ+åŠ¨æ€é“¾æ¥+è¿”å›åœ°å€"| VMStack["ğŸ“š è™šæ‹Ÿæœºæ ˆ VM Stack"]
        
        JVMMemory -->|"æœ¬åœ°æ–¹æ³•(native)æœåŠ¡+JNIè°ƒç”¨"| NativeStack["ğŸ”§ æœ¬åœ°æ–¹æ³•æ ˆ Native Stack"]
        
        JVMMemory -->|"è®°å½•å½“å‰æ‰§è¡Œå­—èŠ‚ç æŒ‡ä»¤åœ°å€+çº¿ç¨‹ç§æœ‰"| PCRegister["ğŸ“Œ ç¨‹åºè®¡æ•°å™¨ PC Register"]
    end
    
    subgraph "ğŸŒ± å †å†…å­˜ç»†åˆ†" ["å †å†…å­˜ç»†åˆ†"]
        Heap -->|"æ–°å¯¹è±¡åˆ†é…+Eden:Survivor=8:1:1"| YoungGen["ğŸŒ± æ–°ç”Ÿä»£ Young"]
        Heap -->|"é•¿æœŸå­˜æ´»å¯¹è±¡+å¤§å¯¹è±¡ç›´æ¥åˆ†é…"| OldGen["ğŸ  è€å¹´ä»£ Old"]
        
        YoungGen -->|"æ–°å¯¹è±¡é¦–å…ˆåˆ†é…åŒºåŸŸ"| Eden["EdenåŒº"]
        YoungGen -->|"å­˜æ´»å¯¹è±¡äº¤æ›¿ä½¿ç”¨åŒºåŸŸ"| Survivor0["Survivor 0"]
        YoungGen -->|"å­˜æ´»å¯¹è±¡äº¤æ›¿ä½¿ç”¨åŒºåŸŸ"| Survivor1["Survivor 1"]
    end
    
    subgraph "ğŸ” æ ˆå¸§ç»“æ„" ["æ ˆå¸§ç»“æ„"]
        VMStack -->|"å­˜å‚¨å±€éƒ¨å˜é‡+å‚æ•°å€¼"| LocalVarTable["å±€éƒ¨å˜é‡è¡¨"]
        VMStack -->|"è®¡ç®—è¿‡ç¨‹ä¸­æ“ä½œæ•°æ ˆ"| OperandStack["æ“ä½œæ•°æ ˆ"]
        VMStack -->|"è¿è¡Œæ—¶å¸¸é‡æ± å¼•ç”¨"| DynamicLink["åŠ¨æ€é“¾æ¥"]
        VMStack -->|"è¿”å›åœ°å€+å¼‚å¸¸ä¿¡æ¯"| ReturnAddr["è¿”å›åœ°å€"]
    end
    
    %% æ ·å¼è®¾ç½®
    style JVMMemory fill:#E3F2FD,stroke:#1976D2,stroke-width:2px
    style Heap fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px
    style MethodArea fill:#FFF3E0,stroke:#F57C00,stroke-width:2px
    style VMStack fill:#E8F5E8,stroke:#388E3C,stroke-width:2px
    style YoungGen fill:#FCE4EC,stroke:#C2185B,stroke-width:2px
    style OldGen fill:#E0F2F1,stroke:#00695C,stroke-width:2px
```

#### å†…å­˜åŒºåŸŸè¯¦ç»†è¯´æ˜

1. **å †ï¼ˆHeapï¼‰**
   ```java
   public class HeapExample {
       public void heapAllocation() {
           // å¯¹è±¡åˆ†é…åœ¨å †ä¸Š
           Object obj = new Object();
           
           // æ•°ç»„ä¹Ÿåˆ†é…åœ¨å †ä¸Š
           int[] array = new int[1000];
           
           // å­—ç¬¦ä¸²å¸¸é‡æ± åœ¨å †ä¸­
           String str = new String("hello");  // åœ¨å †ä¸­åˆ›å»ºå¯¹è±¡
           String intern = str.intern();      // å°è¯•åœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾æˆ–åˆ›å»º
       }
   }
   ```

2. **æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰**
   ```java
   public class MethodAreaExample {
       // é™æ€å˜é‡å­˜å‚¨åœ¨æ–¹æ³•åŒº
       private static final String CONSTANT = "å¸¸é‡";
       private static String staticVar = "é™æ€å˜é‡";
       
       // ç±»ä¿¡æ¯å­˜å‚¨åœ¨æ–¹æ³•åŒº
       static class InnerClass {
           public void method() {}
       }
   }
   ```

3. **è™šæ‹Ÿæœºæ ˆï¼ˆVM Stackï¼‰**
   ```java
   public class StackExample {
       public void stackFrameDemo(int param) {
           // å±€éƒ¨å˜é‡å­˜å‚¨åœ¨æ ˆå¸§ä¸­
           int localVar = param + 1;
           
           // æ–¹æ³•è°ƒç”¨ä¼šåˆ›å»ºæ–°çš„æ ˆå¸§
           anotherMethod();
           
           // åŸºæœ¬ç±»å‹çš„å±€éƒ¨å˜é‡ç›´æ¥å­˜å‚¨åœ¨æ ˆä¸­
           int a = 1;
           long b = 2L;
           
           // å¼•ç”¨ç±»å‹çš„å˜é‡å¼•ç”¨å­˜å‚¨åœ¨æ ˆä¸­ï¼Œå¯¹è±¡å­˜å‚¨åœ¨å †ä¸­
           Object obj = new Object();
       }
       
       private void anotherMethod() {
           // æ–°çš„æ ˆå¸§
           int anotherLocal = 100;
       }
   }
   ```

### é”æœºåˆ¶è¯¦è§£
```java
/**
 * é”çš„ç±»å‹
 * 1. synchronizedï¼šå†…ç½®é”
 * 2. ReentrantLockï¼šå¯é‡å…¥é”
 * 3. ReadWriteLockï¼šè¯»å†™é”
 * 4. StampedLockï¼šé‚®æˆ³é”
 */

public class LockExample {
    // ReentrantLock ç¤ºä¾‹
    private final ReentrantLock lock = new ReentrantLock(true); // å…¬å¹³é”
    
    public void reentrantLockExample() {
        lock.lock();
        try {
            // ä¸´ç•ŒåŒºä»£ç 
        } finally {
            lock.unlock();
        }
    }
    
    // ReadWriteLock ç¤ºä¾‹
    private final ReadWriteLock rwLock = new ReentrantReadWriteLock();
    private final Lock readLock = rwLock.readLock();
    private final Lock writeLock = rwLock.writeLock();
    
    public void readWriteLockExample() {
        readLock.lock();
        try {
            // è¯»æ“ä½œ
        } finally {
            readLock.unlock();
        }
        
        writeLock.lock();
        try {
            // å†™æ“ä½œ
        } finally {
            writeLock.unlock();
        }
    }
    
    // StampedLock ç¤ºä¾‹
    private final StampedLock stampedLock = new StampedLock();
    
    public void stampedLockExample() {
        long stamp = stampedLock.tryOptimisticRead(); // ä¹è§‚è¯»
        // è¯»å–å…±äº«å˜é‡
        if (!stampedLock.validate(stamp)) { // æ£€æŸ¥æœŸé—´æ˜¯å¦æœ‰å†™æ“ä½œ
            stamp = stampedLock.readLock(); // è·å–æ‚²è§‚è¯»é”
            try {
                // è¯»å–å…±äº«å˜é‡
            } finally {
                stampedLock.unlockRead(stamp);
            }
        }
    }
}
```

### å¹¶å‘å®¹å™¨

#### ConcurrentHashMapå®ç°åŸç†ä¸æœºåˆ¶

**ConcurrentHashMapå‘å±•å†ç¨‹**

ConcurrentHashMapåœ¨ä¸åŒJDKç‰ˆæœ¬ä¸­æœ‰é‡è¦çš„æ¶æ„å˜åŒ–ï¼š

| JDKç‰ˆæœ¬ | å®ç°æ–¹å¼ | å¹¶å‘åº¦æ§åˆ¶ | é”ç²’åº¦ |
|---------|----------|------------|--------|
| **JDK 1.7** | åˆ†æ®µé”(Segment) | 16ä¸ªSegment | ä¸€ä¸ªSegmentä¸€æŠŠé” |
| **JDK 1.8** | CAS + synchronized | æ•°ç»„é•¿åº¦ | å•ä¸ªæ•°ç»„å…ƒç´ ä¸€æŠŠé” |

**JDK 1.8 ConcurrentHashMapå†…éƒ¨ç»“æ„**

```java
public class ConcurrentHashMap<K,V> extends AbstractMap<K,V>
    implements ConcurrentMap<K,V>, Serializable {
    
    // å­˜å‚¨æ•°æ®çš„æ•°ç»„
    transient volatile Node<K,V>[] table;
    
    // æ‰©å®¹æ—¶çš„ä¸´æ—¶æ•°ç»„
    private transient volatile Node<K,V>[] nextTable;
    
    // æ§åˆ¶tableçš„åˆå§‹åŒ–å’Œæ‰©å®¹
    // -1: è¡¨ç¤ºæ­£åœ¨åˆå§‹åŒ–
    // -N: è¡¨ç¤ºæœ‰N-1ä¸ªçº¿ç¨‹æ­£åœ¨æ‰©å®¹
    // 0: é»˜è®¤å€¼ï¼Œåç»­ä¼šè¢«æ›´æ–°ä¸ºn*0.75
    // >0: ä¸‹æ¬¡æ‰©å®¹çš„é˜ˆå€¼
    private transient volatile int sizeCtl;
    
    // èŠ‚ç‚¹ç±»å‹æ ‡è¯†
    static final int MOVED = -1;     // ForwardingNodeèŠ‚ç‚¹
    static final int TREEBIN = -2;   // TreeBinèŠ‚ç‚¹
    static final int RESERVED = -3;  // ReservationNodeèŠ‚ç‚¹
    
    // æ™®é€šèŠ‚ç‚¹
    static class Node<K,V> implements Map.Entry<K,V> {
        final int hash;
        final K key;
        volatile V val;
        volatile Node<K,V> next;
    }
    
    // æ ‘å½¢èŠ‚ç‚¹
    static final class TreeBin<K,V> extends Node<K,V> {
        TreeNode<K,V> root;
        volatile TreeNode<K,V> first;
        volatile Thread waiter;
        volatile int lockState;
    }
}
```

**ConcurrentHashMapå­˜å‚¨ç»“æ„å›¾**

```mermaid
graph TD
    subgraph "ConcurrentHashMap JDK1.8ç»“æ„"
        A["tableæ•°ç»„"] --> B["index 0<br/>æ™®é€šNodeé“¾è¡¨"]
        A --> C["index 1<br/>TreeBinçº¢é»‘æ ‘"]
        A --> D["index 2<br/>ForwardingNode(æ‰©å®¹ä¸­)"]
        A --> E["..."]
        
        B --> B1["Node"] --> B2["Node"] --> B3["Node"]
        
        C --> C1["TreeBin<br/>(è¯»å†™é”æ§åˆ¶)"]
        C1 --> C2["TreeNodeæ ‘ç»“æ„"]
        
        D --> D1["ForwardingNode<br/>(æŒ‡å‘æ–°table)"]
    end
    
    style B fill:#e3f2fd
    style C1 fill:#ffeb3b  
    style D1 fill:#ff9800
```

**ConcurrentHashMapçš„putæ“ä½œè¯¦è§£**

```java
final V putVal(K key, V value, boolean onlyIfAbsent) {
    if (key == null || value == null) throw new NullPointerException();
    
    int hash = spread(key.hashCode());  // é‡æ–°è®¡ç®—hash
    int binCount = 0;
    
    for (Node<K,V>[] tab = table;;) {
        Node<K,V> f; int n, i, fh;
        
        // 1. å¦‚æœtableæœªåˆå§‹åŒ–ï¼Œå…ˆåˆå§‹åŒ–
        if (tab == null || (n = tab.length) == 0)
            tab = initTable();
            
        // 2. å¦‚æœç›®æ ‡ä½ç½®ä¸ºç©ºï¼Œä½¿ç”¨CASç›´æ¥æ’å…¥
        else if ((f = tabAt(tab, i = (n - 1) & hash)) == null) {
            if (casTabAt(tab, i, null, new Node<K,V>(hash, key, value, null)))
                break;  // æ’å…¥æˆåŠŸï¼Œé€€å‡ºå¾ªç¯
        }
        
        // 3. å¦‚æœæ­£åœ¨æ‰©å®¹ï¼ŒååŠ©æ‰©å®¹
        else if ((fh = f.hash) == MOVED)
            tab = helpTransfer(tab, f);
            
        // 4. å¯¹é“¾è¡¨æˆ–çº¢é»‘æ ‘è¿›è¡Œsynchronizedæ“ä½œ
        else {
            V oldVal = null;
            synchronized (f) {  // é”å®šå¤´èŠ‚ç‚¹
                if (tabAt(tab, i) == f) {  // åŒé‡æ£€æŸ¥
                    if (fh >= 0) {  // é“¾è¡¨èŠ‚ç‚¹
                        binCount = 1;
                        for (Node<K,V> e = f;; ++binCount) {
                            K ek;
                            if (e.hash == hash &&
                                ((ek = e.key) == key || (ek != null && key.equals(ek)))) {
                                oldVal = e.val;
                                if (!onlyIfAbsent)
                                    e.val = value;
                                break;
                            }
                            Node<K,V> pred = e;
                            if ((e = e.next) == null) {
                                pred.next = new Node<K,V>(hash, key, value, null);
                                break;
                            }
                        }
                    }
                    else if (f instanceof TreeBin) {  // çº¢é»‘æ ‘èŠ‚ç‚¹
                        Node<K,V> p;
                        binCount = 2;
                        if ((p = ((TreeBin<K,V>)f).putTreeVal(hash, key, value)) != null) {
                            oldVal = p.val;
                            if (!onlyIfAbsent)
                                p.val = value;
                        }
                    }
                }
            }
            
            // 5. æ£€æŸ¥æ˜¯å¦éœ€è¦æ ‘åŒ–
            if (binCount != 0) {
                if (binCount >= TREEIFY_THRESHOLD)
                    treeifyBin(tab, i);
                if (oldVal != null)
                    return oldVal;
                break;
            }
        }
    }
    
    // 6. å¢åŠ sizeè®¡æ•°ï¼Œæ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹
    addCount(1L, binCount);
    return null;
}
```

**ConcurrentHashMapæ‰©å®¹æœºåˆ¶(transfer)**

æ‰©å®¹æ˜¯ConcurrentHashMapæœ€å¤æ‚çš„æ“ä½œï¼Œé‡‡ç”¨**å¤šçº¿ç¨‹åä½œ**æ–¹å¼ï¼š

```java
private final void transfer(Node<K,V>[] tab, Node<K,V>[] nextTab) {
    int n = tab.length, stride;
    
    // è®¡ç®—æ¯ä¸ªçº¿ç¨‹å¤„ç†çš„æ¡¶æ•°é‡
    if ((stride = (NCPU > 1) ? (n >>> 3) / NCPU : n) < MIN_TRANSFER_STRIDE)
        stride = MIN_TRANSFER_STRIDE;
        
    // åˆå§‹åŒ–æ–°æ•°ç»„
    if (nextTab == null) {
        try {
            @SuppressWarnings("unchecked")
            Node<K,V>[] nt = (Node<K,V>[])new Node<?,?>[n << 1];  // æ‰©å®¹2å€
            nextTab = nt;
        } catch (Throwable ex) {
            sizeCtl = Integer.MAX_VALUE;
            return;
        }
        nextTable = nextTab;
        transferIndex = n;  // ä»åå¾€å‰è¿ç§»
    }
    
    int nextn = nextTab.length;
    ForwardingNode<K,V> fwd = new ForwardingNode<K,V>(nextTab);
    boolean advance = true;
    boolean finishing = false;
    
    // å¤šçº¿ç¨‹åä½œè¿ç§»æ•°æ®
    for (int i = 0, bound = 0;;) {
        Node<K,V> f; int fh;
        
        // è·å–ä¸‹ä¸€ä¸ªéœ€è¦å¤„ç†çš„æ¡¶
        while (advance) {
            int nextIndex, nextBound;
            if (--i >= bound || finishing)
                advance = false;
            else if ((nextIndex = transferIndex) <= 0) {
                i = -1;
                advance = false;
            }
            else if (U.compareAndSwapInt(this, TRANSFERINDEX, nextIndex,
                                         nextBound = (nextIndex > stride ?
                                                     nextIndex - stride : 0))) {
                bound = nextBound;
                i = nextIndex - 1;
                advance = false;
            }
        }
        
        // å¤„ç†å½“å‰æ¡¶
        if ((f = tabAt(tab, i)) == null)
            advance = casTabAt(tab, i, null, fwd);  // ç©ºæ¡¶ç›´æ¥æ”¾ForwardingNode
        else if ((fh = f.hash) == MOVED)
            advance = true;  // å·²ç»è¢«å…¶ä»–çº¿ç¨‹å¤„ç†
        else {
            synchronized (f) {  // é”å®šæ—§æ¡¶
                if (tabAt(tab, i) == f) {
                    Node<K,V> ln, hn;
                    if (fh >= 0) {
                        // é“¾è¡¨è¿ç§»ï¼šåˆ†ä¸ºä½ä½é“¾å’Œé«˜ä½é“¾
                        int runBit = fh & n;
                        Node<K,V> lastRun = f;
                        for (Node<K,V> p = f.next; p != null; p = p.next) {
                            int b = p.hash & n;
                            if (b != runBit) {
                                runBit = b;
                                lastRun = p;
                            }
                        }
                        if (runBit == 0) {
                            ln = lastRun;
                            hn = null;
                        } else {
                            hn = lastRun;
                            ln = null;
                        }
                        for (Node<K,V> p = f; p != lastRun; p = p.next) {
                            int ph = p.hash; K pk = p.key; V pv = p.val;
                            if ((ph & n) == 0)
                                ln = new Node<K,V>(ph, pk, pv, ln);
                            else
                                hn = new Node<K,V>(ph, pk, pv, hn);
                        }
                        setTabAt(nextTab, i, ln);
                        setTabAt(nextTab, i + n, hn);
                        setTabAt(tab, i, fwd);
                        advance = true;
                    }
                    else if (f instanceof TreeBin) {
                        // çº¢é»‘æ ‘è¿ç§»
                        TreeBin<K,V> t = (TreeBin<K,V>)f;
                        TreeNode<K,V> lo = null, loTail = null;
                        TreeNode<K,V> hi = null, hiTail = null;
                        // ... æ ‘çš„åˆ†ç¦»é€»è¾‘
                    }
                }
            }
        }
    }
}
```

**ConcurrentHashMapçš„sizeè®¡ç®—**

ç”±äºå¹¶å‘ç‰¹æ€§ï¼ŒConcurrentHashMapä½¿ç”¨**åˆ†æ®µè®¡æ•°**æ–¹å¼ï¼š

```java
// ä½¿ç”¨CounterCellæ•°ç»„åˆ†æ•£è®¡æ•°ï¼Œå‡å°‘ç«äº‰
@sun.misc.Contended static final class CounterCell {
    volatile long value;
    CounterCell(long x) { value = x; }
}

private transient volatile CounterCell[] counterCells;
private transient volatile long baseCount;

// è·å–å½“å‰å¤§å°
public int size() {
    long n = sumCount();
    return ((n < 0L) ? 0 : (n > (long)Integer.MAX_VALUE) ? Integer.MAX_VALUE : (int)n);
}

final long sumCount() {
    CounterCell[] as = counterCells; CounterCell a;
    long sum = baseCount;
    if (as != null) {
        for (int i = 0; i < as.length; ++i) {
            if ((a = as[i]) != null)
                sum += a.value;
        }
    }
    return sum;
}
```

**ConcurrentHashMapå¹¶å‘æ§åˆ¶æœºåˆ¶æ€»ç»“**

```mermaid
flowchart TD
    A["ConcurrentHashMapå¹¶å‘æ§åˆ¶"] --> B["æ— é”æ“ä½œ"]
    A --> C["ç»†ç²’åº¦é”"]
    A --> D["åä½œå¼æ‰©å®¹"]
    
    B --> B1["CASæ“ä½œ<br/>â€¢æ•°ç»„å…ƒç´ è®¾ç½®<br/>â€¢sizeè®¡æ•°<br/>â€¢æ‰©å®¹æ ‡è¯†"]
    
    C --> C1["synchronizedé”<br/>â€¢é”å®šé“¾è¡¨å¤´èŠ‚ç‚¹<br/>â€¢é”å®šTreeBinèŠ‚ç‚¹<br/>â€¢æœ€å°åŒ–é”èŒƒå›´"]
    
    D --> D1["å¤šçº¿ç¨‹åä½œ<br/>â€¢åˆ†æ®µè¿ç§»æ•°æ®<br/>â€¢ForwardingNodeæ ‡è¯†<br/>â€¢åŠ¨æ€è´Ÿè½½å‡è¡¡"]
    
    style B1 fill:#4caf50
    style C1 fill:#ffeb3b
    style D1 fill:#ff9800
```

**ConcurrentHashMapæ€§èƒ½ä¼˜åŠ¿åˆ†æ**

| ç‰¹æ€§ | HashMap | ConcurrentHashMap | è¯´æ˜ |
|------|---------|------------------|------|
| **çº¿ç¨‹å®‰å…¨** | å¦ | æ˜¯ | ConcurrentHashMapæ”¯æŒå¹¶å‘è¯»å†™ |
| **é”ç²’åº¦** | æ— é” | æ¡¶çº§åˆ«é” | åªé”å®šæ“ä½œçš„å…·ä½“æ¡¶ä½ç½® |
| **è¯»æ“ä½œ** | æ— é” | æ— é” | è¯»æ“ä½œå®Œå…¨æ— é”ï¼Œæ€§èƒ½æ¥è¿‘HashMap |
| **å†™æ“ä½œ** | æ— é” | CAS+synchronized | å†²çªæ—¶æ‰ä½¿ç”¨é” |
| **æ‰©å®¹** | å•çº¿ç¨‹ | å¤šçº¿ç¨‹åä½œ | å¤šçº¿ç¨‹å¹¶è¡Œè¿ç§»ï¼Œæ‰©å®¹æ›´å¿« |
| **å†…å­˜å ç”¨** | è¾ƒå°‘ | è¾ƒå¤š | é¢å¤–çš„å¹¶å‘æ§åˆ¶ç»“æ„å¼€é”€ |

```java
/**
 * å…¶ä»–å¹¶å‘å®¹å™¨ç¤ºä¾‹
 */
public class OtherConcurrentContainers {
    
    // CopyOnWriteArrayListï¼šå†™æ—¶å¤åˆ¶çš„ArrayList
    private CopyOnWriteArrayList<String> cowList = new CopyOnWriteArrayList<>();
    
    public void copyOnWriteDemo() {
        // è¯»æ“ä½œæ— é”ï¼Œå†™æ“ä½œå¤åˆ¶æ•´ä¸ªæ•°ç»„
        cowList.add("item1");  // ä¼šå¤åˆ¶æ•°ç»„
        
        // é€‚ç”¨åœºæ™¯ï¼šè¯»å¤šå†™å°‘
        for (String item : cowList) {  // éå†æ—¶ä¸ä¼šè¢«å†™æ“ä½œå½±å“
            System.out.println(item);
        }
    }
    
    // BlockingQueueï¼šé˜»å¡é˜Ÿåˆ—
    private BlockingQueue<Task> taskQueue = new LinkedBlockingQueue<>(100);
    
    public void blockingQueueOperations() {
        // ç”Ÿäº§è€…
        try {
            taskQueue.put(new Task());  // é˜»å¡ç›´åˆ°æœ‰ç©ºé—´
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
        
        // æ¶ˆè´¹è€…
        try {
            Task task = taskQueue.take();  // é˜»å¡ç›´åˆ°æœ‰å…ƒç´ 
            processTask(task);
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
    }
    
    // ConcurrentSkipListMapï¼šè·³è¡¨å®ç°çš„æœ‰åºæ˜ å°„
    private ConcurrentSkipListMap<String, Integer> skipListMap = new ConcurrentSkipListMap<>();
    
    public void skipListMapDemo() {
        skipListMap.put("key1", 1);
        skipListMap.put("key2", 2);
        
        // æ”¯æŒé«˜æ•ˆçš„èŒƒå›´æŸ¥è¯¢
        NavigableMap<String, Integer> subMap = skipListMap.subMap("key1", true, "key2", false);
    }
}
```
### åŸå­æ“ä½œç±»
```java
/**
 * åŸå­ç±»å‹
 * 1. AtomicInteger/Long/Booleanï¼šåŸºæœ¬ç±»å‹åŸå­ç±»
 * 2. AtomicReferenceï¼šå¼•ç”¨ç±»å‹åŸå­ç±»
 * 3. AtomicIntegerArrayï¼šæ•°ç»„å…ƒç´ åŸå­æ“ä½œ
 * 4. AtomicIntegerFieldUpdaterï¼šå¯¹è±¡å­—æ®µåŸå­æ›´æ–°
 */

public class AtomicExample {
    // AtomicInteger ç¤ºä¾‹
    private AtomicInteger counter = new AtomicInteger(0);
    
    public void atomicOperations() {
        // åŸå­é€’å¢
        counter.incrementAndGet();
        // CASæ“ä½œ
        counter.compareAndSet(1, 2);
        // åŸå­æ›´æ–°
        counter.updateAndGet(x -> x * 2);
    }
    
    // AtomicReference ç¤ºä¾‹
    private AtomicReference<User> userRef = new AtomicReference<>();
    
    public void atomicReferenceOperations() {
        User user = new User("John");
        userRef.set(user);
        
        // CASæ›´æ–°
        User oldUser = userRef.get();
        User newUser = new User("Jane");
        userRef.compareAndSet(oldUser, newUser);
    }
}
```

## é›†åˆæ¡†æ¶

### é›†åˆæ¡†æ¶æ¦‚è§ˆ

Java é›†åˆæ¡†æ¶çš„æ•´ä½“ç»“æ„å¦‚ä¸‹ï¼š

```mermaid
flowchart TD
    subgraph "ğŸ“š Javaé›†åˆæ¡†æ¶ä½“ç³»" ["Javaé›†åˆæ¡†æ¶ä½“ç³»"]
        Framework["ğŸ’» Javaé›†åˆæ¡†æ¶"] -->|"å•åˆ—å®¹å™¨+ç»§æ‰¿å…³ç³»+å…¬å…±æ“ä½œ"| Collection["ğŸ“š Collectionæ¥å£"]
        Framework -->|"é”®å€¼å¯¹å­˜å‚¨+ä¸ç»§æ‰¿Collection+ç‹¬ç«‹ä½“ç³»"| Map["ğŸ—ºï¸ Mapæ¥å£"]
    end
    
    subgraph "ğŸ“ƒ Collectionç³»åˆ—é›†åˆ" ["Collectionç³»åˆ—é›†åˆ"]
        Collection -->|"æœ‰åºå®¹å™¨+å…è®¸é‡å¤+ç´¢å¼•è®¿é—®"| List["ğŸ“‹ Listæ¥å£"]
        Collection -->|"æ— åºå®¹å™¨+ä¸å…è®¸é‡å¤+å”¯ä¸€æ€§ä¿éšœ"| Set["ğŸŒŸ Setæ¥å£"]
        Collection -->|"é˜Ÿåˆ—å®¹å™¨+FIFO/LIFO+å…ˆè¿›å…ˆå‡º"| Queue["ğŸ—¡ï¸ Queueæ¥å£"]
        
        List -->|"åŠ¨æ€æ•°ç»„+O(1)éšæœºè®¿é—®+1.5å€æ‰©å®¹"| ArrayList["ArrayList"]
        List -->|"åŒå‘é“¾è¡¨+O(1)æ’å…¥åˆ é™¤+èŠ‚ç‚¹å­˜å‚¨"| LinkedList["LinkedList"]
        List -->|"åŒæ­¥ArrayList+çº¿ç¨‹å®‰å…¨+æ€§èƒ½è¾ƒä½"| Vector["Vector"]
        
        Set -->|"å“ˆå¸Œè¡¨å®ç°+O(1)æ“ä½œ+æ— åºå­˜å‚¨"| HashSet["HashSet"]
        Set -->|"çº¢é»‘æ ‘å®ç°+O(logn)æ“ä½œ+æœ‰åºå­˜å‚¨"| TreeSet["TreeSet"]
        Set -->|"å“ˆå¸Œè¡¨+åŒå‘é“¾è¡¨+æ’å…¥é¡ºåº"| LinkedHashSet["LinkedHashSet"]
        
        Queue -->|"ä¼˜å…ˆçº§é˜Ÿåˆ—+å †ç»“æ„+è‡ªç„¶æ’åº"| PriorityQueue["PriorityQueue"]
        Queue -->|"åŒç«¯é˜Ÿåˆ—+å¤´å°¾æ“ä½œ+åŠ¨æ€æ•°ç»„"| ArrayDeque["ArrayDeque"]
        Queue -->|"é˜»å¡é˜Ÿåˆ—+å¹¶å‘å®‰å…¨+ç”Ÿäº§è€…æ¶ˆè´¹è€…"| BlockingQueue["BlockingQueue"]
    end
    
    subgraph "ğŸ—ºï¸ Mapç³»åˆ—é›†åˆ" ["Mapç³»åˆ—é›†åˆ"]
        Map -->|"å“ˆå¸Œè¡¨å®ç°+O(1)æ“ä½œ+æ— åºå­˜å‚¨"| HashMap["HashMap"]
        Map -->|"çº¢é»‘æ ‘å®ç°+O(logn)æ“ä½œ+Keyæ’åº"| TreeMap["TreeMap"]
        Map -->|"å“ˆå¸Œè¡¨+åŒå‘é“¾è¡¨+æ’å…¥é¡ºåº"| LinkedHashMap["LinkedHashMap"]
        Map -->|"åˆ†æ®µé”æœºåˆ¶+å¹¶å‘å®‰å…¨+é«˜æ€§èƒ½"| ConcurrentHashMap["ConcurrentHashMap"]
    end
    
    %% æ ·å¼è®¾ç½®
    style Framework fill:#E3F2FD,stroke:#1976D2,stroke-width:2px
    style Collection fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px
    style Map fill:#FFF3E0,stroke:#F57C00,stroke-width:2px
    style List fill:#E8F5E8,stroke:#388E3C,stroke-width:2px
    style Set fill:#FCE4EC,stroke:#C2185B,stroke-width:2px
    style Queue fill:#E0F2F1,stroke:#00695C,stroke-width:2px
```

### Listé›†åˆ

#### ArrayListå®ç°åŸç†ä¸æœºåˆ¶

**å†…éƒ¨æ•°æ®ç»“æ„**

ArrayListåŸºäº**åŠ¨æ€æ•°ç»„**å®ç°ï¼Œå…¶æ ¸å¿ƒæ˜¯ä¸€ä¸ªObjectæ•°ç»„ï¼Œé€šè¿‡æ•°ç»„ä¸‹æ ‡è¿›è¡Œå…ƒç´ è®¿é—®ã€‚

```java
public class ArrayList<E> extends AbstractList<E> 
    implements List<E>, RandomAccess, Cloneable, java.io.Serializable {
    
    // é»˜è®¤åˆå§‹å®¹é‡
    private static final int DEFAULT_CAPACITY = 10;
    
    // ç©ºæ•°ç»„å®ä¾‹ï¼Œç”¨äºç©ºæ„é€ å‡½æ•°
    private static final Object[] EMPTY_ELEMENTDATA = {};
    
    // é»˜è®¤å¤§å°çš„ç©ºæ•°ç»„å®ä¾‹
    private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {};
    
    // å­˜å‚¨ArrayListå…ƒç´ çš„æ•°ç»„ç¼“å†²åŒº
    transient Object[] elementData;
    
    // ArrayListä¸­å…ƒç´ çš„æ•°é‡
    private int size;
    
    // æ•°ç»„å¯åˆ†é…çš„æœ€å¤§å¤§å°
    private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8;
}
```

**ArrayListæ‰©å®¹æœºåˆ¶è¯¦è§£**

```mermaid
graph TD
    A["æ·»åŠ å…ƒç´  add(E)"] --> B["æ£€æŸ¥å®¹é‡ ensureCapacityInternal()"]
    B --> C{"size + 1 > elementData.length?"}
    C -->|å¦| D["ç›´æ¥æ·»åŠ å…ƒç´ "]
    C -->|æ˜¯| E["éœ€è¦æ‰©å®¹ grow()"]
    E --> F["è®¡ç®—æ–°å®¹é‡ newCapacity"]
    F --> G["newCapacity = oldCapacity + (oldCapacity >> 1)"]
    G --> H{"newCapacity > MAX_ARRAY_SIZE?"}
    H -->|æ˜¯| I["ä½¿ç”¨ hugeCapacity()"]
    H -->|å¦| J["ä½¿ç”¨è®¡ç®—çš„æ–°å®¹é‡"]
    I --> K["Arrays.copyOf() åˆ›å»ºæ–°æ•°ç»„"]
    J --> K
    K --> L["å¤åˆ¶åŸæ•°ç»„å†…å®¹åˆ°æ–°æ•°ç»„"]
    L --> M["æ·»åŠ æ–°å…ƒç´ "]
    
    style E fill:#ffeb3b
    style G fill:#4caf50
    style K fill:#f44336
```

**æ‰©å®¹å…³é”®ä»£ç å®ç°**ï¼š

```java
// ç¡®ä¿å†…éƒ¨å®¹é‡
private void ensureCapacityInternal(int minCapacity) {
    ensureExplicitCapacity(calculateCapacity(elementData, minCapacity));
}

// è®¡ç®—å®¹é‡
private static int calculateCapacity(Object[] elementData, int minCapacity) {
    // å¦‚æœæ˜¯é»˜è®¤ç©ºæ•°ç»„ï¼Œè¿”å›é»˜è®¤å®¹é‡å’Œæœ€å°å®¹é‡çš„è¾ƒå¤§å€¼
    if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) {
        return Math.max(DEFAULT_CAPACITY, minCapacity);
    }
    return minCapacity;
}

// æ ¸å¿ƒæ‰©å®¹æ–¹æ³•
private void grow(int minCapacity) {
    int oldCapacity = elementData.length;
    
    // æ–°å®¹é‡ = åŸå®¹é‡ + åŸå®¹é‡/2 (å³1.5å€æ‰©å®¹)
    int newCapacity = oldCapacity + (oldCapacity >> 1);
    
    // å¦‚æœè®¡ç®—çš„æ–°å®¹é‡å°äºæœ€å°éœ€è¦å®¹é‡ï¼Œä½¿ç”¨æœ€å°éœ€è¦å®¹é‡
    if (newCapacity - minCapacity < 0)
        newCapacity = minCapacity;
        
    // å¦‚æœæ–°å®¹é‡å¤§äºæœ€å¤§æ•°ç»„å¤§å°ï¼Œè¿›è¡Œè¾¹ç•Œå¤„ç†
    if (newCapacity - MAX_ARRAY_SIZE > 0)
        newCapacity = hugeCapacity(minCapacity);
        
    // åˆ›å»ºæ–°æ•°ç»„å¹¶å¤åˆ¶åŸæ•°ç»„å†…å®¹
    elementData = Arrays.copyOf(elementData, newCapacity);
}

// è¶…å¤§å®¹é‡å¤„ç†
private static int hugeCapacity(int minCapacity) {
    if (minCapacity < 0) // overflow
        throw new OutOfMemoryError();
    return (minCapacity > MAX_ARRAY_SIZE) ?
        Integer.MAX_VALUE :
        MAX_ARRAY_SIZE;
}
```

**ArrayListæ·»åŠ å…ƒç´ çš„å®Œæ•´æµç¨‹**ï¼š

```java
// æ·»åŠ å…ƒç´ åˆ°æœ«å°¾
public boolean add(E e) {
    ensureCapacityInternal(size + 1);  // ç¡®ä¿å®¹é‡è¶³å¤Ÿ
    elementData[size++] = e;           // åœ¨æœ«å°¾æ·»åŠ å…ƒç´ 
    return true;
}

// åœ¨æŒ‡å®šä½ç½®æ·»åŠ å…ƒç´ 
public void add(int index, E element) {
    rangeCheckForAdd(index);           // æ£€æŸ¥ç´¢å¼•è¾¹ç•Œ
    
    ensureCapacityInternal(size + 1);  // ç¡®ä¿å®¹é‡è¶³å¤Ÿ
    
    // å°†indexä¹‹åçš„å…ƒç´ åç§»ä¸€ä½
    System.arraycopy(elementData, index, elementData, index + 1, size - index);
    elementData[index] = element;      // æ’å…¥æ–°å…ƒç´ 
    size++;
}
```

**ArrayListåˆ é™¤å…ƒç´ æœºåˆ¶**ï¼š

```java
// åˆ é™¤æŒ‡å®šä½ç½®çš„å…ƒç´ 
public E remove(int index) {
    rangeCheck(index);                 // æ£€æŸ¥è¾¹ç•Œ
    
    modCount++;                        // ä¿®æ”¹è®¡æ•°å™¨++
    E oldValue = (E) elementData[index]; // è·å–è¢«åˆ é™¤çš„å…ƒç´ 
    
    int numMoved = size - index - 1;   // è®¡ç®—éœ€è¦ç§»åŠ¨çš„å…ƒç´ æ•°é‡
    if (numMoved > 0)
        // å°†index+1ä¹‹åçš„å…ƒç´ å‰ç§»ä¸€ä½
        System.arraycopy(elementData, index+1, elementData, index, numMoved);
        
    elementData[--size] = null;        // æ¸…é™¤æœ€åä¸€ä¸ªå…ƒç´ å¼•ç”¨ï¼ŒGC
    
    return oldValue;
}
```

**ArrayListæ€§èƒ½ç‰¹ç‚¹åˆ†æ**ï¼š

| æ“ä½œ | æ—¶é—´å¤æ‚åº¦ | ç©ºé—´å¤æ‚åº¦ | è¯´æ˜ |
|------|------------|------------|------|
| **get(index)** | O(1) | O(1) | ç›´æ¥æ•°ç»„ä¸‹æ ‡è®¿é—® |
| **add(element)** | O(1)å‡æ‘Š | O(1) | æœ«å°¾æ·»åŠ ï¼Œå¯èƒ½è§¦å‘æ‰©å®¹ |
| **add(index, element)** | O(n) | O(1) | éœ€è¦ç§»åŠ¨åç»­å…ƒç´  |
| **remove(index)** | O(n) | O(1) | éœ€è¦ç§»åŠ¨åç»­å…ƒç´  |
| **contains(element)** | O(n) | O(1) | éœ€è¦éå†æŸ¥æ‰¾ |
| **æ‰©å®¹æ“ä½œ** | O(n) | O(n) | åˆ›å»ºæ–°æ•°ç»„å¹¶å¤åˆ¶ |

#### LinkedListå®ç°åŸç†ä¸æœºåˆ¶

**å†…éƒ¨æ•°æ®ç»“æ„**

LinkedListåŸºäº**åŒå‘é“¾è¡¨**å®ç°ï¼Œæ¯ä¸ªèŠ‚ç‚¹åŒ…å«æ•°æ®ã€å‰é©±æŒ‡é’ˆå’Œåç»§æŒ‡é’ˆã€‚

```java
public class LinkedList<E> extends AbstractSequentialList<E>
    implements List<E>, Deque<E>, Cloneable, java.io.Serializable {
    
    transient int size = 0;        // é“¾è¡¨å¤§å°
    transient Node<E> first;       // å¤´èŠ‚ç‚¹
    transient Node<E> last;        // å°¾èŠ‚ç‚¹
    
    // åŒå‘é“¾è¡¨èŠ‚ç‚¹ç»“æ„
    private static class Node<E> {
        E item;           // å­˜å‚¨çš„æ•°æ®
        Node<E> next;     // æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
        Node<E> prev;     // æŒ‡å‘ä¸Šä¸€ä¸ªèŠ‚ç‚¹
        
        Node(Node<E> prev, E element, Node<E> next) {
            this.item = element;
            this.next = next;
            this.prev = prev;
        }
    }
}
```

**LinkedListåŒå‘é“¾è¡¨ç»“æ„å›¾**ï¼š

```mermaid
graph LR
    subgraph "LinkedListå†…éƒ¨ç»“æ„"
        H[first] --> A
        T[last] --> C
        
        A[Node1<br/>prev: null<br/>item: data1<br/>next: â†’] --> B[Node2<br/>prev: â†<br/>item: data2<br/>next: â†’]
        B --> C[Node3<br/>prev: â†<br/>item: data3<br/>next: null]
        
        B --> A
        C --> B
    end
    
    style A fill:#e3f2fd
    style B fill:#e8f5e9
    style C fill:#fff3e0
    style H fill:#f3e5f5
    style T fill:#f3e5f5
```

**LinkedListæ·»åŠ å…ƒç´ å®ç°**ï¼š

```java
// åœ¨é“¾è¡¨æœ«å°¾æ·»åŠ å…ƒç´ 
public boolean add(E e) {
    linkLast(e);
    return true;
}

// åœ¨æœ«å°¾æ·»åŠ èŠ‚ç‚¹çš„æ ¸å¿ƒæ–¹æ³•
void linkLast(E e) {
    final Node<E> l = last;                    // ä¿å­˜å½“å‰å°¾èŠ‚ç‚¹
    final Node<E> newNode = new Node<>(l, e, null); // åˆ›å»ºæ–°èŠ‚ç‚¹
    last = newNode;                            // æ–°èŠ‚ç‚¹æˆä¸ºå°¾èŠ‚ç‚¹
    
    if (l == null)                             // é“¾è¡¨ä¸ºç©º
        first = newNode;
    else
        l.next = newNode;                      // åŸå°¾èŠ‚ç‚¹æŒ‡å‘æ–°èŠ‚ç‚¹
    
    size++;
    modCount++;
}

// åœ¨æŒ‡å®šä½ç½®æ’å…¥å…ƒç´ 
public void add(int index, E element) {
    checkPositionIndex(index);                 // æ£€æŸ¥ç´¢å¼•
    
    if (index == size)
        linkLast(element);                     // åœ¨æœ«å°¾æ’å…¥
    else
        linkBefore(element, node(index));      // åœ¨ä¸­é—´æ’å…¥
}

// åœ¨æŒ‡å®šèŠ‚ç‚¹å‰æ’å…¥æ–°èŠ‚ç‚¹
void linkBefore(E e, Node<E> succ) {
    final Node<E> pred = succ.prev;           // è·å–å‰é©±èŠ‚ç‚¹
    final Node<E> newNode = new Node<>(pred, e, succ); // åˆ›å»ºæ–°èŠ‚ç‚¹
    succ.prev = newNode;                      // åç»§èŠ‚ç‚¹æŒ‡å‘æ–°èŠ‚ç‚¹
    
    if (pred == null)
        first = newNode;                      // æ’å…¥åˆ°å¤´éƒ¨
    else
        pred.next = newNode;                  // å‰é©±èŠ‚ç‚¹æŒ‡å‘æ–°èŠ‚ç‚¹
        
    size++;
    modCount++;
}
```

**LinkedListæŸ¥æ‰¾å…ƒç´ æœºåˆ¶**ï¼š

```java
// æ ¹æ®ç´¢å¼•è·å–èŠ‚ç‚¹ï¼ˆäºŒåˆ†æŸ¥æ‰¾ä¼˜åŒ–ï¼‰
Node<E> node(int index) {
    // äºŒåˆ†æŸ¥æ‰¾ä¼˜åŒ–ï¼šä»å‰åŠéƒ¨åˆ†æˆ–ååŠéƒ¨åˆ†å¼€å§‹éå†
    if (index < (size >> 1)) {
        Node<E> x = first;
        for (int i = 0; i < index; i++)
            x = x.next;
        return x;
    } else {
        Node<E> x = last;
        for (int i = size - 1; i > index; i--)
            x = x.prev;
        return x;
    }
}

// è·å–æŒ‡å®šä½ç½®çš„å…ƒç´ 
public E get(int index) {
    checkElementIndex(index);
    return node(index).item;
}
```

**LinkedListåˆ é™¤å…ƒç´ å®ç°**ï¼š

```java
// åˆ é™¤æŒ‡å®šä½ç½®çš„å…ƒç´ 
public E remove(int index) {
    checkElementIndex(index);
    return unlink(node(index));
}

// åˆ é™¤æŒ‡å®šèŠ‚ç‚¹
E unlink(Node<E> x) {
    final E element = x.item;
    final Node<E> next = x.next;
    final Node<E> prev = x.prev;
    
    // å¤„ç†å‰é©±èŠ‚ç‚¹
    if (prev == null) {
        first = next;
    } else {
        prev.next = next;
        x.prev = null;                        // æ–­å¼€å¼•ç”¨ï¼Œå¸®åŠ©GC
    }
    
    // å¤„ç†åç»§èŠ‚ç‚¹
    if (next == null) {
        last = prev;
    } else {
        next.prev = prev;
        x.next = null;                        // æ–­å¼€å¼•ç”¨ï¼Œå¸®åŠ©GC
    }
    
    x.item = null;                            // æ¸…é™¤æ•°æ®å¼•ç”¨
    size--;
    modCount++;
    return element;
}
```

**LinkedListä½œä¸ºé˜Ÿåˆ—å’Œæ ˆçš„å®ç°**ï¼š

```java
// é˜Ÿåˆ—æ“ä½œï¼ˆFIFOï¼‰
public boolean offer(E e) {
    return add(e);                            // åœ¨æœ«å°¾æ·»åŠ 
}

public E poll() {
    final Node<E> f = first;
    return (f == null) ? null : unlinkFirst(f); // ä»å¤´éƒ¨ç§»é™¤
}

public E peek() {
    final Node<E> f = first;
    return (f == null) ? null : f.item;       // æŸ¥çœ‹å¤´éƒ¨å…ƒç´ 
}

// æ ˆæ“ä½œï¼ˆLIFOï¼‰
public void push(E e) {
    addFirst(e);                              // åœ¨å¤´éƒ¨æ·»åŠ 
}

public E pop() {
    return removeFirst();                     // ä»å¤´éƒ¨ç§»é™¤
}

// åŒç«¯é˜Ÿåˆ—æ“ä½œ
public void addFirst(E e) {
    linkFirst(e);
}

public void addLast(E e) {
    linkLast(e);
}
```

**ArrayList vs LinkedListæ€§èƒ½å¯¹æ¯”**ï¼š

```mermaid
graph TD
    A["æ“ä½œç±»å‹"] --> B["éšæœºè®¿é—® get(index)"]
    A --> C["æœ«å°¾æ·»åŠ  add(element)"] 
    A --> D["ä¸­é—´æ’å…¥ add(index, element)"]
    A --> E["åˆ é™¤å…ƒç´  remove(index)"]
    A --> F["å†…å­˜å ç”¨"]
    
    B --> B1["ArrayList: O(1)<br/>æ•°ç»„ä¸‹æ ‡ç›´æ¥è®¿é—®"]
    B --> B2["LinkedList: O(n)<br/>éœ€è¦éå†é“¾è¡¨"]
    
    C --> C1["ArrayList: O(1)å‡æ‘Š<br/>å¯èƒ½è§¦å‘æ‰©å®¹O(n)"]
    C --> C2["LinkedList: O(1)<br/>ç›´æ¥ä¿®æ”¹æŒ‡é’ˆ"]
    
    D --> D1["ArrayList: O(n)<br/>éœ€è¦ç§»åŠ¨åç»­å…ƒç´ "]
    D --> D2["LinkedList: O(n)<br/>éœ€è¦å…ˆå®šä½åˆ°ä½ç½®"]
    
    E --> E1["ArrayList: O(n)<br/>éœ€è¦ç§»åŠ¨åç»­å…ƒç´ "]
    E --> E2["LinkedList: O(n)<br/>éœ€è¦å…ˆå®šä½åˆ°ä½ç½®"]
    
    F --> F1["ArrayList: è¾ƒå°‘<br/>åªå­˜å‚¨å…ƒç´ å¼•ç”¨"]
    F --> F2["LinkedList: è¾ƒå¤š<br/>é¢å¤–å­˜å‚¨prev/nextæŒ‡é’ˆ"]
    
    style B1 fill:#4caf50
    style B2 fill:#f44336
    style C1 fill:#4caf50
    style C2 fill:#4caf50
    style D1 fill:#f44336
    style D2 fill:#f44336
    style E1 fill:#f44336
    style E2 fill:#f44336
    style F1 fill:#4caf50
    style F2 fill:#f44336
```

#### çº¿ç¨‹å®‰å…¨çš„Listå®ç°
```java
public class ThreadSafeListExample {
    /**
     * CopyOnWriteArrayList
     * é€‚ç”¨åœºæ™¯ï¼šè¯»å¤šå†™å°‘ï¼Œæ•°æ®é‡è¾ƒå°
     * ç‰¹ç‚¹ï¼šå†™æ—¶å¤åˆ¶ï¼Œè¯»å†™åˆ†ç¦»
     */
    public void copyOnWriteArrayListDemo() {
        CopyOnWriteArrayList<String> list = new CopyOnWriteArrayList<>();
        
        // çº¿ç¨‹å®‰å…¨çš„æ·»åŠ 
        list.add("A");
        list.addIfAbsent("B");  // å…ƒç´ ä¸å­˜åœ¨æ—¶æ‰æ·»åŠ 
        
        // æ‰¹é‡æ·»åŠ 
        list.addAllAbsent(Arrays.asList("C", "D"));
    }
    
    /**
     * Vectorï¼ˆä¸æ¨èä½¿ç”¨ï¼‰
     * ç‰¹ç‚¹ï¼šæ‰€æœ‰æ–¹æ³•åŒæ­¥ï¼Œæ€§èƒ½è¾ƒå·®
     */
    public void vectorDemo() {
        Vector<String> vector = new Vector<>();
        vector.add("A");
        vector.elementAt(0);
    }
}
```

### Seté›†åˆ

#### HashSetå®ç°åŸç†ä¸æœºåˆ¶

**HashSetæ ¸å¿ƒç‰¹ç‚¹**ï¼š
- **æ— åºå­˜å‚¨**ï¼šä¸ä¿è¯å…ƒç´ çš„å­˜å‚¨é¡ºåº
- **ä¸å…è®¸é‡å¤**ï¼šåŸºäºequals()å’ŒhashCode()åˆ¤æ–­
- **å…è®¸nullå€¼**ï¼šæœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªnullå…ƒç´ 
- **éçº¿ç¨‹å®‰å…¨**ï¼šå¤šçº¿ç¨‹ç¯å¢ƒéœ€è¦å¤–éƒ¨åŒæ­¥
- **åŸºäºHashMap**ï¼šå†…éƒ¨ä½¿ç”¨HashMapå­˜å‚¨å…ƒç´ 

**HashSetå†…éƒ¨æ•°æ®ç»“æ„**

```java
public class HashSet<E> extends AbstractSet<E>
    implements Set<E>, Cloneable, java.io.Serializable {
    
    // å†…éƒ¨ä½¿ç”¨HashMapå­˜å‚¨æ•°æ®
    private transient HashMap<E,Object> map;
    
    // è™šæ‹Ÿå€¼å¯¹è±¡ï¼Œç”¨ä½œHashMapçš„value
    private static final Object PRESENT = new Object();
    
    // é»˜è®¤æ„é€ æ–¹æ³•
    public HashSet() {
        map = new HashMap<>();
    }
    
    // æŒ‡å®šåˆå§‹å®¹é‡å’Œè´Ÿè½½å› å­
    public HashSet(int initialCapacity, float loadFactor) {
        map = new HashMap<>(initialCapacity, loadFactor);
    }
}
```

**HashSetå…³é”®æ“ä½œå®ç°**

```java
// æ·»åŠ å…ƒç´ 
public boolean add(E e) {
    // ä½¿ç”¨HashMapçš„putæ–¹æ³•ï¼Œå…ƒç´ ä½œä¸ºkeyï¼ŒPRESENTä½œä¸ºvalue
    return map.put(e, PRESENT) == null;
}

// åˆ é™¤å…ƒç´ 
public boolean remove(Object o) {
    return map.remove(o) == PRESENT;
}

// æ£€æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨
public boolean contains(Object o) {
    return map.containsKey(o);
}

// è·å–é›†åˆå¤§å°
public int size() {
    return map.size();
}

// æ¸…ç©ºé›†åˆ
public void clear() {
    map.clear();
}
```

**HashSetå»é‡åŸç†è¯¦è§£**

HashSeté€šè¿‡**equals()å’ŒhashCode()**ä¸¤ä¸ªæ–¹æ³•æ¥åˆ¤æ–­å…ƒç´ æ˜¯å¦é‡å¤ï¼š

```mermaid
flowchart TD
    A["æ·»åŠ å…ƒç´  add(e)"] --> B["è®¡ç®— e.hashCode()"]
    B --> C["æ ¹æ®hashCodeç¡®å®šå­˜å‚¨ä½ç½®"]
    C --> D{è¯¥ä½ç½®å·²æœ‰å…ƒç´ ?}
    
    D -->|å¦| E["ç›´æ¥æ·»åŠ å…ƒç´ "]
    D -->|æ˜¯| F["è°ƒç”¨ e.equals(existing)"]
    
    F --> G{equals()è¿”å›true?}
    G -->|æ˜¯| H["å…ƒç´ é‡å¤ï¼Œä¸æ·»åŠ "]
    G -->|å¦| I["æ·»åŠ åˆ°åŒä¸€ä½ç½®çš„é“¾è¡¨/æ ‘ä¸­"]
    
    E --> J["æ·»åŠ æˆåŠŸ"]
    I --> J
    H --> K["æ·»åŠ å¤±è´¥"]
```

**è‡ªå®šä¹‰å¯¹è±¡çš„HashSetä½¿ç”¨**

```java
public class Person {
    private String name;
    private int age;
    
    // å¿…é¡»é‡å†™equalsæ–¹æ³•
    @Override
    public boolean equals(Object obj) {
        if (this == obj) return true;
        if (obj == null || getClass() != obj.getClass()) return false;
        
        Person person = (Person) obj;
        return age == person.age && Objects.equals(name, person.name);
    }
    
    // å¿…é¡»é‡å†™hashCodeæ–¹æ³•
    @Override
    public int hashCode() {
        return Objects.hash(name, age);
    }
}

// ä½¿ç”¨ç¤ºä¾‹
public void customObjectDemo() {
    HashSet<Person> personSet = new HashSet<>();
    personSet.add(new Person("John", 25));
    personSet.add(new Person("John", 25)); // é‡å¤å…ƒç´ ï¼Œä¸ä¼šæ·»åŠ 
    
    System.out.println(personSet.size()); // è¾“å‡ºï¼š1
}
```

#### TreeSetå®ç°åŸç†ä¸æœºåˆ¶

**TreeSetæ ¸å¿ƒç‰¹ç‚¹**ï¼š
- **æœ‰åºå­˜å‚¨**ï¼šæŒ‰ç…§å…ƒç´ çš„è‡ªç„¶é¡ºåºæˆ–Comparatoræ’åº
- **ä¸å…è®¸é‡å¤**ï¼šåŸºäºComparator.compare()æˆ–Comparable.compareTo()åˆ¤æ–­
- **ä¸å…è®¸nullå€¼**ï¼šTreeSetä¸å…è®¸nullå…ƒç´ 
- **éçº¿ç¨‹å®‰å…¨**ï¼šå¤šçº¿ç¨‹ç¯å¢ƒéœ€è¦å¤–éƒ¨åŒæ­¥
- **åŸºäºTreeMap**ï¼šå†…éƒ¨ä½¿ç”¨TreeMapå­˜å‚¨å…ƒç´ 

**TreeSetå†…éƒ¨æ•°æ®ç»“æ„**

```java
public class TreeSet<E> extends AbstractSet<E>
    implements NavigableSet<E>, Cloneable, java.io.Serializable {
    
    // å†…éƒ¨ä½¿ç”¨TreeMapå­˜å‚¨æ•°æ®
    private transient NavigableMap<E,Object> m;
    
    // è™šæ‹Ÿå€¼å¯¹è±¡ï¼Œç”¨ä½œTreeMapçš„value
    private static final Object PRESENT = new Object();
    
    // ä½¿ç”¨TreeMapä½œä¸ºåº•å±‚å­˜å‚¨
    public TreeSet() {
        this(new TreeMap<E,Object>());
    }
    
    // ä½¿ç”¨æŒ‡å®šçš„Comparator
    public TreeSet(Comparator<? super E> comparator) {
        this(new TreeMap<>(comparator));
    }
    
    // å†…éƒ¨æ„é€ æ–¹æ³•
    TreeSet(NavigableMap<E,Object> m) {
        this.m = m;
    }
}
```

**TreeSetå…³é”®æ“ä½œå®ç°**

```java
// æ·»åŠ å…ƒç´ 
public boolean add(E e) {
    return m.put(e, PRESENT) == null;
}

// åˆ é™¤å…ƒç´ 
public boolean remove(Object o) {
    return m.remove(o) == PRESENT;
}

// æ£€æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨
public boolean contains(Object o) {
    return m.containsKey(o);
}

// è·å–ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆæœ€å°ï¼‰
public E first() {
    return m.firstKey();
}

// è·å–æœ€åä¸€ä¸ªå…ƒç´ ï¼ˆæœ€å¤§ï¼‰
public E last() {
    return m.lastKey();
}

// è·å–å°äºæŒ‡å®šå…ƒç´ çš„æœ€å¤§å…ƒç´ 
public E lower(E e) {
    return m.lowerKey(e);
}

// è·å–å¤§äºæŒ‡å®šå…ƒç´ çš„æœ€å°å…ƒç´ 
public E higher(E e) {
    return m.higherKey(e);
}

// èŒƒå›´æŸ¥è¯¢
public SortedSet<E> subSet(E fromElement, E toElement) {
    return subSet(fromElement, true, toElement, false);
}
```

**TreeSetæ’åºæœºåˆ¶è¯¦è§£**

TreeSetçš„æ’åºæœ‰ä¸¤ç§æ–¹å¼ï¼š

1. **è‡ªç„¶æ’åº**ï¼šå…ƒç´ å®ç°Comparableæ¥å£
```java
public class Student implements Comparable<Student> {
    private String name;
    private int score;
    
    @Override
    public int compareTo(Student other) {
        // æŒ‰åˆ†æ•°é™åºæ’åˆ—
        return Integer.compare(other.score, this.score);
    }
}

TreeSet<Student> students = new TreeSet<>();
students.add(new Student("Alice", 90));
students.add(new Student("Bob", 85));
// è‡ªåŠ¨æŒ‰åˆ†æ•°é™åºæ’åˆ—
```

2. **å®šåˆ¶æ’åº**ï¼šæä¾›Comparatoræ¯”è¾ƒå™¨
```java
// æŒ‰å­—ç¬¦ä¸²é•¿åº¦æ’åº
TreeSet<String> set = new TreeSet<>((s1, s2) -> {
    int lengthCompare = Integer.compare(s1.length(), s2.length());
    // é•¿åº¦ç›¸åŒæ—¶æŒ‰å­—å…¸åº
    return lengthCompare != 0 ? lengthCompare : s1.compareTo(s2);
});

set.add("apple");
set.add("pie");
set.add("banana");
// ç»“æœï¼š["pie", "apple", "banana"]
```

**TreeSetä¸HashSetæ€§èƒ½å¯¹æ¯”**

| æ“ä½œç±»å‹ | HashSet | TreeSet | è¯´æ˜ |
|---------|---------|---------|------|
| **add()** | O(1)å¹³å‡ | O(log n) | TreeSetéœ€è¦ç»´æŠ¤æœ‰åºæ€§ |
| **remove()** | O(1)å¹³å‡ | O(log n) | TreeSetéœ€è¦é‡æ–°å¹³è¡¡æ ‘ |
| **contains()** | O(1)å¹³å‡ | O(log n) | TreeSetéœ€è¦äºŒåˆ†æŸ¥æ‰¾ |
| **éå†** | O(n) | O(n) | TreeSetéå†æ˜¯æœ‰åºçš„ |
| **å†…å­˜å ç”¨** | è¾ƒå°‘ | è¾ƒå¤š | TreeSetéœ€è¦é¢å¤–å­˜å‚¨æ ‘ç»“æ„ |

#### ç‰¹æ®ŠSetå®ç°

**LinkedHashSetå®ç°åŸç†**

LinkedHashSetç»§æ‰¿è‡ªHashSetï¼Œå†…éƒ¨ä½¿ç”¨LinkedHashMapç»´æŠ¤æ’å…¥é¡ºåºï¼š

```java
public class LinkedHashSet<E> extends HashSet<E>
    implements Set<E>, Cloneable, java.io.Serializable {
    
    // è°ƒç”¨HashSetçš„æ„é€ æ–¹æ³•ï¼Œä½†ä¼ å…¥LinkedHashMap
    public LinkedHashSet(int initialCapacity, float loadFactor) {
        super(initialCapacity, loadFactor, true); // trueè¡¨ç¤ºä½¿ç”¨LinkedHashMap
    }
}
```

**LinkedHashSetç‰¹ç‚¹**ï¼š
- ç»´æŠ¤**æ’å…¥é¡ºåº**ï¼šéå†æ—¶æŒ‰æ’å…¥é¡ºåºè¿”å›å…ƒç´ 
- æ€§èƒ½ä»‹äºHashSetå’ŒTreeSetä¹‹é—´
- é€‚ç”¨äºéœ€è¦ä¿æŒæ’å…¥é¡ºåºçš„å»é‡åœºæ™¯

**EnumSetä¼˜åŒ–å®ç°**

EnumSetæ˜¯ä¸“é—¨ä¸ºæšä¸¾ç±»å‹ä¼˜åŒ–çš„Setå®ç°ï¼š

```java
public enum Color {
    RED, GREEN, BLUE, YELLOW, BLACK, WHITE
}

// ä½¿ç”¨ç¤ºä¾‹
public void enumSetDemo() {
    // åˆ›å»ºåŒ…å«æ‰€æœ‰æšä¸¾å€¼çš„Set
    EnumSet<Color> allColors = EnumSet.allOf(Color.class);
    
    // åˆ›å»ºåŒ…å«æŒ‡å®šæšä¸¾å€¼çš„Set
    EnumSet<Color> primaryColors = EnumSet.of(Color.RED, Color.GREEN, Color.BLUE);
    
    // åˆ›å»ºæŒ‡å®šèŒƒå›´çš„æšä¸¾å€¼Set
    EnumSet<Color> range = EnumSet.range(Color.RED, Color.BLUE);
    
    // æ€§èƒ½æé«˜ï¼Œå†…éƒ¨ä½¿ç”¨ä½å‘é‡å®ç°
    primaryColors.add(Color.YELLOW);
    primaryColors.remove(Color.GREEN);
}
```

**EnumSetæ€§èƒ½ä¼˜åŠ¿**ï¼š
- **ä½å‘é‡å®ç°**ï¼šæ¯ä¸ªæšä¸¾å€¼å¯¹åº”ä¸€ä¸ªbitä½
- **ç©ºé—´æ•ˆç‡é«˜**ï¼š64ä¸ªä»¥å†…çš„æšä¸¾åªéœ€è¦ä¸€ä¸ªlong
- **æ“ä½œé€Ÿåº¦å¿«**ï¼šä½è¿ç®—å®ç°ï¼Œæ¥è¿‘O(1)æ€§èƒ½

### Mapé›†åˆ

#### HashMapå®ç°åŸç†ä¸æœºåˆ¶

**æ ¸å¿ƒæ•°æ®ç»“æ„æ¼”è¿›**

HashMapçš„åº•å±‚å®ç°åœ¨ä¸åŒJDKç‰ˆæœ¬ä¸­æœ‰é‡è¦å˜åŒ–ï¼š
- **JDK 1.7åŠä¹‹å‰**ï¼šæ•°ç»„ + é“¾è¡¨
- **JDK 1.8åŠä¹‹å**ï¼šæ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘

**å†…éƒ¨æ•°æ®ç»“æ„å®šä¹‰**

```java
public class HashMap<K,V> extends AbstractMap<K,V>
    implements Map<K,V>, Cloneable, Serializable {
    
    // é»˜è®¤åˆå§‹å®¹é‡ï¼Œå¿…é¡»æ˜¯2çš„å¹‚
    static final int DEFAULT_INITIAL_CAPACITY = 1 << 4; // 16
    
    // æœ€å¤§å®¹é‡
    static final int MAXIMUM_CAPACITY = 1 << 30;
    
    // é»˜è®¤è´Ÿè½½å› å­
    static final float DEFAULT_LOAD_FACTOR = 0.75f;
    
    // é“¾è¡¨è½¬çº¢é»‘æ ‘é˜ˆå€¼
    static final int TREEIFY_THRESHOLD = 8;
    
    // çº¢é»‘æ ‘é€€åŒ–ä¸ºé“¾è¡¨é˜ˆå€¼
    static final int UNTREEIFY_THRESHOLD = 6;
    
    // æœ€å°æ ‘å½¢åŒ–å®¹é‡é˜ˆå€¼
    static final int MIN_TREEIFY_CAPACITY = 64;
    
    // å­˜å‚¨æ•°æ®çš„æ•°ç»„
    transient Node<K,V>[] table;
    
    // å®é™…å­˜å‚¨çš„é”®å€¼å¯¹æ•°é‡
    transient int size;
    
    // æ‰©å®¹é˜ˆå€¼ = capacity * load factor
    int threshold;
    
    // è´Ÿè½½å› å­
    final float loadFactor;
}
```

**èŠ‚ç‚¹ç»“æ„å®šä¹‰**

```java
// é“¾è¡¨èŠ‚ç‚¹
static class Node<K,V> implements Map.Entry<K,V> {
    final int hash;    // å“ˆå¸Œå€¼
    final K key;       // é”®
    V value;          // å€¼
    Node<K,V> next;   // ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
    
    Node(int hash, K key, V value, Node<K,V> next) {
        this.hash = hash;
        this.key = key;
        this.value = value;
        this.next = next;
    }
}

// çº¢é»‘æ ‘èŠ‚ç‚¹
static final class TreeNode<K,V> extends LinkedHashMap.Entry<K,V> {
    TreeNode<K,V> parent;  // çˆ¶èŠ‚ç‚¹
    TreeNode<K,V> left;    // å·¦å­èŠ‚ç‚¹
    TreeNode<K,V> right;   // å³å­èŠ‚ç‚¹
    TreeNode<K,V> prev;    // å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆç»´æŠ¤æ’å…¥é¡ºåºï¼‰
    boolean red;           // é¢œè‰²æ ‡è®°
}
```

**HashMapå­˜å‚¨ç»“æ„æ¼”åŒ–å›¾**ï¼š

```mermaid
graph TD
    subgraph "JDK 1.8 HashMapç»“æ„"
        A["tableæ•°ç»„"] --> B["index 0"]
        A --> C["index 1"] 
        A --> D["index 2"]
        A --> E["..."]
        A --> F["index n"]
        
        B --> B1["Node1"] --> B2["Node2"] --> B3["Node3"]
        C --> C1["TreeNode(çº¢é»‘æ ‘æ ¹)"]
        C1 --> C2["å·¦å­æ ‘"]
        C1 --> C3["å³å­æ ‘"]
        
        D --> D1["Node1"]
    end
    
    style B1 fill:#e3f2fd
    style C1 fill:#ffeb3b
    style D1 fill:#e8f5e9
```

**å“ˆå¸Œè®¡ç®—ä¸ç´¢å¼•å®šä½**

```java
// è®¡ç®—keyçš„hashå€¼ï¼ˆJDK 1.8ä¼˜åŒ–ç‰ˆæœ¬ï¼‰
static final int hash(Object key) {
    int h;
    // keyçš„hashCodeä¸å…¶é«˜16ä½è¿›è¡Œå¼‚æˆ–è¿ç®—
    return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);
}

// æ ¹æ®hashå€¼è®¡ç®—æ•°ç»„ç´¢å¼•
// ä½¿ç”¨ (n-1) & hash ä»£æ›¿ hash % nï¼Œä½è¿ç®—æ›´é«˜æ•ˆ
int index = (table.length - 1) & hash;
```

**HashMapçš„putæ“ä½œè¯¦ç»†æµç¨‹**

```mermaid
flowchart TD
    A["è°ƒç”¨put(key, value)"] --> B["è®¡ç®—hashå€¼"]
    B --> C["è®¡ç®—æ•°ç»„ç´¢å¼• (n-1) & hash"]
    C --> D{æ•°ç»„è¯¥ä½ç½®æ˜¯å¦ä¸ºç©º?}
    
    D -->|æ˜¯| E["ç›´æ¥æ’å…¥æ–°èŠ‚ç‚¹"]
    D -->|å¦| F{keyæ˜¯å¦ç›¸åŒ?}
    
    F -->|æ˜¯| G["æ›´æ–°valueå€¼"]
    F -->|å¦| H{å½“å‰æ˜¯é“¾è¡¨è¿˜æ˜¯æ ‘?}
    
    H -->|é“¾è¡¨| I["éå†é“¾è¡¨"]
    H -->|çº¢é»‘æ ‘| J["åœ¨çº¢é»‘æ ‘ä¸­æŸ¥æ‰¾/æ’å…¥"]
    
    I --> K{æ‰¾åˆ°ç›¸åŒkey?}
    K -->|æ˜¯| G
    K -->|å¦| L["æ’å…¥åˆ°é“¾è¡¨æœ«å°¾"]
    
    L --> M{é“¾è¡¨é•¿åº¦ >= 8?}
    M -->|æ˜¯| N{æ•°ç»„é•¿åº¦ >= 64?}
    M -->|å¦| O["æ’å…¥å®Œæˆ"]
    
    N -->|æ˜¯| P["è½¬æ¢ä¸ºçº¢é»‘æ ‘"]
    N -->|å¦| Q["å…ˆæ‰©å®¹æ•°ç»„"]
    
    P --> O
    Q --> O
    J --> O
    G --> O
    E --> O
    
    O --> R{size > threshold?}
    R -->|æ˜¯| S["æ‰©å®¹resize()"]
    R -->|å¦| T["ç»“æŸ"]
    S --> T
```

**HashMapçš„putæ–¹æ³•æ ¸å¿ƒå®ç°**

```java
public V put(K key, V value) {
    return putVal(hash(key), key, value, false, true);
}

final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) {
    Node<K,V>[] tab; Node<K,V> p; int n, i;
    
    // 1. å¦‚æœtableä¸ºç©ºï¼Œè¿›è¡Œåˆå§‹åŒ–
    if ((tab = table) == null || (n = tab.length) == 0)
        n = (tab = resize()).length;
        
    // 2. è®¡ç®—ç´¢å¼•ï¼Œå¦‚æœè¯¥ä½ç½®ä¸ºç©ºï¼Œç›´æ¥æ’å…¥
    if ((p = tab[i = (n - 1) & hash]) == null)
        tab[i] = newNode(hash, key, value, null);
    else {
        Node<K,V> e; K k;
        
        // 3. å¦‚æœç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„keyç›¸åŒï¼Œè®°å½•è¯¥èŠ‚ç‚¹
        if (p.hash == hash && ((k = p.key) == key || (key != null && key.equals(k))))
            e = p;
            
        // 4. å¦‚æœæ˜¯çº¢é»‘æ ‘èŠ‚ç‚¹ï¼ŒæŒ‰æ ‘çš„æ–¹å¼æ’å…¥
        else if (p instanceof TreeNode)
            e = ((TreeNode<K,V>)p).putTreeVal(this, tab, hash, key, value);
            
        // 5. å¤„ç†é“¾è¡¨æƒ…å†µ
        else {
            for (int binCount = 0; ; ++binCount) {
                // æ’å…¥åˆ°é“¾è¡¨æœ«å°¾
                if ((e = p.next) == null) {
                    p.next = newNode(hash, key, value, null);
                    
                    // æ£€æŸ¥æ˜¯å¦éœ€è¦æ ‘å½¢åŒ–
                    if (binCount >= TREEIFY_THRESHOLD - 1)
                        treeifyBin(tab, hash);
                    break;
                }
                
                // æ‰¾åˆ°ç›¸åŒkey
                if (e.hash == hash && ((k = e.key) == key || (key != null && key.equals(k))))
                    break;
                p = e;
            }
        }
        
        // 6. å¦‚æœæ‰¾åˆ°ç›¸åŒkeyï¼Œæ›´æ–°value
        if (e != null) {
            V oldValue = e.value;
            if (!onlyIfAbsent || oldValue == null)
                e.value = value;
            afterNodeAccess(e);
            return oldValue;
        }
    }
    
    ++modCount;
    
    // 7. æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹
    if (++size > threshold)
        resize();
        
    afterNodeInsertion(evict);
    return null;
}
```

**HashMapæ‰©å®¹æœºåˆ¶è¯¦è§£**

```java
final Node<K,V>[] resize() {
    Node<K,V>[] oldTab = table;
    int oldCap = (oldTab == null) ? 0 : oldTab.length;
    int oldThr = threshold;
    int newCap, newThr = 0;
    
    if (oldCap > 0) {
        // å·²è¾¾åˆ°æœ€å¤§å®¹é‡
        if (oldCap >= MAXIMUM_CAPACITY) {
            threshold = Integer.MAX_VALUE;
            return oldTab;
        }
        // å®¹é‡å’Œé˜ˆå€¼éƒ½æ‰©å¤§2å€
        else if ((newCap = oldCap << 1) < MAXIMUM_CAPACITY && oldCap >= DEFAULT_INITIAL_CAPACITY)
            newThr = oldThr << 1;
    }
    
    // åˆ›å»ºæ–°æ•°ç»„
    Node<K,V>[] newTab = (Node<K,V>[])new Node[newCap];
    table = newTab;
    
    // é‡æ–°åˆ†å¸ƒåŸæœ‰å…ƒç´ 
    if (oldTab != null) {
        for (int j = 0; j < oldCap; ++j) {
            Node<K,V> e;
            if ((e = oldTab[j]) != null) {
                oldTab[j] = null;
                
                if (e.next == null)
                    // åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œç›´æ¥é‡æ–°è®¡ç®—ä½ç½®
                    newTab[e.hash & (newCap - 1)] = e;
                else if (e instanceof TreeNode)
                    // çº¢é»‘æ ‘çš„åˆ†ç¦»
                    ((TreeNode<K,V>)e).split(this, newTab, j, oldCap);
                else {
                    // é“¾è¡¨çš„ä¼˜åŒ–åˆ†ç¦»
                    Node<K,V> loHead = null, loTail = null;
                    Node<K,V> hiHead = null, hiTail = null;
                    Node<K,V> next;
                    
                    do {
                        next = e.next;
                        // æ ¹æ®hash & oldCapåˆ¤æ–­ä½ç½®
                        if ((e.hash & oldCap) == 0) {
                            if (loTail == null)
                                loHead = e;
                            else
                                loTail.next = e;
                            loTail = e;
                        } else {
                            if (hiTail == null)
                                hiHead = e;
                            else
                                hiTail.next = e;
                            hiTail = e;
                        }
                    } while ((e = next) != null);
                    
                    // æ”¾ç½®åˆ°æ–°ä½ç½®
                    if (loTail != null) {
                        loTail.next = null;
                        newTab[j] = loHead;
                    }
                    if (hiTail != null) {
                        hiTail.next = null;
                        newTab[j + oldCap] = hiHead;
                    }
                }
            }
        }
    }
    return newTab;
}
```

**é“¾è¡¨è½¬çº¢é»‘æ ‘çš„æ¡ä»¶ä¸è¿‡ç¨‹**

é“¾è¡¨è½¬çº¢é»‘æ ‘éœ€è¦åŒæ—¶æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š
1. **é“¾è¡¨é•¿åº¦ >= 8**ï¼ˆTREEIFY_THRESHOLDï¼‰
2. **æ•°ç»„é•¿åº¦ >= 64**ï¼ˆMIN_TREEIFY_CAPACITYï¼‰

å¦‚æœæ•°ç»„é•¿åº¦å°äº64ï¼Œä¼˜å…ˆè¿›è¡Œæ‰©å®¹è€Œä¸æ˜¯æ ‘å½¢åŒ–ã€‚

**HashMapæ€§èƒ½ç‰¹ç‚¹åˆ†æ**

| æ“ä½œç±»å‹ | å¹³å‡æ—¶é—´å¤æ‚åº¦ | æœ€åæ—¶é—´å¤æ‚åº¦ | è¯´æ˜ |
|---------|---------------|---------------|------|
| **putæ“ä½œ** | O(1) | O(log n) | çº¢é»‘æ ‘ä¼˜åŒ–åæœ€åæƒ…å†µ |
| **getæ“ä½œ** | O(1) | O(log n) | å“ˆå¸Œå†²çªæ—¶éå†é“¾è¡¨/æ ‘ |
| **removeæ“ä½œ** | O(1) | O(log n) | åŒgetæ“ä½œ |
| **æ‰©å®¹æ“ä½œ** | O(n) | O(n) | éœ€è¦é‡æ–°è®¡ç®—æ‰€æœ‰å…ƒç´ ä½ç½® |

#### TreeMapå®ç°åŸç†ä¸æœºåˆ¶

TreeMapåŸºäº**çº¢é»‘æ ‘**å®ç°ï¼Œä¿è¯äº†O(log n)çš„æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾æ€§èƒ½ï¼Œå¹¶ç»´æŠ¤é”®çš„æœ‰åºæ€§ã€‚

**TreeMapæ ¸å¿ƒç‰¹ç‚¹**ï¼š
- **æœ‰åºå­˜å‚¨**ï¼šæŒ‰é”®çš„è‡ªç„¶é¡ºåºæˆ–Comparatoræ’åº
- **ä¸å…è®¸nullé”®**ï¼šä½†å¯ä»¥æœ‰nullå€¼
- **éçº¿ç¨‹å®‰å…¨**ï¼šéœ€è¦å¤–éƒ¨åŒæ­¥
- **åŸºäºçº¢é»‘æ ‘**ï¼šè‡ªå¹³è¡¡äºŒå‰æœç´¢æ ‘

**TreeMapå†…éƒ¨æ•°æ®ç»“æ„**

```java
public class TreeMap<K,V> extends AbstractMap<K,V>
    implements NavigableMap<K,V>, Cloneable, java.io.Serializable {
    
    // æ¯”è¾ƒå™¨ï¼Œå¦‚æœä¸ºnullåˆ™ä½¿ç”¨é”®çš„è‡ªç„¶é¡ºåº
    private final Comparator<? super K> comparator;
    
    // çº¢é»‘æ ‘çš„æ ¹èŠ‚ç‚¹
    private transient Entry<K,V> root;
    
    // æ ‘ä¸­èŠ‚ç‚¹çš„æ•°é‡
    private transient int size = 0;
    
    // æ ‘çš„ä¿®æ”¹æ¬¡æ•°ï¼Œç”¨äºè¿­ä»£å™¨çš„fail-fastæœºåˆ¶
    private transient int modCount = 0;
    
    // çº¢é»‘æ ‘èŠ‚ç‚¹ç»“æ„
    static final class Entry<K,V> implements Map.Entry<K,V> {
        K key;              // é”®
        V value;            // å€¼
        Entry<K,V> left;    // å·¦å­èŠ‚ç‚¹
        Entry<K,V> right;   // å³å­èŠ‚ç‚¹
        Entry<K,V> parent;  // çˆ¶èŠ‚ç‚¹
        boolean color = BLACK;  // èŠ‚ç‚¹é¢œè‰²ï¼Œé»˜è®¤ä¸ºé»‘è‰²
        
        Entry(K key, V value, Entry<K,V> parent) {
            this.key = key;
            this.value = value;
            this.parent = parent;
        }
    }
}
```

**çº¢é»‘æ ‘çš„æ€§è´¨ä¸è§„åˆ™**

çº¢é»‘æ ‘æ˜¯ä¸€ç§è‡ªå¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼Œæ»¡è¶³ä»¥ä¸‹æ€§è´¨ï¼š
1. **èŠ‚ç‚¹é¢œè‰²**ï¼šæ¯ä¸ªèŠ‚ç‚¹è¦ä¹ˆæ˜¯çº¢è‰²ï¼Œè¦ä¹ˆæ˜¯é»‘è‰²
2. **æ ¹èŠ‚ç‚¹**ï¼šæ ¹èŠ‚ç‚¹å¿…é¡»æ˜¯é»‘è‰²
3. **å¶å­èŠ‚ç‚¹**ï¼šå¶å­èŠ‚ç‚¹ï¼ˆNILèŠ‚ç‚¹ï¼‰éƒ½æ˜¯é»‘è‰²
4. **çº¢è‰²èŠ‚ç‚¹**ï¼šçº¢è‰²èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å¿…é¡»éƒ½æ˜¯é»‘è‰²
5. **é»‘è‰²å¹³è¡¡**ï¼šä»ä»»ä¸€èŠ‚ç‚¹åˆ°å…¶æ¯ä¸ªå¶å­çš„è·¯å¾„éƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹

**TreeMapçº¢é»‘æ ‘ç»“æ„ç¤ºæ„å›¾**ï¼š

```mermaid
graph TD
    subgraph "çº¢é»‘æ ‘ç»“æ„ç¤ºä¾‹"
        A["30(B)"] --> B["20(R)"]
        A --> C["40(B)"]
        
        B --> D["10(B)"]
        B --> E["25(B)"]
        
        C --> F["35(R)"]
        C --> G["50(R)"]
        
        D --> H["NIL(B)"]
        D --> I["NIL(B)"]
        E --> J["NIL(B)"]
        E --> K["NIL(B)"]
        F --> L["NIL(B)"]
        F --> M["NIL(B)"]
        G --> N["NIL(B)"]
        G --> O["NIL(B)"]
    end
    
    style A fill:#333333,color:#ffffff
    style C fill:#333333,color:#ffffff
    style D fill:#333333,color:#ffffff
    style E fill:#333333,color:#ffffff
    style B fill:#ff4444,color:#ffffff
    style F fill:#ff4444,color:#ffffff
    style G fill:#ff4444,color:#ffffff
```

**TreeMapçš„putæ“ä½œå®ç°**

```java
public V put(K key, V value) {
    Entry<K,V> t = root;
    
    // å¦‚æœæ ‘ä¸ºç©ºï¼Œåˆ›å»ºæ ¹èŠ‚ç‚¹
    if (t == null) {
        compare(key, key); // æ£€æŸ¥keyçš„ç±»å‹
        root = new Entry<>(key, value, null);
        size = 1;
        modCount++;
        return null;
    }
    
    int cmp;
    Entry<K,V> parent;
    Comparator<? super K> cpr = comparator;
    
    // å¯»æ‰¾æ’å…¥ä½ç½®
    do {
        parent = t;
        cmp = (cpr != null) ? cpr.compare(key, t.key)
                           : ((Comparable<? super K>)key).compareTo(t.key);
        if (cmp < 0)
            t = t.left;
        else if (cmp > 0)
            t = t.right;
        else
            return t.setValue(value); // é”®å·²å­˜åœ¨ï¼Œæ›´æ–°å€¼
    } while (t != null);
    
    // åˆ›å»ºæ–°èŠ‚ç‚¹
    Entry<K,V> e = new Entry<>(key, value, parent);
    if (cmp < 0)
        parent.left = e;
    else
        parent.right = e;
        
    // æ’å…¥åçš„çº¢é»‘æ ‘ä¿®å¤
    fixAfterInsertion(e);
    size++;
    modCount++;
    return null;
}
```

**çº¢é»‘æ ‘æ’å…¥ä¿®å¤è¿‡ç¨‹**

æ’å…¥æ–°èŠ‚ç‚¹åï¼Œéœ€è¦é€šè¿‡**æ—‹è½¬**å’Œ**é‡æ–°ç€è‰²**æ¥ç»´æŠ¤çº¢é»‘æ ‘æ€§è´¨ï¼š

```java
private void fixAfterInsertion(Entry<K,V> x) {
    x.color = RED; // æ–°æ’å…¥çš„èŠ‚ç‚¹ä¸ºçº¢è‰²
    
    while (x != null && x != root && x.parent.color == RED) {
        if (parentOf(x) == leftOf(parentOf(parentOf(x)))) {
            // çˆ¶èŠ‚ç‚¹æ˜¯ç¥–çˆ¶èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹
            Entry<K,V> y = rightOf(parentOf(parentOf(x))); // å”å”èŠ‚ç‚¹
            
            if (colorOf(y) == RED) {
                // Case 1: å”å”èŠ‚ç‚¹æ˜¯çº¢è‰²
                setColor(parentOf(x), BLACK);
                setColor(y, BLACK);
                setColor(parentOf(parentOf(x)), RED);
                x = parentOf(parentOf(x));
            } else {
                if (x == rightOf(parentOf(x))) {
                    // Case 2: å”å”èŠ‚ç‚¹æ˜¯é»‘è‰²ï¼Œä¸”å½“å‰èŠ‚ç‚¹æ˜¯çˆ¶èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹
                    x = parentOf(x);
                    rotateLeft(x);
                }
                // Case 3: å”å”èŠ‚ç‚¹æ˜¯é»‘è‰²ï¼Œä¸”å½“å‰èŠ‚ç‚¹æ˜¯çˆ¶èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹
                setColor(parentOf(x), BLACK);
                setColor(parentOf(parentOf(x)), RED);
                rotateRight(parentOf(parentOf(x)));
            }
        } else {
            // çˆ¶èŠ‚ç‚¹æ˜¯ç¥–çˆ¶èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹ï¼ˆå¯¹ç§°æƒ…å†µï¼‰
            Entry<K,V> y = leftOf(parentOf(parentOf(x)));
            
            if (colorOf(y) == RED) {
                setColor(parentOf(x), BLACK);
                setColor(y, BLACK);
                setColor(parentOf(parentOf(x)), RED);
                x = parentOf(parentOf(x));
            } else {
                if (x == leftOf(parentOf(x))) {
                    x = parentOf(x);
                    rotateRight(x);
                }
                setColor(parentOf(x), BLACK);
                setColor(parentOf(parentOf(x)), RED);
                rotateLeft(parentOf(parentOf(x)));
            }
        }
    }
    root.color = BLACK; // æ ¹èŠ‚ç‚¹å§‹ç»ˆä¸ºé»‘è‰²
}
```

**çº¢é»‘æ ‘æ—‹è½¬æ“ä½œ**

æ—‹è½¬æ˜¯ç»´æŠ¤çº¢é»‘æ ‘å¹³è¡¡çš„å…³é”®æ“ä½œï¼š

**å·¦æ—‹æ“ä½œ**ï¼š
```java
private void rotateLeft(Entry<K,V> p) {
    if (p != null) {
        Entry<K,V> r = p.right;
        p.right = r.left;
        
        if (r.left != null)
            r.left.parent = p;
            
        r.parent = p.parent;
        
        if (p.parent == null)
            root = r;
        else if (p.parent.left == p)
            p.parent.left = r;
        else
            p.parent.right = r;
            
        r.left = p;
        p.parent = r;
    }
}
```

**å³æ—‹æ“ä½œ**ï¼š
```java
private void rotateRight(Entry<K,V> p) {
    if (p != null) {
        Entry<K,V> l = p.left;
        p.left = l.right;
        
        if (l.right != null)
            l.right.parent = p;
            
        l.parent = p.parent;
        
        if (p.parent == null)
            root = l;
        else if (p.parent.right == p)
            p.parent.right = l;
        else
            p.parent.left = l;
            
        l.right = p;
        p.parent = l;
    }
}
```

**å·¦æ—‹è½¬è¿‡ç¨‹å›¾è§£**ï¼š

```mermaid
graph TD
    subgraph "å·¦æ—‹è½¬å‰"
        A1["P"] --> B1["L"]
        A1 --> C1["R"]
        C1 --> D1["RL"]
        C1 --> E1["RR"]
    end
    
    subgraph "å·¦æ—‹è½¬å"
        A2["R"] --> B2["P"]
        A2 --> C2["RR"]
        B2 --> D2["L"]
        B2 --> E2["RL"]
    end
    
    style A1 fill:#ffeb3b
    style C1 fill:#4caf50
    style A2 fill:#4caf50
    style B2 fill:#ffeb3b
```

**TreeMapæŸ¥æ‰¾æ“ä½œ**

```java
public V get(Object key) {
    Entry<K,V> p = getEntry(key);
    return (p == null ? null : p.value);
}

final Entry<K,V> getEntry(Object key) {
    // å¦‚æœæœ‰è‡ªå®šä¹‰æ¯”è¾ƒå™¨ï¼Œä½¿ç”¨æ¯”è¾ƒå™¨æŸ¥æ‰¾
    if (comparator != null)
        return getEntryUsingComparator(key);
        
    if (key == null)
        throw new NullPointerException();
        
    @SuppressWarnings("unchecked")
    Comparable<? super K> k = (Comparable<? super K>) key;
    Entry<K,V> p = root;
    
    // äºŒåˆ†æŸ¥æ‰¾
    while (p != null) {
        int cmp = k.compareTo(p.key);
        if (cmp < 0)
            p = p.left;
        else if (cmp > 0)
            p = p.right;
        else
            return p;
    }
    return null;
}
```

**TreeMapæ€§èƒ½ç‰¹ç‚¹åˆ†æ**

| æ“ä½œç±»å‹ | æ—¶é—´å¤æ‚åº¦ | è¯´æ˜ |
|---------|-----------|------|
| **putæ“ä½œ** | O(log n) | æŸ¥æ‰¾ä½ç½® + æ’å…¥ä¿®å¤ |
| **getæ“ä½œ** | O(log n) | äºŒåˆ†æŸ¥æ‰¾ |
| **removeæ“ä½œ** | O(log n) | æŸ¥æ‰¾ + åˆ é™¤ä¿®å¤ |
| **firstKey/lastKey** | O(log n) | æ‰¾åˆ°æœ€å·¦/å³èŠ‚ç‚¹ |
| **éå†æ“ä½œ** | O(n) | ä¸­åºéå†æ‰€æœ‰èŠ‚ç‚¹ |

#### ç‰¹æ®ŠMapå®ç°
```java
public class SpecialMapExample {
    /**
     * LinkedHashMap
     * ç‰¹ç‚¹ï¼šç»´æŠ¤æ’å…¥é¡ºåºæˆ–è®¿é—®é¡ºåº
     */
    public void linkedHashMapDemo() {
        // LRUç¼“å­˜å®ç°
        LinkedHashMap<String, Integer> lruCache = 
            new LinkedHashMap<>(16, 0.75f, true) {
                @Override
                protected boolean removeEldestEntry(Map.Entry<String, Integer> eldest) {
                    return size() > 100;
                }
            };
    }
    
    /**
     * WeakHashMap
     * ç‰¹ç‚¹ï¼šå¼±å¼•ç”¨é”®ï¼Œé€‚åˆç¼“å­˜
     */
    public void weakHashMapDemo() {
        WeakHashMap<UniqueObject, String> cache = new WeakHashMap<>();
        UniqueObject key = new UniqueObject("test");
        cache.put(key, "value");
        key = null;  // é”®å¯èƒ½è¢«GCå›æ”¶
    }
}
```

### Queueé›†åˆ

#### åŸºæœ¬é˜Ÿåˆ—å®ç°
```java
public class QueueExample {
    /**
     * ArrayDeque
     * ç‰¹ç‚¹ï¼šæ•°ç»„å®ç°çš„åŒç«¯é˜Ÿåˆ—
     */
    public void arrayDequeDemo() {
        ArrayDeque<String> deque = new ArrayDeque<>();
        
        // é˜Ÿåˆ—æ“ä½œ
        deque.offer("First");
        deque.poll();
        
        // æ ˆæ“ä½œ
        deque.push("Top");
        deque.pop();
    }
    
    /**
     * PriorityQueue
     * ç‰¹ç‚¹ï¼šåŸºäºå †çš„ä¼˜å…ˆçº§é˜Ÿåˆ—
     */
    public void priorityQueueDemo() {
        // æœ€å°å †
        PriorityQueue<Integer> minHeap = new PriorityQueue<>();
        
        // æœ€å¤§å †
        PriorityQueue<Integer> maxHeap = new PriorityQueue<>(
            Collections.reverseOrder()
        );
    }
}
```

#### é˜»å¡é˜Ÿåˆ—å®ç°
```java
public class BlockingQueueExample {
    /**
     * å¸¸ç”¨é˜»å¡é˜Ÿåˆ—å®ç°
     */
    public void blockingQueueDemo() {
        // å›ºå®šå¤§å°çš„é˜»å¡é˜Ÿåˆ—
        ArrayBlockingQueue<String> arrayQueue = 
            new ArrayBlockingQueue<>(100);
        
        // æ— ç•Œé˜»å¡é˜Ÿåˆ—
        LinkedBlockingQueue<String> linkedQueue = 
            new LinkedBlockingQueue<>();
        
        // å»¶è¿Ÿé˜Ÿåˆ—
        DelayQueue<DelayedElement> delayQueue = 
            new DelayQueue<>();
        
        // åŒæ­¥é˜Ÿåˆ—
        SynchronousQueue<String> syncQueue = 
            new SynchronousQueue<>();
    }
}
```

### é›†åˆæ€§èƒ½å¯¹æ¯”

#### æ—¶é—´å¤æ‚åº¦å¯¹æ¯”è¡¨

| é›†åˆç±»å‹          | æ’å…¥              | åˆ é™¤              | æŸ¥æ‰¾     | éå† | çº¿ç¨‹å®‰å…¨ | é€‚ç”¨åœºæ™¯   |
| ----------------- | ----------------- | ----------------- | -------- | ---- | -------- | ---------- |
| ArrayList         | O(1)å°¾éƒ¨/O(n)ä¸­é—´ | O(1)å°¾éƒ¨/O(n)ä¸­é—´ | O(1)     | O(n) | å¦       | éšæœºè®¿é—®å¤š |
| LinkedList        | O(1)              | O(1)              | O(n)     | O(n) | å¦       | æ’å…¥åˆ é™¤å¤š |
| HashMap           | O(1)              | O(1)              | O(1)     | O(n) | å¦       | é”®å€¼å¯¹å­˜å‚¨ |
| TreeMap           | O(log n)          | O(log n)          | O(log n) | O(n) | å¦       | æœ‰åºé”®å€¼å¯¹ |
| HashSet           | O(1)              | O(1)              | O(1)     | O(n) | å¦       | å»é‡å­˜å‚¨   |
| TreeSet           | O(log n)          | O(log n)          | O(log n) | O(n) | å¦       | æœ‰åºå»é‡   |
| ConcurrentHashMap | O(1)              | O(1)              | O(1)     | O(n) | æ˜¯       | å¹¶å‘é”®å€¼å¯¹ |

#### è¯¦ç»†æ€§èƒ½åˆ†æ

**Listé›†åˆæ€§èƒ½æ¯”è¾ƒ**

| æ“ä½œç±»å‹ | ArrayListæ€§èƒ½åˆ†æ | LinkedListæ€§èƒ½åˆ†æ | é€‰æ‹©å»ºè®® |
|----------|-------------------|-------------------|----------|
| **éšæœºè®¿é—®** | O(1) - æ•°ç»„ä¸‹æ ‡ç›´æ¥å®šä½ | O(n) - éœ€è¦éå†é“¾è¡¨ | **éœ€è¦é¢‘ç¹éšæœºè®¿é—®é€‰ArrayList** |
| **é¡ºåºéå†** | é«˜æ•ˆ - è¿ç»­å†…å­˜è®¿é—® | ä¸­ç­‰ - æŒ‡é’ˆè·³è½¬å¼€é”€ | å¤§é‡æ•°æ®éå†é€‰ArrayList |
| **å¤´éƒ¨æ’å…¥** | O(n) - éœ€è¦ç§»åŠ¨æ‰€æœ‰å…ƒç´  | O(1) - ç›´æ¥ä¿®æ”¹å¤´æŒ‡é’ˆ | **é¢‘ç¹å¤´éƒ¨æ“ä½œé€‰LinkedList** |
| **ä¸­é—´æ’å…¥** | O(n) - éœ€è¦ç§»åŠ¨åç»­å…ƒç´  | O(n) - éœ€è¦å…ˆå®šä½ä½ç½® | æ€§èƒ½ç›¸è¿‘ï¼Œè€ƒè™‘å…¶ä»–å› ç´  |
| **å°¾éƒ¨æ’å…¥** | O(1)å‡æ‘Š - å¯èƒ½è§¦å‘æ‰©å®¹ | O(1) - ç›´æ¥ä¿®æ”¹å°¾æŒ‡é’ˆ | æ€§èƒ½ç›¸è¿‘ |
| **å†…å­˜å ç”¨** | è¾ƒå°‘ - åªå­˜å‚¨å…ƒç´  | è¾ƒå¤š - é¢å¤–å­˜å‚¨æŒ‡é’ˆ | **å†…å­˜æ•æ„Ÿé€‰ArrayList** |

**Mapé›†åˆæ€§èƒ½æ¯”è¾ƒ**

| ç‰¹æ€§ | HashMap | TreeMap | LinkedHashMap | ConcurrentHashMap |
|------|---------|---------|---------------|-------------------|
| **æ’å…¥æ€§èƒ½** | O(1)æœ€ä¼˜ | O(log n)è¾ƒæ…¢ | O(1)æ¥è¿‘HashMap | O(1)ç¨æ…¢äºHashMap |
| **æŸ¥è¯¢æ€§èƒ½** | O(1)æœ€ä¼˜ | O(log n)è¾ƒæ…¢ | O(1)æ¥è¿‘HashMap | O(1)æ¥è¿‘HashMap |
| **æœ‰åºæ€§** | æ— åº | **æŒ‰é”®æ’åº** | **æŒ‰æ’å…¥é¡ºåº** | æ— åº |
| **çº¿ç¨‹å®‰å…¨** | å¦ | å¦ | å¦ | **æ˜¯** |
| **å†…å­˜å¼€é”€** | è¾ƒå°‘ | ä¸­ç­‰ | è¾ƒå¤š(ç»´æŠ¤é“¾è¡¨) | è¾ƒå¤š(å¹¶å‘æ§åˆ¶) |
| **é€‚ç”¨åœºæ™¯** | **é€šç”¨é”®å€¼å­˜å‚¨** | **éœ€è¦æ’åºçš„åœºæ™¯** | **éœ€è¦ä¿æŒæ’å…¥é¡ºåº** | **é«˜å¹¶å‘ç¯å¢ƒ** |

#### é›†åˆé€‰æ‹©å†³ç­–æ ‘

```mermaid
flowchart TD
    subgraph "ğŸ§  é›†åˆç±»å‹é€‰æ‹©å†³ç­–" ["é›†åˆç±»å‹é€‰æ‹©å†³ç­–"]
        Start["ğŸ“Œ é€‰æ‹©é›†åˆç±»å‹"] -->|"éœ€è¦é€‚åˆçš„æ•°æ®ç»“æ„"| MapOrCollection{{"ğŸ—ºï¸ éœ€è¦å­˜å‚¨é”®å€¼å¯¹?"}}
        
        MapOrCollection -->|"æ˜¯: é”®å€¼å¯¹å­˜å‚¨"| MapSelection["ğŸ—ºï¸ Mapç±»å‹é€‰æ‹©"]
        MapOrCollection -->|"å¦: å•åˆ—æ•°æ®å®¹å™¨"| CollectionSelection["ğŸ“ Collectionç±»å‹é€‰æ‹©"]
    end
    
    subgraph "ğŸ—ºï¸ Mapç±»å‹é€‰æ‹©åˆ†æ”¯" ["Mapç±»å‹é€‰æ‹©åˆ†æ”¯"]
        MapSelection -->|"å¹¶å‘å®‰å…¨+é«˜æ€§èƒ½"| ConcurrentHashMap["ConcurrentHashMap"]
        MapSelection -->|"æœ‰åºå­˜å‚¨+èŒƒå›´æŸ¥è¯¢"| TreeMap["TreeMap"]
        MapSelection -->|"ä¿æŒæ’å…¥é¡ºåº+LRUç¼“å­˜"| LinkedHashMap["LinkedHashMap"]
        MapSelection -->|"é€šç”¨é”®å€¼å­˜å‚¨+æœ€é«˜æ€§èƒ½"| HashMap["HashMap"]
    end
    
    subgraph "ğŸ“ Collectioné€‰æ‹©åˆ†æ”¯" ["Collectioné€‰æ‹©åˆ†æ”¯"]
        CollectionSelection -->|"å»é‡å­˜å‚¨+å”¯ä¸€æ€§çº¦æŸ"| SetSelection["ğŸŒŸ Seté€‰æ‹©"]
        CollectionSelection -->|"æœ‰åºå®¹å™¨+å…è®¸é‡å¤+ç´¢å¼•è®¿é—®"| ListSelection["ğŸ“‹ Listé€‰æ‹©"]
        CollectionSelection -->|"é˜Ÿåˆ—æ“ä½œ+FIFO/LIFO+ä¼˜å…ˆçº§"| QueueSelection["ğŸ—¡ï¸ Queueé€‰æ‹©"]
        
        SetSelection -->|"æœ‰åºé›†åˆ+æ’åºæŸ¥è¯¢"| TreeSet["TreeSet"]
        SetSelection -->|"ä¿æŒæ’å…¥é¡ºåº+å»é‡"| LinkedHashSet["LinkedHashSet"]
        SetSelection -->|"å¿«é€Ÿå»é‡+æ— åºå­˜å‚¨"| HashSet["HashSet"]
        
        ListSelection -->|"éšæœºè®¿é—®å¤š+å†…å­˜æ•æ„Ÿ"| ArrayList["ArrayList"]
        ListSelection -->|"æ’å…¥åˆ é™¤å¤š+å¤´å°¾æ“ä½œ"| LinkedList["LinkedList"]
        ListSelection -->|"åŒæ­¥å®¹å™¨+çº¿ç¨‹å®‰å…¨"| Vector["Vector"]
        
        QueueSelection -->|"ä¼˜å…ˆçº§æ’åº+å †ç»“æ„"| PriorityQueue["PriorityQueue"]
        QueueSelection -->|"åŒç«¯é˜Ÿåˆ—+å¤´å°¾æ“ä½œ"| ArrayDeque["ArrayDeque"]
        QueueSelection -->|"å…ˆè¿›å…ˆå‡º+ç®€å•é˜Ÿåˆ—"| SimpleQueue["LinkedListé˜Ÿåˆ—"]
    end
    
    subgraph "ğŸ¯ é€‰æ‹©ç»“æœå»ºè®®" ["é€‰æ‹©ç»“æœå»ºè®®"]
        HashMap -->|"é«˜æ€§èƒ½+æ— åºå­˜å‚¨"| MapResult1["ğŸš€ é€šç”¨é¦–é€‰"]
        ArrayList -->|"é«˜æ•ˆéšæœºè®¿é—®"| ListResult1["ğŸš€ é€šç”¨é¦–é€‰"]
        HashSet -->|"å¿«é€Ÿå»é‡æŸ¥æ‰¾"| SetResult1["ğŸš€ é€šç”¨é¦–é€‰"]
        ArrayDeque -->|"é«˜æ•ˆåŒç«¯é˜Ÿåˆ—"| QueueResult1["ğŸš€ é€šç”¨é¦–é€‰"]
    end
    
    %% æ ·å¼è®¾ç½®
    style Start fill:#E3F2FD,stroke:#1976D2,stroke-width:2px
    style HashMap fill:#C8E6C9,stroke:#4CAF50,stroke-width:2px
    style ArrayList fill:#C8E6C9,stroke:#4CAF50,stroke-width:2px
    style HashSet fill:#C8E6C9,stroke:#4CAF50,stroke-width:2px
    style ArrayDeque fill:#C8E6C9,stroke:#4CAF50,stroke-width:2px
    style MapResult1 fill:#E8F5E8,stroke:#388E3C,stroke-width:2px
    style ListResult1 fill:#E8F5E8,stroke:#388E3C,stroke-width:2px
    style SetResult1 fill:#E8F5E8,stroke:#388E3C,stroke-width:2px
    style QueueResult1 fill:#E8F5E8,stroke:#388E3C,stroke-width:2px
```

#### åœºæ™¯åŒ–é€‰æ‹©æŒ‡å—

**1. Webåº”ç”¨å¼€å‘**
```java
// ç”¨æˆ·ä¼šè¯ç®¡ç† - éœ€è¦çº¿ç¨‹å®‰å…¨
ConcurrentHashMap<String, UserSession> sessionMap = new ConcurrentHashMap<>();

// é…ç½®ä¿¡æ¯å­˜å‚¨ - éœ€è¦æ’åºå±•ç¤º
TreeMap<String, String> configMap = new TreeMap<>();

// ç”¨æˆ·æƒé™åˆ—è¡¨ - å¿«é€Ÿå»é‡æŸ¥æ‰¾
HashSet<String> permissions = new HashSet<>();

// æ“ä½œæ—¥å¿—è®°å½• - é¢‘ç¹å°¾éƒ¨æ’å…¥
ArrayList<LogEntry> operationLogs = new ArrayList<>();
```

**2. æ•°æ®å¤„ç†ç³»ç»Ÿ**
```java
// å¤§é‡æ•°æ®æ‰¹å¤„ç† - å†…å­˜æ•ˆç‡ä¼˜å…ˆ
ArrayList<DataRecord> batchData = new ArrayList<>(10000);

// å®æ—¶æ•°æ®æµå¤„ç† - é¢‘ç¹æ’å…¥åˆ é™¤
LinkedList<StreamEvent> eventQueue = new LinkedList<>();

// æ’è¡Œæ¦œç³»ç»Ÿ - è‡ªåŠ¨æ’åº
TreeSet<ScoreEntry> leaderboard = new TreeSet<>();
```

**3. ç¼“å­˜ç³»ç»Ÿè®¾è®¡**
```java
// LRUç¼“å­˜å®ç° - ä¿æŒè®¿é—®é¡ºåº
LinkedHashMap<String, CacheItem> lruCache = 
    new LinkedHashMap<>(16, 0.75f, true) {
        @Override
        protected boolean removeEldestEntry(Map.Entry<String, CacheItem> eldest) {
            return size() > MAX_SIZE;
        }
    };

// å¤šçº§ç¼“å­˜ - å¹¶å‘å®‰å…¨
ConcurrentHashMap<String, Object> level1Cache = new ConcurrentHashMap<>();
```

#### æ€§èƒ½è°ƒä¼˜å»ºè®®

**å†…å­˜ä¼˜åŒ–ç­–ç•¥**

| é›†åˆç±»å‹ | ä¼˜åŒ–å»ºè®® | ä»£ç ç¤ºä¾‹ |
|----------|----------|----------|
| **ArrayList** | é¢„è®¾åˆå§‹å®¹é‡ | `new ArrayList<>(expectedSize)` |
| **HashMap** | è®¾ç½®åˆç†è´Ÿè½½å› å­ | `new HashMap<>(capacity, 0.75f)` |
| **HashSet** | åŸºäºå…ƒç´ æ•°é‡é¢„è®¾å®¹é‡ | `new HashSet<>(elementCount * 4/3)` |

**å¹¶å‘æ€§èƒ½ä¼˜åŒ–**

| åœºæ™¯ | ä¸æ¨è | æ¨è | åŸå›  |
|------|--------|------|------|
| **é«˜å¹¶å‘è¯»å†™** | `Collections.synchronizedMap()` | `ConcurrentHashMap` | é”ç²’åº¦æ›´ç»†ï¼Œæ€§èƒ½æ›´å¥½ |
| **è¯»å¤šå†™å°‘** | `Vector` | `CopyOnWriteArrayList` | è¯»æ“ä½œæ— é”ï¼Œé€‚åˆè¯»å¤šåœºæ™¯ |
| **ç”Ÿäº§è€…æ¶ˆè´¹è€…** | `synchronized` + `ArrayList` | `BlockingQueueå®ç°` | ä¸“é—¨çš„å¹¶å‘æ•°æ®ç»“æ„ |

### é›†åˆä½¿ç”¨æœ€ä½³å®è·µ

```java
/**
 * é›†åˆä½¿ç”¨æœ€ä½³å®è·µ
 */
public class CollectionBestPractices {
    
    /**
     * é€‰æ‹©åˆé€‚çš„é›†åˆç±»å‹
     */
    public void chooseRightCollection() {
        // 1. éœ€è¦ç´¢å¼•è®¿é—® -> ArrayList
        List<String> indexedList = new ArrayList<>();
        
        // 2. é¢‘ç¹æ’å…¥åˆ é™¤ -> LinkedList
        List<String> modifiableList = new LinkedList<>();
        
        // 3. å»é‡å­˜å‚¨ -> HashSet
        Set<String> uniqueItems = new HashSet<>();
        
        // 4. æœ‰åºå»é‡ -> TreeSet
        Set<String> sortedUniqueItems = new TreeSet<>();
        
        // 5. é”®å€¼å¯¹å­˜å‚¨ -> HashMap
        Map<String, Object> keyValueStore = new HashMap<>();
        
        // 6. æœ‰åºé”®å€¼å¯¹ -> TreeMap
        Map<String, Object> sortedKeyValueStore = new TreeMap<>();
    }
    
    /**
     * æ€§èƒ½ä¼˜åŒ–æŠ€å·§
     */
    public void performanceOptimization() {
        // 1. é¢„è®¾å®¹é‡é¿å…æ‰©å®¹
        List<String> list = new ArrayList<>(1000);
        Map<String, String> map = new HashMap<>(1000);
        
        // 2. ä½¿ç”¨åˆé€‚çš„è´Ÿè½½å› å­
        Map<String, String> optimizedMap = new HashMap<>(16, 0.75f);
        
        // 3. æ‰¹é‡æ“ä½œ
        List<String> source = Arrays.asList("a", "b", "c");
        List<String> target = new ArrayList<>();
        target.addAll(source);  // æ‰¹é‡æ·»åŠ 
        
        // 4. ä½¿ç”¨Iteratoråˆ é™¤å…ƒç´ 
        Iterator<String> iterator = list.iterator();
        while (iterator.hasNext()) {
            String item = iterator.next();
            if (shouldRemove(item)) {
                iterator.remove();  // å®‰å…¨åˆ é™¤
            }
        }
    }
    
    /**
     * çº¿ç¨‹å®‰å…¨å¤„ç†
     */
    public void threadSafetyHandling() {
        // 1. ä½¿ç”¨å¹¶å‘é›†åˆ
        Map<String, String> concurrentMap = new ConcurrentHashMap<>();
        List<String> copyOnWriteList = new CopyOnWriteArrayList<>();
        
        // 2. åŒæ­¥åŒ…è£…å™¨ï¼ˆæ€§èƒ½è¾ƒå·®ï¼‰
        List<String> syncList = Collections.synchronizedList(new ArrayList<>());
        Map<String, String> syncMap = Collections.synchronizedMap(new HashMap<>());
        
        // 3. å¤–éƒ¨åŒæ­¥
        List<String> list = new ArrayList<>();
        synchronized (list) {
            list.add("item");
        }
    }
}
```

## å‡½æ•°å¼ç¼–ç¨‹

### Lambdaè¡¨è¾¾å¼

**Lambdaè¡¨è¾¾å¼**æ˜¯Java 8å¼•å…¥çš„é‡è¦ç‰¹æ€§ï¼Œæä¾›äº†**ç®€æ´çš„å‡½æ•°å¼ç¼–ç¨‹**æ–¹å¼ã€‚

```java
/**
 * Lambdaè¡¨è¾¾å¼è¯¦è§£
 * è¯­æ³•ï¼š(å‚æ•°) -> è¡¨è¾¾å¼ æˆ– (å‚æ•°) -> { è¯­å¥å— }
 */
public class LambdaExample {
    
    /**
     * åŸºç¡€è¯­æ³•ç¤ºä¾‹
     */
    public void basicSyntax() {
        // æ— å‚æ•°Lambda
        Runnable r1 = () -> System.out.println("Hello Lambda");
        
        // å•å‚æ•°Lambdaï¼ˆå¯çœç•¥æ‹¬å·ï¼‰
        Consumer<String> c1 = s -> System.out.println(s);
        Consumer<String> c2 = (s) -> System.out.println(s);
        
        // å¤šå‚æ•°Lambda
        BinaryOperator<Integer> add = (a, b) -> a + b;
        
        // å¤šè¡ŒLambda
        Function<String, String> processor = (input) -> {
            String processed = input.trim().toLowerCase();
            return processed.isEmpty() ? "empty" : processed;
        };
        
        // æ–¹æ³•å¼•ç”¨
        List<String> list = Arrays.asList("a", "b", "c");
        list.forEach(System.out::println);  // ç­‰ä»·äº s -> System.out.println(s)
    }
    
    /**
     * å˜é‡æ•è·
     */
    public void variableCapture() {
        String prefix = "Hello ";  // æœ‰æ•ˆfinalå˜é‡
        
        Function<String, String> greeter = name -> prefix + name;
        
        // prefix = "Hi ";  // ç¼–è¯‘é”™è¯¯ï¼šLambdaä¸­ä½¿ç”¨çš„å˜é‡å¿…é¡»æ˜¯finalæˆ–æœ‰æ•ˆfinal
        
        // å®ä¾‹å˜é‡å’Œé™æ€å˜é‡å¯ä»¥ä¿®æ”¹
        List<String> results = new ArrayList<>();
        Stream.of("a", "b", "c")
              .forEach(s -> results.add(s.toUpperCase()));
    }
    
    /**
     * ç±»å‹æ¨æ–­
     */
    public void typeInference() {
        // ç¼–è¯‘å™¨å¯ä»¥æ¨æ–­å‚æ•°ç±»å‹
        List<String> list = Arrays.asList("apple", "banana", "cherry");
        
        // æ˜¾å¼ç±»å‹å£°æ˜
        list.sort((String a, String b) -> a.compareTo(b));
        
        // ç±»å‹æ¨æ–­
        list.sort((a, b) -> a.compareTo(b));
        
        // æ–¹æ³•å¼•ç”¨
        list.sort(String::compareTo);
    }
}
```

### Stream API

**Stream API**æä¾›äº†**å£°æ˜å¼çš„æ•°æ®å¤„ç†**æ–¹å¼ï¼Œæ”¯æŒé“¾å¼æ“ä½œã€‚

```java
/**
 * Stream APIè¯¦è§£
 * ç‰¹ç‚¹ï¼šå£°æ˜å¼ã€å¯é“¾å¼è°ƒç”¨ã€æ”¯æŒå¹¶è¡Œå¤„ç†
 */
public class StreamExample {
    
    /**
     * åˆ›å»ºStreamçš„æ–¹å¼
     */
    public void createStreams() {
        // 1. ä»é›†åˆåˆ›å»º
        List<String> list = Arrays.asList("a", "b", "c");
        Stream<String> stream1 = list.stream();
        
        // 2. ä»æ•°ç»„åˆ›å»º
        String[] array = {"a", "b", "c"};
        Stream<String> stream2 = Arrays.stream(array);
        
        // 3. ä½¿ç”¨Stream.of()
        Stream<String> stream3 = Stream.of("a", "b", "c");
        
        // 4. æ— é™æµ
        Stream<Integer> infiniteStream = Stream.iterate(0, n -> n + 1);
        Stream<Double> randomStream = Stream.generate(Math::random);
        
        // 5. æ•°å€¼æµ
        IntStream intStream = IntStream.range(1, 100);
        LongStream longStream = LongStream.rangeClosed(1, 100);
    }
    
    /**
     * ä¸­é—´æ“ä½œï¼ˆæƒ°æ€§æ±‚å€¼ï¼‰
     */
    public void intermediateOperations() {
        List<String> words = Arrays.asList("apple", "banana", "cherry", "date");
        
        // filterï¼šè¿‡æ»¤
        words.stream()
             .filter(word -> word.length() > 5)
             .forEach(System.out::println);
        
        // mapï¼šè½¬æ¢
        words.stream()
             .map(String::toUpperCase)
             .forEach(System.out::println);
        
        // flatMapï¼šæ‰å¹³åŒ–
        List<List<String>> nestedList = Arrays.asList(
            Arrays.asList("a", "b"),
            Arrays.asList("c", "d")
        );
        nestedList.stream()
                  .flatMap(List::stream)
                  .forEach(System.out::println);
        
        // distinctï¼šå»é‡
        Arrays.asList("a", "b", "a", "c")
              .stream()
              .distinct()
              .forEach(System.out::println);
        
        // sortedï¼šæ’åº
        words.stream()
             .sorted()
             .forEach(System.out::println);
        
        // limitï¼šé™åˆ¶æ•°é‡
        words.stream()
             .limit(2)
             .forEach(System.out::println);
        
        // skipï¼šè·³è¿‡
        words.stream()
             .skip(1)
             .forEach(System.out::println);
    }
    
    /**
     * ç»ˆç«¯æ“ä½œï¼ˆè§¦å‘è®¡ç®—ï¼‰
     */
    public void terminalOperations() {
        List<Integer> numbers = Arrays.asList(1, 2, 3, 4, 5);
        
        // forEachï¼šéå†
        numbers.stream().forEach(System.out::println);
        
        // collectï¼šæ”¶é›†
        List<Integer> evenNumbers = numbers.stream()
                                          .filter(n -> n % 2 == 0)
                                          .collect(Collectors.toList());
        
        // reduceï¼šå½’çº¦
        Optional<Integer> sum = numbers.stream()
                                      .reduce((a, b) -> a + b);
        int sum2 = numbers.stream()
                         .reduce(0, Integer::sum);
        
        // countï¼šè®¡æ•°
        long count = numbers.stream()
                           .filter(n -> n > 3)
                           .count();
        
        // anyMatch/allMatch/noneMatchï¼šåŒ¹é…
        boolean hasEven = numbers.stream().anyMatch(n -> n % 2 == 0);
        boolean allPositive = numbers.stream().allMatch(n -> n > 0);
        boolean noneNegative = numbers.stream().noneMatch(n -> n < 0);
        
        // findFirst/findAnyï¼šæŸ¥æ‰¾
        Optional<Integer> first = numbers.stream()
                                        .filter(n -> n > 3)
                                        .findFirst();
        
        // min/maxï¼šæœ€å€¼
        Optional<Integer> min = numbers.stream().min(Integer::compareTo);
        Optional<Integer> max = numbers.stream().max(Integer::compareTo);
    }
    
    /**
     * æ”¶é›†å™¨ä½¿ç”¨
     */
    public void collectorsUsage() {
        List<Person> people = Arrays.asList(
            new Person("Alice", 25, "Engineer"),
            new Person("Bob", 30, "Manager"),
            new Person("Charlie", 25, "Engineer")
        );
        
        // è½¬æ¢ä¸ºList
        List<String> names = people.stream()
                                  .map(Person::getName)
                                  .collect(Collectors.toList());
        
        // è½¬æ¢ä¸ºSet
        Set<String> departments = people.stream()
                                       .map(Person::getDepartment)
                                       .collect(Collectors.toSet());
        
        // åˆ†ç»„
        Map<String, List<Person>> byDepartment = 
            people.stream()
                  .collect(Collectors.groupingBy(Person::getDepartment));
        
        // åˆ†åŒº
        Map<Boolean, List<Person>> partitioned = 
            people.stream()
                  .collect(Collectors.partitioningBy(p -> p.getAge() > 25));
        
        // ç»Ÿè®¡
        IntSummaryStatistics ageStats = 
            people.stream()
                  .collect(Collectors.summarizingInt(Person::getAge));
        
        // è¿æ¥å­—ç¬¦ä¸²
        String nameList = people.stream()
                               .map(Person::getName)
                               .collect(Collectors.joining(", "));
    }
    
    /**
     * å¹¶è¡Œæµ
     */
    public void parallelStreams() {
        List<Integer> numbers = IntStream.range(1, 1000000)
                                       .boxed()
                                       .collect(Collectors.toList());
        
        // ä¸²è¡Œå¤„ç†
        long start = System.currentTimeMillis();
        long sum1 = numbers.stream()
                          .mapToLong(Integer::longValue)
                          .sum();
        long serialTime = System.currentTimeMillis() - start;
        
        // å¹¶è¡Œå¤„ç†
        start = System.currentTimeMillis();
        long sum2 = numbers.parallelStream()
                          .mapToLong(Integer::longValue)
                          .sum();
        long parallelTime = System.currentTimeMillis() - start;
        
        System.out.println("ä¸²è¡Œè€—æ—¶ï¼š" + serialTime + "ms");
        System.out.println("å¹¶è¡Œè€—æ—¶ï¼š" + parallelTime + "ms");
    }
}
```

### å‡½æ•°å¼æ¥å£

Java 8æä¾›äº†ä¸°å¯Œçš„**å‡½æ•°å¼æ¥å£**ï¼Œæ”¯æŒå‡½æ•°å¼ç¼–ç¨‹èŒƒå¼ã€‚

```java
/**
 * å¸¸ç”¨å‡½æ•°å¼æ¥å£
 */
public class FunctionalInterfaceExample {
    
    /**
     * åŸºæœ¬å‡½æ•°å¼æ¥å£
     */
    public void basicFunctionalInterfaces() {
        // Supplierï¼šä¾›åº”è€…ï¼Œæ— å‚æ•°æœ‰è¿”å›å€¼
        Supplier<String> stringSupplier = () -> "Hello World";
        Supplier<Double> randomSupplier = Math::random;
        
        // Consumerï¼šæ¶ˆè´¹è€…ï¼Œæœ‰å‚æ•°æ— è¿”å›å€¼
        Consumer<String> printer = System.out::println;
        Consumer<String> upperCasePrinter = s -> System.out.println(s.toUpperCase());
        
        // Functionï¼šå‡½æ•°ï¼Œæœ‰å‚æ•°æœ‰è¿”å›å€¼
        Function<String, Integer> lengthFunction = String::length;
        Function<Integer, String> toStringFunction = Object::toString;
        
        // Predicateï¼šæ–­è¨€ï¼Œæœ‰å‚æ•°è¿”å›boolean
        Predicate<String> isEmpty = String::isEmpty;
        Predicate<Integer> isEven = n -> n % 2 == 0;
        
        // UnaryOperatorï¼šä¸€å…ƒæ“ä½œç¬¦ï¼Œè¾“å…¥è¾“å‡ºç±»å‹ç›¸åŒ
        UnaryOperator<String> toUpperCase = String::toUpperCase;
        
        // BinaryOperatorï¼šäºŒå…ƒæ“ä½œç¬¦ï¼Œä¸¤ä¸ªè¾“å…¥ä¸€ä¸ªè¾“å‡ºï¼Œç±»å‹ç›¸åŒ
        BinaryOperator<Integer> add = Integer::sum;
        BinaryOperator<String> concat = String::concat;
    }
    
    /**
     * å‡½æ•°å¼æ¥å£ç»„åˆ
     */
    public void functionalInterfaceComposition() {
        // Functionç»„åˆ
        Function<String, String> trim = String::trim;
        Function<String, String> upperCase = String::toUpperCase;
        Function<String, String> combined = trim.andThen(upperCase);
        
        // Predicateç»„åˆ
        Predicate<String> notEmpty = s -> !s.isEmpty();
        Predicate<String> notBlank = s -> !s.trim().isEmpty();
        Predicate<String> valid = notEmpty.and(notBlank);
        
        // Consumerç»„åˆ
        Consumer<String> print = System.out::println;
        Consumer<String> log = s -> System.err.println("LOG: " + s);
        Consumer<String> printAndLog = print.andThen(log);
    }
    
    /**
     * è‡ªå®šä¹‰å‡½æ•°å¼æ¥å£
     */
    @FunctionalInterface
    public interface TriFunction<T, U, V, R> {
        R apply(T t, U u, V v);
        
        // é»˜è®¤æ–¹æ³•
        default <W> TriFunction<T, U, V, W> andThen(Function<? super R, ? extends W> after) {
            Objects.requireNonNull(after);
            return (T t, U u, V v) -> after.apply(apply(t, u, v));
        }
    }
    
    public void customFunctionalInterface() {
        TriFunction<Integer, Integer, Integer, Integer> sum3 = 
            (a, b, c) -> a + b + c;
        
        int result = sum3.apply(1, 2, 3);  // 6
    }
}
```

### æ–¹æ³•å¼•ç”¨

**æ–¹æ³•å¼•ç”¨**æ˜¯Lambdaè¡¨è¾¾å¼çš„ç®€åŒ–å½¢å¼ï¼Œæä¾›äº†æ›´ç®€æ´çš„è¯­æ³•ã€‚

```java
/**
 * æ–¹æ³•å¼•ç”¨è¯¦è§£
 * è¯­æ³•ï¼šç±»å::æ–¹æ³•å æˆ– å¯¹è±¡::æ–¹æ³•å
 */
public class MethodReferenceExample {
    
    /**
     * é™æ€æ–¹æ³•å¼•ç”¨
     */
    public void staticMethodReference() {
        List<String> numbers = Arrays.asList("1", "2", "3");
        
        // Lambdaè¡¨è¾¾å¼
        List<Integer> integers1 = numbers.stream()
                                        .map(s -> Integer.parseInt(s))
                                        .collect(Collectors.toList());
        
        // é™æ€æ–¹æ³•å¼•ç”¨
        List<Integer> integers2 = numbers.stream()
                                        .map(Integer::parseInt)
                                        .collect(Collectors.toList());
    }
    
    /**
     * å®ä¾‹æ–¹æ³•å¼•ç”¨
     */
    public void instanceMethodReference() {
        List<String> words = Arrays.asList("apple", "banana", "cherry");
        
        // Lambdaè¡¨è¾¾å¼
        words.stream()
             .map(s -> s.toUpperCase())
             .forEach(s -> System.out.println(s));
        
        // å®ä¾‹æ–¹æ³•å¼•ç”¨
        words.stream()
             .map(String::toUpperCase)
             .forEach(System.out::println);
    }
    
    /**
     * æ„é€ æ–¹æ³•å¼•ç”¨
     */
    public void constructorReference() {
        List<String> names = Arrays.asList("Alice", "Bob", "Charlie");
        
        // Lambdaè¡¨è¾¾å¼
        List<Person> people1 = names.stream()
                                   .map(name -> new Person(name))
                                   .collect(Collectors.toList());
        
        // æ„é€ æ–¹æ³•å¼•ç”¨
        List<Person> people2 = names.stream()
                                   .map(Person::new)
                                   .collect(Collectors.toList());
        
        // æ•°ç»„æ„é€ æ–¹æ³•å¼•ç”¨
        String[] array = names.stream()
                             .toArray(String[]::new);
    }
    
    /**
     * ç‰¹å®šå¯¹è±¡çš„æ–¹æ³•å¼•ç”¨
     */
    public void specificObjectMethodReference() {
        List<String> words = Arrays.asList("hello", "world");
        StringBuilder sb = new StringBuilder();
        
        // Lambdaè¡¨è¾¾å¼
        words.forEach(word -> sb.append(word));
        
        // ç‰¹å®šå¯¹è±¡çš„æ–¹æ³•å¼•ç”¨
        words.forEach(sb::append);
    }
}
```

## åå°„ä¸æ³¨è§£

### åå°„æœºåˆ¶

**åå°„**æ˜¯Javaçš„å¼ºå¤§ç‰¹æ€§ï¼Œå…è®¸ç¨‹åºåœ¨**è¿è¡Œæ—¶æ£€æŸ¥å’Œæ“ä½œç±»ã€æ–¹æ³•ã€å­—æ®µ**ç­‰ã€‚

```java
/**
 * åå°„æœºåˆ¶è¯¦è§£
 * åº”ç”¨åœºæ™¯ï¼šæ¡†æ¶å¼€å‘ã€åŠ¨æ€ä»£ç†ã€æ³¨è§£å¤„ç†ã€åºåˆ—åŒ–
 */
public class ReflectionExample {
    
    /**
     * è·å–Classå¯¹è±¡çš„æ–¹å¼
     */
    public void getClassObject() throws ClassNotFoundException {
        // 1. é€šè¿‡ç±»å.class
        Class<String> clazz1 = String.class;
        
        // 2. é€šè¿‡å¯¹è±¡.getClass()
        String str = "hello";
        Class<?> clazz2 = str.getClass();
        
        // 3. é€šè¿‡Class.forName()
        Class<?> clazz3 = Class.forName("java.lang.String");
        
        // 4. é€šè¿‡ç±»åŠ è½½å™¨
        ClassLoader loader = Thread.currentThread().getContextClassLoader();
        Class<?> clazz4 = loader.loadClass("java.lang.String");
    }
    
    /**
     * ç±»ä¿¡æ¯è·å–
     */
    public void getClassInfo() {
        Class<Person> clazz = Person.class;
        
        // åŸºæœ¬ä¿¡æ¯
        System.out.println("ç±»åï¼š" + clazz.getName());
        System.out.println("ç®€å•ç±»åï¼š" + clazz.getSimpleName());
        System.out.println("åŒ…åï¼š" + clazz.getPackage().getName());
        System.out.println("ä¿®é¥°ç¬¦ï¼š" + Modifier.toString(clazz.getModifiers()));
        
        // çˆ¶ç±»å’Œæ¥å£
        Class<?> superClass = clazz.getSuperclass();
        Class<?>[] interfaces = clazz.getInterfaces();
        
        // å†…éƒ¨ç±»
        Class<?>[] innerClasses = clazz.getDeclaredClasses();
    }
    
    /**
     * å­—æ®µæ“ä½œ
     */
    public void fieldOperations() throws Exception {
        Class<Person> clazz = Person.class;
        Person person = new Person("Alice", 25);
        
        // è·å–æ‰€æœ‰å…¬å…±å­—æ®µ
        Field[] publicFields = clazz.getFields();
        
        // è·å–æ‰€æœ‰å£°æ˜å­—æ®µï¼ˆåŒ…æ‹¬ç§æœ‰ï¼‰
        Field[] declaredFields = clazz.getDeclaredFields();
        
        // è·å–ç‰¹å®šå­—æ®µ
        Field nameField = clazz.getDeclaredField("name");
        nameField.setAccessible(true);  // è®¿é—®ç§æœ‰å­—æ®µ
        
        // è¯»å–å­—æ®µå€¼
        String name = (String) nameField.get(person);
        System.out.println("å§“åï¼š" + name);
        
        // è®¾ç½®å­—æ®µå€¼
        nameField.set(person, "Bob");
        
        // å­—æ®µä¿¡æ¯
        System.out.println("å­—æ®µåï¼š" + nameField.getName());
        System.out.println("å­—æ®µç±»å‹ï¼š" + nameField.getType());
        System.out.println("å­—æ®µä¿®é¥°ç¬¦ï¼š" + Modifier.toString(nameField.getModifiers()));
    }
    
    /**
     * æ–¹æ³•æ“ä½œ
     */
    public void methodOperations() throws Exception {
        Class<Person> clazz = Person.class;
        Person person = new Person("Alice", 25);
        
        // è·å–æ‰€æœ‰å…¬å…±æ–¹æ³•
        Method[] publicMethods = clazz.getMethods();
        
        // è·å–æ‰€æœ‰å£°æ˜æ–¹æ³•
        Method[] declaredMethods = clazz.getDeclaredMethods();
        
        // è·å–ç‰¹å®šæ–¹æ³•
        Method setNameMethod = clazz.getDeclaredMethod("setName", String.class);
        Method getNameMethod = clazz.getDeclaredMethod("getName");
        
        // è°ƒç”¨æ–¹æ³•
        setNameMethod.invoke(person, "Charlie");
        String name = (String) getNameMethod.invoke(person);
        
        // æ–¹æ³•ä¿¡æ¯
        System.out.println("æ–¹æ³•åï¼š" + setNameMethod.getName());
        System.out.println("å‚æ•°ç±»å‹ï¼š" + Arrays.toString(setNameMethod.getParameterTypes()));
        System.out.println("è¿”å›ç±»å‹ï¼š" + setNameMethod.getReturnType());
        System.out.println("å¼‚å¸¸ç±»å‹ï¼š" + Arrays.toString(setNameMethod.getExceptionTypes()));
    }
    
    /**
     * æ„é€ æ–¹æ³•æ“ä½œ
     */
    public void constructorOperations() throws Exception {
        Class<Person> clazz = Person.class;
        
        // è·å–æ‰€æœ‰æ„é€ æ–¹æ³•
        Constructor<?>[] constructors = clazz.getConstructors();
        
        // è·å–ç‰¹å®šæ„é€ æ–¹æ³•
        Constructor<Person> constructor = clazz.getConstructor(String.class, int.class);
        
        // åˆ›å»ºå®ä¾‹
        Person person = constructor.newInstance("David", 30);
        
        // æ— å‚æ„é€ æ–¹æ³•
        Constructor<Person> defaultConstructor = clazz.getConstructor();
        Person person2 = defaultConstructor.newInstance();
        
        // ä½¿ç”¨Class.newInstance()ï¼ˆå·²åºŸå¼ƒï¼‰
        // Person person3 = clazz.newInstance();
    }
    
    /**
     * æ³›å‹ä¿¡æ¯è·å–
     */
    public void genericTypeInfo() throws Exception {
        Class<GenericClass> clazz = GenericClass.class;
        
        // è·å–æ³›å‹çˆ¶ç±»
        Type genericSuperclass = clazz.getGenericSuperclass();
        if (genericSuperclass instanceof ParameterizedType) {
            ParameterizedType paramType = (ParameterizedType) genericSuperclass;
            Type[] actualTypes = paramType.getActualTypeArguments();
        }
        
        // è·å–å­—æ®µçš„æ³›å‹ç±»å‹
        Field listField = clazz.getDeclaredField("list");
        Type genericType = listField.getGenericType();
        if (genericType instanceof ParameterizedType) {
            ParameterizedType paramType = (ParameterizedType) genericType;
            Type[] actualTypes = paramType.getActualTypeArguments();
        }
    }
    
    /**
     * åå°„æ€§èƒ½ä¼˜åŒ–
     */
    public void performanceOptimization() throws Exception {
        Class<Person> clazz = Person.class;
        Method method = clazz.getDeclaredMethod("getName");
        
        // ç¼“å­˜Methodå¯¹è±¡
        Map<String, Method> methodCache = new ConcurrentHashMap<>();
        methodCache.put("getName", method);
        
        // ä½¿ç”¨MethodHandleï¼ˆJava 7+ï¼‰
        MethodHandles.Lookup lookup = MethodHandles.lookup();
        MethodHandle methodHandle = lookup.findVirtual(Person.class, "getName", 
                                                      MethodType.methodType(String.class));
        
        Person person = new Person("Alice", 25);
        
        // ä¼ ç»Ÿåå°„è°ƒç”¨
        String name1 = (String) method.invoke(person);
        
        // MethodHandleè°ƒç”¨ï¼ˆæ€§èƒ½æ›´å¥½ï¼‰
        String name2 = (String) methodHandle.invoke(person);
    }
}

/**
 * ç¤ºä¾‹ç±»
 */
class GenericClass<T> {
    private List<String> list;
    private T data;
}
```

### æ³¨è§£å¤„ç†

**æ³¨è§£**æä¾›äº†**å…ƒæ•°æ®**æ”¯æŒï¼Œå¹¿æ³›ç”¨äºæ¡†æ¶å¼€å‘å’Œä»£ç ç”Ÿæˆã€‚

```java
/**
 * è‡ªå®šä¹‰æ³¨è§£ç¤ºä¾‹
 */

// æ–¹æ³•çº§æ³¨è§£
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.METHOD)
public @interface Audit {
    String value() default "";
    boolean enabled() default true;
    String[] roles() default {};
}

// ç±»çº§æ³¨è§£
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.TYPE)
public @interface Entity {
    String tableName() default "";
    String schema() default "";
}

// å­—æ®µçº§æ³¨è§£
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.FIELD)
public @interface Column {
    String name() default "";
    boolean nullable() default true;
    int length() default 255;
}

// å‚æ•°çº§æ³¨è§£
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.PARAMETER)
public @interface Valid {
    String message() default "å‚æ•°éªŒè¯å¤±è´¥";
}

/**
 * æ³¨è§£ä½¿ç”¨ç¤ºä¾‹
 */
@Entity(tableName = "users", schema = "public")
public class User {
    @Column(name = "user_id", nullable = false)
    private Long id;
    
    @Column(name = "user_name", length = 50)
    private String name;
    
    @Column(name = "email", length = 100)
    private String email;
    
    @Audit(value = "ç”¨æˆ·ç™»å½•", roles = {"USER", "ADMIN"})
    public boolean login(@Valid String username, @Valid String password) {
        // ç™»å½•é€»è¾‘
        return true;
    }
    
    @Audit(value = "æ›´æ–°ç”¨æˆ·ä¿¡æ¯", enabled = true)
    public void updateProfile(@Valid User user) {
        // æ›´æ–°é€»è¾‘
    }
}

/**
 * æ³¨è§£å¤„ç†å™¨
 */
public class AnnotationProcessor {
    
    /**
     * å¤„ç†ç±»çº§æ³¨è§£
     */
    public void processClassAnnotations(Class<?> clazz) {
        if (clazz.isAnnotationPresent(Entity.class)) {
            Entity entity = clazz.getAnnotation(Entity.class);
            System.out.println("è¡¨åï¼š" + entity.tableName());
            System.out.println("æ¨¡å¼ï¼š" + entity.schema());
        }
    }
    
    /**
     * å¤„ç†å­—æ®µæ³¨è§£
     */
    public void processFieldAnnotations(Class<?> clazz) {
        Field[] fields = clazz.getDeclaredFields();
        for (Field field : fields) {
            if (field.isAnnotationPresent(Column.class)) {
                Column column = field.getAnnotation(Column.class);
                System.out.println("å­—æ®µï¼š" + field.getName());
                System.out.println("åˆ—åï¼š" + column.name());
                System.out.println("å¯ç©ºï¼š" + column.nullable());
                System.out.println("é•¿åº¦ï¼š" + column.length());
            }
        }
    }
    
    /**
     * å¤„ç†æ–¹æ³•æ³¨è§£
     */
    public void processMethodAnnotations(Class<?> clazz) {
        Method[] methods = clazz.getDeclaredMethods();
        for (Method method : methods) {
            if (method.isAnnotationPresent(Audit.class)) {
                Audit audit = method.getAnnotation(Audit.class);
                System.out.println("æ–¹æ³•ï¼š" + method.getName());
                System.out.println("å®¡è®¡ä¿¡æ¯ï¼š" + audit.value());
                System.out.println("æ˜¯å¦å¯ç”¨ï¼š" + audit.enabled());
                System.out.println("è§’è‰²ï¼š" + Arrays.toString(audit.roles()));
            }
        }
    }
    
    /**
     * å¤„ç†å‚æ•°æ³¨è§£
     */
    public void processParameterAnnotations(Method method) {
        Parameter[] parameters = method.getParameters();
        Annotation[][] paramAnnotations = method.getParameterAnnotations();
        
        for (int i = 0; i < parameters.length; i++) {
            Parameter param = parameters[i];
            Annotation[] annotations = paramAnnotations[i];
            
            for (Annotation annotation : annotations) {
                if (annotation instanceof Valid) {
                    Valid valid = (Valid) annotation;
                    System.out.println("å‚æ•°ï¼š" + param.getName());
                    System.out.println("éªŒè¯æ¶ˆæ¯ï¼š" + valid.message());
                }
            }
        }
    }
    
    /**
     * æ³¨è§£é©±åŠ¨çš„å¯¹è±¡æ˜ å°„
     */
    public String generateSQL(Class<?> clazz) {
        if (!clazz.isAnnotationPresent(Entity.class)) {
            throw new IllegalArgumentException("ç±»å¿…é¡»æ ‡æ³¨@Entityæ³¨è§£");
        }
        
        Entity entity = clazz.getAnnotation(Entity.class);
        StringBuilder sql = new StringBuilder();
        sql.append("CREATE TABLE ");
        
        if (!entity.schema().isEmpty()) {
            sql.append(entity.schema()).append(".");
        }
        
        sql.append(entity.tableName()).append(" (");
        
        Field[] fields = clazz.getDeclaredFields();
        List<String> columns = new ArrayList<>();
        
        for (Field field : fields) {
            if (field.isAnnotationPresent(Column.class)) {
                Column column = field.getAnnotation(Column.class);
                StringBuilder columnDef = new StringBuilder();
                
                columnDef.append(column.name().isEmpty() ? field.getName() : column.name());
                columnDef.append(" VARCHAR(").append(column.length()).append(")");
                
                if (!column.nullable()) {
                    columnDef.append(" NOT NULL");
                }
                
                columns.add(columnDef.toString());
            }
        }
        
        sql.append(String.join(", ", columns));
        sql.append(")");
        
        return sql.toString();
    }
}
```

### åŠ¨æ€ä»£ç†

**åŠ¨æ€ä»£ç†**æ˜¯åå°„çš„é‡è¦åº”ç”¨ï¼Œç”¨äº**AOPã€æ¡†æ¶å¼€å‘**ç­‰åœºæ™¯ã€‚

```java
/**
 * åŠ¨æ€ä»£ç†ç¤ºä¾‹
 */
public class DynamicProxyExample {
    
    // ä¸šåŠ¡æ¥å£
    public interface UserService {
        void save(User user);
        User findById(Long id);
        void delete(Long id);
    }
    
    // ä¸šåŠ¡å®ç°
    public static class UserServiceImpl implements UserService {
        @Override
        public void save(User user) {
            System.out.println("ä¿å­˜ç”¨æˆ·ï¼š" + user.getName());
        }
        
        @Override
        public User findById(Long id) {
            System.out.println("æŸ¥æ‰¾ç”¨æˆ·ï¼š" + id);
            return new User("User" + id, 25);
        }
        
        @Override
        public void delete(Long id) {
            System.out.println("åˆ é™¤ç”¨æˆ·ï¼š" + id);
        }
    }
    
    /**
     * JDKåŠ¨æ€ä»£ç†
     */
    public static class JdkProxyHandler implements InvocationHandler {
        private final Object target;
        
        public JdkProxyHandler(Object target) {
            this.target = target;
        }
        
        @Override
        public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
            // å‰ç½®å¤„ç†
            System.out.println("=== æ–¹æ³•è°ƒç”¨å‰ ===");
            System.out.println("æ–¹æ³•åï¼š" + method.getName());
            System.out.println("å‚æ•°ï¼š" + Arrays.toString(args));
            
            long startTime = System.currentTimeMillis();
            
            try {
                // è°ƒç”¨ç›®æ ‡æ–¹æ³•
                Object result = method.invoke(target, args);
                
                // åç½®å¤„ç†
                long endTime = System.currentTimeMillis();
                System.out.println("æ–¹æ³•æ‰§è¡Œè€—æ—¶ï¼š" + (endTime - startTime) + "ms");
                System.out.println("=== æ–¹æ³•è°ƒç”¨å ===");
                
                return result;
            } catch (Exception e) {
                System.err.println("æ–¹æ³•æ‰§è¡Œå¼‚å¸¸ï¼š" + e.getMessage());
                throw e;
            }
        }
        
        // åˆ›å»ºä»£ç†å¯¹è±¡
        @SuppressWarnings("unchecked")
        public static <T> T createProxy(T target, Class<T> interfaceClass) {
            return (T) Proxy.newProxyInstance(
                interfaceClass.getClassLoader(),
                new Class[]{interfaceClass},
                new JdkProxyHandler(target)
            );
        }
    }
    
    /**
     * CGLIBåŠ¨æ€ä»£ç†ï¼ˆéœ€è¦å¼•å…¥cglibä¾èµ–ï¼‰
     */
    public static class CglibProxyInterceptor implements MethodInterceptor {
        @Override
        public Object intercept(Object obj, Method method, Object[] args, 
                              MethodProxy proxy) throws Throwable {
            System.out.println("CGLIBä»£ç† - æ–¹æ³•è°ƒç”¨å‰ï¼š" + method.getName());
            
            Object result = proxy.invokeSuper(obj, args);
            
            System.out.println("CGLIBä»£ç† - æ–¹æ³•è°ƒç”¨å");
            return result;
        }
        
        // åˆ›å»ºCGLIBä»£ç†
        @SuppressWarnings("unchecked")
        public static <T> T createProxy(Class<T> clazz) {
            Enhancer enhancer = new Enhancer();
            enhancer.setSuperclass(clazz);
            enhancer.setCallback(new CglibProxyInterceptor());
            return (T) enhancer.create();
        }
    }
    
    /**
     * ä»£ç†ä½¿ç”¨ç¤ºä¾‹
     */
    public static void main(String[] args) {
        // JDKåŠ¨æ€ä»£ç†ï¼ˆåŸºäºæ¥å£ï¼‰
        UserService userService = new UserServiceImpl();
        UserService proxy = JdkProxyHandler.createProxy(userService, UserService.class);
        
        proxy.save(new User("Alice", 25));
        User user = proxy.findById(1L);
        proxy.delete(1L);
        
        // CGLIBä»£ç†ï¼ˆåŸºäºç»§æ‰¿ï¼‰
        // UserServiceImpl cglibProxy = CglibProxyInterceptor.createProxy(UserServiceImpl.class);
        // cglibProxy.save(new User("Bob", 30));
    }
    
    /**
     * ä»£ç†æ¨¡å¼çš„åº”ç”¨åœºæ™¯
     */
    public void proxyApplications() {
        // 1. äº‹åŠ¡ç®¡ç†
        // @Transactionalæ³¨è§£çš„å®ç°åŸç†
        
        // 2. å®‰å…¨æ§åˆ¶
        // æ–¹æ³•çº§æƒé™æ§åˆ¶
        
        // 3. ç¼“å­˜
        // æ–¹æ³•ç»“æœç¼“å­˜
        
        // 4. æ—¥å¿—è®°å½•
        // æ–¹æ³•è°ƒç”¨æ—¥å¿—
        
        // 5. æ€§èƒ½ç›‘æ§
        // æ–¹æ³•æ‰§è¡Œæ—¶é—´ç»Ÿè®¡
        
        // 6. å»¶è¿ŸåŠ è½½
        // å¯¹è±¡å±æ€§çš„æ‡’åŠ è½½
    }
}
 String last = set.last();
    }
}
```

#### ç‰¹æ®ŠSetå®ç°
```java
public class SpecialSetExample {
    /**
     * LinkedHashSet
     * ç‰¹ç‚¹ï¼šç»´æŠ¤æ’å…¥é¡ºåºçš„HashSet
     */
    public void linkedHashSetDemo() {
        LinkedHashSet<String> set = new LinkedHashSet<>();
        set.add("C");
        set.add("A");
        set.add("B");
        // éå†é¡ºåºï¼šC, A, B
    }
    
    /**
     * ConcurrentSkipListSet
     * ç‰¹ç‚¹ï¼šçº¿ç¨‹å®‰å…¨çš„æœ‰åºSet
     */
    public void concurrentSetDemo() {
        ConcurrentSkipListSet<Integer> set = new ConcurrentSkipListSet<>();
        set.add(5);
        set.add(1);
        set.add(3);
        // è‡ªåŠ¨æ’åºï¼š1, 3, 5
    }
}
```

### å‡½æ•°å¼ç¼–ç¨‹

#### Lambdaè¡¨è¾¾å¼
```java
public class LambdaExample {
    public void lambdaDemo() {
        // åŸºæœ¬è¯­æ³•
        Runnable r = () -> System.out.println("Hello Lambda");
        
        // å¸¦å‚æ•°
        Consumer<String> printer = s -> System.out.println(s);
        
        // å¤šè¡Œè¯­å¥
        Comparator<String> comparator = (s1, s2) -> {
            if (s1 == null) return -1;
            if (s2 == null) return 1;
            return s1.compareTo(s2);
        };
    }
}
```

#### Stream API
```java
public class StreamExample {
    public void streamOperations() {
        List<String> list = Arrays.asList("A", "B", "C");
        
        // è½¬æ¢
        list.stream()
            .map(String::toLowerCase)
            .collect(Collectors.toList());
        
        // è¿‡æ»¤
        list.stream()
            .filter(s -> s.startsWith("A"))
            .collect(Collectors.toList());
        
        // æ’åº
        list.stream()
            .sorted()
            .collect(Collectors.toList());
        
        // åˆ†ç»„
        Map<Integer, List<String>> groups = list.stream()
            .collect(Collectors.groupingBy(String::length));
    }
}
```

### åå°„ä¸æ³¨è§£

### åå°„æœºåˆ¶
```java
/**
 * åå°„åº”ç”¨åœºæ™¯
 * 1. æ¡†æ¶å¼€å‘
 * 2. åŠ¨æ€ä»£ç†
 * 3. æ³¨è§£å¤„ç†
 */

public class ReflectionExample {
    // åå°„è·å–ç±»ä¿¡æ¯
    public void reflectionInfo() {
        Class<?> clazz = Class.forName("com.example.User");
        
        // è·å–æ‰€æœ‰æ–¹æ³•
        Method[] methods = clazz.getDeclaredMethods();
        
        // è·å–ç‰¹å®šæ–¹æ³•
        Method method = clazz.getDeclaredMethod("getName");
        method.setAccessible(true);  // è®¿é—®ç§æœ‰æ–¹æ³•
        
        // åˆ›å»ºå®ä¾‹
        Constructor<?> constructor = clazz.getDeclaredConstructor();
        Object instance = constructor.newInstance();
        
        // è°ƒç”¨æ–¹æ³•
        Object result = method.invoke(instance);
    }
    
    // åŠ¨æ€ä»£ç†
    public interface UserService {
        void save(User user);
    }
    
    public class ServiceProxy implements InvocationHandler {
        private final Object target;
        
        public ServiceProxy(Object target) {
            this.target = target;
        }
        
        @Override
        public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
            System.out.println("Before method: " + method.getName());
            Object result = method.invoke(target, args);
            System.out.println("After method: " + method.getName());
            return result;
        }
    }
}
```

### æ³¨è§£å¤„ç†
```java
/**
 * è‡ªå®šä¹‰æ³¨è§£ä¸å¤„ç†å™¨
 */

// è‡ªå®šä¹‰æ³¨è§£
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.METHOD)
public @interface Audit {
    String value() default "";
    boolean enabled() default true;
}

// æ³¨è§£å¤„ç†
public class AnnotationProcessor {
    public void processAnnotations(Object obj) {
        Class<?> clazz = obj.getClass();
        for (Method method : clazz.getDeclaredMethods()) {
            Audit audit = method.getAnnotation(Audit.class);
            if (audit != null && audit.enabled()) {
                // å¤„ç†æ³¨è§£é€»è¾‘
            }
        }
    }
}
```

## åƒåœ¾å›æ”¶æœºåˆ¶

### åƒåœ¾å›æ”¶åŸºæœ¬åŸç†

åƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼ŒGCï¼‰æ˜¯Javaè™šæ‹Ÿæœºè‡ªåŠ¨ç®¡ç†å†…å­˜çš„é‡è¦æœºåˆ¶ï¼Œå®ƒèƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«å¹¶æ¸…ç†ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œé‡Šæ”¾å†…å­˜ç©ºé—´ã€‚

```mermaid
flowchart TD
    subgraph "ğŸš€ GCè§¦å‘é˜¶æ®µ" ["GCè§¦å‘é˜¶æ®µ"]
        Start["åƒåœ¾å›æ”¶å¯åŠ¨"] -->|"å †å†…å­˜ä¸è¶³/é˜ˆå€¼è¶…é™/System.gc()"| GCType{{"GCç±»å‹åˆ¤æ–­"}}
    end
    
    subgraph "ğŸ” æ ‡è®°é˜¶æ®µ" ["æ ‡è®°é˜¶æ®µ"]
        Mark["æ ¹å¯¹è±¡æ ‡è®°"] -->|"GC Roots: è™šæ‹Ÿæœºæ ˆ/æ–¹æ³•åŒº/JNI/ç±»åŠ è½½å™¨"| Traverse["å¯è¾¾æ€§åˆ†æ"]
        Traverse -->|"å¼ºå¼•ç”¨/è½¯å¼•ç”¨/å¼±å¼•ç”¨/è™šå¼•ç”¨åˆ¤æ–­"| MarkResult["æ ‡è®°å®Œæˆ"]
    end
    
    subgraph "ğŸŒ± æ–°ç”Ÿä»£å›æ”¶" ["æ–°ç”Ÿä»£å›æ”¶"]
        MinorGC["Minor GCæ‰§è¡Œ"] -->|"STW + å¤åˆ¶ç®—æ³•"| Copy["å­˜æ´»å¯¹è±¡å¤åˆ¶"]
        Copy -->|"Edenâ†’Survivor, Fromâ†’To"| AgeCheck{{"å¹´é¾„æ£€æŸ¥"}}
        AgeCheck -->|"å¹´é¾„â‰¥15"| Promote["æ™‹å‡è€å¹´ä»£"]
        AgeCheck -->|"å¹´é¾„<15"| Stay["ç•™åœ¨æ–°ç”Ÿä»£"]
    end
    
    subgraph "ğŸ  è€å¹´ä»£å›æ”¶" ["è€å¹´ä»£å›æ”¶"]
        MajorGC["Major/Full GCæ‰§è¡Œ"] -->|"æ ¹æ®æ”¶é›†å™¨é€‰æ‹©"| Algorithm{{"ç®—æ³•é€‰æ‹©"}}
        Algorithm -->|"Serial/Parallel Old"| MarkCompact["æ ‡è®°-æ•´ç†"]
        Algorithm -->|"CMS"| ConcurrentMS["å¹¶å‘æ ‡è®°æ¸…é™¤"]
        Algorithm -->|"G1/ZGC"| RegionalGC["åŒºåŸŸåŒ–å›æ”¶"]
    end
    
    subgraph "ğŸ“‹ å›æ”¶åå¤„ç†" ["å›æ”¶åå¤„ç†"]
        PostProcess["å†…å­˜é‡Šæ”¾"] -->|"æ›´æ–°ç»Ÿè®¡/è®°å½•æ—¥å¿—"| Complete["GCå®Œæˆ"]
        Complete -->|"è§¦å‘æ¡ä»¶æ»¡è¶³"| CheckNext{{"æ£€æŸ¥ä¸‹æ¬¡GC"}}
    end
    
    %% ä¸»æµç¨‹è¿æ¥
    GCType -->|"æ–°ç”Ÿä»£ç©ºé—´ä¸è¶³"| Mark
    GCType -->|"è€å¹´ä»£ç©ºé—´ä¸è¶³"| Mark
    MarkResult --> MinorGC
    MarkResult --> MajorGC
    Promote --> PostProcess
    Stay --> PostProcess
    MarkCompact --> PostProcess
    ConcurrentMS --> PostProcess
    RegionalGC --> PostProcess
    CheckNext -->|"æ˜¯"| Start
    CheckNext -->|"å¦"| End["GCå‘¨æœŸç»“æŸ"]
    
    %% æ ·å¼è®¾ç½®
    style Start fill:#E3F2FD,stroke:#1976D2,stroke-width:2px
    style Mark fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px
    style MinorGC fill:#FFF3E0,stroke:#F57C00,stroke-width:2px
    style MajorGC fill:#E8F5E8,stroke:#388E3C,stroke-width:2px
    style PostProcess fill:#FCE4EC,stroke:#C2185B,stroke-width:2px
    style End fill:#E0F2F1,stroke:#00695C,stroke-width:2px
```

**å¯¹è±¡å­˜æ´»åˆ¤æ–­æ–¹æ³•ï¼š**

1. **å¼•ç”¨è®¡æ•°æ³•**ï¼šç»™å¯¹è±¡æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒæ—¶ï¼Œè®¡æ•°å™¨å€¼åŠ 1ï¼›å½“å¼•ç”¨å¤±æ•ˆæ—¶ï¼Œè®¡æ•°å™¨å€¼å‡1ï¼›è®¡æ•°å™¨ä¸º0çš„å¯¹è±¡ä¸å¯èƒ½å†è¢«ä½¿ç”¨ã€‚
   - **ä¼˜ç‚¹**ï¼šå®ç°ç®€å•ï¼Œåˆ¤å®šæ•ˆç‡é«˜
   - **ç¼ºç‚¹**ï¼šæ— æ³•è§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜

2. **å¯è¾¾æ€§åˆ†æç®—æ³•**ï¼šä»GC Rootså¼€å§‹å‘ä¸‹æœç´¢ï¼Œæœç´¢æ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºå¼•ç”¨é“¾ã€‚å½“ä¸€ä¸ªå¯¹è±¡åˆ°GC Rootsæ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿æ—¶ï¼Œåˆ™è¯æ˜æ­¤å¯¹è±¡æ˜¯ä¸å¯ç”¨çš„ã€‚
   - **GC RootsåŒ…æ‹¬**ï¼š
     - è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡
     - æ–¹æ³•åŒºä¸­é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡
     - æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡
     - æœ¬åœ°æ–¹æ³•æ ˆä¸­JNIå¼•ç”¨çš„å¯¹è±¡

**å¼•ç”¨ç±»å‹ï¼š**

1. **å¼ºå¼•ç”¨**ï¼šæœ€å¸¸è§çš„å¼•ç”¨ç±»å‹ï¼Œå¦‚`Object obj = new Object()`ï¼Œåªè¦å¼ºå¼•ç”¨å­˜åœ¨ï¼Œåƒåœ¾æ”¶é›†å™¨æ°¸è¿œä¸ä¼šå›æ”¶è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚

2. **è½¯å¼•ç”¨**ï¼šæè¿°æœ‰ç”¨ä½†éå¿…éœ€çš„å¯¹è±¡ï¼Œåœ¨ç³»ç»Ÿå°†è¦å‘ç”Ÿå†…å­˜æº¢å‡ºå‰ï¼Œä¼šå›æ”¶è½¯å¼•ç”¨å¯¹è±¡ã€‚
   ```java
   SoftReference<Object> softRef = new SoftReference<>(new Object());
   ```

3. **å¼±å¼•ç”¨**ï¼šæè¿°éå¿…éœ€å¯¹è±¡ï¼Œæ¯”è½¯å¼•ç”¨æ›´å¼±ï¼Œä¸€æ—¦å‘ç”Ÿåƒåœ¾æ”¶é›†ï¼Œæ— è®ºå†…å­˜æ˜¯å¦è¶³å¤Ÿï¼Œéƒ½ä¼šå›æ”¶å¼±å¼•ç”¨å¯¹è±¡ã€‚
   ```java
   WeakReference<Object> weakRef = new WeakReference<>(new Object());
   ```

4. **è™šå¼•ç”¨**ï¼šæœ€å¼±çš„å¼•ç”¨ï¼Œä¸ä¼šå½±å“å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œç”¨äºè·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶çš„çŠ¶æ€ã€‚
   ```java
   PhantomReference<Object> phantomRef = new PhantomReference<>(new Object(), referenceQueue);
   ```

### åƒåœ¾å›æ”¶ç®—æ³•

Javaåƒåœ¾å›æ”¶ç®—æ³•çš„æ•´ä½“ç»“æ„å¦‚ä¸‹ï¼š

```mermaid
flowchart TD
    subgraph "ğŸ”§ ç®—æ³•é€‰æ‹©å› ç´ " ["ç®—æ³•é€‰æ‹©å› ç´ "]
        Start["åƒåœ¾å›æ”¶ç®—æ³•é€‰æ‹©"] -->|"å †åŒºåŸŸ+å¯¹è±¡å­˜æ´»ç‡+å†…å­˜è¦æ±‚+åœé¡¿æ—¶é—´"| ChoiceFactors{{"é€‰æ‹©å†³ç­–æ ‘"}}
    end
    
    subgraph "ğŸ§¹ æ ‡è®°-æ¸…é™¤ç®—æ³•" ["æ ‡è®°-æ¸…é™¤ç®—æ³•"]
        MarkSweep["æ ‡è®°-æ¸…é™¤æ‰§è¡Œ"] -->|"æ ‡è®°: GC Rootséå†"| MSMark["æ ‡è®°å¯è¾¾å¯¹è±¡"]
        MSMark -->|"æ¸…é™¤: ç›´æ¥å›æ”¶"| MSSweep["æ¸…é™¤æœªæ ‡è®°å¯¹è±¡"]
        MSSweep -->|"ä¼˜ç‚¹: å®ç°ç®€å• | ç¼ºç‚¹: å†…å­˜ç¢ç‰‡"| MSResult["é€‚ç”¨äºè€å¹´ä»£"]
    end
    
    subgraph "ğŸ“‹ æ ‡è®°-å¤åˆ¶ç®—æ³•" ["æ ‡è®°-å¤åˆ¶ç®—æ³•"]
        MarkCopy["æ ‡è®°-å¤åˆ¶æ‰§è¡Œ"] -->|"å†…å­˜åˆ’åˆ†ä¸ºFrom/Toä¸¤å—"| MCMark["æ ‡è®°å­˜æ´»å¯¹è±¡"]
        MCMark -->|"å¤åˆ¶: Fromâ†’To"| MCCopy["å¤åˆ¶å­˜æ´»å¯¹è±¡"]
        MCCopy -->|"ä¼˜ç‚¹: æ— ç¢ç‰‡ | ç¼ºç‚¹: å†…å­˜åˆ©ç”¨ç‡50%"| MCResult["é€‚ç”¨äºæ–°ç”Ÿä»£"]
    end
    
    subgraph "ğŸ”„ æ ‡è®°-æ•´ç†ç®—æ³•" ["æ ‡è®°-æ•´ç†ç®—æ³•"]
        MarkCompact["æ ‡è®°-æ•´ç†æ‰§è¡Œ"] -->|"æ ‡è®°: GC Rootséå†"| MCTMark["æ ‡è®°å¯è¾¾å¯¹è±¡"]
        MCTMark -->|"æ•´ç†: ç§»åŠ¨å­˜æ´»å¯¹è±¡åˆ°ä¸€ç«¯"| MCTCompact["æ•´ç†å†…å­˜ç©ºé—´"]
        MCTCompact -->|"ä¼˜ç‚¹: æ— ç¢ç‰‡+åˆ©ç”¨ç‡é«˜ | ç¼ºç‚¹: ç§»åŠ¨å¼€é”€å¤§"| MCTResult["é€‚ç”¨äºè€å¹´ä»£"]
    end
    
    subgraph "ğŸ¢ åˆ†ä»£æ”¶é›†ç®—æ³•" ["åˆ†ä»£æ”¶é›†ç®—æ³•"]
        GenerationalGC["åˆ†ä»£æ”¶é›†æ‰§è¡Œ"] -->|"æ–°ç”Ÿä»£: æ ‡è®°-å¤åˆ¶"| YoungGenAlgo["æ–°ç”Ÿä»£ç®—æ³•"]
        GenerationalGC -->|"è€å¹´ä»£: æ ‡è®°-æ•´ç†"| OldGenAlgo["è€å¹´ä»£ç®—æ³•"]
        YoungGenAlgo -->|"å¯¹è±¡å¹´é¾„è®¡æ•°+æ™‹å‡æœºåˆ¶"| Promotion["å¯¹è±¡æ™‹å‡"]
        OldGenAlgo --> Promotion
        Promotion -->|"ä¼˜ç‚¹: é’ˆå¯¹æ€§ä¼˜åŒ– | ç¼ºç‚¹: å®ç°å¤æ‚"| GenResult["é€‚ç”¨äºå¤§å¤šæ•°åœºæ™¯"]
    end
    
    subgraph "ğŸ“Š æ€§èƒ½å¯¹æ¯”åˆ†æ" ["æ€§èƒ½å¯¹æ¯”åˆ†æ"]
        Comparison["ç®—æ³•æ€§èƒ½å¯¹æ¯”"] -->|"å†…å­˜ç¢ç‰‡"| FragmentAnalysis{{"ç¢ç‰‡åˆ†æ"}}
        Comparison -->|"å†…å­˜åˆ©ç”¨ç‡"| UtilizationAnalysis{{"åˆ©ç”¨ç‡åˆ†æ"}}
        Comparison -->|"åœé¡¿æ—¶é—´"| PauseAnalysis{{"åœé¡¿åˆ†æ"}}
        
        FragmentAnalysis -->|"æ¸…é™¤>æ•´ç†>å¤åˆ¶"| UseCase1["å†…å­˜ç¢ç‰‡æ’åº"]
        UtilizationAnalysis -->|"æ•´ç†>æ¸…é™¤>å¤åˆ¶"| UseCase2["å†…å­˜åˆ©ç”¨ç‡æ’åº"]
        PauseAnalysis -->|"å¤åˆ¶>æ¸…é™¤>æ•´ç†"| UseCase3["åœé¡¿æ—¶é—´æ’åº"]
    end
    
    %% ä¸»æµç¨‹è¿æ¥
    ChoiceFactors -->|"è€å¹´ä»£åœºæ™¯"| MarkSweep
    ChoiceFactors -->|"æ–°ç”Ÿä»£åœºæ™¯"| MarkCopy
    ChoiceFactors -->|"å†…å­˜æ•´ç†éœ€æ±‚"| MarkCompact
    ChoiceFactors -->|"ç»¼åˆåœºæ™¯"| GenerationalGC
    
    MSResult --> Comparison
    MCResult --> Comparison
    MCTResult --> Comparison
    GenResult --> Comparison
    
    UseCase1 --> Decision["ç®—æ³•é€‰æ‹©å†³ç­–"]
    UseCase2 --> Decision
    UseCase3 --> Decision
    
    %% æ ·å¼è®¾ç½®
    style Start fill:#E3F2FD,stroke:#1976D2,stroke-width:2px
    style MarkSweep fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px
    style MarkCopy fill:#FFF3E0,stroke:#F57C00,stroke-width:2px
    style MarkCompact fill:#E8F5E8,stroke:#388E3C,stroke-width:2px
    style GenerationalGC fill:#FCE4EC,stroke:#C2185B,stroke-width:2px
    style Comparison fill:#E0F2F1,stroke:#00695C,stroke-width:2px
    style Decision fill:#FFEBEE,stroke:#D32F2F,stroke-width:2px
```

#### æ ‡è®°-æ¸…é™¤ç®—æ³•

æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼ˆMark-Sweepï¼‰æ˜¯æœ€åŸºç¡€çš„åƒåœ¾æ”¶é›†ç®—æ³•ï¼Œåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š

```mermaid
flowchart TD
    subgraph "ğŸ“‹ æ ‡è®°-å¤åˆ¶ç®—æ³•æµç¨‹" ["æ ‡è®°-å¤åˆ¶ç®—æ³•æµç¨‹"]
        Start["æ ‡è®°-å¤åˆ¶å¯åŠ¨"] -->|"å †å†…å­˜åˆ’åˆ†From/Toç©ºé—´+æš‚åœåº”ç”¨"| Mark["ğŸ·ï¸ æ ‡è®°é˜¶æ®µ"]
        
        Mark -->|"ä»GC Rootséå†Fromç©ºé—´+æ ‡è®°å¯è¾¾å¯¹è±¡"| Copy["ğŸ“‹ å¤åˆ¶é˜¶æ®µ"]
        
        Copy -->|"å¤åˆ¶å­˜æ´»å¯¹è±¡åˆ°Toç©ºé—´+è½¬å‘æŒ‡é’ˆ+æ›´æ–°å¼•ç”¨"| Swap["ğŸ”„ äº¤æ¢é˜¶æ®µ"]
        
        Swap -->|"æ¸…ç©ºFromç©ºé—´+äº¤æ¢From/Toè§’è‰²+é‡ç½®åˆ†é…æŒ‡é’ˆ"| Complete["âœ… ç®—æ³•å®Œæˆ"]
    end
    
    subgraph "ğŸ† ç®—æ³•ç‰¹ç‚¹" ["ç®—æ³•ç‰¹ç‚¹"]
        Complete -->|"æ— å†…å­˜ç¢ç‰‡+é«˜æ•ˆåˆ†é…"| Pros["âœ… ä¼˜ç‚¹"]
        Complete -->|"å†…å­˜åˆ©ç”¨ç‡50%+å¤åˆ¶å¼€é”€"| Cons["âš ï¸ ç¼ºç‚¹"]
        
        Pros -->|"æŒ‡é’ˆç§»åŠ¨åˆ†é…+åœ°å€è¿ç»­+ç¼“å­˜å‘½ä¸­ç‡é«˜"| ProDetails["ä¼˜ç‚¹è¯¦æƒ…"]
        Cons -->|"åŒå€å†…å­˜ç©ºé—´+å­˜æ´»ç‡é«˜æ—¶å¼€é”€å¤§"| ConDetails["ç¼ºç‚¹è¯¦æƒ…"]
    end
    
    %% æ ·å¼è®¾ç½®
    style Start fill:#E3F2FD,stroke:#1976D2,stroke-width:2px
    style Mark fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px
    style Copy fill:#FFF3E0,stroke:#F57C00,stroke-width:2px
    style Swap fill:#E8F5E8,stroke:#388E3C,stroke-width:2px
    style Complete fill:#FCE4EC,stroke:#C2185B,stroke-width:2px
    style Pros fill:#E0F2F1,stroke:#00695C,stroke-width:2px
    style Cons fill:#FFEBEE,stroke:#D32F2F,stroke-width:2px
```

**ç‰¹ç‚¹ï¼š**
- **ä¼˜ç‚¹**ï¼š
  - å®ç°ç®€å•ï¼Œç®—æ³•é€»è¾‘æ¸…æ™°
  - ä¸éœ€è¦ç§»åŠ¨å¯¹è±¡ï¼Œå¯¹è±¡åœ°å€ä¿æŒç¨³å®š
  - é€‚åˆå¯¹è±¡å­˜æ´»ç‡ä½çš„åœºæ™¯

- **ç¼ºç‚¹**ï¼š
  - äº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜åˆ†é…æ•ˆç‡ä¸‹é™
  - æ ‡è®°å’Œæ¸…é™¤ä¸¤ä¸ªé˜¶æ®µæ•ˆç‡éƒ½ä¸é«˜
  - éœ€è¦é¢å¤–çš„ç©ºé—²å†…å­˜ç®¡ç†æ•°æ®ç»“æ„

**å®ç°ä»£ç ç¤ºä¾‹ï¼š**

```java
public class MarkSweepExample {
    public void markSweepAnalysis() {
        // æ ‡è®°é˜¶æ®µ
        // 1. ä»GC Rootså¼€å§‹éå†
        // 2. æ ‡è®°æ‰€æœ‰å¯è¾¾å¯¹è±¡
        markFromGCRoots();
        
        // æ¸…é™¤é˜¶æ®µ
        // 1. éå†æ•´ä¸ªå †
        // 2. å›æ”¶æœªæ ‡è®°å¯¹è±¡
        // 3. äº§ç”Ÿå†…å­˜ç¢ç‰‡
        sweepUnmarkedObjects();
    }
    
    /**
     * å†…å­˜ç¢ç‰‡é—®é¢˜
     */
    public void fragmentationIssue() {
        // ç¢ç‰‡æ•´ç†ç­–ç•¥
        // 1. ç©ºé—²åˆ—è¡¨ï¼šè®°å½•ç©ºé—²åŒºå—
        maintainFreeList();
        
        // 2. åˆ†é…é€Ÿåº¦ä¸‹é™
        // - éœ€è¦éå†ç©ºé—²åˆ—è¡¨æ‰¾åˆ°è¶³å¤Ÿå¤§çš„ç©ºé—´
        // - å¯èƒ½éœ€è¦å¤šä¸ªå°ç©ºé—´ç»„åˆ
        allocateWithFragmentation();
    }
}
```

#### æ ‡è®°-å¤åˆ¶ç®—æ³•

æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼ˆMark-Copyï¼‰å°†å¯ç”¨å†…å­˜åˆ’åˆ†ä¸ºç›¸ç­‰çš„ä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­ä¸€å—ï¼Œå¦ä¸€å—ç”¨äºå¤åˆ¶ã€‚

```mermaid
flowchart TD
    subgraph "ğŸ“‹ æ ‡è®°-å¤åˆ¶ç®—æ³•æµç¨‹" ["æ ‡è®°-å¤åˆ¶ç®—æ³•æµç¨‹"]
        Start["å¼€å§‹æ ‡è®°-å¤åˆ¶ç®—æ³•"] -->|"å †å†…å­˜åˆ’åˆ†ä¸ºFrom/Toç©ºé—´+æš‚åœSTW"| PrepPhase["ğŸ› ï¸ å‡†å¤‡é˜¶æ®µ"]
        
        PrepPhase -->|"ä»GC Rootséå†Fromç©ºé—´+æ ‡è®°å¯è¾¾å¯¹è±¡+æ·±åº¦ä¼˜å…ˆ"| MarkPhase["ğŸ·ï¸ æ ‡è®°é˜¶æ®µ"]
        
        MarkPhase -->|"å¤åˆ¶å­˜æ´»å¯¹è±¡åˆ°Toç©ºé—´+è½¬å‘æŒ‡é’ˆæœºåˆ¶+æ›´æ–°å¼•ç”¨"| CopyPhase["ğŸ“‹ å¤åˆ¶é˜¶æ®µ"]
        
        CopyPhase -->|"æ¸…ç©ºFromç©ºé—´+äº¤æ¢From/Toè§’è‰²+é‡ç½®åˆ†é…æŒ‡é’ˆ"| SwapPhase["ğŸ”„ äº¤æ¢é˜¶æ®µ"]
        
        SwapPhase -->|"ä¼˜ç‚¹: æ— å†…å­˜ç¢ç‰‡é«˜æ•ˆåˆ†é… | ç¼ºç‚¹: å†…å­˜åˆ©ç”¨ç‡50%"| End["ç®—æ³•ç»“æŸ"]
    end
    
    %% æ ·å¼è®¾ç½®
    style Start fill:#E3F2FD,stroke:#1976D2,stroke-width:2px
    style PrepPhase fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px
    style MarkPhase fill:#FFF3E0,stroke:#F57C00,stroke-width:2px
    style CopyPhase fill:#E8F5E8,stroke:#388E3C,stroke-width:2px
    style SwapPhase fill:#FCE4EC,stroke:#C2185B,stroke-width:2px
    style End fill:#E0F2F1,stroke:#00695C,stroke-width:2px
```

**ç‰¹ç‚¹ï¼š**
- **ä¼˜ç‚¹ï¼š**
  - è§£å†³äº†å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œå¯¹è±¡åˆ†é…é«˜æ•ˆ
  - å†…å­˜åˆ†é…ç®€å•ï¼Œåªéœ€è¦ç§»åŠ¨æŒ‡é’ˆï¼ˆé¡ºåºåˆ†é…ï¼‰
  - å¯¹è±¡è¢«å¤åˆ¶ååœ°å€è¿ç»­ï¼Œæé«˜ç¼“å­˜å‘½ä¸­ç‡
  - å¯¹äºå­˜æ´»å¯¹è±¡æ¯”ä¾‹ä½çš„åœºæ™¯éå¸¸é«˜æ•ˆ

- **ç¼ºç‚¹ï¼š**
  - éœ€è¦åŒå€å†…å­˜ç©ºé—´ï¼Œå†…å­˜åˆ©ç”¨ç‡åªæœ‰50%
  - å¯¹äºå­˜æ´»å¯¹è±¡æ¯”ä¾‹é«˜çš„æƒ…å†µï¼Œå¤åˆ¶å¼€é”€å¤§
  - éœ€è¦æ›´æ–°æ‰€æœ‰å¯¹è±¡çš„å¼•ç”¨åœ°å€

**å®ç°ä»£ç ç¤ºä¾‹ï¼š**

```java
public class CopyingExample {
    public void copyingAnalysis() {
        // å†…å­˜åˆ†é…
        // 1. Fromç©ºé—´å’ŒToç©ºé—´å„å ä¸€åŠ
        // 2. åªä½¿ç”¨Fromç©ºé—´åˆ†é…å¯¹è±¡
        allocateInFromSpace();
        
        // å›æ”¶è¿‡ç¨‹
        // 1. æ ‡è®°å­˜æ´»å¯¹è±¡
        // 2. å¤åˆ¶åˆ°Toç©ºé—´
        // 3. äº¤æ¢Fromå’ŒToç©ºé—´
        copyAndSwapSpaces();
    }
    
    /**
     * SurvivoråŒºåº”ç”¨
     */
    public void survivorSpaceUsage() {
        // EdenåŒºå’ŒSurvivoråŒº
        // 1. Eden:Survivor = 8:1
        // 2. ä¸¤ä¸ªSurvivoräº¤æ›¿ä½¿ç”¨
        // 3. å¯¹è±¡å¹´é¾„è®¡æ•°
        manageSurvivorSpaces();
    }
}
```

#### æ ‡è®°-æ•´ç†ç®—æ³•

æ ‡è®°-æ•´ç†ç®—æ³•ï¼ˆMark-Compactï¼‰ç»“åˆäº†æ ‡è®°-æ¸…é™¤å’Œæ ‡è®°-å¤åˆ¶çš„ä¼˜ç‚¹ï¼Œåœ¨æ ‡è®°åå°†å­˜æ´»å¯¹è±¡ç§»åˆ°å†…å­˜çš„ä¸€ç«¯ï¼Œç„¶åæ¸…é™¤è¾¹ç•Œå¤–çš„å†…å­˜ã€‚

```mermaid
flowchart TD
    subgraph "ğŸ”„ æ ‡è®°-æ•´ç†ç®—æ³•æµç¨‹" ["æ ‡è®°-æ•´ç†ç®—æ³•æµç¨‹"]
        Start["æ ‡è®°-æ•´ç†å¯åŠ¨"] -->|"æš‚åœåº”ç”¨+GC Rootsé›†åˆ+åˆå§‹åŒ–æ ‡è®°ä½å›¾"| Mark["ğŸ·ï¸ æ ‡è®°é˜¶æ®µ"]
        
        Mark -->|"ä»æ ¹å¯¹è±¡éå†+æ ‡è®°å¯è¾¾å¯¹è±¡+æ·±åº¦ä¼˜å…ˆéå†"| Compact["ğŸ“ æ•´ç†é˜¶æ®µ"]
        
        Compact -->|"æ‰«æå †å†…å­˜+è®¡ç®—æ–°åœ°å€+ç§»åŠ¨å¯¹è±¡+æ›´æ–°å¼•ç”¨"| Clear["ğŸ§¹ æ¸…ç†é˜¶æ®µ"]
        
        Clear -->|"æ¸…é™¤è¾¹ç•Œå¤–å†…å­˜+é‡ç½®åˆ†é…æŒ‡é’ˆ"| Complete["âœ… ç®—æ³•å®Œæˆ"]
    end
    
    subgraph "ğŸ† ç®—æ³•ç‰¹ç‚¹" ["ç®—æ³•ç‰¹ç‚¹"]
        Complete -->|"æ— å†…å­˜ç¢ç‰‡+100%åˆ©ç”¨ç‡"| Pros["âœ… ä¼˜ç‚¹"]
        Complete -->|"ç§»åŠ¨å¼€é”€å¤§+å¤šæ¬¡æ‰«æ"| Cons["âš ï¸ ç¼ºç‚¹"]
        
        Pros -->|"å¯¹è±¡åˆ†å¸ƒç´§å‡‘+é¡ºåºåˆ†é…+ç¼“å­˜å‘½ä¸­ç‡é«˜"| ProDetails["ä¼˜ç‚¹è¯¦æƒ…"]
        Cons -->|"æ›´æ–°å¼•ç”¨åœ°å€+æ•´ç†è¿‡ç¨‹å¤æ‚+åœé¡¿æ—¶é—´é•¿"| ConDetails["ç¼ºç‚¹è¯¦æƒ…"]
    end
    
    %% æ ·å¼è®¾ç½®
    style Start fill:#E3F2FD,stroke:#1976D2,stroke-width:2px
    style Mark fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px
    style Compact fill:#FFF3E0,stroke:#F57C00,stroke-width:2px
    style Clear fill:#E8F5E8,stroke:#388E3C,stroke-width:2px
    style Complete fill:#FCE4EC,stroke:#C2185B,stroke-width:2px
    style Pros fill:#E0F2F1,stroke:#00695C,stroke-width:2px
    style Cons fill:#FFEBEE,stroke:#D32F2F,stroke-width:2px
```

**ç‰¹ç‚¹ï¼š**
- **ä¼˜ç‚¹ï¼š**
  - æ²¡æœ‰å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œå¯¹è±¡åˆ†å¸ƒç´§å‡‘
  - æ— éœ€é¢å¤–ç©ºé—´ï¼Œå†…å­˜åˆ©ç”¨ç‡é«˜ï¼ˆ100%ï¼‰
  - åˆ†é…æ–°å¯¹è±¡æ—¶æ•ˆç‡é«˜ï¼ˆé¡ºåºåˆ†é…ï¼‰
  - ç¼“å­˜å‘½ä¸­ç‡é«˜ï¼Œå¯¹è±¡åˆ†å¸ƒè¿ç»­

- **ç¼ºç‚¹ï¼š**
  - ç§»åŠ¨å¯¹è±¡å¼€é”€å¤§ï¼Œéœ€è¦å¤šæ¬¡æ‰«æå †å†…å­˜
  - éœ€è¦æ›´æ–°æ‰€æœ‰å¯¹è±¡çš„å¼•ç”¨åœ°å€
  - æ•´ç†è¿‡ç¨‹å¤æ‚ï¼Œæ‰§è¡Œæ—¶é—´é•¿
  - åœé¡¿æ—¶é—´é•¿ï¼Œå¯¹å®æ—¶æ€§è¦æ±‚é«˜çš„åº”ç”¨ä¸å‹å¥½

**å®ç°ä»£ç ç¤ºä¾‹ï¼š**

```java
public class MarkCompactExample {
    public void markCompactAnalysis() {
        // æ ‡è®°é˜¶æ®µ
        // 1. ä¸æ ‡è®°-æ¸…é™¤ç®—æ³•ç›¸åŒ
        markFromGCRoots();
        
        // æ•´ç†é˜¶æ®µ
        // 1. ç§»åŠ¨å­˜æ´»å¯¹è±¡
        // 2. æ›´æ–°å¼•ç”¨åœ°å€
        // 3. æ¸…ç†è¾¹ç•Œä»¥å¤–å†…å­˜
        compactObjects();
    }
    
    /**
     * ç§»åŠ¨å¯¹è±¡ç­–ç•¥
     */
    public void objectMovingStrategy() {
        // åŒæŒ‡é’ˆæŠ€æœ¯
        // 1. ä¸€ä¸ªæŒ‡é’ˆéå†å¯¹è±¡
        // 2. ä¸€ä¸ªæŒ‡é’ˆè®°å½•ä½ç½®
        moveWithTwoPointers();
        
        // æ›´æ–°å¼•ç”¨
        // 1. ç»´æŠ¤è½¬å‘è¡¨
        // 2. æ›´æ–°æ‰€æœ‰å¼•ç”¨
        updateReferences();
    }
}
```

#### åˆ†ä»£æ”¶é›†ç®—æ³•

åˆ†ä»£æ”¶é›†ç®—æ³•ï¼ˆGenerational Collectionï¼‰æ˜¯åŸºäºå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„ç»Ÿè®¡è§„å¾‹ï¼Œå°†å †å†…å­˜åˆ’åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œé‡‡ç”¨ä¸åŒç®—æ³•é’ˆå¯¹ä¸åŒä»£çš„å¯¹è±¡ã€‚

```mermaid
flowchart TD
    subgraph "ğŸ¢ åˆ†ä»£æ”¶é›†ç®—æ³•æµç¨‹" ["åˆ†ä»£æ”¶é›†ç®—æ³•æµç¨‹"]
        Start["åˆ†ä»£æ”¶é›†å¯åŠ¨"] -->|"å †å†…å­˜åˆ’åˆ†: æ–°ç”Ÿä»£(1/3)+è€å¹´ä»£(2/3)"| MemoryLayout["ğŸ“‹ å†…å­˜å¸ƒå±€é˜¶æ®µ"]
        
        MemoryLayout -->|"æ–°å¯¹è±¡ä¼˜å…ˆEdenåˆ†é…+å¤§å¯¹è±¡ç›´æ¥è€å¹´ä»£"| ObjectAlloc["ğŸŒ± å¯¹è±¡åˆ†é…é˜¶æ®µ"]
        
        ObjectAlloc -->|"å°å¯¹è±¡Edenåˆ†é…+å¤§å¯¹è±¡è€å¹´ä»£åˆ†é…"| MinorGC["ğŸ”„ æ–°ç”Ÿä»£GCé˜¶æ®µ"]
        
        MinorGC -->|"æ ‡è®°-å¤åˆ¶ç®—æ³•+å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°Survivor+å¹´é¾„+1"| Promotion["ğŸ” å¯¹è±¡æ™‹å‡é˜¶æ®µ"]
        
        Promotion -->|"å¹´é¾„é˜ˆå€¼(é»˜è®¤15)+åŠ¨æ€å¹´é¾„åˆ¤å®š+ç©ºé—´æ‹…ä¿"| MajorGC["ğŸ  è€å¹´ä»£GCé˜¶æ®µ"]
        
        MajorGC -->|"æ ‡è®°-æ•´ç†ç®—æ³•+æ•´ä¸ªå †æ”¶é›†+ä½é¢‘ç‡æ‰§è¡Œ"| Complete["âœ… æ”¶é›†å®Œæˆ"]
    end
    
    subgraph "ğŸŒ± æ–°ç”Ÿä»£ç»†èŠ‚" ["æ–°ç”Ÿä»£ç»†èŠ‚"]
        MemoryLayout -->|"å†…å­˜ç»“æ„: Eden(80%) + Survivor(10%+10%)"| YoungDetails["ğŸŒ± æ–°ç”Ÿä»£ç»“æ„"]
        YoungDetails -->|"å¤åˆ¶ç®—æ³•+é«˜é¢‘ç‡æ‰§è¡Œ+STWæ—¶é—´çŸ­"| YoungGCFeatures["æ–°ç”Ÿä»£GCç‰¹ç‚¹"]
    end
    
    subgraph "ğŸ  è€å¹´ä»£ç»†èŠ‚" ["è€å¹´ä»£ç»†èŠ‚"]
        MajorGC -->|"å­˜å‚¨é•¿æœŸå­˜æ´»å¯¹è±¡+ç©ºé—´è¾ƒå¤§"| OldDetails["ğŸ  è€å¹´ä»£ç»“æ„"]
        OldDetails -->|"æ ‡è®°-æ•´ç†ç®—æ³•+ä½é¢‘ç‡æ‰§è¡Œ+STWæ—¶é—´é•¿"| OldGCFeatures["è€å¹´ä»£GCç‰¹ç‚¹"]
    end
    
    subgraph "ğŸ“ˆ æ€§èƒ½ä¼˜åŠ¿" ["æ€§èƒ½ä¼˜åŠ¿"]
        Complete -->|"ç»“åˆç®—æ³•ä¼˜ç‚¹+æé«˜æ•ˆç‡"| Performance["ğŸš€ æ€§èƒ½æå‡"]
        Performance -->|"å†…å­˜åˆ©ç”¨ç‡é«˜+ç¢ç‰‡å°‘+GCæ€§èƒ½ä¼˜åŒ–"| Benefits["ğŸ† ç»¼åˆæ•ˆç›Š"]
    end
    
    %% æ ·å¼è®¾ç½®
    style Start fill:#E3F2FD,stroke:#1976D2,stroke-width:2px
    style MemoryLayout fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px
    style ObjectAlloc fill:#FFF3E0,stroke:#F57C00,stroke-width:2px
    style MinorGC fill:#E8F5E8,stroke:#388E3C,stroke-width:2px
    style Promotion fill:#FCE4EC,stroke:#C2185B,stroke-width:2px
    style MajorGC fill:#E0F2F1,stroke:#00695C,stroke-width:2px
    style Complete fill:#FFEBEE,stroke:#D32F2F,stroke-width:2px
    style Performance fill:#E1F5FE,stroke:#0277BD,stroke-width:2px
```

**ç‰¹ç‚¹ï¼š**
- **ä¼˜ç‚¹**ï¼šç»¼åˆäº†å„ç§ç®—æ³•çš„ä¼˜ç‚¹ï¼Œæé«˜äº†æ”¶é›†æ•ˆç‡
- **ç¼ºç‚¹**ï¼šå®ç°å¤æ‚ï¼Œéœ€è¦ç»´æŠ¤å¤šä¸ªå†…å­˜åŒºåŸŸ

**å®ç°è¿‡ç¨‹ï¼š**

1. **æ–°ç”Ÿä»£å†…å­˜å¸ƒå±€**ï¼š
   - EdenåŒºï¼šå¤§çº¦80%çš„æ–°ç”Ÿä»£ç©ºé—´ï¼Œæ–°å¯¹è±¡é¦–å…ˆåˆ†é…åœ¨è¿™é‡Œ
   - SurvivoråŒºï¼šåˆ†ä¸ºS0å’ŒS1ä¸¤ä¸ªåŒºåŸŸï¼Œæ¯ä¸ªå æ–°ç”Ÿä»£çš„10%ï¼Œæ¯æ¬¡åªä½¿ç”¨ä¸€ä¸ª

2. **Minor GCè¿‡ç¨‹**ï¼š
   - EdenåŒºç©ºé—´ä¸è¶³æ—¶è§¦å‘
   - å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°ä¸€ä¸ªSurvivoråŒº
   - æ¸…ç©ºEdenåŒº
   - ä¸‹ä¸€æ¬¡Minor GCæ—¶ï¼Œå­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€ä¸ªSurvivoråŒº

3. **å¯¹è±¡æ™‹å‡**ï¼š
   - å¯¹è±¡åœ¨SurvivoråŒºä¸­æ¯ç»è¿‡ä¸€æ¬¡Minor GCï¼Œå¹´é¾„+1
   - å½“å¯¹è±¡å¹´é¾„è¶…è¿‡é˜ˆå€¼ï¼ˆé»˜è®¤15ï¼‰ï¼Œæ™‹å‡åˆ°è€å¹´ä»£
   - å¤§å¯¹è±¡ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£

4. **Major GC/Full GC**ï¼š
   - è€å¹´ä»£ç©ºé—´ä¸è¶³æ—¶è§¦å‘
   - é€šå¸¸æ¯”Minor GCæ…¢å¾ˆå¤šå€
   - å¸¸ç”¨æ ‡è®°-æ•´ç†ç®—æ³•

```java
public class GenerationalGCExample {
    public void generationalGCProcess() {
        // æ–°å¯¹è±¡åˆ†é…
        Object newObject = new Object();  // é¦–å…ˆåˆ†é…åœ¨EdenåŒº
        
        // Minor GC
        // 1. EdenåŒºæ»¡æ—¶è§¦å‘
        // 2. å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°SurvivoråŒº
        // 3. å¯¹è±¡å¹´é¾„å¢åŠ 
        performMinorGC();
        
        // å¯¹è±¡æ™‹å‡
        // 1. å¯¹è±¡å¹´é¾„è¾¾åˆ°é˜ˆå€¼æ—¶æ™‹å‡åˆ°è€å¹´ä»£
        // 2. SurvivoråŒºå®¹çº³ä¸ä¸‹æ—¶æå‰æ™‹å‡
        promoteObjects();
        
        // Major GC
        // 1. è€å¹´ä»£ç©ºé—´ä¸è¶³æ—¶è§¦å‘
        // 2. æ ‡è®°-æ•´ç†ç®—æ³•
        performMajorGC();
    }
    
    /**
     * åŠ¨æ€å¹´é¾„é˜ˆå€¼è°ƒæ•´
     */
    public void dynamicTenuring() {
        // è‡ªé€‚åº”ç®—æ³•
        // 1. ç›‘æ§SurvivoråŒºå¯¹è±¡å¹´é¾„åˆ†å¸ƒ
        // 2. åŠ¨æ€è°ƒæ•´æ™‹å‡é˜ˆå€¼
        adjustTenuringThreshold();
    }
}
```

### åƒåœ¾æ”¶é›†å™¨

Javaåƒåœ¾æ”¶é›†å™¨çš„åˆ†ç±»å’Œç‰¹ç‚¹ï¼š

``mermaid
flowchart TD
    subgraph "ğŸš€ æ”¶é›†å™¨åˆ†ç±»" ["æ”¶é›†å™¨åˆ†ç±»"]
        Start["åƒåœ¾æ”¶é›†å™¨é€‰æ‹©"] -->|"æŒ‰åŒºåŸŸ/çº¿ç¨‹/å¹¶å‘æ¨¡å¼"| Classification{{"æ”¶é›†å™¨åˆ†ç±»"}}
    end
    
    subgraph "ğŸ—ƒ ä¼ ç»Ÿæ”¶é›†å™¨" ["ä¼ ç»Ÿæ”¶é›†å™¨"]
        SerialGC["Serialç³»åˆ—"] -->|"å•çº¿ç¨‹+STW+ç®€å•é«˜æ•ˆ"| SerialFeatures["é€‚ç”¨å°å†…å­˜"]
    end
    
    subgraph "ğŸ”„ å¹¶è¡Œæ”¶é›†å™¨" ["å¹¶è¡Œæ”¶é›†å™¨"]
        ParallelGC["Parallelç³»åˆ—"] -->|"å¤šçº¿ç¨‹+é«˜ååé‡+è‡ªé€‚åº”"| ParallelFeatures["é€‚ç”¨åå°è¿ç®—"]
    end
    
    subgraph "ğŸŒ€ å¹¶å‘æ”¶é›†å™¨" ["å¹¶å‘æ”¶é›†å™¨"]
        CMSGC["CMSæ”¶é›†å™¨"] -->|"å››é˜¶æ®µ: åˆå§‹æ ‡è®°â†’å¹¶å‘æ ‡è®°â†’é‡æ–°æ ‡è®°â†’å¹¶å‘æ¸…é™¤"| CMSFeatures["é€‚ç”¨äº¤äº’åº”ç”¨"]
    end
    
    subgraph "ğŸ¯ G1æ”¶é›†å™¨" ["G1æ”¶é›†å™¨"]
        G1GC["G1æ”¶é›†å™¨"] -->|"åŒºåŸŸåŒ–+å¯é¢„æµ‹åœé¡¿+å››é˜¶æ®µæµç¨‹"| G1Features["é€‚ç”¨å¤§å†…å­˜"]
    end
    
    subgraph "ğŸš€ è¶…ä½å»¶è¿Ÿæ”¶é›†å™¨" ["è¶…ä½å»¶è¿Ÿæ”¶é›†å™¨"]
        ZGC["ZGC/Shenandoah"] -->|"ç€è‰²æŒ‡é’ˆ/è½¬å‘æŒ‡é’ˆ+å¹¶å‘æ‰§è¡Œ"| LowLatencyFeatures["é€‚ç”¨æä½å»¶è¿Ÿ"]
    end
    
    subgraph "ğŸ“Š æ€§èƒ½å¯¹æ¯”" ["æ€§èƒ½å¯¹æ¯”"]
        Performance["æ€§èƒ½çŸ©é˜µ"] -->|"åœé¡¿æ—¶é—´/ååé‡/å†…å­˜å¼€é”€"| Decision["é€‰æ‹©å†³ç­–"]
    end
    
    %% ä¸»æµç¨‹è¿æ¥
    Classification -->|"å°å†…å­˜åº”ç”¨"| SerialGC
    Classification -->|"é«˜ååé‡éœ€æ±‚"| ParallelGC
    Classification -->|"ä½å»¶è¿Ÿéœ€æ±‚"| CMSGC
    Classification -->|"å¹³è¡¡æ€§èƒ½"| G1GC
    Classification -->|"æä½å»¶è¿Ÿ"| ZGC
    
    SerialFeatures --> Performance
    ParallelFeatures --> Performance
    CMSFeatures --> Performance
    G1Features --> Performance
    LowLatencyFeatures --> Performance
    
    %% æ ·å¼è®¾ç½®
    style Start fill:#E3F2FD,stroke:#1976D2,stroke-width:2px
    style SerialGC fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px
    style ParallelGC fill:#FFF3E0,stroke:#F57C00,stroke-width:2px
    style CMSGC fill:#E8F5E8,stroke:#388E3C,stroke-width:2px
    style G1GC fill:#FCE4EC,stroke:#C2185B,stroke-width:2px
```
    style ZGC fill:#E0F2F1,stroke:#00695C,stroke-width:2px
    style Decision fill:#FFEBEE,stroke:#D32F2F,stroke-width:2px
```

#### æ–°ç”Ÿä»£æ”¶é›†å™¨

æ–°ç”Ÿä»£æ”¶é›†å™¨ä¸»è¦è´Ÿè´£æ”¶é›†æ–°ç”Ÿä»£åŒºåŸŸçš„åƒåœ¾ï¼Œæ‰§è¡ŒMinor GCã€‚

```mermaid
flowchart TD
    subgraph "ğŸŒ± æ–°ç”Ÿä»£æ”¶é›†å™¨å¯¹æ¯”" ["æ–°ç”Ÿä»£æ”¶é›†å™¨å¯¹æ¯”"]
        Start["æ–°ç”Ÿä»£æ”¶é›†å™¨é€‰æ‹©"] -->|"é¢‘ç¹GC+å¿«é€Ÿæ‰§è¡Œ+å¤åˆ¶ç®—æ³•"| Choice{{"æ”¶é›†å™¨ç±»å‹"}}
        
        Choice -->|"å•çº¿ç¨‹+ç®€å•é«˜æ•ˆ"| Serial["ğŸ—ƒ Serialæ”¶é›†å™¨"]
        Choice -->|"å¤šçº¿ç¨‹+CMSæ­é…"| ParNew["ğŸ”„ ParNewæ”¶é›†å™¨"]
        Choice -->|"å¤šçº¿ç¨‹+é«˜ååé‡"| Parallel["ğŸš€ Parallel Scavenge"]
        
        Serial -->|"é€‚ç”¨: å•CPU/å°å†…å­˜/Clientæ¨¡å¼"| SerialResult["å•æœºåº”ç”¨"]
        ParNew -->|"é€‚ç”¨: å¤šCPU/äº¤äº’åº”ç”¨/ä½å»¶è¿Ÿ"| ParNewResult["ç½‘ç«™æœåŠ¡"]
        Parallel -->|"é€‚ç”¨: åå°è¿ç®—/æ‰¹å¤„ç†/ç§‘å­¦è®¡ç®—"| ParallelResult["æ•°æ®å¤„ç†"]
    end
    
    %% æ ·å¼è®¾ç½®
    style Start fill:#E3F2FD,stroke:#1976D2,stroke-width:2px
    style Serial fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px
    style ParNew fill:#FFF3E0,stroke:#F57C00,stroke-width:2px
    style Parallel fill:#E8F5E8,stroke:#388E3C,stroke-width:2px
```

**1. Serialæ”¶é›†å™¨**

å•çº¿ç¨‹æ”¶é›†å™¨ï¼Œåœ¨è¿›è¡ŒGCæ—¶å¿…é¡»æš‚åœæ‰€æœ‰ç”¨æˆ·çº¿ç¨‹ï¼ˆStop The Worldï¼‰ã€‚

- **å·¥ä½œåŸç†**ï¼šå•çº¿ç¨‹ä¾æ¬¡æ‰§è¡Œæ ‡è®°ã€æ¸…é™¤ã€æ•´ç†ç­‰å·¥ä½œ
- **é€‚ç”¨åœºæ™¯**ï¼šå•CPUç¯å¢ƒã€å°å†…å­˜å †ï¼ˆ<100MBï¼‰ã€Clientæ¨¡å¼
- **å¯ç”¨å‚æ•°**ï¼š`-XX:+UseSerialGC`

**2. ParNewæ”¶é›†å™¨**

Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹å¹¶è¡Œç‰ˆæœ¬ï¼Œä¾ç„¶éœ€è¦Stop The Worldã€‚

- **å·¥ä½œåŸç†**ï¼šå¤šçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œæ ‡è®°-å¤åˆ¶ç®—æ³•
- **é€‚ç”¨åœºæ™¯**ï¼šå¤šCPUç¯å¢ƒã€ä¸CMSæ”¶é›†å™¨é…åˆä½¿ç”¨ã€Serveræ¨¡å¼
- **å¯ç”¨å‚æ•°**ï¼š`-XX:+UseParNewGC -XX:ParallelGCThreads=n`

**3. Parallel Scavengeæ”¶é›†å™¨**

å…³æ³¨ååé‡ï¼ˆé«˜æ•ˆåˆ©ç”¨CPUæ—¶é—´ï¼‰çš„å¤šçº¿ç¨‹æ”¶é›†å™¨ã€‚

- **å·¥ä½œåŸç†**ï¼šå¤šçº¿ç¨‹å¹¶è¡Œæ”¶é›†ï¼Œå¹¶æä¾›è‡ªé€‚åº”è°ƒèŠ‚å‚æ•°
- **é€‚ç”¨åœºæ™¯**ï¼šåå°è¿ç®—ä»»åŠ¡ã€æ‰¹å¤„ç†ã€ç§‘å­¦è®¡ç®—
- **å¯ç”¨å‚æ•°**ï¼š`-XX:+UseParallelGC -XX:MaxGCPauseMillis=n -XX:GCTimeRatio=n`

**æ–°ç”Ÿä»£æ”¶é›†å™¨å¯¹æ¯”ï¼š**

| æ”¶é›†å™¨ | çº¿ç¨‹ | ç®—æ³• | é‡ç‚¹ | åœé¡¿æ—¶é—´ | é€‚ç”¨åœºæ™¯ |
| ------------ | ------ | ------ | ------ | ------------ | ------------ |
| Serial | å•çº¿ç¨‹ | å¤åˆ¶ | ç®€å•é«˜æ•ˆ | è¾ƒé•¿ | å•CPUã€å°å†…å­˜ |
| ParNew | å¤šçº¿ç¨‹ | å¤åˆ¶ | ä¸CMSé…åˆ | ä¸­ç­‰ | å¤šCPUã€äº¤äº’åº”ç”¨ |
| Parallel Scavenge | å¤šçº¿ç¨‹ | å¤åˆ¶ | ååé‡ä¼˜å…ˆ | ä¸­ç­‰ | åå°è¿ç®—ã€æ‰¹å¤„ç† |

#### è€å¹´ä»£æ”¶é›†å™¨

è€å¹´ä»£æ”¶é›†å™¨è´Ÿè´£æ”¶é›†è€å¹´ä»£åŒºåŸŸçš„åƒåœ¾ï¼Œæ‰§è¡ŒMajor GCæˆ–Full GCã€‚

```mermaid
flowchart TD
    subgraph "ğŸ  è€å¹´ä»£æ”¶é›†å™¨å¯¹æ¯”" ["è€å¹´ä»£æ”¶é›†å™¨å¯¹æ¯”"]
        Start["è€å¹´ä»£æ”¶é›†å™¨é€‰æ‹©"] -->|"è´Ÿè´£Major GC/Full GC+è€å¹´ä»£åŒºåŸŸå›æ”¶"| Choice{{"æ”¶é›†å™¨ç±»å‹"}}
        
        Choice -->|"å•çº¿ç¨‹+ç®€å•é«˜æ•ˆ"| SerialOld["ğŸ—ºï¸ Serial Old"]
        Choice -->|"å¤šçº¿ç¨‹+ååé‡ä¼˜å…ˆ"| ParallelOld["ğŸš€ Parallel Old"]
        Choice -->|"ä½åœé¡¿æ—¶é—´+å¹¶å‘æ”¶é›†"| CMS["ğŸŒ€ CMS"]
        
        SerialOld -->|"æ ‡è®°-æ•´ç†ç®—æ³•+STWæ—¶é—´é•¿"| SerialResult["é€‚ç”¨: å•CPU/å°å†…å­˜"]
        ParallelOld -->|"æ ‡è®°-æ•´ç†ç®—æ³•+å¤šçº¿ç¨‹å¹¶è¡Œ"| ParallelResult["é€‚ç”¨: å¤šCPU/æ‰¹å¤„ç†"]
        CMS -->|"æ ‡è®°-æ¸…é™¤ç®—æ³•+å››é˜¶æ®µæ”¶é›†"| CMSResult["é€‚ç”¨: å¤šCPU/äº¤äº’åº”ç”¨"]
    end
    
    subgraph "ğŸŒ€ CMSæ”¶é›†å™¨ç»†èŠ‚" ["CMSæ”¶é›†å™¨ç»†èŠ‚"]
        CMS -->|"å¹¶å‘æ”¶é›†+ä½åœé¡¿"| CMSPhases["ğŸ”„ CMSå››é˜¶æ®µ"]
        CMSPhases -->|"åˆå§‹æ ‡è®°(STW)â†’å¹¶å‘æ ‡è®°â†’é‡æ–°æ ‡è®°(STW)â†’å¹¶å‘æ¸…é™¤"| CMSFeatures["ä¼˜ç‚¹: å¹¶å‘æ”¶é›†+ä½åœé¡¿"]
        CMSFeatures -->|"ç¼ºç‚¹: CPUæ•æ„Ÿ+æµ®åŠ¨åƒåœ¾+å†…å­˜ç¢ç‰‡"| CMSLimits["é™åˆ¶å’Œé—®é¢˜"]
    end
    
    subgraph "ğŸ“ˆ æ€§èƒ½å¯¹æ¯”" ["æ€§èƒ½å¯¹æ¯”"]
        PerformanceMatrix["ğŸ“Š æ€§èƒ½çŸ©é˜µ"] -->|"åœé¡¿æ—¶é—´: CMS < Parallel Old < Serial Old"| PauseTime["åœé¡¿æ—¶é—´æ’åº"]
        PerformanceMatrix -->|"ååé‡: Parallel Old > Serial Old > CMS"| Throughput["ååé‡æ’åº"]
        PerformanceMatrix -->|"å†…å­˜å¼€é”€: CMS > Parallel Old > Serial Old"| MemoryOverhead["å†…å­˜å¼€é”€æ’åº"]
    end
    
    %% æ ·å¼è®¾ç½®
    style Start fill:#E3F2FD,stroke:#1976D2,stroke-width:2px
    style SerialOld fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px
    style ParallelOld fill:#FFF3E0,stroke:#F57C00,stroke-width:2px
    style CMS fill:#E8F5E8,stroke:#388E3C,stroke-width:2px
    style CMSPhases fill:#FCE4EC,stroke:#C2185B,stroke-width:2px
    style PerformanceMatrix fill:#E0F2F1,stroke:#00695C,stroke-width:2px
```

**1. Serial Oldæ”¶é›†å™¨**

Serialæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œä½¿ç”¨å•çº¿ç¨‹æ‰§è¡Œæ ‡è®°-æ•´ç†ç®—æ³•ã€‚

- **å·¥ä½œåŸç†**ï¼šå•çº¿ç¨‹ä¾æ¬¡æ‰§è¡Œæ ‡è®°ã€æ•´ç†ç­‰å·¥ä½œ
- **é€‚ç”¨åœºæ™¯**ï¼šå•CPUç¯å¢ƒã€å°å†…å­˜å †ã€Clientæ¨¡å¼
- **å¯ç”¨å‚æ•°**ï¼šæ­é…`-XX:+UseSerialGC`ä½¿ç”¨

**2. Parallel Oldæ”¶é›†å™¨**

Parallel Scavengeæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œä½¿ç”¨å¤šçº¿ç¨‹æ‰§è¡Œæ ‡è®°-æ•´ç†ç®—æ³•ã€‚

- **å·¥ä½œåŸç†**ï¼šå¤šçº¿ç¨‹å¹¶è¡Œæ ‡è®°ã€æ•´ç†åƒåœ¾å¯¹è±¡
- **é€‚ç”¨åœºæ™¯**ï¼šå¤šCPUç¯å¢ƒã€å…³æ³¨ååé‡çš„åœºæ™¯
- **å¯ç”¨å‚æ•°**ï¼š`-XX:+UseParallelOldGC`ï¼ˆé€šå¸¸ä¸`-XX:+UseParallelGC`ä¸€èµ·ä½¿ç”¨ï¼‰

**3. CMSæ”¶é›†å™¨ï¼ˆConcurrent Mark Sweepï¼‰**

ä»¥è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ï¼Œé‡‡ç”¨æ ‡è®°-æ¸…é™¤ç®—æ³•ã€‚

- **å·¥ä½œåŸç†**ï¼šåˆ†ä¸ºå››ä¸ªæ”¶é›†é˜¶æ®µï¼š
  1. **åˆå§‹æ ‡è®°**ï¼ˆInitial Markï¼‰ï¼šæš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œä»…æ ‡è®°GC Rootsç›´æ¥å…³è”çš„å¯¹è±¡
  2. **å¹¶å‘æ ‡è®°**ï¼ˆConcurrent Markï¼‰ï¼šä¸ç”¨æˆ·çº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œéå†å¯¹è±¡å›¾
  3. **é‡æ–°æ ‡è®°**ï¼ˆRemarkï¼‰ï¼šæš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œå¤„ç†å¹¶å‘æ ‡è®°é˜¶æ®µå˜åŠ¨çš„å¯¹è±¡
  4. **å¹¶å‘æ¸…é™¤**ï¼ˆConcurrent Sweepï¼‰ï¼šä¸ç”¨æˆ·çº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œæ¸…é™¤æ ‡è®°çš„åƒåœ¾

- **ä¼˜ç¼ºç‚¹**ï¼š
  - **ä¼˜ç‚¹**ï¼šå¹¶å‘æ”¶é›†ã€ä½åœé¡¿æ—¶é—´ï¼Œé€‚åˆäº¤äº’å¼åº”ç”¨
  - **ç¼ºç‚¹**ï¼šCPUèµ„æºæ•æ„Ÿã€æµ®åŠ¨åƒåœ¾é—®é¢˜ã€å†…å­˜ç¢ç‰‡é—®é¢˜

- **å¯ç”¨å‚æ•°**ï¼š`-XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=n`

**è€å¹´ä»£æ”¶é›†å™¨å¯¹æ¯”ï¼š**

| æ”¶é›†å™¨ | çº¿ç¨‹ | ç®—æ³• | é‡ç‚¹ | åœé¡¿æ—¶é—´ | é€‚ç”¨åœºæ™¯ |
| ------------ | ------ | ------ | ------ | ------------ | ------------ |
| Serial Old | å•çº¿ç¨‹ | æ ‡è®°-æ•´ç† | ç®€å•é«˜æ•ˆ | é•¿ | å•CPUã€å°å†…å­˜ |
| Parallel Old | å¤šçº¿ç¨‹ | æ ‡è®°-æ•´ç† | ååé‡ä¼˜å…ˆ | ä¸­ç­‰ | å¤šCPUã€æ‰¹å¤„ç† |
| CMS | å¤šçº¿ç¨‹ | æ ‡è®°-æ¸…é™¤ | ä½åœé¡¿æ—¶é—´ | çŸ­ | å¤šCPUã€äº¤äº’åº”ç”¨ |

#### æ··åˆæ”¶é›†å™¨

æ··åˆæ”¶é›†å™¨ä¸»è¦é’ˆå¯¹æ•´ä¸ªå †è¿›è¡Œæ”¶é›†ï¼Œå…·æœ‰æ›´å…ˆè¿›çš„ç®—æ³•å’Œç‰¹æ€§ã€‚

```mermaid
flowchart TD
    subgraph "ğŸŒŒ æ··åˆæ”¶é›†å™¨ä½“ç³»" ["æ··åˆæ”¶é›†å™¨ä½“ç³»"]
        Start["æ··åˆæ”¶é›†å™¨é€‰æ‹©"] -->|"é’ˆå¯¹æ•´ä¸ªå †è¿›è¡Œæ”¶é›†+å…ˆè¿›ç®—æ³•+ä½å»¶è¿Ÿ"| CollectorChoice{{"æ”¶é›†å™¨ç±»å‹"}}
        
        CollectorChoice -->|"åŒºåŸŸåŒ–+å¯é¢„æµ‹åœé¡¿"| G1["ğŸ¯ G1æ”¶é›†å™¨"]
        CollectorChoice -->|"ç€è‰²æŒ‡é’ˆ+è¶…ä½å»¶è¿Ÿ"| ZGC["âš¡ ZGCæ”¶é›†å™¨"]
        CollectorChoice -->|"è½¬å‘æŒ‡é’ˆ+å¹¶å‘æ”¶é›†"| Shenandoah["ğŸŒ€ Shenandoah"]
    end
    
    subgraph "ğŸ¯ G1æ”¶é›†å™¨ç»†èŠ‚" ["G1æ”¶é›†å™¨ç»†èŠ‚"]
        G1 -->|"åˆ†ä»£æ”¶é›†+RegionåŒºåŸŸ"| G1Features["ğŸ¯ G1ç‰¹ç‚¹"]
        G1Features -->|"åˆå§‹æ ‡è®°(STW)â†’å¹¶å‘æ ‡è®°â†’æœ€ç»ˆæ ‡è®°(STW)â†’ç­›é€‰å›æ”¶(STW)"| G1Phases["å››é˜¶æ®µæ”¶é›†"]
        G1Phases -->|"é€‚ç”¨: 1G-32Gå †+ä¼ä¸šåº”ç”¨+å¯é¢„æµ‹åœé¡¿"| G1Result["é€‚ç”¨åœºæ™¯"]
    end
    
    subgraph "âš¡ ZGCæ”¶é›†å™¨ç»†èŠ‚" ["ZGCæ”¶é›†å™¨ç»†èŠ‚"]
        ZGC -->|"å¹¶å‘æ”¶é›†+æ— å †å¤§å°é™åˆ¶"| ZGCFeatures["âš¡ ZGCç‰¹ç‚¹"]
        ZGCFeatures -->|"å¯¹è±¡åœ°å€ä¸­å­˜å‚¨å…ƒæ•°æ®+é¿å…å†…å­˜å±éšœ"| ColoredPointers["ç€è‰²æŒ‡é’ˆæŠ€æœ¯"]
        ColoredPointers -->|"é€‚ç”¨: >32Gå †+é‡‘èäº¤æ˜“+è¶…ä½å»¶è¿Ÿ"| ZGCResult["é€‚ç”¨åœºæ™¯"]
    end
    
    subgraph "ğŸŒ€ Shenandoahç»†èŠ‚" ["Shenandoahç»†èŠ‚"]
        Shenandoah -->|"ä¸åº”ç”¨çº¿ç¨‹å¹¶å‘+Brooksè½¬å‘æŒ‡é’ˆ"| ShenFeatures["ğŸŒ€ Shenandoahç‰¹ç‚¹"]
        ShenFeatures -->|"å¹¶å‘æ ‡è®°+æ•´ç†+æ•´åˆé˜¶æ®µ"| ShenPhases["å¹¶å‘å¤„ç†"]
        ShenPhases -->|"é€‚ç”¨: å¤§å †å†…å­˜+ä½å»¶è¿Ÿåº”ç”¨"| ShenResult["é€‚ç”¨åœºæ™¯"]
    end
    
    subgraph "ğŸ“ˆ æ€§èƒ½å¯¹æ¯”" ["æ€§èƒ½å¯¹æ¯”"]
        Comparison["ğŸ“Š æ··åˆæ”¶é›†å™¨å¯¹æ¯”"] -->|"åœé¡¿æ—¶é—´: ZGC/Shenandoah(<10ms) < G1(æ¯«ç§’çº§)"| PauseTime["åœé¡¿æ—¶é—´"]
        Comparison -->|"å†…å­˜å¼€é”€: ZGC/Shenandoah(è¾ƒé«˜) > G1(ä¸­ç­‰)"| MemoryOverhead["å†…å­˜å¼€é”€"]
        Comparison -->|"é€‚ç”¨å †å¤§å°: G1(1-32G) < ZGC/Shenandoah(>32G)"| HeapSize["é€‚ç”¨å †å¤§å°"]
    end
    
    %% æ ·å¼è®¾ç½®
    style Start fill:#E3F2FD,stroke:#1976D2,stroke-width:2px
    style G1 fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px
    style ZGC fill:#FFF3E0,stroke:#F57C00,stroke-width:2px
    style Shenandoah fill:#E8F5E8,stroke:#388E3C,stroke-width:2px
    style G1Features fill:#FCE4EC,stroke:#C2185B,stroke-width:2px
    style ZGCFeatures fill:#E0F2F1,stroke:#00695C,stroke-width:2px
    style ShenFeatures fill:#FFEBEE,stroke:#D32F2F,stroke-width:2px
    style Comparison fill:#E1F5FE,stroke:#0277BD,stroke-width:2px
```

**1. G1æ”¶é›†å™¨ï¼ˆGarbage Firstï¼‰**

é¢å‘æœåŠ¡ç«¯åº”ç”¨çš„æ”¶é›†å™¨ï¼Œå…·æœ‰å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´ã€‚

- **å·¥ä½œåŸç†**ï¼š
  1. å°†å †åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„åŒºåŸŸï¼ˆRegionï¼‰
  2. æ¯ä¸ªåŒºåŸŸå¯ä»¥æ˜¯æ–°ç”Ÿä»£ã€è€å¹´ä»£æˆ–å¤§å¯¹è±¡åŒºåŸŸ
  3. æ”¶é›†è¿‡ç¨‹åˆ†å››ä¸ªé˜¶æ®µï¼šåˆå§‹æ ‡è®°ã€å¹¶å‘æ ‡è®°ã€æœ€ç»ˆæ ‡è®°ã€ç­›é€‰å›æ”¶
  4. ä¼˜å…ˆå›æ”¶åƒåœ¾æœ€å¤šçš„åŒºåŸŸï¼ˆGarbage Firstï¼‰

- **ä¼˜ç¼ºç‚¹**ï¼š
  - **ä¼˜ç‚¹**ï¼šå¯é¢„æµ‹åœé¡¿æ—¶é—´ã€åŒºåŸŸåŒ–åˆ†ä»£ã€ç©ºé—´æ•´åˆã€é€‚åº”æ€§å¼º
  - **ç¼ºç‚¹**ï¼šå†…å­˜å¼€é”€è¾ƒå¤§ã€åœ¨æŸäº›åœºæ™¯ä¸‹åœé¡¿æ—¶é—´ä¸ç¨³å®š

- **å¯ç”¨å‚æ•°**ï¼š`-XX:+UseG1GC -XX:MaxGCPauseMillis=n -XX:G1HeapRegionSize=n`

**2. ZGCæ”¶é›†å™¨ï¼ˆZ Garbage Collectorï¼‰**

Java 11å¼•å…¥çš„ä½å»¶è¿Ÿæ”¶é›†å™¨ï¼Œé€‚ç”¨äºå¤§å†…å­˜ä½å»¶è¿Ÿåº”ç”¨ã€‚

- **å·¥ä½œåŸç†**ï¼š
  1. ä½¿ç”¨ç€è‰²æŒ‡é’ˆï¼ˆColored Pointersï¼‰æŠ€æœ¯ï¼Œåœ¨æŒ‡é’ˆä¸­å­˜å‚¨å…ƒæ•°æ®
  2. å¹¶å‘æ ‡è®°ã€å¹¶å‘é¢„å¤‡é‡åˆ†é…ã€å¹¶å‘é‡åˆ†é…ã€å¹¶å‘é‡æ˜ å°„
  3. åœé¡¿æ—¶é—´é€šå¸¸å°äº10msï¼Œä¸éšå †å¤§å°å¢åŠ è€Œå¢åŠ 

- **ä¼˜ç¼ºç‚¹**ï¼š
  - **ä¼˜ç‚¹**ï¼šè¶…ä½åœé¡¿æ—¶é—´ã€é€‚ç”¨äºTçº§å†…å­˜ã€åœé¡¿æ—¶é—´ä¸éšå †å¢å¤§è€Œå¢åŠ 
  - **ç¼ºç‚¹**ï¼šå†…å­˜å¼€é”€è¾ƒå¤§ã€å¯¹CPUèµ„æºæ¶ˆè€—è¾ƒé«˜

- **å¯ç”¨å‚æ•°**ï¼š`-XX:+UseZGC`ï¼ˆJava 15ä¹‹åæ­£å¼å‘å¸ƒï¼‰

**3. Shenandoahæ”¶é›†å™¨**

RedHatå¼€å‘çš„ä½åœé¡¿æ—¶é—´æ”¶é›†å™¨ï¼Œä¸ZGCç±»ä¼¼ã€‚

- **å·¥ä½œåŸç†**ï¼š
  1. ä¸åº”ç”¨çº¿ç¨‹å¹¶å‘å·¥ä½œï¼ŒåŒ…æ‹¬æ ‡è®°ã€æ•´ç†ã€æ•´åˆé˜¶æ®µ
  2. ä½¿ç”¨Brooksè½¬å‘æŒ‡é’ˆå®ç°å¹¶å‘å¯¹è±¡ç§»åŠ¨

- **ä¼˜ç¼ºç‚¹**ï¼š
  - **ä¼˜ç‚¹**ï¼šä½åœé¡¿æ—¶é—´ã€ä¸åº”ç”¨çº¿ç¨‹å¹¶å‘æ‰§è¡Œå¤§éƒ¨åˆ†å·¥ä½œ
  - **ç¼ºç‚¹**ï¼šå†…å­˜å’ŒCPUå¼€é”€è¾ƒå¤§

- **å¯ç”¨å‚æ•°**ï¼š`-XX:+UseShenandoahGC`

**æ··åˆæ”¶é›†å™¨å¯¹æ¯”ï¼š**

| æ”¶é›†å™¨ | é¦–æ¬¡å‘å¸ƒ | åœé¡¿æ—¶é—´ | å†…å­˜å¼€é”€ | é€‚ç”¨å †å¤§å° | ä¸»è¦ç‰¹ç‚¹ |
| ------------ | ---------- | ------------ | ------------ | ------------ | ------------ |
| G1 | JDK 7 | å¯é¢„æµ‹ï¼ˆæ¯«ç§’çº§ï¼‰ | ä¸­ç­‰ | ä¸­å°å‹å † | åŒºåŸŸåŒ–åˆ†ä»£ã€å¯é¢„æµ‹åœé¡¿ |
| ZGC | JDK 11 | è¶…ä½ï¼ˆ<10msï¼‰ | è¾ƒé«˜ | å¤§å‹å † | ç€è‰²æŒ‡é’ˆã€å¹¶å‘æ”¶é›† |
| Shenandoah | JDK 12 | è¶…ä½ï¼ˆ<10msï¼‰ | è¾ƒé«˜ | å¤§å‹å † | Brooksè½¬å‘æŒ‡é’ˆã€å¹¶å‘æ”¶é›† |

### åƒåœ¾æ”¶é›†å™¨é€‰æ‹©

é€‰æ‹©åˆé€‚çš„åƒåœ¾æ”¶é›†å™¨éœ€è¦è€ƒè™‘å¤šæ–¹é¢å› ç´ ï¼š

```mermaid
flowchart TD
    subgraph "ğŸ¯ æ”¶é›†å™¨é€‰æ‹©å†³ç­–æ ‘" ["æ”¶é›†å™¨é€‰æ‹©å†³ç­–æ ‘"]
        Start["åƒåœ¾æ”¶é›†å™¨é€‰æ‹©"] -->|"è€ƒè™‘å› ç´ : åº”ç”¨ç±»å‹+ç¡¬ä»¶ç¯å¢ƒ+æ€§èƒ½ç›®æ ‡+JDKç‰ˆæœ¬"| AppType{{"åº”ç”¨ç±»å‹?"}}
        
        AppType -->|"å•æœº/å°å†…å­˜<100MB"| SmallApp["Serial + Serial Old"]
        AppType -->|"æ‰¹å¤„ç†/åå°è¿ç®—"| BatchApp["Parallel Scavenge + Parallel Old"]
        AppType -->|"äº¤äº’åº”ç”¨/ä½å»¶è¿Ÿ"| InteractiveApp
        
        InteractiveApp{{"å †å†…å­˜å¤§å°?"}} -->|"å°å †<4GB"| SmallHeap["ParNew + CMS"]
        InteractiveApp -->|"ä¸­å †4GB-32GB"| MediumHeap["G1æ”¶é›†å™¨"]
        InteractiveApp -->|"å¤§å †>32GB"| LargeHeap
        
        LargeHeap{{"æ˜¯å¦Java 11+?"}} -->|"æ˜¯"| ModernJDK["ZGC/Shenandoah"]
        LargeHeap -->|"å¦"| LegacyJDK["G1æ”¶é›†å™¨"]
        
        SmallApp -->|"é€‚ç”¨: å•çº¿ç¨‹+ç®€å•é«˜æ•ˆ"| Result1["å•æœºæ¡Œé¢åº”ç”¨"]
        BatchApp -->|"é€‚ç”¨: é«˜ååé‡+åå°ä»»åŠ¡"| Result2["æ•°æ®å¤„ç†ç³»ç»Ÿ"]
        SmallHeap -->|"é€‚ç”¨: ä½å»¶è¿Ÿ+ä¸­å°å†…å­˜"| Result3["ä¼ ç»Ÿç½‘ç«™"]
        MediumHeap -->|"é€‚ç”¨: å¹³è¡¡æ€§èƒ½+å¯é¢„æµ‹åœé¡¿"| Result4["ä¼ä¸šåº”ç”¨"]
        ModernJDK -->|"é€‚ç”¨: æä½å»¶è¿Ÿ+å¤§å†…å­˜"| Result5["é‡‘èäº¤æ˜“ç³»ç»Ÿ"]
        LegacyJDK --> Result4
    end
    
    %% æ ·å¼è®¾ç½®
    style Start fill:#E3F2FD,stroke:#1976D2,stroke-width:2px
    style SmallApp fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px
    style BatchApp fill:#FFF3E0,stroke:#F57C00,stroke-width:2px
    style SmallHeap fill:#E8F5E8,stroke:#388E3C,stroke-width:2px
    style MediumHeap fill:#FCE4EC,stroke:#C2185B,stroke-width:2px
    style ModernJDK fill:#E0F2F1,stroke:#00695C,stroke-width:2px
```

**æ”¶é›†å™¨é€‰æ‹©å»ºè®®ï¼š**

1. **äº¤äº’å¼åº”ç”¨**ï¼ˆä½å»¶è¿Ÿä¼˜å…ˆï¼‰ï¼š
   - JDK 8ï¼šæ–°ç”Ÿä»£ä½¿ç”¨ParNewï¼Œè€å¹´ä»£ä½¿ç”¨CMSï¼ˆ`-XX:+UseConcMarkSweepGC`ï¼‰
   - JDK 11+ï¼šä½¿ç”¨G1ï¼ˆ`-XX:+UseG1GC`ï¼‰æˆ–ZGCï¼ˆ`-XX:+UseZGC`ï¼‰

2. **æ‰¹å¤„ç†åº”ç”¨**ï¼ˆé«˜ååé‡ä¼˜å…ˆï¼‰ï¼š
   - ä½¿ç”¨Parallel Scavenge + Parallel Oldï¼ˆ`-XX:+UseParallelGC`ï¼‰

3. **å°å†…å­˜åº”ç”¨**ï¼ˆ<100MBï¼‰ï¼š
   - ä½¿ç”¨Serial + Serial Oldï¼ˆ`-XX:+UseSerialGC`ï¼‰

4. **ä¸­ç­‰å†…å­˜åº”ç”¨**ï¼ˆ<4GBï¼‰ï¼š
   - äº¤äº’å¼ï¼šParNew + CMS
   - æ‰¹å¤„ç†ï¼šParallel Scavenge + Parallel Old

5. **å¤§å†…å­˜åº”ç”¨**ï¼ˆ>4GBï¼‰ï¼š
   - JDK 8/9/10ï¼šG1æ”¶é›†å™¨
   - JDK 11+ï¼šZGCæˆ–Shenandoah

**æ”¶é›†å™¨æ€§èƒ½å¯¹æ¯”è¡¨ï¼š**

| æ”¶é›†å™¨ | çº¿ç¨‹ | åœé¡¿æ—¶é—´ | ååé‡ | å†…å­˜å ç”¨ | å †å†…å­˜èŒƒå›´ | é€‚ç”¨åœºæ™¯ |
| ------------ | ------ | ------------ | ---------- | ------------ | ------------ | ------------ |
| Serial/Serial Old | å•çº¿ç¨‹ | è¾ƒé•¿ | ä¸€èˆ¬ | æœ€ä½ | <100M | å•CPUã€Clientæ¨¡å¼ |
| ParNew/CMS | å¤šçº¿ç¨‹ | ä¸­ç­‰/çŸ­ | ä¸­ç­‰ | è¾ƒé«˜ | <8G | å¤šCPUã€äº¤äº’åº”ç”¨ |
| Parallel Scavenge/Old | å¤šçº¿ç¨‹ | ä¸­ç­‰ | æœ€é«˜ | ä¸­ç­‰ | <4G | åå°è®¡ç®—ã€æ‰¹å¤„ç† |
| G1 | å¤šçº¿ç¨‹ | å¯é¢„æµ‹ | é«˜ | è¾ƒé«˜ | 1G-32G | å¤§å†…å­˜ã€å¯é¢„æµ‹åœé¡¿ |
| ZGC | å¤šçº¿ç¨‹ | æœ€çŸ­ | é«˜ | ä¸­ç­‰ | >32G | è¶…å¤§å†…å­˜ã€è¶…ä½å»¶è¿Ÿ |

## æ€§èƒ½ä¼˜åŒ–

### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
```java
/**
 * æ€§èƒ½ä¼˜åŒ–å…³é”®ç‚¹
 * 1. JVM è°ƒä¼˜
 * 2. ä»£ç ä¼˜åŒ–
 * 3. æ•°æ®ç»“æ„é€‰æ‹©
 * 4. å¹¶å‘ä¼˜åŒ–
 */

public class PerformanceOptimization {
    // JVM è°ƒä¼˜
    public void jvmOptimization() {
        // å†…å­˜åˆ†é…
        // -XX:+UseG1GC
        // -XX:MaxGCPauseMillis=200
        // -XX:ParallelGCThreads=20
        // -XX:ConcGCThreads=5
        
        // GC æ—¥å¿—åˆ†æ
        // jstat -gcutil pid 1000
        // jmap -heap pid
        // jstack pid
    }
    
    // ä»£ç ä¼˜åŒ–
    public void codeOptimization() {
        // 1. ä½¿ç”¨ StringBuilder è€Œä¸æ˜¯ String è¿æ¥
        StringBuilder sb = new StringBuilder();
        for (int i = 0; i < 1000; i++) {
            sb.append(i);
        }
        
        // 2. é¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡
        String str = "Hello";
        for (int i = 0; i < 1000; i++) {
            str.trim();  // æ¯æ¬¡éƒ½åˆ›å»ºæ–°å¯¹è±¡
        }
        
        // 3. ä½¿ç”¨æ‰¹é‡æ“ä½œ
        List<String> list = new ArrayList<>();
        list.addAll(Arrays.asList("a", "b", "c"));
    }
    
    // æ•°æ®ç»“æ„ä¼˜åŒ–
    public void dataStructureOptimization() {
        // 1. åˆé€‚çš„åˆå§‹å®¹é‡
        Map<String, String> map = new HashMap<>(1000);
        
        // 2. ä½¿ç”¨ EnumSet ä»£æ›¿ HashSet<Enum>
        EnumSet<DayOfWeek> weekends = EnumSet.of(DayOfWeek.SATURDAY, DayOfWeek.SUNDAY);
        
        // 3. ä½¿ç”¨ BitSet å¤„ç†å¤§é‡å¸ƒå°”å€¼
        BitSet bits = new BitSet(1000);
        bits.set(10);  // è®¾ç½®ç¬¬10ä½ä¸ºtrue
    }
    
    // å¹¶å‘ä¼˜åŒ–
    public void concurrencyOptimization() {
        // 1. ä½¿ç”¨çº¿ç¨‹æ± 
        ExecutorService executor = Executors.newFixedThreadPool(10);
        
        // 2. é¿å…è¿‡åº¦åŒæ­¥
        ConcurrentHashMap<String, String> concurrentMap = new ConcurrentHashMap<>();
        
        // 3. ä½¿ç”¨ volatile è€Œä¸æ˜¯ synchronized
        private volatile boolean flag;
    }
}
```

## å¤šçº¿ç¨‹ç¼–ç¨‹

### çº¿ç¨‹åŸºç¡€

#### çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ
```mermaid
graph TD
    A[çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ] --> B[NEW]
    B --> C[RUNNABLE]
    C --> D[BLOCKED]
    C --> E[WAITING]
    C --> F[TIMED_WAITING]
    C --> G[TERMINATED]
    
    D --> C
    E --> C
    F --> C
```

#### çº¿ç¨‹åˆ›å»ºä¸ä½¿ç”¨
```java
public class ThreadCreationExample {
    /**
     * åˆ›å»ºçº¿ç¨‹çš„å‡ ç§æ–¹å¼
     */
    public void threadCreationDemo() {
        // 1. ç»§æ‰¿Threadç±»
        class MyThread extends Thread {
            @Override
            public void run() {
                System.out.println("Thread running: " + Thread.currentThread().getName());
            }
        }
        new MyThread().start();
        
        // 2. å®ç°Runnableæ¥å£
        Runnable task = () -> 
            System.out.println("Runnable running: " + Thread.currentThread().getName());
        new Thread(task).start();
        
        // 3. å®ç°Callableæ¥å£ï¼ˆæœ‰è¿”å›å€¼ï¼‰
        Callable<String> callable = () -> {
            Thread.sleep(1000);
            return "Callable result";
        };
        FutureTask<String> future = new FutureTask<>(callable);
        new Thread(future).start();
        
        try {
            String result = future.get();  // è·å–è¿”å›å€¼
        } catch (InterruptedException | ExecutionException e) {
            Thread.currentThread().interrupt();
        }
    }
    
    /**
     * çº¿ç¨‹æ§åˆ¶æ–¹æ³•
     */
    public void threadControlDemo() {
        Thread thread = new Thread(() -> {
            try {
                // ä¼‘çœ 
                Thread.sleep(1000);
                
                // è®©å‡ºCPU
                Thread.yield();
                
                // ç­‰å¾…å…¶ä»–çº¿ç¨‹
                Thread.join();
                
                // ä¸­æ–­æ£€æŸ¥
                if (Thread.interrupted()) {
                    return;
                }
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        });
        
        // å¯åŠ¨çº¿ç¨‹
        thread.start();
        
        // è®¾ç½®å®ˆæŠ¤çº¿ç¨‹
        thread.setDaemon(true);
        
        // è®¾ç½®ä¼˜å…ˆçº§
        thread.setPriority(Thread.MAX_PRIORITY);
        
        // ä¸­æ–­çº¿ç¨‹
        thread.interrupt();
    }
}
```

### çº¿ç¨‹æ± è¯¦è§£

#### çº¿ç¨‹æ± å·¥ä½œæµç¨‹
```mermaid
sequenceDiagram
    participant Task
    participant ThreadPool
    participant CorePool
    participant Queue
    participant MaxPool
    
    Task->>ThreadPool: æäº¤ä»»åŠ¡
    alt æ ¸å¿ƒçº¿ç¨‹æ± æœªæ»¡
        ThreadPool->>CorePool: åˆ›å»ºæ–°çº¿ç¨‹
    else æ ¸å¿ƒçº¿ç¨‹æ± å·²æ»¡
        alt ä»»åŠ¡é˜Ÿåˆ—æœªæ»¡
            ThreadPool->>Queue: åŠ å…¥é˜Ÿåˆ—
        else ä»»åŠ¡é˜Ÿåˆ—å·²æ»¡
            alt æœ€å¤§çº¿ç¨‹æ± æœªæ»¡
                ThreadPool->>MaxPool: åˆ›å»ºæ–°çº¿ç¨‹
            else æœ€å¤§çº¿ç¨‹æ± å·²æ»¡
                ThreadPool->>Task: æ‰§è¡Œæ‹’ç»ç­–ç•¥
            end
        end
    end
```

#### çº¿ç¨‹æ± å®ç°
```java
public class ThreadPoolExample {
    /**
     * å¸¸ç”¨çº¿ç¨‹æ± ç±»å‹
     */
    public void threadPoolTypesDemo() {
        // 1. å›ºå®šå¤§å°çº¿ç¨‹æ± 
        ExecutorService fixedPool = Executors.newFixedThreadPool(5);
        
        // 2. ç¼“å­˜çº¿ç¨‹æ± 
        ExecutorService cachedPool = Executors.newCachedThreadPool();
        
        // 3. å•çº¿ç¨‹æ± 
        ExecutorService singlePool = Executors.newSingleThreadExecutor();
        
        // 4. è°ƒåº¦çº¿ç¨‹æ± 
        ScheduledExecutorService scheduledPool = 
            Executors.newScheduledThreadPool(5);
    }
    
    /**
     * è‡ªå®šä¹‰çº¿ç¨‹æ± 
     */
    public void customThreadPoolDemo() {
        ThreadPoolExecutor executor = new ThreadPoolExecutor(
            5,                      // æ ¸å¿ƒçº¿ç¨‹æ•°
            10,                     // æœ€å¤§çº¿ç¨‹æ•°
            60L,                    // ç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´
            TimeUnit.SECONDS,       // æ—¶é—´å•ä½
            new LinkedBlockingQueue<>(100),  // å·¥ä½œé˜Ÿåˆ—
            new ThreadFactory() {   // çº¿ç¨‹å·¥å‚
                private final AtomicInteger count = new AtomicInteger(1);
                @Override
                public Thread newThread(Runnable r) {
                    Thread thread = new Thread(r);
                    thread.setName("CustomThread-" + count.getAndIncrement());
                    return thread;
                }
            },
            new ThreadPoolExecutor.CallerRunsPolicy()  // æ‹’ç»ç­–ç•¥
        );
        
        // åŠ¨æ€è°ƒæ•´çº¿ç¨‹æ± 
        executor.setCorePoolSize(8);
        executor.setMaximumPoolSize(15);
        
        // é¢„å¯åŠ¨æ ¸å¿ƒçº¿ç¨‹
        executor.prestartAllCoreThreads();
        
        // å…è®¸æ ¸å¿ƒçº¿ç¨‹è¶…æ—¶
        executor.allowCoreThreadTimeOut(true);
    }
    
    /**
     * çº¿ç¨‹æ± ç›‘æ§
     */
    public void threadPoolMonitorDemo() {
        ThreadPoolExecutor executor = new ThreadPoolExecutor(
            5, 10, 60L, TimeUnit.SECONDS,
            new LinkedBlockingQueue<>(100)
        );
        
        // å®šæ—¶ç›‘æ§çº¿ç¨‹æ± çŠ¶æ€
        ScheduledExecutorService monitor = Executors.newScheduledThreadPool(1);
        monitor.scheduleAtFixedRate(() -> {
            System.out.println("=== çº¿ç¨‹æ± çŠ¶æ€ ===");
            System.out.println("æ´»è·ƒçº¿ç¨‹æ•°ï¼š" + executor.getActiveCount());
            System.out.println("æ ¸å¿ƒçº¿ç¨‹æ•°ï¼š" + executor.getCorePoolSize());
            System.out.println("æœ€å¤§çº¿ç¨‹æ•°ï¼š" + executor.getMaximumPoolSize());
            System.out.println("çº¿ç¨‹æ± å¤§å°ï¼š" + executor.getPoolSize());
            System.out.println("é˜Ÿåˆ—ä»»åŠ¡æ•°ï¼š" + executor.getQueue().size());
            System.out.println("å·²å®Œæˆä»»åŠ¡ï¼š" + executor.getCompletedTaskCount());
            System.out.println("æ€»ä»»åŠ¡æ•°ï¼š" + executor.getTaskCount());
            System.out.println("================");
        }, 0, 5, TimeUnit.SECONDS);
    }
}
```

### çº¿ç¨‹å®‰å…¨

#### åŒæ­¥æœºåˆ¶
```java
public class ThreadSafetyExample {
    /**
     * synchronized å…³é”®å­—ä½¿ç”¨
     */
    public void synchronizedDemo() {
        // 1. åŒæ­¥æ–¹æ³•
        public synchronized void method() {
            // ä¸´ç•ŒåŒºä»£ç 
        }
        
        // 2. åŒæ­¥ä»£ç å—
        synchronized (this) {
            // ä¸´ç•ŒåŒºä»£ç 
        }
        
        // 3. é™æ€åŒæ­¥æ–¹æ³•
        public static synchronized void staticMethod() {
            // ä¸´ç•ŒåŒºä»£ç 
        }
        
        // 4. ç±»é”
        synchronized (ClassName.class) {
            // ä¸´ç•ŒåŒºä»£ç 
        }
    }
    
    /**
     * volatile å…³é”®å­—ä½¿ç”¨
     */
    private volatile boolean flag = false;
    
    public void volatileDemo() {
        // ä¿è¯å¯è§æ€§
        flag = true;
        
        // åŒé‡æ£€æŸ¥é”å®š
        private static volatile SingletonClass instance;
        public static SingletonClass getInstance() {
            if (instance == null) {
                synchronized (SingletonClass.class) {
                    if (instance == null) {
                        instance = new SingletonClass();
                    }
                }
            }
            return instance;
        }
    }
}
```

#### çº¿ç¨‹åä½œ
```java
public class ThreadCoordinationExample {
    /**
     * ç­‰å¾…/é€šçŸ¥æœºåˆ¶
     */
    public void waitNotifyDemo() {
        Object lock = new Object();
        
        // ç­‰å¾…çº¿ç¨‹
        new Thread(() -> {
            synchronized (lock) {
                try {
                    System.out.println("ç­‰å¾…ä¿¡å·...");
                    lock.wait();
                    System.out.println("æ”¶åˆ°ä¿¡å·");
                } catch (InterruptedException e) {
                    Thread.currentThread().interrupt();
                }
            }
        }).start();
        
        // é€šçŸ¥çº¿ç¨‹
        new Thread(() -> {
            synchronized (lock) {
                System.out.println("å‘é€ä¿¡å·...");
                lock.notify();
            }
        }).start();
    }
    
    /**
     * CountDownLatchä½¿ç”¨
     */
    public void countDownLatchDemo() {
        CountDownLatch latch = new CountDownLatch(3);
        
        // å¯åŠ¨å¤šä¸ªå·¥ä½œçº¿ç¨‹
        for (int i = 0; i < 3; i++) {
            new Thread(() -> {
                try {
                    Thread.sleep(1000);
                    System.out.println("ä»»åŠ¡å®Œæˆ");
                    latch.countDown();
                } catch (InterruptedException e) {
                    Thread.currentThread().interrupt();
                }
            }).start();
        }
        
        // ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
        try {
            latch.await();
            System.out.println("æ‰€æœ‰ä»»åŠ¡å·²å®Œæˆ");
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
    }
    
    /**
     * CyclicBarrierä½¿ç”¨
     */
    public void cyclicBarrierDemo() {
        CyclicBarrier barrier = new CyclicBarrier(3, () -> 
            System.out.println("æ‰€æœ‰çº¿ç¨‹åˆ°è¾¾å±éšœç‚¹")
        );
        
        for (int i = 0; i < 3; i++) {
            new Thread(() -> {
                try {
                    System.out.println("çº¿ç¨‹ç­‰å¾…...");
                    barrier.await();
                    System.out.println("ç»§ç»­æ‰§è¡Œ");
                } catch (InterruptedException | BrokenBarrierException e) {
                    Thread.currentThread().interrupt();
                }
            }).start();
        }
    }
    
    /**
     * Semaphoreä½¿ç”¨
     */
    public void semaphoreDemo() {
        // åˆ›å»ºåªå…è®¸5ä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®çš„ä¿¡å·é‡
        Semaphore semaphore = new Semaphore(5);
        
        for (int i = 0; i < 10; i++) {
            new Thread(() -> {
                try {
                    semaphore.acquire();  // è·å–è®¸å¯
                    System.out.println("è·å¾—è®¸å¯æ‰§è¡Œä»»åŠ¡");
                    Thread.sleep(1000);
                } catch (InterruptedException e) {
                    Thread.currentThread().interrupt();
                } finally {
                    semaphore.release();  // é‡Šæ”¾è®¸å¯
                }
            }).start();
        }
    }
}
```

### çº¿ç¨‹æ± æœ€ä½³å®è·µ

```java
public class ThreadPoolBestPractices {
    /**
     * çº¿ç¨‹æ± å‚æ•°é…ç½®å»ºè®®
     */
    public void threadPoolConfigurationGuide() {
        // CPUå¯†é›†å‹ä»»åŠ¡
        int cpuCores = Runtime.getRuntime().availableProcessors();
        ThreadPoolExecutor cpuPool = new ThreadPoolExecutor(
            cpuCores,                    // æ ¸å¿ƒçº¿ç¨‹æ•° = CPUæ ¸å¿ƒæ•°
            cpuCores + 1,               // æœ€å¤§çº¿ç¨‹æ•° = CPUæ ¸å¿ƒæ•° + 1
            60L, TimeUnit.SECONDS,
            new LinkedBlockingQueue<>(1000)
        );
        
        // IOå¯†é›†å‹ä»»åŠ¡
        ThreadPoolExecutor ioPool = new ThreadPoolExecutor(
            cpuCores * 2,               // æ ¸å¿ƒçº¿ç¨‹æ•° = CPUæ ¸å¿ƒæ•° * 2
            cpuCores * 4,               // æœ€å¤§çº¿ç¨‹æ•° = CPUæ ¸å¿ƒæ•° * 4
            60L, TimeUnit.SECONDS,
            new LinkedBlockingQueue<>(2000)
        );
        
        // æ··åˆå‹ä»»åŠ¡
        ThreadPoolExecutor mixedPool = new ThreadPoolExecutor(
            cpuCores + 1,               // æ ¸å¿ƒçº¿ç¨‹æ•° = CPUæ ¸å¿ƒæ•° + 1
            cpuCores * 2,               // æœ€å¤§çº¿ç¨‹æ•° = CPUæ ¸å¿ƒæ•° * 2
            60L, TimeUnit.SECONDS,
            new ArrayBlockingQueue<>(1000),  // ä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—
            new ThreadPoolExecutor.CallerRunsPolicy()  // ä½¿ç”¨è°ƒç”¨è€…è¿è¡Œç­–ç•¥
        );
    }
    
    /**
     * ä»»åŠ¡æäº¤æœ€ä½³å®è·µ
     */
    public void taskSubmissionBestPractices() {
        ExecutorService executor = Executors.newFixedThreadPool(5);
        
        // æäº¤ä»»åŠ¡å¹¶è·å–Future
        Future<String> future = executor.submit(() -> {
            // ä»»åŠ¡æ‰§è¡Œé€»è¾‘
            return "ä»»åŠ¡ç»“æœ";
        });
        
        // æ‰¹é‡æäº¤ä»»åŠ¡
        List<Callable<String>> tasks = Arrays.asList(
            () -> "Task 1",
            () -> "Task 2",
            () -> "Task 3"
        );
        
        try {
            // æ‰§è¡Œæ‰€æœ‰ä»»åŠ¡å¹¶ç­‰å¾…å®Œæˆ
            List<Future<String>> futures = executor.invokeAll(tasks);
            
            // è·å–ç¬¬ä¸€ä¸ªå®Œæˆçš„ä»»åŠ¡ç»“æœ
            String firstResult = executor.invokeAny(tasks);
            
        } catch (InterruptedException | ExecutionException e) {
            Thread.currentThread().interrupt();
        }
    }
    
    /**
     * å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ
     */
    public void exceptionHandlingBestPractices() {
        ThreadPoolExecutor executor = new ThreadPoolExecutor(
            5, 10, 60L, TimeUnit.SECONDS,
            new LinkedBlockingQueue<>(100)
        ) {
            @Override
            protected void afterExecute(Runnable r, Throwable t) {
                super.afterExecute(r, t);
                if (t != null) {
                    // å¤„ç†æœªæ•è·çš„å¼‚å¸¸
                    System.err.println("ä»»åŠ¡æ‰§è¡Œå¼‚å¸¸: " + t.getMessage());
                }
            }
        };
        
        // ä½¿ç”¨UncaughtExceptionHandler
        Thread.setDefaultUncaughtExceptionHandler((thread, throwable) -> {
            System.err.println("çº¿ç¨‹ " + thread.getName() + " å‘ç”Ÿå¼‚å¸¸: " + 
                             throwable.getMessage());
        });
    }
    
    /**
     * ä¼˜é›…å…³é—­çº¿ç¨‹æ± 
     */
    public void gracefulShutdownDemo() {
        ThreadPoolExecutor executor = new ThreadPoolExecutor(
            5, 10, 60L, TimeUnit.SECONDS,
            new LinkedBlockingQueue<>(100)
        );
        
        // æ³¨å†Œå…³é—­é’©å­
        Runtime.getRuntime().addShutdownHook(new Thread(() -> {
            System.out.println("å¼€å§‹å…³é—­çº¿ç¨‹æ± ...");
            
            // æ‹’ç»æ–°ä»»åŠ¡
            executor.shutdown();
            try {
                // ç­‰å¾…å·²æäº¤ä»»åŠ¡å®Œæˆ
                if (!executor.awaitTermination(60, TimeUnit.SECONDS)) {
                    // å¼ºåˆ¶å…³é—­
                    executor.shutdownNow();
                    
                    // ç­‰å¾…ä¸­æ–­å“åº”
                    if (!executor.awaitTermination(60, TimeUnit.SECONDS)) {
                        System.err.println("çº¿ç¨‹æ± æœªèƒ½å®Œå…¨å…³é—­");
                    }
                }
            } catch (InterruptedException e) {
                // é‡æ–°å°è¯•å…³é—­
                executor.shutdownNow();
                Thread.currentThread().interrupt();
            }
            
            System.out.println("çº¿ç¨‹æ± å·²å…³é—­");
        }));
    }
}
```

## è®¾è®¡æ¨¡å¼

### åˆ›å»ºå‹æ¨¡å¼

#### å•ä¾‹æ¨¡å¼
```java
/**
 * å•ä¾‹æ¨¡å¼å®ç°æ–¹å¼å¯¹æ¯”
 * ç›®çš„ï¼šç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›å…¨å±€è®¿é—®ç‚¹
 */

// 1. é¥¿æ±‰å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼Œä½†å¯èƒ½æµªè´¹å†…å­˜ï¼‰
public class EagerSingleton {
    private static final EagerSingleton INSTANCE = new EagerSingleton();
    
    private EagerSingleton() {}
    
    public static EagerSingleton getInstance() {
        return INSTANCE;
    }
}

// 2. æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰
public class LazySingleton {
    private static LazySingleton instance;
    
    private LazySingleton() {}
    
    public static LazySingleton getInstance() {
        if (instance == null) {
            instance = new LazySingleton();
        }
        return instance;
    }
}

// 3. åŒé‡æ£€æŸ¥é”å®šï¼ˆæ¨èï¼‰
public class DoubleCheckedSingleton {
    private static volatile DoubleCheckedSingleton instance;
    
    private DoubleCheckedSingleton() {}
    
    public static DoubleCheckedSingleton getInstance() {
        if (instance == null) {
            synchronized (DoubleCheckedSingleton.class) {
                if (instance == null) {
                    instance = new DoubleCheckedSingleton();
                }
            }
        }
        return instance;
    }
}

// 4. é™æ€å†…éƒ¨ç±»ï¼ˆæ¨èï¼‰
public class StaticInnerSingleton {
    private StaticInnerSingleton() {}
    
    private static class SingletonHolder {
        private static final StaticInnerSingleton INSTANCE = new StaticInnerSingleton();
    }
    
    public static StaticInnerSingleton getInstance() {
        return SingletonHolder.INSTANCE;
    }
}

// 5. æšä¸¾å®ç°ï¼ˆæœ€ä½³å®è·µï¼‰
public enum EnumSingleton {
    INSTANCE;
    
    public void doSomething() {
        System.out.println("æšä¸¾å•ä¾‹æ‰§è¡Œæ“ä½œ");
    }
}
```

#### å·¥å‚æ¨¡å¼
```java
/**
 * å·¥å‚æ¨¡å¼ç¤ºä¾‹
 * ç›®çš„ï¼šåˆ›å»ºå¯¹è±¡è€Œä¸æš´éœ²åˆ›å»ºé€»è¾‘ï¼Œé€šè¿‡å…¬å…±æ¥å£å¼•ç”¨æ–°åˆ›å»ºçš„å¯¹è±¡
 */

// äº§å“æ¥å£
public interface Product {
    void use();
}

// å…·ä½“äº§å“
public class ConcreteProductA implements Product {
    @Override
    public void use() {
        System.out.println("ä½¿ç”¨äº§å“A");
    }
}

public class ConcreteProductB implements Product {
    @Override
    public void use() {
        System.out.println("ä½¿ç”¨äº§å“B");
    }
}

// ç®€å•å·¥å‚
public class SimpleFactory {
    public static Product createProduct(String type) {
        switch (type) {
            case "A":
                return new ConcreteProductA();
            case "B":
                return new ConcreteProductB();
            default:
                throw new IllegalArgumentException("æœªçŸ¥äº§å“ç±»å‹ï¼š" + type);
        }
    }
}

// å·¥å‚æ–¹æ³•æ¨¡å¼
public abstract class Factory {
    public abstract Product createProduct();
    
    public void doSomething() {
        Product product = createProduct();
        product.use();
    }
}

public class ConcreteFactoryA extends Factory {
    @Override
    public Product createProduct() {
        return new ConcreteProductA();
    }
}

// æŠ½è±¡å·¥å‚æ¨¡å¼
public interface AbstractFactory {
    Product createProductA();
    Product createProductB();
}

public class ConcreteFactory1 implements AbstractFactory {
    @Override
    public Product createProductA() {
        return new ConcreteProductA();
    }
    
    @Override
    public Product createProductB() {
        return new ConcreteProductB();
    }
}
```

#### å»ºé€ è€…æ¨¡å¼
```java
/**
 * å»ºé€ è€…æ¨¡å¼ç¤ºä¾‹
 * ç›®çš„ï¼šå°†å¤æ‚å¯¹è±¡çš„æ„å»ºä¸è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤º
 */
public class Computer {
    private String cpu;
    private String memory;
    private String storage;
    private String graphics;
    private String motherboard;
    
    private Computer(Builder builder) {
        this.cpu = builder.cpu;
        this.memory = builder.memory;
        this.storage = builder.storage;
        this.graphics = builder.graphics;
        this.motherboard = builder.motherboard;
    }
    
    public static class Builder {
        private String cpu;
        private String memory;
        private String storage;
        private String graphics;
        private String motherboard;
        
        public Builder cpu(String cpu) {
            this.cpu = cpu;
            return this;
        }
        
        public Builder memory(String memory) {
            this.memory = memory;
            return this;
        }
        
        public Builder storage(String storage) {
            this.storage = storage;
            return this;
        }
        
        public Builder graphics(String graphics) {
            this.graphics = graphics;
            return this;
        }
        
        public Builder motherboard(String motherboard) {
            this.motherboard = motherboard;
            return this;
        }
        
        public Computer build() {
            return new Computer(this);
        }
    }
    
    // ä½¿ç”¨ç¤ºä¾‹
    public static void main(String[] args) {
        Computer computer = new Computer.Builder()
            .cpu("Intel i7")
            .memory("16GB")
            .storage("512GB SSD")
            .graphics("RTX 3080")
            .motherboard("ASUS ROG")
            .build();
    }
}
```

### ç»“æ„å‹æ¨¡å¼

#### é€‚é…å™¨æ¨¡å¼
```java
/**
 * é€‚é…å™¨æ¨¡å¼ç¤ºä¾‹
 * ç›®çš„ï¼šå°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦ä¸€ä¸ªæ¥å£
 */

// ç›®æ ‡æ¥å£
public interface Target {
    void request();
}

// éœ€è¦é€‚é…çš„ç±»
public class Adaptee {
    public void specificRequest() {
        System.out.println("ç‰¹æ®Šè¯·æ±‚");
    }
}

// å¯¹è±¡é€‚é…å™¨
public class ObjectAdapter implements Target {
    private Adaptee adaptee;
    
    public ObjectAdapter(Adaptee adaptee) {
        this.adaptee = adaptee;
    }
    
    @Override
    public void request() {
        adaptee.specificRequest();
    }
}

// ç±»é€‚é…å™¨
public class ClassAdapter extends Adaptee implements Target {
    @Override
    public void request() {
        specificRequest();
    }
}
```

#### è£…é¥°å™¨æ¨¡å¼
```java
/**
 * è£…é¥°å™¨æ¨¡å¼ç¤ºä¾‹
 * ç›®çš„ï¼šåŠ¨æ€åœ°ç»™å¯¹è±¡æ·»åŠ ä¸€äº›é¢å¤–çš„èŒè´£
 */

// ç»„ä»¶æ¥å£
public interface Component {
    void operation();
}

// å…·ä½“ç»„ä»¶
public class ConcreteComponent implements Component {
    @Override
    public void operation() {
        System.out.println("åŸºæœ¬æ“ä½œ");
    }
}

// è£…é¥°å™¨åŸºç±»
public abstract class Decorator implements Component {
    protected Component component;
    
    public Decorator(Component component) {
        this.component = component;
    }
    
    @Override
    public void operation() {
        component.operation();
    }
}

// å…·ä½“è£…é¥°å™¨
public class ConcreteDecoratorA extends Decorator {
    public ConcreteDecoratorA(Component component) {
        super(component);
    }
    
    @Override
    public void operation() {
        super.operation();
        addedBehavior();
    }
    
    private void addedBehavior() {
        System.out.println("æ·»åŠ çš„è¡Œä¸ºA");
    }
}

public class ConcreteDecoratorB extends Decorator {
    public ConcreteDecoratorB(Component component) {
        super(component);
    }
    
    @Override
    public void operation() {
        super.operation();
        addedBehavior();
    }
    
    private void addedBehavior() {
        System.out.println("æ·»åŠ çš„è¡Œä¸ºB");
    }
}

// ä½¿ç”¨ç¤ºä¾‹
public class DecoratorDemo {
    public static void main(String[] args) {
        Component component = new ConcreteComponent();
        component = new ConcreteDecoratorA(component);
        component = new ConcreteDecoratorB(component);
        component.operation();
    }
}
```

### è¡Œä¸ºå‹æ¨¡å¼

#### è§‚å¯Ÿè€…æ¨¡å¼
```java
/**
 * è§‚å¯Ÿè€…æ¨¡å¼ç¤ºä¾‹
 * ç›®çš„ï¼šå®šä¹‰å¯¹è±¡é—´çš„ä¸€å¯¹å¤šä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çŠ¶æ€æ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–å®ƒçš„å¯¹è±¡éƒ½å¾—åˆ°é€šçŸ¥
 */

// è§‚å¯Ÿè€…æ¥å£
public interface Observer {
    void update(String message);
}

// ä¸»é¢˜æ¥å£
public interface Subject {
    void attach(Observer observer);
    void detach(Observer observer);
    void notifyObservers();
}

// å…·ä½“ä¸»é¢˜
public class ConcreteSubject implements Subject {
    private List<Observer> observers = new ArrayList<>();
    private String state;
    
    @Override
    public void attach(Observer observer) {
        observers.add(observer);
    }
    
    @Override
    public void detach(Observer observer) {
        observers.remove(observer);
    }
    
    @Override
    public void notifyObservers() {
        for (Observer observer : observers) {
            observer.update(state);
        }
    }
    
    public void setState(String state) {
        this.state = state;
        notifyObservers();
    }
}

// å…·ä½“è§‚å¯Ÿè€…
public class ConcreteObserver implements Observer {
    private String name;
    
    public ConcreteObserver(String name) {
        this.name = name;
    }
    
    @Override
    public void update(String message) {
        System.out.println(name + " æ”¶åˆ°æ¶ˆæ¯ï¼š" + message);
    }
}
```

#### ç­–ç•¥æ¨¡å¼
```java
/**
 * ç­–ç•¥æ¨¡å¼ç¤ºä¾‹
 * ç›®çš„ï¼šå®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼ŒæŠŠå®ƒä»¬ä¸€ä¸ªä¸ªå°è£…èµ·æ¥ï¼Œå¹¶ä¸”ä½¿å®ƒä»¬å¯ç›¸äº’æ›¿æ¢
 */

// ç­–ç•¥æ¥å£
public interface Strategy {
    double calculate(double amount);
}

// å…·ä½“ç­–ç•¥
public class RegularCustomerStrategy implements Strategy {
    @Override
    public double calculate(double amount) {
        return amount;  // æ— æŠ˜æ‰£
    }
}

public class VipCustomerStrategy implements Strategy {
    @Override
    public double calculate(double amount) {
        return amount * 0.9;  // 9æŠ˜
    }
}

public class SuperVipCustomerStrategy implements Strategy {
    @Override
    public double calculate(double amount) {
        return amount * 0.8;  // 8æŠ˜
    }
}

// ä¸Šä¸‹æ–‡
public class PriceCalculator {
    private Strategy strategy;
    
    public PriceCalculator(Strategy strategy) {
        this.strategy = strategy;
    }
    
    public void setStrategy(Strategy strategy) {
        this.strategy = strategy;
    }
    
    public double calculatePrice(double amount) {
        return strategy.calculate(amount);
    }
}

// ä½¿ç”¨ç¤ºä¾‹
public class StrategyDemo {
    public static void main(String[] args) {
        PriceCalculator calculator = new PriceCalculator(new RegularCustomerStrategy());
        System.out.println("æ™®é€šå®¢æˆ·ä»·æ ¼ï¼š" + calculator.calculatePrice(100));
        
        calculator.setStrategy(new VipCustomerStrategy());
        System.out.println("VIPå®¢æˆ·ä»·æ ¼ï¼š" + calculator.calculatePrice(100));
        
        calculator.setStrategy(new SuperVipCustomerStrategy());
        System.out.println("è¶…çº§VIPå®¢æˆ·ä»·æ ¼ï¼š" + calculator.calculatePrice(100));
    }
}
```

## å¸¸è§é¢è¯•é¢˜

### åŸºç¡€çŸ¥è¯†é¢è¯•é¢˜

#### 1. JavaåŸºç¡€æ¦‚å¿µ

**Q1: Javaçš„ä¸‰å¤§ç‰¹æ€§æ˜¯ä»€ä¹ˆï¼Ÿè¯·è¯¦ç»†è§£é‡Šã€‚**

**ç­”æ¡ˆï¼š**
Javaçš„ä¸‰å¤§ç‰¹æ€§æ˜¯**å°è£…ã€ç»§æ‰¿ã€å¤šæ€**ã€‚

- **å°è£…ï¼ˆEncapsulationï¼‰**ï¼šå°†æ•°æ®å’Œæ“ä½œæ•°æ®çš„æ–¹æ³•ç»‘å®šåœ¨ä¸€èµ·ï¼Œéšè—å†…éƒ¨å®ç°ç»†èŠ‚ï¼Œåªæš´éœ²å¿…è¦çš„æ¥å£ã€‚é€šè¿‡privateã€protectedã€publicç­‰è®¿é—®ä¿®é¥°ç¬¦æ§åˆ¶è®¿é—®æƒé™ã€‚
- **ç»§æ‰¿ï¼ˆInheritanceï¼‰**ï¼šå­ç±»å¯ä»¥ç»§æ‰¿çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•ï¼Œå®ç°ä»£ç å¤ç”¨ã€‚Javaæ”¯æŒå•ç»§æ‰¿ï¼Œé€šè¿‡extendså…³é”®å­—å®ç°ã€‚
- **å¤šæ€ï¼ˆPolymorphismï¼‰**ï¼šåŒä¸€ä¸ªæ¥å£å¯ä»¥æœ‰ä¸åŒçš„å®ç°ï¼Œè¿è¡Œæ—¶æ ¹æ®å®é™…å¯¹è±¡ç±»å‹è°ƒç”¨ç›¸åº”çš„æ–¹æ³•ã€‚åŒ…æ‹¬æ–¹æ³•é‡è½½å’Œæ–¹æ³•é‡å†™ã€‚

**Q2: == å’Œ equals() çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ**

**ç­”æ¡ˆï¼š**
- **==** æ¯”è¾ƒçš„æ˜¯**å¼•ç”¨åœ°å€**ï¼ˆå¯¹äºå¯¹è±¡ï¼‰æˆ–**å€¼**ï¼ˆå¯¹äºåŸºæœ¬ç±»å‹ï¼‰
- **equals()** æ¯”è¾ƒçš„æ˜¯**å¯¹è±¡çš„å†…å®¹**

```java
String s1 = new String("hello");
String s2 = new String("hello");
String s3 = "hello";
String s4 = "hello";

System.out.println(s1 == s2);        // falseï¼Œä¸åŒå¯¹è±¡
System.out.println(s1.equals(s2));   // trueï¼Œå†…å®¹ç›¸åŒ
System.out.println(s3 == s4);        // trueï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± 
```

**Q3: Stringã€StringBuilderã€StringBufferçš„åŒºåˆ«ï¼Ÿ**

**ç­”æ¡ˆï¼š**
| ç‰¹æ€§     | String             | StringBuilder  | StringBuffer     |
| -------- | ------------------ | -------------- | ---------------- |
| å¯å˜æ€§   | ä¸å¯å˜             | å¯å˜           | å¯å˜             |
| çº¿ç¨‹å®‰å…¨ | å®‰å…¨               | ä¸å®‰å…¨         | å®‰å…¨             |
| æ€§èƒ½     | å·®ï¼ˆé¢‘ç¹åˆ›å»ºå¯¹è±¡ï¼‰ | å¥½             | ä¸­ç­‰ï¼ˆåŒæ­¥å¼€é”€ï¼‰ |
| ä½¿ç”¨åœºæ™¯ | å°‘é‡å­—ç¬¦ä¸²æ“ä½œ     | å•çº¿ç¨‹å¤§é‡æ“ä½œ | å¤šçº¿ç¨‹å¤§é‡æ“ä½œ   |

#### 2. å¼‚å¸¸å¤„ç†

**Q4: Javaå¼‚å¸¸ä½“ç³»ç»“æ„æ˜¯æ€æ ·çš„ï¼Ÿ**

**ç­”æ¡ˆï¼š**
```mermaid
graph TD
    A[Throwable] --> B[Error]
    A --> C[Exception]
    
    B --> B1[OutOfMemoryError]
    B --> B2[StackOverflowError]
    
    C --> C1[RuntimeException]
    C --> C2[IOException]
    C --> C3[SQLException]
    
    C1 --> C11[NullPointerException]
    C1 --> C12[ArrayIndexOutOfBoundsException]
```

- **Error**ï¼šç³»ç»Ÿçº§é”™è¯¯ï¼Œç¨‹åºæ— æ³•å¤„ç†
- **Exception**ï¼šç¨‹åºå¯ä»¥å¤„ç†çš„å¼‚å¸¸
  - **RuntimeException**ï¼šè¿è¡Œæ—¶å¼‚å¸¸ï¼Œä¸å¼ºåˆ¶å¤„ç†
  - **Checked Exception**ï¼šç¼–è¯‘æ—¶å¼‚å¸¸ï¼Œå¿…é¡»å¤„ç†

**Q5: try-catch-finallyçš„æ‰§è¡Œé¡ºåºï¼Ÿ**

**ç­”æ¡ˆï¼š**
1. æ‰§è¡Œtryå—
2. å¦‚æœæœ‰å¼‚å¸¸ï¼Œæ‰§è¡Œå¯¹åº”çš„catchå—
3. **æ— è®ºæ˜¯å¦æœ‰å¼‚å¸¸ï¼Œéƒ½ä¼šæ‰§è¡Œfinallyå—**
4. finallyå—åœ¨returnè¯­å¥ä¹‹å‰æ‰§è¡Œ

```java
public int testFinally() {
    try {
        return 1;
    } catch (Exception e) {
        return 2;
    } finally {
        System.out.println("finallyæ‰§è¡Œ");  // ä¼šæ‰§è¡Œ
        // return 3;  // å¦‚æœfinallyä¸­æœ‰returnï¼Œä¼šè¦†ç›–try/catchçš„return
    }
}
```

#### 3. æ³›å‹æœºåˆ¶

**Q6: ä»€ä¹ˆæ˜¯æ³›å‹æ“¦é™¤ï¼Ÿæœ‰ä»€ä¹ˆå½±å“ï¼Ÿ**

**ç­”æ¡ˆï¼š**
**æ³›å‹æ“¦é™¤**æ˜¯æŒ‡Javaåœ¨ç¼–è¯‘æ—¶ä¼šå°†æ³›å‹ä¿¡æ¯æ“¦é™¤ï¼Œè¿è¡Œæ—¶ä¸å­˜åœ¨æ³›å‹ä¿¡æ¯ã€‚

```java
List<String> stringList = new ArrayList<>();
List<Integer> intList = new ArrayList<>();

// è¿è¡Œæ—¶ç±»å‹ç›¸åŒ
System.out.println(stringList.getClass() == intList.getClass()); // true
```

**å½±å“ï¼š**
1. ä¸èƒ½ä½¿ç”¨åŸºæœ¬ç±»å‹ä½œä¸ºæ³›å‹å‚æ•°
2. ä¸èƒ½åˆ›å»ºæ³›å‹æ•°ç»„
3. ä¸èƒ½åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨æ³›å‹
4. è¿è¡Œæ—¶æ— æ³•è·å–æ³›å‹çš„å…·ä½“ç±»å‹

### JVMé¢è¯•é¢˜

#### 1. å†…å­˜æ¨¡å‹

**Q7: JVMå†…å­˜ç»“æ„æ˜¯æ€æ ·çš„ï¼Ÿ**

**ç­”æ¡ˆï¼š**
```mermaid
graph TD
    A[JVMå†…å­˜] --> B[å †å†…å­˜]
    A --> C[æ–¹æ³•åŒº]
    A --> D[è™šæ‹Ÿæœºæ ˆ]
    A --> E[æœ¬åœ°æ–¹æ³•æ ˆ]
    A --> F[ç¨‹åºè®¡æ•°å™¨]
    
    B --> B1[æ–°ç”Ÿä»£]
    B --> B2[è€å¹´ä»£]
    
    B1 --> B11[EdenåŒº]
    B1 --> B12[Survivor0]
    B1 --> B13[Survivor1]
```

- **å †å†…å­˜**ï¼šå­˜å‚¨å¯¹è±¡å®ä¾‹ï¼Œåˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£
- **æ–¹æ³•åŒº**ï¼šå­˜å‚¨ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡
- **è™šæ‹Ÿæœºæ ˆ**ï¼šå­˜å‚¨å±€éƒ¨å˜é‡ã€æ–¹æ³•å‚æ•°ã€è¿”å›åœ°å€
- **æœ¬åœ°æ–¹æ³•æ ˆ**ï¼šä¸ºnativeæ–¹æ³•æœåŠ¡
- **ç¨‹åºè®¡æ•°å™¨**ï¼šè®°å½•å½“å‰æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤åœ°å€

**Q8: ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼ï¼Ÿå¦‚ä½•é¿å…ï¼Ÿ**

**ç­”æ¡ˆï¼š**
**å†…å­˜æ³„æ¼**æ˜¯æŒ‡ç¨‹åºä¸­å·²åŠ¨æ€åˆ†é…çš„å †å†…å­˜ç”±äºæŸç§åŸå› æœªé‡Šæ”¾æˆ–æ— æ³•é‡Šæ”¾ã€‚

**å¸¸è§åŸå› ï¼š**
1. **é›†åˆç±»æœªæ¸…ç†**
```java
// é”™è¯¯ç¤ºä¾‹
private List<Object> cache = new ArrayList<>();
public void addToCache(Object obj) {
    cache.add(obj);  // åªæ·»åŠ ä¸æ¸…ç†
}
```

2. **ç›‘å¬å™¨æœªç§»é™¤**
```java
// é”™è¯¯ç¤ºä¾‹
button.addActionListener(listener);  // æœªåœ¨é€‚å½“æ—¶æœºç§»é™¤
```

3. **é™æ€é›†åˆæŒæœ‰å¯¹è±¡å¼•ç”¨**
```java
// é”™è¯¯ç¤ºä¾‹
private static List<Object> staticList = new ArrayList<>();
```

**é¿å…æ–¹æ³•ï¼š**
- åŠæ—¶æ¸…ç†é›†åˆ
- ç§»é™¤ç›‘å¬å™¨
- ä½¿ç”¨WeakReference
- é¿å…é™æ€é›†åˆæŒæœ‰å¤§å¯¹è±¡

#### 2. åƒåœ¾å›æ”¶

**Q9: åƒåœ¾å›æ”¶ç®—æ³•æœ‰å“ªäº›ï¼Ÿå„æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ**

**ç­”æ¡ˆï¼š**

| ç®—æ³•      | ç‰¹ç‚¹                   | ä¼˜ç‚¹       | ç¼ºç‚¹           | é€‚ç”¨åœºæ™¯ |
| --------- | ---------------------- | ---------- | -------------- | -------- |
| æ ‡è®°-æ¸…é™¤ | æ ‡è®°åƒåœ¾å¯¹è±¡åæ¸…é™¤     | å®ç°ç®€å•   | äº§ç”Ÿå†…å­˜ç¢ç‰‡   | è€å¹´ä»£   |
| æ ‡è®°-å¤åˆ¶ | å¤åˆ¶å­˜æ´»å¯¹è±¡åˆ°å¦ä¸€ç©ºé—´ | æ— å†…å­˜ç¢ç‰‡ | éœ€è¦åŒå€ç©ºé—´   | æ–°ç”Ÿä»£   |
| æ ‡è®°-æ•´ç† | æ ‡è®°åç§»åŠ¨å­˜æ´»å¯¹è±¡     | æ— å†…å­˜ç¢ç‰‡ | ç§»åŠ¨å¯¹è±¡å¼€é”€å¤§ | è€å¹´ä»£   |

**Q10: ä»€ä¹ˆæ—¶å€™ä¼šå‘ç”ŸFull GCï¼Ÿå¦‚ä½•é¿å…ï¼Ÿ**

**ç­”æ¡ˆï¼š**
**Full GCè§¦å‘æ¡ä»¶ï¼š**
1. è€å¹´ä»£ç©ºé—´ä¸è¶³
2. æ–¹æ³•åŒºç©ºé—´ä¸è¶³
3. é€šè¿‡Minor GCåè¿›å…¥è€å¹´ä»£çš„å¹³å‡å¤§å°å¤§äºè€å¹´ä»£çš„å¯ç”¨å†…å­˜
4. æ˜¾å¼è°ƒç”¨System.gc()

**é¿å…æ–¹æ³•ï¼š**
- åˆç†è®¾ç½®å †å¤§å°
- ä¼˜åŒ–å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ
- é¿å…åˆ›å»ºå¤§å¯¹è±¡
- åˆç†ä½¿ç”¨ç¼“å­˜
- é¿å…æ˜¾å¼è°ƒç”¨System.gc()

#### 3. ç±»åŠ è½½

**Q11: ç±»åŠ è½½è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ**

**ç­”æ¡ˆï¼š**
```mermaid
graph LR
    A[åŠ è½½] --> B[éªŒè¯]
    B --> C[å‡†å¤‡]
    C --> D[è§£æ]
    D --> E[åˆå§‹åŒ–]
```

1. **åŠ è½½**ï¼šè·å–ç±»çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œç”ŸæˆClasså¯¹è±¡
2. **éªŒè¯**ï¼šç¡®ä¿å­—èŠ‚ç å®‰å…¨æ€§
3. **å‡†å¤‡**ï¼šä¸ºé™æ€å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®é»˜è®¤å€¼
4. **è§£æ**ï¼šå°†ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨
5. **åˆå§‹åŒ–**ï¼šæ‰§è¡Œç±»æ„é€ å™¨ï¼Œä¸ºé™æ€å˜é‡èµ‹å€¼

**Q12: åŒäº²å§”æ´¾æ¨¡å‹æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦ä½¿ç”¨ï¼Ÿ**

**ç­”æ¡ˆï¼š**
**åŒäº²å§”æ´¾æ¨¡å‹**ï¼šå½“ä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°ç±»åŠ è½½è¯·æ±‚æ—¶ï¼Œé¦–å…ˆå§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨ï¼Œåªæœ‰çˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½æ—¶æ‰è‡ªå·±åŠ è½½ã€‚

**ä¼˜ç‚¹ï¼š**
1. **é¿å…ç±»çš„é‡å¤åŠ è½½**
2. **ä¿è¯Javaæ ¸å¿ƒAPIä¸è¢«ç¯¡æ”¹**
3. **æä¾›ç»Ÿä¸€çš„ç±»åŠ è½½æœºåˆ¶**

```java
protected Class<?> loadClass(String name, boolean resolve) {
    // é¦–å…ˆæ£€æŸ¥ç±»æ˜¯å¦å·²ç»åŠ è½½
    Class<?> c = findLoadedClass(name);
    if (c == null) {
        try {
            if (parent != null) {
                // å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨
                c = parent.loadClass(name, false);
            } else {
                // å§”æ´¾ç»™å¯åŠ¨ç±»åŠ è½½å™¨
                c = findBootstrapClassOrNull(name);
            }
        } catch (ClassNotFoundException e) {
            // çˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½
        }
        
        if (c == null) {
            // è‡ªå·±å°è¯•åŠ è½½
            c = findClass(name);
        }
    }
    return c;
}
```

### é›†åˆæ¡†æ¶é¢è¯•é¢˜

#### 1. Listé›†åˆ

**Q13: ArrayListå’ŒLinkedListçš„åŒºåˆ«ï¼Ÿ**

**ç­”æ¡ˆï¼š**

| ç‰¹æ€§             | ArrayList  | LinkedList       |
| ---------------- | ---------- | ---------------- |
| åº•å±‚ç»“æ„         | åŠ¨æ€æ•°ç»„   | åŒå‘é“¾è¡¨         |
| éšæœºè®¿é—®         | O(1)       | O(n)             |
| æ’å…¥åˆ é™¤ï¼ˆå¤´éƒ¨ï¼‰ | O(n)       | O(1)             |
| æ’å…¥åˆ é™¤ï¼ˆå°¾éƒ¨ï¼‰ | O(1)       | O(1)             |
| æ’å…¥åˆ é™¤ï¼ˆä¸­é—´ï¼‰ | O(n)       | O(1)             |
| å†…å­˜å ç”¨         | è¾ƒå°‘       | è¾ƒå¤šï¼ˆå­˜å‚¨æŒ‡é’ˆï¼‰ |
| é€‚ç”¨åœºæ™¯         | éšæœºè®¿é—®å¤š | æ’å…¥åˆ é™¤å¤š       |

**Q14: ArrayListçš„æ‰©å®¹æœºåˆ¶æ˜¯æ€æ ·çš„ï¼Ÿ**

**ç­”æ¡ˆï¼š**
1. **åˆå§‹å®¹é‡**ï¼šé»˜è®¤ä¸º10
2. **æ‰©å®¹æ—¶æœº**ï¼šå½“æ·»åŠ å…ƒç´ æ—¶å®¹é‡ä¸è¶³
3. **æ‰©å®¹å¤§å°**ï¼šæ–°å®¹é‡ = æ—§å®¹é‡ + æ—§å®¹é‡/2ï¼ˆå³1.5å€ï¼‰
4. **æœ€å¤§å®¹é‡**ï¼šInteger.MAX_VALUE - 8

```java
private void grow(int minCapacity) {
    int oldCapacity = elementData.length;
    int newCapacity = oldCapacity + (oldCapacity >> 1);  // 1.5å€æ‰©å®¹
    if (newCapacity - minCapacity < 0)
        newCapacity = minCapacity;
    if (newCapacity - MAX_ARRAY_SIZE > 0)
        newCapacity = hugeCapacity(minCapacity);
    elementData = Arrays.copyOf(elementData, newCapacity);
}
```

#### 2. Mapé›†åˆ

**Q15: HashMapçš„åº•å±‚å®ç°åŸç†ï¼Ÿ**

**ç­”æ¡ˆï¼š**
**JDK 1.8ä¹‹å‰**ï¼šæ•°ç»„ + é“¾è¡¨
**JDK 1.8ä¹‹å**ï¼šæ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘

**å·¥ä½œåŸç†ï¼š**
1. è®¡ç®—keyçš„hashCode
2. é€šè¿‡hashå‡½æ•°è®¡ç®—æ•°ç»„ç´¢å¼•
3. å¦‚æœæ²¡æœ‰å†²çªï¼Œç›´æ¥å­˜å‚¨
4. å¦‚æœæœ‰å†²çªï¼Œä½¿ç”¨é“¾è¡¨å­˜å‚¨
5. å½“é“¾è¡¨é•¿åº¦è¶…è¿‡8ä¸”æ•°ç»„é•¿åº¦è¶…è¿‡64æ—¶ï¼Œè½¬æ¢ä¸ºçº¢é»‘æ ‘

```java
// ç®€åŒ–çš„putæ–¹æ³•
public V put(K key, V value) {
    int hash = hash(key);
    int index = (n - 1) & hash;  // è®¡ç®—æ•°ç»„ç´¢å¼•
    
    Node<K,V> node = table[index];
    if (node == null) {
        // ç›´æ¥å­˜å‚¨
        table[index] = new Node<>(hash, key, value, null);
    } else {
        // å¤„ç†å†²çª
        // ... é“¾è¡¨æˆ–çº¢é»‘æ ‘æ“ä½œ
    }
    return value;
}
```

**Q16: HashMapä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨ï¼Ÿ**

**ç­”æ¡ˆï¼š**
1. **æ•°æ®è¦†ç›–**ï¼šå¤šçº¿ç¨‹åŒæ—¶putå¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±
2. **æ­»å¾ªç¯**ï¼šJDK 1.7ä¸­æ‰©å®¹æ—¶å¯èƒ½å½¢æˆç¯å½¢é“¾è¡¨
3. **æ•°æ®ä¸ä¸€è‡´**ï¼šgetå’Œputæ“ä½œæ²¡æœ‰åŒæ­¥

**è§£å†³æ–¹æ¡ˆï¼š**
- ä½¿ç”¨ConcurrentHashMap
- ä½¿ç”¨Collections.synchronizedMap()
- å¤–éƒ¨åŒæ­¥

**Q17: ConcurrentHashMapçš„å®ç°åŸç†ï¼Ÿ**

**ç­”æ¡ˆï¼š**
**JDK 1.7**ï¼šåˆ†æ®µé”ï¼ˆSegmentï¼‰
**JDK 1.8**ï¼šCAS + synchronized

**JDK 1.8å®ç°ï¼š**
1. **æ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘**ç»“æ„
2. **CASæ“ä½œ**ï¼šç”¨äºæ— é”çš„åŸå­æ“ä½œ
3. **synchronized**ï¼šé”å®šé“¾è¡¨æˆ–çº¢é»‘æ ‘çš„å¤´èŠ‚ç‚¹
4. **åˆ†æ®µæ€æƒ³**ï¼šåªé”å®šéœ€è¦ä¿®æ”¹çš„éƒ¨åˆ†

```java
final V putVal(K key, V value, boolean onlyIfAbsent) {
    int hash = spread(key.hashCode());
    for (Node<K,V>[] tab = table;;) {
        Node<K,V> f; int n, i, fh;
        if (tab == null || (n = tab.length) == 0)
            tab = initTable();
        else if ((f = tabAt(tab, i = (n - 1) & hash)) == null) {
            // CASæ“ä½œæ’å…¥æ–°èŠ‚ç‚¹
            if (casTabAt(tab, i, null, new Node<K,V>(hash, key, value, null)))
                break;
        } else {
            // synchronizedé”å®šå¤´èŠ‚ç‚¹
            synchronized (f) {
                // é“¾è¡¨æˆ–çº¢é»‘æ ‘æ“ä½œ
            }
        }
    }
}
```

### å¤šçº¿ç¨‹é¢è¯•é¢˜

#### 1. çº¿ç¨‹åŸºç¡€

**Q18: åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼æœ‰å“ªäº›ï¼Ÿ**

**ç­”æ¡ˆï¼š**
1. **ç»§æ‰¿Threadç±»**
```java
class MyThread extends Thread {
    public void run() {
        // çº¿ç¨‹æ‰§è¡Œé€»è¾‘
    }
}
```

2. **å®ç°Runnableæ¥å£**
```java
class MyRunnable implements Runnable {
    public void run() {
        // çº¿ç¨‹æ‰§è¡Œé€»è¾‘
    }
}
```

3. **å®ç°Callableæ¥å£**
```java
class MyCallable implements Callable<String> {
    public String call() throws Exception {
        return "ç»“æœ";
    }
}
```

4. **ä½¿ç”¨çº¿ç¨‹æ± **
```java
ExecutorService executor = Executors.newFixedThreadPool(5);
executor.submit(() -> {
    // çº¿ç¨‹æ‰§è¡Œé€»è¾‘
});
```

**Q19: çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸæ˜¯æ€æ ·çš„ï¼Ÿ**

**ç­”æ¡ˆï¼š**
```mermaid
graph TD
    A[NEW] --> B[RUNNABLE]
    B --> C[BLOCKED]
    B --> D[WAITING]
    B --> E[TIMED_WAITING]
    B --> F[TERMINATED]
    
    C --> B
    D --> B
    E --> B
```

- **NEW**ï¼šçº¿ç¨‹åˆ›å»ºä½†æœªå¯åŠ¨
- **RUNNABLE**ï¼šçº¿ç¨‹æ­£åœ¨è¿è¡Œæˆ–ç­‰å¾…CPUè°ƒåº¦
- **BLOCKED**ï¼šçº¿ç¨‹è¢«é˜»å¡ç­‰å¾…ç›‘è§†å™¨é”
- **WAITING**ï¼šçº¿ç¨‹æ— é™æœŸç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œç‰¹å®šæ“ä½œ
- **TIMED_WAITING**ï¼šçº¿ç¨‹ç­‰å¾…æŒ‡å®šæ—¶é—´
- **TERMINATED**ï¼šçº¿ç¨‹æ‰§è¡Œå®Œæ¯•

#### 2. çº¿ç¨‹åŒæ­¥

**Q20: synchronizedå’ŒReentrantLockçš„åŒºåˆ«ï¼Ÿ**

**ç­”æ¡ˆï¼š**

| ç‰¹æ€§     | synchronized | ReentrantLock   |
| -------- | ------------ | --------------- |
| å®ç°æ–¹å¼ | JVMå†…ç½®      | JDKå®ç°         |
| æ€§èƒ½     | ä¼˜åŒ–åæ€§èƒ½å¥½ | æ€§èƒ½å¥½          |
| åŠŸèƒ½     | åŸºç¡€åŠŸèƒ½     | åŠŸèƒ½ä¸°å¯Œ        |
| å¯ä¸­æ–­   | ä¸å¯ä¸­æ–­     | å¯ä¸­æ–­          |
| å…¬å¹³é”   | éå…¬å¹³       | å¯é€‰å…¬å¹³/éå…¬å¹³ |
| æ¡ä»¶å˜é‡ | å•ä¸€æ¡ä»¶     | å¤šä¸ªæ¡ä»¶        |
| é‡Šæ”¾æ–¹å¼ | è‡ªåŠ¨é‡Šæ”¾     | æ‰‹åŠ¨é‡Šæ”¾        |

**Q21: volatileå…³é”®å­—çš„ä½œç”¨ï¼Ÿ**

**ç­”æ¡ˆï¼š**
1. **ä¿è¯å¯è§æ€§**ï¼šä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹å˜é‡åï¼Œå…¶ä»–çº¿ç¨‹èƒ½ç«‹å³çœ‹åˆ°
2. **ç¦æ­¢æŒ‡ä»¤é‡æ’åº**ï¼šä¿è¯ä»£ç æ‰§è¡Œé¡ºåº
3. **ä¸ä¿è¯åŸå­æ€§**ï¼šä¸èƒ½æ›¿ä»£synchronized

```java
public class VolatileExample {
    private volatile boolean flag = false;
    
    public void writer() {
        flag = true;  // å†™æ“ä½œå¯¹å…¶ä»–çº¿ç¨‹ç«‹å³å¯è§
    }
    
    public void reader() {
        if (flag) {   // èƒ½ç«‹å³çœ‹åˆ°flagçš„å˜åŒ–
            // æ‰§è¡Œé€»è¾‘
        }
    }
}
```

**ä½¿ç”¨åœºæ™¯ï¼š**
- çŠ¶æ€æ ‡è®°é‡
- åŒé‡æ£€æŸ¥é”å®š
- å•ä¾‹æ¨¡å¼

#### 3. çº¿ç¨‹æ± 

**Q22: çº¿ç¨‹æ± çš„æ ¸å¿ƒå‚æ•°æœ‰å“ªäº›ï¼Ÿ**

**ç­”æ¡ˆï¼š**
```java
public ThreadPoolExecutor(
    int corePoolSize,           // æ ¸å¿ƒçº¿ç¨‹æ•°
    int maximumPoolSize,        // æœ€å¤§çº¿ç¨‹æ•°
    long keepAliveTime,         // ç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´
    TimeUnit unit,              // æ—¶é—´å•ä½
    BlockingQueue<Runnable> workQueue,  // å·¥ä½œé˜Ÿåˆ—
    ThreadFactory threadFactory,         // çº¿ç¨‹å·¥å‚
    RejectedExecutionHandler handler     // æ‹’ç»ç­–ç•¥
)
```

**æ‰§è¡Œæµç¨‹ï¼š**
1. å¦‚æœè¿è¡Œçº¿ç¨‹å°‘äºcorePoolSizeï¼Œåˆ›å»ºæ–°çº¿ç¨‹
2. å¦‚æœè¿è¡Œçº¿ç¨‹ç­‰äºæˆ–å¤šäºcorePoolSizeï¼Œå°†ä»»åŠ¡åŠ å…¥é˜Ÿåˆ—
3. å¦‚æœé˜Ÿåˆ—å·²æ»¡ä¸”è¿è¡Œçº¿ç¨‹å°‘äºmaximumPoolSizeï¼Œåˆ›å»ºæ–°çº¿ç¨‹
4. å¦‚æœé˜Ÿåˆ—å·²æ»¡ä¸”è¿è¡Œçº¿ç¨‹ç­‰äºmaximumPoolSizeï¼Œæ‰§è¡Œæ‹’ç»ç­–ç•¥

**Q23: å¸¸è§çš„æ‹’ç»ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ**

**ç­”æ¡ˆï¼š**
1. **AbortPolicy**ï¼šæŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸ï¼ˆé»˜è®¤ï¼‰
2. **CallerRunsPolicy**ï¼šç”±è°ƒç”¨çº¿ç¨‹æ‰§è¡Œä»»åŠ¡
3. **DiscardPolicy**ï¼šé™é»˜ä¸¢å¼ƒä»»åŠ¡
4. **DiscardOldestPolicy**ï¼šä¸¢å¼ƒé˜Ÿåˆ—ä¸­æœ€è€çš„ä»»åŠ¡

```java
// è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥
public class CustomRejectedExecutionHandler implements RejectedExecutionHandler {
    @Override
    public void rejectedExecution(Runnable r, ThreadPoolExecutor executor) {
        // è®°å½•æ—¥å¿—
        System.err.println("ä»»åŠ¡è¢«æ‹’ç»ï¼š" + r.toString());
        // å¯ä»¥é€‰æ‹©é‡æ–°æäº¤åˆ°å…¶ä»–çº¿ç¨‹æ± 
    }
}
```

### è®¾è®¡æ¨¡å¼é¢è¯•é¢˜

#### 1. å•ä¾‹æ¨¡å¼

**Q24: å•ä¾‹æ¨¡å¼æœ‰å“ªäº›å®ç°æ–¹å¼ï¼Ÿå„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ**

**ç­”æ¡ˆï¼š**

**1. é¥¿æ±‰å¼**
```java
public class EagerSingleton {
    private static final EagerSingleton INSTANCE = new EagerSingleton();
    private EagerSingleton() {}
    public static EagerSingleton getInstance() {
        return INSTANCE;
    }
}
```
- ä¼˜ç‚¹ï¼šçº¿ç¨‹å®‰å…¨ï¼Œå®ç°ç®€å•
- ç¼ºç‚¹ï¼šå¯èƒ½é€ æˆå†…å­˜æµªè´¹

**2. æ‡’æ±‰å¼ï¼ˆåŒé‡æ£€æŸ¥é”ï¼‰**
```java
public class LazyDoubleCheckSingleton {
    private static volatile LazyDoubleCheckSingleton instance;
    private LazyDoubleCheckSingleton() {}
    
    public static LazyDoubleCheckSingleton getInstance() {
        if (instance == null) {
            synchronized (LazyDoubleCheckSingleton.class) {
                if (instance == null) {
                    instance = new LazyDoubleCheckSingleton();
                }
            }
        }
        return instance;
    }
}
```
- ä¼˜ç‚¹ï¼šå»¶è¿ŸåŠ è½½ï¼Œçº¿ç¨‹å®‰å…¨
- ç¼ºç‚¹ï¼šä»£ç å¤æ‚

**3. é™æ€å†…éƒ¨ç±»**
```java
public class StaticInnerSingleton {
    private StaticInnerSingleton() {}
    
    private static class SingletonHolder {
        private static final StaticInnerSingleton INSTANCE = new StaticInnerSingleton();
    }
    
    public static StaticInnerSingleton getInstance() {
        return SingletonHolder.INSTANCE;
    }
}
```
- ä¼˜ç‚¹ï¼šå»¶è¿ŸåŠ è½½ï¼Œçº¿ç¨‹å®‰å…¨ï¼Œæ€§èƒ½å¥½
- ç¼ºç‚¹ï¼šæ— 

**4. æšä¸¾å®ç°**
```java
public enum EnumSingleton {
    INSTANCE;
    
    public void doSomething() {
        // ä¸šåŠ¡é€»è¾‘
    }
}
```
- ä¼˜ç‚¹ï¼šçº¿ç¨‹å®‰å…¨ï¼Œé˜²æ­¢åå°„æ”»å‡»ï¼Œé˜²æ­¢åºåˆ—åŒ–ç ´å
- ç¼ºç‚¹ï¼šä¸å¤Ÿçµæ´»

#### 2. å·¥å‚æ¨¡å¼

**Q25: ç®€å•å·¥å‚ã€å·¥å‚æ–¹æ³•ã€æŠ½è±¡å·¥å‚çš„åŒºåˆ«ï¼Ÿ**

**ç­”æ¡ˆï¼š**

**ç®€å•å·¥å‚**ï¼šä¸€ä¸ªå·¥å‚ç±»åˆ›å»ºæ‰€æœ‰äº§å“
```java
public class SimpleFactory {
    public static Product createProduct(String type) {
        switch (type) {
            case "A": return new ProductA();
            case "B": return new ProductB();
            default: throw new IllegalArgumentException();
        }
    }
}
```

**å·¥å‚æ–¹æ³•**ï¼šæ¯ä¸ªäº§å“æœ‰å¯¹åº”çš„å·¥å‚
```java
public abstract class Factory {
    public abstract Product createProduct();
}

public class FactoryA extends Factory {
    public Product createProduct() {
        return new ProductA();
    }
}
```

**æŠ½è±¡å·¥å‚**ï¼šåˆ›å»ºä¸€ç³»åˆ—ç›¸å…³äº§å“
```java
public interface AbstractFactory {
    ProductA createProductA();
    ProductB createProductB();
}

public class ConcreteFactory1 implements AbstractFactory {
    public ProductA createProductA() { return new ProductA1(); }
    public ProductB createProductB() { return new ProductB1(); }
}
```

### æ€§èƒ½ä¼˜åŒ–é¢è¯•é¢˜

**Q26: Javaç¨‹åºæ€§èƒ½ä¼˜åŒ–æœ‰å“ªäº›æ–¹æ³•ï¼Ÿ**

**ç­”æ¡ˆï¼š**

**1. JVMå±‚é¢ä¼˜åŒ–**
- åˆç†è®¾ç½®å †å†…å­˜å¤§å°
- é€‰æ‹©åˆé€‚çš„åƒåœ¾æ”¶é›†å™¨
- è°ƒæ•´GCå‚æ•°
- ä½¿ç”¨JITç¼–è¯‘ä¼˜åŒ–

**2. ä»£ç å±‚é¢ä¼˜åŒ–**
- é¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡
- ä½¿ç”¨StringBuilderä»£æ›¿Stringæ‹¼æ¥
- åˆç†ä½¿ç”¨é›†åˆç±»å‹
- é¿å…æ·±å±‚åµŒå¥—å¾ªç¯

**3. å¹¶å‘ä¼˜åŒ–**
- ä½¿ç”¨çº¿ç¨‹æ± 
- å‡å°‘é”çš„ç²’åº¦
- ä½¿ç”¨æ— é”æ•°æ®ç»“æ„
- åˆç†ä½¿ç”¨å¹¶å‘é›†åˆ

**4. å†…å­˜ä¼˜åŒ–**
- åŠæ—¶é‡Šæ”¾èµ„æº
- ä½¿ç”¨å¯¹è±¡æ± 
- é¿å…å†…å­˜æ³„æ¼
- åˆç†ä½¿ç”¨ç¼“å­˜

**Q27: å¦‚ä½•æ’æŸ¥Javaç¨‹åºçš„æ€§èƒ½é—®é¢˜ï¼Ÿ**

**ç­”æ¡ˆï¼š**

**1. æ€§èƒ½ç›‘æ§å·¥å…·**
- **jstat**ï¼šç›‘æ§GCæƒ…å†µ
- **jmap**ï¼šåˆ†æå†…å­˜ä½¿ç”¨
- **jstack**ï¼šåˆ†æçº¿ç¨‹çŠ¶æ€
- **jvisualvm**ï¼šå¯è§†åŒ–ç›‘æ§

**2. åˆ†ææ­¥éª¤**
1. ç¡®å®šæ€§èƒ½ç“¶é¢ˆï¼ˆCPUã€å†…å­˜ã€IOï¼‰
2. ä½¿ç”¨profilerå·¥å…·åˆ†æçƒ­ç‚¹ä»£ç 
3. åˆ†æGCæ—¥å¿—
4. æ£€æŸ¥çº¿ç¨‹çŠ¶æ€
5. åˆ†æå†…å­˜ä½¿ç”¨æƒ…å†µ

**3. å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ**
- **CPUä½¿ç”¨ç‡é«˜**ï¼šä¼˜åŒ–ç®—æ³•ï¼Œå‡å°‘è®¡ç®—å¤æ‚åº¦
- **å†…å­˜ä½¿ç”¨ç‡é«˜**ï¼šæ£€æŸ¥å†…å­˜æ³„æ¼ï¼Œä¼˜åŒ–æ•°æ®ç»“æ„
- **GCé¢‘ç¹**ï¼šè°ƒæ•´å †å¤§å°ï¼Œä¼˜åŒ–å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ
- **çº¿ç¨‹é˜»å¡**ï¼šå‡å°‘é”ç«äº‰ï¼Œä¼˜åŒ–åŒæ­¥ç­–ç•¥

### é«˜çº§ç‰¹æ€§é¢è¯•é¢˜

#### 1. åå°„ä¸æ³¨è§£

**Q26: ä»€ä¹ˆæ˜¯Javaåå°„ï¼Ÿæœ‰ä»€ä¹ˆåº”ç”¨åœºæ™¯ï¼Ÿ**

**ç­”æ¡ˆï¼š**
**åå°„**æ˜¯Javaåœ¨è¿è¡Œæ—¶æ£€æŸ¥å’Œæ“ä½œç±»ã€æ–¹æ³•ã€å­—æ®µçš„èƒ½åŠ›ã€‚

**æ ¸å¿ƒAPIï¼š**
- `Class.forName()` - è·å–ç±»å¯¹è±¡
- `getMethod()` - è·å–æ–¹æ³•
- `getField()` - è·å–å­—æ®µ
- `newInstance()` - åˆ›å»ºå®ä¾‹

```java
// åå°„ç¤ºä¾‹
public class ReflectionExample {
    public void reflectionDemo() throws Exception {
        // 1. è·å–Classå¯¹è±¡
        Class<?> clazz = Class.forName("com.example.User");
        
        // 2. åˆ›å»ºå®ä¾‹
        Object instance = clazz.getDeclaredConstructor().newInstance();
        
        // 3. è·å–å¹¶è°ƒç”¨æ–¹æ³•
        Method setName = clazz.getMethod("setName", String.class);
        setName.invoke(instance, "å¼ ä¸‰");
        
        // 4. è·å–å¹¶è®¾ç½®å­—æ®µ
        Field nameField = clazz.getDeclaredField("name");
        nameField.setAccessible(true);
        nameField.set(instance, "æå››");
    }
}
```

**åº”ç”¨åœºæ™¯ï¼š**
- **æ¡†æ¶å¼€å‘**ï¼šSpring IoCå®¹å™¨ã€MyBatis ORMæ˜ å°„
- **æ³¨è§£å¤„ç†**ï¼šè¿è¡Œæ—¶è§£æè‡ªå®šä¹‰æ³¨è§£
- **åºåˆ—åŒ–**ï¼šJSON/XMLåºåˆ—åŒ–æ¡†æ¶
- **åŠ¨æ€ä»£ç†**ï¼šAOPåˆ‡é¢ç¼–ç¨‹

**Q27: è‡ªå®šä¹‰æ³¨è§£å¦‚ä½•å®ç°ï¼Ÿ**

**ç­”æ¡ˆï¼š**
```java
// 1. å®šä¹‰æ³¨è§£
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
@Documented
public @interface LogExecution {
    String value() default "";
    boolean enable() default true;
}

// 2. ä½¿ç”¨æ³¨è§£
public class UserService {
    @LogExecution(value = "ç”¨æˆ·æŸ¥è¯¢", enable = true)
    public User findUser(Long id) {
        return userDao.findById(id);
    }
}

// 3. æ³¨è§£å¤„ç†å™¨
@Component
@Aspect
public class LogAspect {
    @Around("@annotation(logExecution)")
    public Object logExecutionTime(ProceedingJoinPoint joinPoint, 
                                  LogExecution logExecution) throws Throwable {
        if (!logExecution.enable()) {
            return joinPoint.proceed();
        }
        
        long startTime = System.currentTimeMillis();
        try {
            Object result = joinPoint.proceed();
            long endTime = System.currentTimeMillis();
            
            System.out.println(logExecution.value() + 
                " æ‰§è¡Œæ—¶é—´: " + (endTime - startTime) + "ms");
            return result;
        } catch (Exception e) {
            System.err.println(logExecution.value() + " æ‰§è¡Œå¼‚å¸¸: " + e.getMessage());
            throw e;
        }
    }
}
```

#### 2. å‡½æ•°å¼ç¼–ç¨‹

**Q28: Stream APIçš„å¸¸ç”¨æ“ä½œæœ‰å“ªäº›ï¼Ÿ**

**ç­”æ¡ˆï¼š**
```java
public class StreamExample {
    public void streamOperations() {
        List<Integer> numbers = Arrays.asList(1, 2, 3, 4, 5, 6, 7, 8, 9, 10);
        
        // 1. è¿‡æ»¤å’Œæ˜ å°„
        List<String> evenSquares = numbers.stream()
            .filter(n -> n % 2 == 0)        // è¿‡æ»¤å¶æ•°
            .map(n -> n * n)                // å¹³æ–¹
            .map(String::valueOf)           // è½¬å­—ç¬¦ä¸²
            .collect(Collectors.toList());   // æ”¶é›†ç»“æœ
        
        // 2. èšåˆæ“ä½œ
        OptionalInt max = numbers.stream().mapToInt(Integer::intValue).max();
        int sum = numbers.stream().mapToInt(Integer::intValue).sum();
        double average = numbers.stream().mapToInt(Integer::intValue).average().orElse(0);
        
        // 3. åˆ†ç»„å’Œåˆ†åŒº
        List<Person> persons = getPersons();
        Map<Integer, List<Person>> byAge = persons.stream()
            .collect(Collectors.groupingBy(Person::getAge));
        
        Map<Boolean, List<Person>> byAdult = persons.stream()
            .collect(Collectors.partitioningBy(p -> p.getAge() >= 18));
        
        // 4. å¹¶è¡Œæµ
        long count = numbers.parallelStream()
            .filter(n -> isPrime(n))
            .count();
    }
}
```

**Q29: Lambdaè¡¨è¾¾å¼çš„ä¼˜ç¼ºç‚¹ï¼Ÿ**

**ç­”æ¡ˆï¼š**
**ä¼˜ç‚¹ï¼š**
- **ç®€æ´æ€§**ï¼šå‡å°‘å†—ä½™ä»£ç 
- **å¯è¯»æ€§**ï¼šå‡½æ•°å¼ç¼–ç¨‹æ›´ç›´è§‚
- **å¹¶è¡Œå¤„ç†**ï¼šæ˜“äºå¹¶è¡Œæµæ“ä½œ

**ç¼ºç‚¹ï¼š**
- **è°ƒè¯•å›°éš¾**ï¼šå †æ ˆä¿¡æ¯ä¸æ¸…æ™°
- **æ€§èƒ½å¼€é”€**ï¼šå¯èƒ½äº§ç”Ÿé¢å¤–å¯¹è±¡
- **å­¦ä¹ æˆæœ¬**ï¼šéœ€è¦ç†è§£å‡½æ•°å¼ç¼–ç¨‹æ¦‚å¿µ

#### 3. I/Oä¸NIO

**Q30: BIOã€NIOã€AIOçš„åŒºåˆ«ï¼Ÿ**

**ç­”æ¡ˆï¼š**

| ç‰¹æ€§         | BIO              | NIO                 | AIO              |
| ------------ | ---------------- | ------------------- | ---------------- |
| **æ¨¡å‹**     | åŒæ­¥é˜»å¡         | åŒæ­¥éé˜»å¡          | å¼‚æ­¥éé˜»å¡       |
| **çº¿ç¨‹æ¨¡å‹** | ä¸€ä¸ªè¿æ¥ä¸€ä¸ªçº¿ç¨‹ | ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªè¿æ¥ | äº‹ä»¶é©±åŠ¨         |
| **é€‚ç”¨åœºæ™¯** | è¿æ¥æ•°å°‘ï¼Œè¯·æ±‚ç®€å• | è¿æ¥æ•°å¤šï¼Œè¯·æ±‚ç®€å•   | è¿æ¥æ•°å¤šï¼Œè¯·æ±‚å¤æ‚ |
| **JDKç‰ˆæœ¬**  | JDK 1.0          | JDK 1.4             | JDK 1.7          |

```java
// NIOç¤ºä¾‹
public class NIOServer {
    public void startServer() throws IOException {
        Selector selector = Selector.open();
        ServerSocketChannel serverChannel = ServerSocketChannel.open();
        
        serverChannel.configureBlocking(false);
        serverChannel.bind(new InetSocketAddress(8080));
        serverChannel.register(selector, SelectionKey.OP_ACCEPT);
        
        while (true) {
            selector.select();
            Set<SelectionKey> keys = selector.selectedKeys();
            
            for (SelectionKey key : keys) {
                if (key.isAcceptable()) {
                    handleAccept(key);
                } else if (key.isReadable()) {
                    handleRead(key);
                }
            }
            keys.clear();
        }
    }
}
```

### æ¡†æ¶ä¸ä¸­é—´ä»¶é¢è¯•é¢˜

#### 1. Springæ¡†æ¶

**Q31: Spring IoCçš„å®ç°åŸç†ï¼Ÿ**

**ç­”æ¡ˆï¼š**
**IoCï¼ˆæ§åˆ¶åè½¬ï¼‰**é€šè¿‡ä¾èµ–æ³¨å…¥å®ç°å¯¹è±¡é—´çš„è§£è€¦ã€‚

**æ ¸å¿ƒç»„ä»¶ï¼š**
- **BeanFactory**ï¼šBeanå®¹å™¨çš„åŸºæœ¬æ¥å£
- **ApplicationContext**ï¼šåº”ç”¨ä¸Šä¸‹æ–‡ï¼Œæ‰©å±•äº†BeanFactory
- **BeanDefinition**ï¼šBeançš„å®šä¹‰ä¿¡æ¯
- **BeanPostProcessor**ï¼šBeanåç½®å¤„ç†å™¨

```java
// ç®€åŒ–ç‰ˆIoCå®¹å™¨å®ç°
public class SimpleIOCContainer {
    private Map<String, Object> beanMap = new ConcurrentHashMap<>();
    private Map<String, BeanDefinition> beanDefinitionMap = new HashMap<>();
    
    // æ³¨å†ŒBeanå®šä¹‰
    public void registerBeanDefinition(String name, BeanDefinition bd) {
        beanDefinitionMap.put(name, bd);
    }
    
    // è·å–Bean
    public Object getBean(String name) {
        Object bean = beanMap.get(name);
        if (bean != null) {
            return bean;
        }
        
        // åˆ›å»ºBean
        BeanDefinition bd = beanDefinitionMap.get(name);
        if (bd != null) {
            bean = createBean(bd);
            beanMap.put(name, bean);
        }
        
        return bean;
    }
    
    private Object createBean(BeanDefinition bd) {
        try {
            Class<?> clazz = Class.forName(bd.getClassName());
            Object bean = clazz.getDeclaredConstructor().newInstance();
            
            // ä¾èµ–æ³¨å…¥
            injectDependencies(bean, bd);
            
            return bean;
        } catch (Exception e) {
            throw new RuntimeException("åˆ›å»ºBeanå¤±è´¥", e);
        }
    }
}
```

**Q32: Spring AOPçš„å®ç°åŸç†ï¼Ÿ**

**ç­”æ¡ˆï¼š**
**AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰**é€šè¿‡åŠ¨æ€ä»£ç†å®ç°æ¨ªåˆ‡å…³æ³¨ç‚¹çš„åˆ†ç¦»ã€‚

**å®ç°æ–¹å¼ï¼š**
1. **JDKåŠ¨æ€ä»£ç†**ï¼šåŸºäºæ¥å£
2. **CGLIBä»£ç†**ï¼šåŸºäºç»§æ‰¿

```java
// JDKåŠ¨æ€ä»£ç†ç¤ºä¾‹
public class JDKProxyExample {
    public static Object createProxy(Object target) {
        return Proxy.newProxyInstance(
            target.getClass().getClassLoader(),
            target.getClass().getInterfaces(),
            (proxy, method, args) -> {
                System.out.println("æ–¹æ³•æ‰§è¡Œå‰: " + method.getName());
                Object result = method.invoke(target, args);
                System.out.println("æ–¹æ³•æ‰§è¡Œå: " + method.getName());
                return result;
            }
        );
    }
}
```

#### 2. MyBatis

**Q33: MyBatisçš„ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜ï¼Ÿ**

**ç­”æ¡ˆï¼š**
- **ä¸€çº§ç¼“å­˜**ï¼šSqlSessionçº§åˆ«ï¼Œé»˜è®¤å¼€å¯
- **äºŒçº§ç¼“å­˜**ï¼šMapperçº§åˆ«ï¼Œéœ€è¦é…ç½®å¼€å¯

```xml
<!-- å¼€å¯äºŒçº§ç¼“å­˜ -->
<cache type="org.apache.ibatis.cache.impl.PerpetualCache"
       size="1024"
       eviction="LRU"
       flushInterval="120000"
       readOnly="false"/>
```

#### 3. Redis

**Q34: Redisçš„æ•°æ®ç»“æ„å’Œåº”ç”¨åœºæ™¯ï¼Ÿ**

**ç­”æ¡ˆï¼š**

| æ•°æ®ç±»å‹     | åº•å±‚å®ç°      | åº”ç”¨åœºæ™¯                 |
| ------------ | ------------- | ------------------------ |
| **String**   | SDS           | ç¼“å­˜ã€è®¡æ•°å™¨ã€åˆ†å¸ƒå¼é”   |
| **List**     | åŒå‘é“¾è¡¨/å‹ç¼©åˆ—è¡¨ | é˜Ÿåˆ—ã€æ ˆã€æ—¶é—´çº¿         |
| **Set**      | å“ˆå¸Œè¡¨/æ•´æ•°é›†åˆ | æ ‡ç­¾ã€å¥½å‹å…³ç³»ã€å»é‡     |
| **ZSet**     | è·³è·ƒè¡¨+å“ˆå¸Œè¡¨ | æ’è¡Œæ¦œã€å»¶æ—¶é˜Ÿåˆ—         |
| **Hash**     | å“ˆå¸Œè¡¨/å‹ç¼©åˆ—è¡¨ | å¯¹è±¡å­˜å‚¨ã€è´­ç‰©è½¦         |

#### 4. æ¶ˆæ¯é˜Ÿåˆ—

**Q35: RabbitMQã€Kafkaã€RocketMQçš„å¯¹æ¯”ï¼Ÿ**

**ç­”æ¡ˆï¼š**

| ç‰¹æ€§         | RabbitMQ         | Kafka            | RocketMQ         |
| ------------ | ---------------- | ---------------- | ---------------- |
| **æ¨¡å‹**     | AMQPåè®®         | å‘å¸ƒè®¢é˜…         | å‘å¸ƒè®¢é˜…         |
| **ååé‡**   | ä¸‡çº§             | ç™¾ä¸‡çº§           | åä¸‡çº§           |
| **å¯é æ€§**   | é«˜               | é«˜               | éå¸¸é«˜           |
| **é¡ºåºæ€§**   | æ”¯æŒ             | æ”¯æŒåˆ†åŒºé¡ºåº     | æ”¯æŒå…¨å±€é¡ºåº     |
| **å»¶æ—¶**     | å¾®ç§’çº§           | æ¯«ç§’çº§           | æ¯«ç§’çº§           |
| **ä½¿ç”¨åœºæ™¯** | ä¼ ç»Ÿä¼ä¸šåº”ç”¨     | å¤§æ•°æ®å®æ—¶å¤„ç†   | é‡‘èçº§åº”ç”¨       |

### åˆ†å¸ƒå¼ç³»ç»Ÿé¢è¯•é¢˜

#### 1. åˆ†å¸ƒå¼ç†è®º

**Q36: CAPç†è®ºå’ŒBASEç†è®ºæ˜¯ä»€ä¹ˆï¼Ÿ**

**ç­”æ¡ˆï¼š**
**CAPç†è®ºï¼š**
- **Cï¼ˆConsistencyï¼‰**ï¼šä¸€è‡´æ€§
- **Aï¼ˆAvailabilityï¼‰**ï¼šå¯ç”¨æ€§  
- **Pï¼ˆPartition toleranceï¼‰**ï¼šåˆ†åŒºå®¹é”™æ€§

**æ— æ³•åŒæ—¶æ»¡è¶³ä¸‰ä¸ªç‰¹æ€§ï¼Œåªèƒ½é€‰æ‹©å…¶ä¸­ä¸¤ä¸ªã€‚**

**BASEç†è®ºï¼š**
- **BAï¼ˆBasically Availableï¼‰**ï¼šåŸºæœ¬å¯ç”¨
- **Sï¼ˆSoft stateï¼‰**ï¼šè½¯çŠ¶æ€
- **Eï¼ˆEventually consistentï¼‰**ï¼šæœ€ç»ˆä¸€è‡´æ€§

#### 2. å¾®æœåŠ¡æ¶æ„

**Q37: å¾®æœåŠ¡çš„ä¼˜ç¼ºç‚¹ï¼Ÿ**

**ç­”æ¡ˆï¼š**
**ä¼˜ç‚¹ï¼š**
- **ç‹¬ç«‹éƒ¨ç½²**ï¼šæœåŠ¡é—´è§£è€¦ï¼Œç‹¬ç«‹å‘å¸ƒ
- **æŠ€æœ¯å¤šæ ·æ€§**ï¼šå¯ä»¥ä½¿ç”¨ä¸åŒæŠ€æœ¯æ ˆ
- **å®¹é”™æ€§**ï¼šå•ä¸ªæœåŠ¡æ•…éšœä¸å½±å“æ•´ä½“
- **æ‰©å±•æ€§**ï¼šå¯ä»¥é’ˆå¯¹æ€§æ‰©å±•é«˜è´Ÿè½½æœåŠ¡

**ç¼ºç‚¹ï¼š**
- **å¤æ‚æ€§**ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿå¤æ‚åº¦å¢åŠ 
- **ç½‘ç»œå»¶è¿Ÿ**ï¼šæœåŠ¡é—´è°ƒç”¨å­˜åœ¨ç½‘ç»œå¼€é”€
- **æ•°æ®ä¸€è‡´æ€§**ï¼šåˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†å¤æ‚
- **è¿ç»´æˆæœ¬**ï¼šéœ€è¦ä¸“ä¸šçš„DevOpså›¢é˜Ÿ

#### 3. åˆ†å¸ƒå¼äº‹åŠ¡

**Q38: åˆ†å¸ƒå¼äº‹åŠ¡çš„è§£å†³æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ**

**ç­”æ¡ˆï¼š**

**ä¸»è¦è§£å†³æ–¹æ¡ˆï¼š**
1. **ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰**ï¼šå¼ºä¸€è‡´æ€§ï¼Œæ€§èƒ½è¾ƒå·®
2. **TCCï¼ˆTry-Confirm-Cancelï¼‰**ï¼šä¸šåŠ¡ä¾µå…¥æ€§å¼ºï¼Œä¸€è‡´æ€§å¥½
3. **Sagaæ¨¡å¼**ï¼šé•¿äº‹åŠ¡å¤„ç†ï¼Œæœ€ç»ˆä¸€è‡´æ€§
4. **æœ¬åœ°æ¶ˆæ¯è¡¨**ï¼šåŸºäºæ¶ˆæ¯çš„æœ€ç»ˆä¸€è‡´æ€§

### é¡¹ç›®å®æˆ˜é¢è¯•é¢˜

#### 1. ç³»ç»Ÿè®¾è®¡

**Q39: å¦‚ä½•è®¾è®¡ä¸€ä¸ªç§’æ€ç³»ç»Ÿï¼Ÿ**

**ç­”æ¡ˆï¼š**
**æ ¸å¿ƒè¦ç‚¹ï¼š**
1. **å‰ç«¯ä¼˜åŒ–**ï¼šCDNã€é™æ€åŒ–ã€æŒ‰é’®æ§åˆ¶
2. **æ¥å…¥å±‚**ï¼šè´Ÿè½½å‡è¡¡ã€é™æµ
3. **æœåŠ¡å±‚**ï¼šç¼“å­˜ã€å¼‚æ­¥å¤„ç†
4. **æ•°æ®å±‚**ï¼šè¯»å†™åˆ†ç¦»ã€åˆ†åº“åˆ†è¡¨

**å…³é”®æŠ€æœ¯ï¼š**
- **Redisé¢„å‡åº“å­˜**ï¼šé¿å…æ•°æ®åº“å‹åŠ›
- **æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥**ï¼šå‰Šå³°å¡«è°·
- **åˆ†å¸ƒå¼é”**ï¼šé˜²æ­¢è¶…å–
- **é™æµç®—æ³•**ï¼šä»¤ç‰Œæ¡¶ã€æ»‘åŠ¨çª—å£

#### 2. æ€§èƒ½ä¼˜åŒ–

**Q40: å¦‚ä½•è¿›è¡ŒJVMæ€§èƒ½è°ƒä¼˜ï¼Ÿ**

**ç­”æ¡ˆï¼š**
**è°ƒä¼˜æ­¥éª¤ï¼š**
1. **ç›‘æ§åˆ†æ**ï¼šä½¿ç”¨JProfilerã€VisualVMç­‰å·¥å…·
2. **å‚æ•°è°ƒä¼˜**ï¼šå †å¤§å°ã€GCç­–ç•¥
3. **ä»£ç ä¼˜åŒ–**ï¼šå‡å°‘å¯¹è±¡åˆ›å»ºã€ä¼˜åŒ–ç®—æ³•
4. **æ¶æ„ä¼˜åŒ–**ï¼šç¼“å­˜ã€å¼‚æ­¥ã€åˆ†å¸ƒå¼

```bash
# JVMè°ƒä¼˜å‚æ•°ç¤ºä¾‹
-Xms4g -Xmx4g                    # å †å†…å­˜
-XX:NewRatio=3                   # æ–°ç”Ÿä»£è€å¹´ä»£æ¯”ä¾‹
-XX:+UseG1GC                     # ä½¿ç”¨G1æ”¶é›†å™¨
-XX:MaxGCPauseMillis=200         # æœ€å¤§GCæš‚åœæ—¶é—´
-XX:+PrintGCDetails              # æ‰“å°GCè¯¦æƒ…
-XX:+HeapDumpOnOutOfMemoryError  # OOMæ—¶ç”Ÿæˆå †è½¬å‚¨
```

#### 3. æ•…éšœæ’æŸ¥

**Q41: çº¿ä¸Šç³»ç»Ÿçªç„¶å“åº”ç¼“æ…¢ï¼Œå¦‚ä½•æ’æŸ¥ï¼Ÿ**

**ç­”æ¡ˆï¼š**
**æ’æŸ¥æ­¥éª¤ï¼š**
1. **ç³»ç»Ÿèµ„æº**ï¼šCPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œ
2. **åº”ç”¨æŒ‡æ ‡**ï¼šQPSã€å“åº”æ—¶é—´ã€é”™è¯¯ç‡
3. **ä¸­é—´ä»¶**ï¼šæ•°æ®åº“ã€ç¼“å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—
4. **åº”ç”¨æ—¥å¿—**ï¼šé”™è¯¯æ—¥å¿—ã€ä¸šåŠ¡æ—¥å¿—

```bash
# å¿«é€Ÿæ’æŸ¥å‘½ä»¤
top                              # æŸ¥çœ‹CPUå’Œå†…å­˜
iostat -x 1                      # æŸ¥çœ‹ç£ç›˜IO
netstat -an | grep ESTABLISHED   # æŸ¥çœ‹ç½‘ç»œè¿æ¥
jstack <pid>                     # æŸ¥çœ‹çº¿ç¨‹å †æ ˆ
jstat -gc <pid> 1s               # æŸ¥çœ‹GCæƒ…å†µ
```

è¿™äº›é¢è¯•é¢˜æ¶µç›–äº†Javaå¼€å‘ä¸­çš„æ ¸å¿ƒçŸ¥è¯†ç‚¹å’Œå®é™…åº”ç”¨åœºæ™¯ï¼ŒåŒ…æ‹¬åŸºç¡€æ¦‚å¿µã€é«˜çº§ç‰¹æ€§ã€æ¡†æ¶åº”ç”¨ã€åˆ†å¸ƒå¼ç³»ç»Ÿç­‰å¤šä¸ªç»´åº¦ï¼Œæ¯ä¸ªé—®é¢˜éƒ½åŒ…å«äº†è¯¦ç»†çš„è§£ç­”å’Œä»£ç ç¤ºä¾‹ï¼Œæœ‰åŠ©äºæ·±å…¥ç†è§£JavaæŠ€æœ¯æ ˆå’Œæå‡é¢è¯•è¡¨ç°ã€‚

## å®æˆ˜åº”ç”¨åœºæ™¯

### é«˜å¹¶å‘ç³»ç»Ÿè®¾è®¡

#### 1. ç§’æ€ç³»ç»Ÿè®¾è®¡

**æ ¸å¿ƒæŒ‘æˆ˜ï¼š**
- ç¬æ—¶é«˜å¹¶å‘è®¿é—®
- åº“å­˜è¶…å–é—®é¢˜
- ç³»ç»Ÿç¨³å®šæ€§ä¿éšœ

**è§£å†³æ–¹æ¡ˆï¼š**

```java
/**
 * ç§’æ€ç³»ç»Ÿæ ¸å¿ƒå®ç°
 */
@Service
public class SeckillService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    @Autowired
    private SeckillMapper seckillMapper;
    
    /**
     * ç§’æ€æ¥å£ - åŸºäºRedisåˆ†å¸ƒå¼é”
     */
    public SeckillResult seckill(Long userId, Long productId) {
        String lockKey = "seckill_lock_" + productId;
        String requestId = UUID.randomUUID().toString();
        
        try {
            // 1. è·å–åˆ†å¸ƒå¼é”
            Boolean lockResult = redisTemplate.opsForValue()
                .setIfAbsent(lockKey, requestId, Duration.ofSeconds(10));
            
            if (!lockResult) {
                return SeckillResult.fail("ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•");
            }
            
            // 2. æ£€æŸ¥åº“å­˜
            String stockKey = "stock_" + productId;
            Integer stock = (Integer) redisTemplate.opsForValue().get(stockKey);
            
            if (stock == null || stock <= 0) {
                return SeckillResult.fail("å•†å“å·²å”®ç½„");
            }
            
            // 3. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²å‚ä¸
            String userKey = "seckill_user_" + productId + "_" + userId;
            if (redisTemplate.hasKey(userKey)) {
                return SeckillResult.fail("æ‚¨å·²å‚ä¸è¿‡æ­¤æ¬¡ç§’æ€");
            }
            
            // 4. æ‰£å‡åº“å­˜
            Long remainStock = redisTemplate.opsForValue().decrement(stockKey);
            if (remainStock < 0) {
                // åº“å­˜ä¸è¶³ï¼Œå›æ»š
                redisTemplate.opsForValue().increment(stockKey);
                return SeckillResult.fail("å•†å“å·²å”®ç½„");
            }
            
            // 5. åˆ›å»ºè®¢å•ï¼ˆå¼‚æ­¥å¤„ç†ï¼‰
            SeckillOrder order = new SeckillOrder();
            order.setUserId(userId);
            order.setProductId(productId);
            order.setCreateTime(new Date());
            
            // å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥å¤„ç†
            rabbitTemplate.convertAndSend("seckill.order.queue", order);
            
            // 6. æ ‡è®°ç”¨æˆ·å·²å‚ä¸
            redisTemplate.opsForValue().set(userKey, "1", Duration.ofHours(24));
            
            return SeckillResult.success("ç§’æ€æˆåŠŸ");
            
        } finally {
            // é‡Šæ”¾åˆ†å¸ƒå¼é”
            releaseLock(lockKey, requestId);
        }
    }
    
    /**
     * é‡Šæ”¾åˆ†å¸ƒå¼é”
     */
    private void releaseLock(String lockKey, String requestId) {
        String script = "if redis.call('get', KEYS[1]) == ARGV[1] then " +
                       "return redis.call('del', KEYS[1]) else return 0 end";
        
        redisTemplate.execute(new DefaultRedisScript<>(script, Long.class),
                            Collections.singletonList(lockKey), requestId);
    }
    
    /**
     * é¢„çƒ­åº“å­˜åˆ°Redis
     */
    @PostConstruct
    public void initStock() {
        List<SeckillProduct> products = seckillMapper.findActiveProducts();
        for (SeckillProduct product : products) {
            String stockKey = "stock_" + product.getId();
            redisTemplate.opsForValue().set(stockKey, product.getStock());
        }
    }
}
```

#### 2. é™æµç­–ç•¥å®ç°

```java
/**
 * å¤šç§é™æµç®—æ³•å®ç°
 */
public class RateLimiter {
    
    /**
     * ä»¤ç‰Œæ¡¶ç®—æ³•
     */
    public static class TokenBucket {
        private final long capacity;        // æ¡¶å®¹é‡
        private final long refillRate;      // ä»¤ç‰Œç”Ÿæˆé€Ÿç‡
        private long tokens;                // å½“å‰ä»¤ç‰Œæ•°
        private long lastRefillTime;       // ä¸Šæ¬¡å¡«å……æ—¶é—´
        
        public TokenBucket(long capacity, long refillRate) {
            this.capacity = capacity;
            this.refillRate = refillRate;
            this.tokens = capacity;
            this.lastRefillTime = System.currentTimeMillis();
        }
        
        public synchronized boolean tryAcquire() {
            refill();
            if (tokens > 0) {
                tokens--;
                return true;
            }
            return false;
        }
        
        private void refill() {
            long now = System.currentTimeMillis();
            long tokensToAdd = (now - lastRefillTime) * refillRate / 1000;
            tokens = Math.min(capacity, tokens + tokensToAdd);
            lastRefillTime = now;
        }
    }
    
    /**
     * æ»‘åŠ¨çª—å£ç®—æ³•
     */
    public static class SlidingWindow {
        private final Queue<Long> requests = new LinkedList<>();
        private final int maxRequests;
        private final long windowSize;
        
        public SlidingWindow(int maxRequests, long windowSize) {
            this.maxRequests = maxRequests;
            this.windowSize = windowSize;
        }
        
        public synchronized boolean tryAcquire() {
            long now = System.currentTimeMillis();
            
            // ç§»é™¤çª—å£å¤–çš„è¯·æ±‚
            while (!requests.isEmpty() && now - requests.peek() > windowSize) {
                requests.poll();
            }
            
            if (requests.size() < maxRequests) {
                requests.offer(now);
                return true;
            }
            
            return false;
        }
    }
    
    /**
     * åŸºäºRedisçš„åˆ†å¸ƒå¼é™æµ
     */
    @Component
    public static class RedisRateLimiter {
        
        @Autowired
        private RedisTemplate<String, Object> redisTemplate;
        
        public boolean tryAcquire(String key, int maxRequests, int windowSeconds) {
            String script = 
                "local key = KEYS[1] " +
                "local window = tonumber(ARGV[1]) " +
                "local limit = tonumber(ARGV[2]) " +
                "local current = redis.call('GET', key) " +
                "if current == false then " +
                "  redis.call('SET', key, 1) " +
                "  redis.call('EXPIRE', key, window) " +
                "  return 1 " +
                "else " +
                "  if tonumber(current) < limit then " +
                "    return redis.call('INCR', key) " +
                "  else " +
                "    return 0 " +
                "  end " +
                "end";
            
            Long result = redisTemplate.execute(
                new DefaultRedisScript<>(script, Long.class),
                Collections.singletonList(key),
                windowSeconds, maxRequests
            );
            
            return result != null && result > 0;
        }
    }
}
```

### ç¼“å­˜è®¾è®¡ä¸å®ç°

#### 1. å¤šçº§ç¼“å­˜æ¶æ„

```java
/**
 * å¤šçº§ç¼“å­˜å®ç°
 * L1: æœ¬åœ°ç¼“å­˜ï¼ˆCaffeineï¼‰
 * L2: åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆRedisï¼‰
 * L3: æ•°æ®åº“
 */
@Service
public class MultiLevelCacheService {
    
    // L1ç¼“å­˜ï¼šæœ¬åœ°ç¼“å­˜
    private final Cache<String, Object> localCache = Caffeine.newBuilder()
            .maximumSize(1000)
            .expireAfterWrite(Duration.ofMinutes(5))
            .build();
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    @Autowired
    private UserMapper userMapper;
    
    /**
     * è·å–ç”¨æˆ·ä¿¡æ¯ - å¤šçº§ç¼“å­˜
     */
    public User getUser(Long userId) {
        String key = "user:" + userId;
        
        // L1ç¼“å­˜æŸ¥è¯¢
        User user = (User) localCache.getIfPresent(key);
        if (user != null) {
            return user;
        }
        
        // L2ç¼“å­˜æŸ¥è¯¢
        user = (User) redisTemplate.opsForValue().get(key);
        if (user != null) {
            // å›å†™L1ç¼“å­˜
            localCache.put(key, user);
            return user;
        }
        
        // L3æ•°æ®åº“æŸ¥è¯¢
        user = userMapper.findById(userId);
        if (user != null) {
            // å›å†™L2ç¼“å­˜
            redisTemplate.opsForValue().set(key, user, Duration.ofHours(1));
            // å›å†™L1ç¼“å­˜
            localCache.put(key, user);
        }
        
        return user;
    }
    
    /**
     * ç¼“å­˜æ›´æ–°ç­–ç•¥
     */
    public void updateUser(User user) {
        // 1. æ›´æ–°æ•°æ®åº“
        userMapper.update(user);
        
        String key = "user:" + user.getId();
        
        // 2. åˆ é™¤ç¼“å­˜ï¼ˆCache Asideæ¨¡å¼ï¼‰
        localCache.invalidate(key);
        redisTemplate.delete(key);
        
        // æˆ–è€…æ›´æ–°ç¼“å­˜ï¼ˆWrite Throughæ¨¡å¼ï¼‰
        // localCache.put(key, user);
        // redisTemplate.opsForValue().set(key, user, Duration.ofHours(1));
    }
}
```

#### 2. ç¼“å­˜ç©¿é€ã€å‡»ç©¿ã€é›ªå´©è§£å†³æ–¹æ¡ˆ

```java
/**
 * ç¼“å­˜é—®é¢˜è§£å†³æ–¹æ¡ˆ
 */
@Service
public class CacheService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    @Autowired
    private UserMapper userMapper;
    
    // å¸ƒéš†è¿‡æ»¤å™¨é˜²æ­¢ç¼“å­˜ç©¿é€
    private BloomFilter<Long> bloomFilter = BloomFilter.create(
        Funnels.longFunnel(), 1000000, 0.01);
    
    /**
     * é˜²ç¼“å­˜ç©¿é€ - å¸ƒéš†è¿‡æ»¤å™¨ + ç©ºå€¼ç¼“å­˜
     */
    public User getUserWithBloomFilter(Long userId) {
        // 1. å¸ƒéš†è¿‡æ»¤å™¨æ£€æŸ¥
        if (!bloomFilter.mightContain(userId)) {
            return null; // ä¸€å®šä¸å­˜åœ¨
        }
        
        String key = "user:" + userId;
        
        // 2. æŸ¥è¯¢ç¼“å­˜
        Object cached = redisTemplate.opsForValue().get(key);
        if (cached != null) {
            return cached.equals("NULL") ? null : (User) cached;
        }
        
        // 3. æŸ¥è¯¢æ•°æ®åº“
        User user = userMapper.findById(userId);
        
        // 4. ç¼“å­˜ç»“æœï¼ˆåŒ…æ‹¬ç©ºå€¼ï¼‰
        if (user != null) {
            redisTemplate.opsForValue().set(key, user, Duration.ofHours(1));
        } else {
            // ç¼“å­˜ç©ºå€¼ï¼Œé˜²æ­¢ç¼“å­˜ç©¿é€
            redisTemplate.opsForValue().set(key, "NULL", Duration.ofMinutes(5));
        }
        
        return user;
    }
    
    /**
     * é˜²ç¼“å­˜å‡»ç©¿ - åˆ†å¸ƒå¼é”
     */
    public User getUserWithLock(Long userId) {
        String key = "user:" + userId;
        String lockKey = "lock:user:" + userId;
        
        // 1. æŸ¥è¯¢ç¼“å­˜
        User user = (User) redisTemplate.opsForValue().get(key);
        if (user != null) {
            return user;
        }
        
        // 2. è·å–åˆ†å¸ƒå¼é”
        String requestId = UUID.randomUUID().toString();
        Boolean lockResult = redisTemplate.opsForValue()
            .setIfAbsent(lockKey, requestId, Duration.ofSeconds(10));
        
        if (lockResult) {
            try {
                // 3. åŒé‡æ£€æŸ¥
                user = (User) redisTemplate.opsForValue().get(key);
                if (user != null) {
                    return user;
                }
                
                // 4. æŸ¥è¯¢æ•°æ®åº“
                user = userMapper.findById(userId);
                
                // 5. æ›´æ–°ç¼“å­˜
                if (user != null) {
                    redisTemplate.opsForValue().set(key, user, Duration.ofHours(1));
                }
                
                return user;
                
            } finally {
                // 6. é‡Šæ”¾é”
                releaseLock(lockKey, requestId);
            }
        } else {
            // è·å–é”å¤±è´¥ï¼Œç­‰å¾…åé‡è¯•
            try {
                Thread.sleep(100);
                return getUserWithLock(userId);
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
                return null;
            }
        }
    }
    
    /**
     * é˜²ç¼“å­˜é›ªå´© - éšæœºè¿‡æœŸæ—¶é—´
     */
    public void setWithRandomExpire(String key, Object value, Duration baseDuration) {
        // åœ¨åŸºç¡€è¿‡æœŸæ—¶é—´ä¸Šå¢åŠ éšæœºæ—¶é—´ï¼Œé¿å…åŒæ—¶è¿‡æœŸ
        long randomSeconds = ThreadLocalRandom.current().nextLong(0, 300); // 0-5åˆ†é’Ÿéšæœº
        Duration finalDuration = baseDuration.plusSeconds(randomSeconds);
        
        redisTemplate.opsForValue().set(key, value, finalDuration);
    }
}
```

### åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘

#### 1. åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ

```java
/**
 * åˆ†å¸ƒå¼äº‹åŠ¡ - Sagaæ¨¡å¼å®ç°
 */
@Service
public class OrderSagaService {
    
    @Autowired
    private OrderService orderService;
    
    @Autowired
    private PaymentService paymentService;
    
    @Autowired
    private InventoryService inventoryService;
    
    /**
     * è®¢å•å¤„ç†Saga
     */
    public void processOrder(OrderRequest request) {
        SagaTransaction saga = new SagaTransaction();
        
        try {
            // 1. åˆ›å»ºè®¢å•
            Long orderId = saga.execute(
                () -> orderService.createOrder(request),
                () -> orderService.cancelOrder(orderId)
            );
            
            // 2. æ‰£å‡åº“å­˜
            saga.execute(
                () -> inventoryService.deductStock(request.getProductId(), request.getQuantity()),
                () -> inventoryService.restoreStock(request.getProductId(), request.getQuantity())
            );
            
            // 3. å¤„ç†æ”¯ä»˜
            saga.execute(
                () -> paymentService.processPayment(orderId, request.getAmount()),
                () -> paymentService.refund(orderId)
            );
            
            // 4. æ›´æ–°è®¢å•çŠ¶æ€
            saga.execute(
                () -> orderService.confirmOrder(orderId),
                () -> orderService.cancelOrder(orderId)
            );
            
        } catch (Exception e) {
            // æ‰§è¡Œè¡¥å¿æ“ä½œ
            saga.compensate();
            throw new BusinessException("è®¢å•å¤„ç†å¤±è´¥", e);
        }
    }
    
    /**
     * Sagaäº‹åŠ¡ç®¡ç†å™¨
     */
    public static class SagaTransaction {
        private final List<Runnable> compensations = new ArrayList<>();
        
        public <T> T execute(Supplier<T> action, Runnable compensation) {
            try {
                T result = action.get();
                compensations.add(compensation);
                return result;
            } catch (Exception e) {
                compensate();
                throw e;
            }
        }
        
        public void compensate() {
            // é€†åºæ‰§è¡Œè¡¥å¿æ“ä½œ
            Collections.reverse(compensations);
            for (Runnable compensation : compensations) {
                try {
                    compensation.run();
                } catch (Exception e) {
                    // è®°å½•è¡¥å¿å¤±è´¥æ—¥å¿—
                    log.error("è¡¥å¿æ“ä½œå¤±è´¥", e);
                }
            }
        }
    }
}
```

#### 2. åˆ†å¸ƒå¼é”å®ç°

```java
/**
 * åŸºäºRedisçš„åˆ†å¸ƒå¼é”
 */
@Component
public class RedisDistributedLock {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    private static final String UNLOCK_SCRIPT = 
        "if redis.call('get', KEYS[1]) == ARGV[1] then " +
        "return redis.call('del', KEYS[1]) else return 0 end";
    
    /**
     * è·å–é”
     */
    public boolean tryLock(String key, String requestId, long expireTime) {
        Boolean result = redisTemplate.opsForValue()
            .setIfAbsent(key, requestId, Duration.ofMillis(expireTime));
        return Boolean.TRUE.equals(result);
    }
    
    /**
     * é‡Šæ”¾é”
     */
    public boolean releaseLock(String key, String requestId) {
        Long result = redisTemplate.execute(
            new DefaultRedisScript<>(UNLOCK_SCRIPT, Long.class),
            Collections.singletonList(key),
            requestId
        );
        return Long.valueOf(1).equals(result);
    }
    
    /**
     * å¯é‡å…¥åˆ†å¸ƒå¼é”
     */
    public static class ReentrantDistributedLock {
        private final RedisTemplate<String, Object> redisTemplate;
        private final ThreadLocal<Integer> lockCount = new ThreadLocal<>();
        
        public ReentrantDistributedLock(RedisTemplate<String, Object> redisTemplate) {
            this.redisTemplate = redisTemplate;
        }
        
        public boolean lock(String key, long expireTime) {
            String threadId = Thread.currentThread().getId() + "";
            Integer count = lockCount.get();
            
            if (count != null && count > 0) {
                // é‡å…¥
                lockCount.set(count + 1);
                return true;
            }
            
            // é¦–æ¬¡è·å–é”
            Boolean result = redisTemplate.opsForValue()
                .setIfAbsent(key, threadId, Duration.ofMillis(expireTime));
            
            if (Boolean.TRUE.equals(result)) {
                lockCount.set(1);
                return true;
            }
            
            return false;
        }
        
        public void unlock(String key) {
            Integer count = lockCount.get();
            if (count == null || count <= 0) {
                return;
            }
            
            if (count == 1) {
                // å®Œå…¨é‡Šæ”¾é”
                String threadId = Thread.currentThread().getId() + "";
                String script = 
                    "if redis.call('get', KEYS[1]) == ARGV[1] then " +
                    "return redis.call('del', KEYS[1]) else return 0 end";
                
                redisTemplate.execute(
                    new DefaultRedisScript<>(script, Long.class),
                    Collections.singletonList(key),
                    threadId
                );
                
                lockCount.remove();
            } else {
                // å‡å°‘é‡å…¥æ¬¡æ•°
                lockCount.set(count - 1);
            }
        }
    }
}
```

## æ•…éšœæ’æŸ¥ä¸è°ƒè¯•

### å†…å­˜é—®é¢˜æ’æŸ¥

#### 1. å†…å­˜æ³„æ¼æ’æŸ¥æ­¥éª¤

```bash
# 1. ç›‘æ§JVMå†…å­˜ä½¿ç”¨æƒ…å†µ
jstat -gc <pid> 1s

# 2. ç”Ÿæˆå †è½¬å‚¨æ–‡ä»¶
jmap -dump:format=b,file=heapdump.hprof <pid>

# 3. åˆ†æå †è½¬å‚¨æ–‡ä»¶
# ä½¿ç”¨Eclipse MATæˆ–VisualVMåˆ†æ

# 4. æŸ¥çœ‹GCæ—¥å¿—
# JVMå‚æ•°ï¼š-XX:+PrintGCDetails -XX:+PrintGCDateStamps -Xloggc:gc.log
```

#### 2. å¸¸è§å†…å­˜æ³„æ¼åœºæ™¯

```java
/**
 * å†…å­˜æ³„æ¼ç¤ºä¾‹åŠè§£å†³æ–¹æ¡ˆ
 */
public class MemoryLeakExamples {
    
    /**
     * 1. é™æ€é›†åˆæŒæœ‰å¯¹è±¡å¼•ç”¨
     */
    public class StaticCollectionLeak {
        // é—®é¢˜ï¼šé™æ€é›†åˆä¸ä¼šè¢«GC
        private static List<Object> staticList = new ArrayList<>();
        
        public void addObject(Object obj) {
            staticList.add(obj);  // å¯¹è±¡æ°¸è¿œä¸ä¼šè¢«é‡Šæ”¾
        }
        
        // è§£å†³æ–¹æ¡ˆï¼šåŠæ—¶æ¸…ç†æˆ–ä½¿ç”¨WeakReference
        private static List<WeakReference<Object>> weakList = new ArrayList<>();
        
        public void addObjectSafely(Object obj) {
            weakList.add(new WeakReference<>(obj));
            
            // å®šæœŸæ¸…ç†å¤±æ•ˆçš„å¼•ç”¨
            weakList.removeIf(ref -> ref.get() == null);
        }
    }
    
    /**
     * 2. ç›‘å¬å™¨æœªç§»é™¤
     */
    public class ListenerLeak {
        private List<EventListener> listeners = new ArrayList<>();
        
        public void addEventListener(EventListener listener) {
            listeners.add(listener);
        }
        
        // é—®é¢˜ï¼šç›‘å¬å™¨æœªç§»é™¤ï¼Œå¯¼è‡´å¯¹è±¡æ— æ³•è¢«GC
        public void removeEventListener(EventListener listener) {
            listeners.remove(listener);  // å¿…é¡»è°ƒç”¨æ­¤æ–¹æ³•
        }
        
        // è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨WeakReferenceæˆ–è‡ªåŠ¨æ¸…ç†æœºåˆ¶
        private List<WeakReference<EventListener>> weakListeners = new ArrayList<>();
        
        public void addEventListenerSafely(EventListener listener) {
            weakListeners.add(new WeakReference<>(listener));
        }
    }
    
    /**
     * 3. çº¿ç¨‹æ± æœªå…³é—­
     */
    public class ThreadPoolLeak {
        private ExecutorService executor = Executors.newFixedThreadPool(10);
        
        public void doWork() {
            executor.submit(() -> {
                // æ‰§è¡Œä»»åŠ¡
            });
        }
        
        // é—®é¢˜ï¼šçº¿ç¨‹æ± æœªå…³é—­ï¼Œçº¿ç¨‹æŒç»­è¿è¡Œ
        // è§£å†³æ–¹æ¡ˆï¼šæ­£ç¡®å…³é—­çº¿ç¨‹æ± 
        public void shutdown() {
            executor.shutdown();
            try {
                if (!executor.awaitTermination(60, TimeUnit.SECONDS)) {
                    executor.shutdownNow();
                }
            } catch (InterruptedException e) {
                executor.shutdownNow();
                Thread.currentThread().interrupt();
            }
        }
    }
}
```

### CPUé—®é¢˜æ’æŸ¥

#### 1. CPUä½¿ç”¨ç‡è¿‡é«˜æ’æŸ¥

```bash
# 1. æŸ¥çœ‹ç³»ç»ŸCPUä½¿ç”¨æƒ…å†µ
top -p <pid>

# 2. æŸ¥çœ‹Javaè¿›ç¨‹ä¸­å„çº¿ç¨‹CPUä½¿ç”¨æƒ…å†µ
top -H -p <pid>

# 3. å°†çº¿ç¨‹IDè½¬æ¢ä¸º16è¿›åˆ¶
printf "%x\n" <thread_id>

# 4. æŸ¥çœ‹çº¿ç¨‹å †æ ˆ
jstack <pid> | grep -A 20 <hex_thread_id>

# 5. åˆ†æçƒ­ç‚¹æ–¹æ³•
# ä½¿ç”¨JProfilerã€Async Profilerç­‰å·¥å…·
```

#### 2. CPUä½¿ç”¨ç‡è¿‡é«˜çš„å¸¸è§åŸå› 

```java
/**
 * CPUä½¿ç”¨ç‡è¿‡é«˜çš„å¸¸è§åœºæ™¯
 */
public class HighCpuExamples {
    
    /**
     * 1. æ­»å¾ªç¯
     */
    public void infiniteLoop() {
        // é—®é¢˜ä»£ç 
        while (true) {
            // æ²¡æœ‰é€‚å½“çš„ç­‰å¾…æˆ–é€€å‡ºæ¡ä»¶
        }
        
        // è§£å†³æ–¹æ¡ˆï¼šæ·»åŠ é€‚å½“çš„ç­‰å¾…
        while (condition) {
            try {
                Thread.sleep(100);  // é€‚å½“ä¼‘çœ 
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
                break;
            }
        }
    }
    
    /**
     * 2. é¢‘ç¹çš„GC
     */
    public void frequentGC() {
        // é—®é¢˜ï¼šé¢‘ç¹åˆ›å»ºå¤§å¯¹è±¡
        for (int i = 0; i < 1000000; i++) {
            byte[] largeArray = new byte[1024 * 1024];  // 1MBå¯¹è±¡
        }
        
        // è§£å†³æ–¹æ¡ˆï¼šå¯¹è±¡å¤ç”¨
        byte[] reusableArray = new byte[1024 * 1024];
        for (int i = 0; i < 1000000; i++) {
            // å¤ç”¨å¯¹è±¡ï¼Œé¿å…é¢‘ç¹åˆ›å»º
            Arrays.fill(reusableArray, (byte) 0);
        }
    }
    
    /**
     * 3. æ­£åˆ™è¡¨è¾¾å¼å›æº¯
     */
    public void regexBacktracking() {
        String text = "aaaaaaaaaaaaaaaaaaaaaaaaaaab";
        
        // é—®é¢˜ï¼šå¤æ‚æ­£åˆ™è¡¨è¾¾å¼å¯¼è‡´å›æº¯
        Pattern badPattern = Pattern.compile("(a+)+b");
        
        // è§£å†³æ–¹æ¡ˆï¼šä¼˜åŒ–æ­£åˆ™è¡¨è¾¾å¼
        Pattern goodPattern = Pattern.compile("a+b");
        
        // æˆ–è€…è®¾ç½®è¶…æ—¶
        try {
            boolean matches = badPattern.matcher(text).matches();
        } catch (Exception e) {
            // å¤„ç†è¶…æ—¶å¼‚å¸¸
        }
    }
}
```

### çº¿ç¨‹é—®é¢˜æ’æŸ¥

#### 1. æ­»é”æ’æŸ¥

```bash
# 1. æ£€æµ‹æ­»é”
jstack <pid> | grep -A 5 -B 5 "Found Java-level deadlock"

# 2. ä½¿ç”¨JConsoleæˆ–VisualVMæ£€æµ‹æ­»é”

# 3. ç¨‹åºåŒ–æ£€æµ‹æ­»é”
```

```java
/**
 * æ­»é”æ£€æµ‹å’Œé¢„é˜²
 */
public class DeadlockDetection {
    
    /**
     * æ­»é”æ£€æµ‹å·¥å…·
     */
    public static class DeadlockDetector {
        private final ThreadMXBean threadBean = ManagementFactory.getThreadMXBean();
        
        public void detectDeadlock() {
            long[] deadlockedThreads = threadBean.findDeadlockedThreads();
            if (deadlockedThreads != null) {
                ThreadInfo[] threadInfos = threadBean.getThreadInfo(deadlockedThreads);
                System.err.println("æ£€æµ‹åˆ°æ­»é”:");
                for (ThreadInfo threadInfo : threadInfos) {
                    System.err.println("çº¿ç¨‹: " + threadInfo.getThreadName());
                    System.err.println("é”ä¿¡æ¯: " + threadInfo.getLockInfo());
                }
            }
        }
        
        // å®šæœŸæ£€æµ‹æ­»é”
        @Scheduled(fixedRate = 30000)  // æ¯30ç§’æ£€æµ‹ä¸€æ¬¡
        public void scheduleDeadlockDetection() {
            detectDeadlock();
        }
    }
    
    /**
     * æ­»é”é¢„é˜² - é”æ’åº
     */
    public static class DeadlockPrevention {
        private final Object lock1 = new Object();
        private final Object lock2 = new Object();
        
        // é—®é¢˜ï¼šå¯èƒ½å¯¼è‡´æ­»é”çš„ä»£ç 
        public void method1() {
            synchronized (lock1) {
                synchronized (lock2) {
                    // ä¸šåŠ¡é€»è¾‘
                }
            }
        }
        
        public void method2() {
            synchronized (lock2) {
                synchronized (lock1) {  // é”é¡ºåºä¸ä¸€è‡´ï¼Œå¯èƒ½æ­»é”
                    // ä¸šåŠ¡é€»è¾‘
                }
            }
        }
        
        // è§£å†³æ–¹æ¡ˆï¼šç»Ÿä¸€é”é¡ºåº
        private void acquireLocksInOrder(Object firstLock, Object secondLock) {
            int hash1 = System.identityHashCode(firstLock);
            int hash2 = System.identityHashCode(secondLock);
            
            if (hash1 < hash2) {
                synchronized (firstLock) {
                    synchronized (secondLock) {
                        // ä¸šåŠ¡é€»è¾‘
                    }
                }
            } else if (hash1 > hash2) {
                synchronized (secondLock) {
                    synchronized (firstLock) {
                        // ä¸šåŠ¡é€»è¾‘
                    }
                }
            } else {
                // hashç›¸åŒï¼Œä½¿ç”¨é¢å¤–çš„é”
                synchronized (tieLock) {
                    synchronized (firstLock) {
                        synchronized (secondLock) {
                            // ä¸šåŠ¡é€»è¾‘
                        }
                    }
                }
            }
        }
        
        private static final Object tieLock = new Object();
    }
}
```

### GCè°ƒä¼˜å®è·µ

GCè°ƒä¼˜æ˜¯æé«˜Javaåº”ç”¨æ€§èƒ½çš„é‡è¦ç¯èŠ‚ï¼Œéœ€è¦å¯¹åº”ç”¨çš„å†…å­˜ä½¿ç”¨æ¨¡å¼å’ŒGCè¡Œä¸ºè¿›è¡Œåˆ†æå’Œä¼˜åŒ–ã€‚

```mermaid
flowchart TD
    subgraph "ğŸ”§ GCè°ƒä¼˜å®è·µæµç¨‹" ["GCè°ƒä¼˜å®è·µæµç¨‹"]
        Start["GCè°ƒä¼˜å¯åŠ¨"] -->|"åŸºå‡†æµ‹è¯•+é—®é¢˜è¯†åˆ«"| Monitor["ğŸ“Š ç›‘æ§åˆ†æé˜¶æ®µ"]
        
        Monitor -->|"GCæ—¥å¿—å¼€å¯+å·¥å…·ç›‘æ§+æŒ‡æ ‡æ”¶é›†"| ParamTune["âš™ï¸ å‚æ•°è°ƒä¼˜é˜¶æ®µ"]
        
        ParamTune -->|"å †å¤§å°è°ƒæ•´+æ”¶é›†å™¨é€‰æ‹©+ç‰¹å®šå‚æ•°ä¼˜åŒ–"| CodeOpt["ğŸ’» ä»£ç ä¼˜åŒ–é˜¶æ®µ"]
        
        CodeOpt -->|"å¯¹è±¡åˆ›å»ºä¼˜åŒ–+å†…å­˜æ³„æ¼é¿å…+å¤§å¯¹è±¡å¤„ç†"| Verify["âœ… æ•ˆæœéªŒè¯é˜¶æ®µ"]
        
        Verify -->|"æŒ‡æ ‡å¯¹æ¯”+æ•ˆæœè¯„ä¼°"| Decision{"è°ƒä¼˜ç›®æ ‡è¾¾æˆ?"}
        
        Decision -->|"Yes"| Complete["ğŸ¯ è°ƒä¼˜å®Œæˆ"]
        Decision -->|"No"| Monitor
    end
    
    subgraph "ğŸ“Š ç›‘æ§åˆ†æè¦ç‚¹" ["ç›‘æ§åˆ†æè¦ç‚¹"]
        Monitor -->|"å¼€å¯è¯¦ç»†GCæ—¥å¿—"| MonitorTools["ç›‘æ§å·¥å…·é€‰æ‹©"]
        MonitorTools -->|"GCViewer+GCeasy+JVisualVM"| KeyMetrics["å…³é”®æŒ‡æ ‡é‡‡é›†"]
        KeyMetrics -->|"åœé¡¿æ—¶é—´+æ”¶é›†é¢‘ç‡+å†…å­˜å ç”¨+åˆ†é…ç‡"| ProblemID["é—®é¢˜æ¨¡å¼è¯†åˆ«"]
        ProblemID -->|"é¢‘ç¹MinorGC+é¢‘ç¹FullGC+é•¿åœé¡¿+å†…å­˜æ³„æ¼"| MonitorResult["ç›‘æ§ç»“æœåˆ†æ"]
    end
    
    subgraph "âš™ï¸ å‚æ•°è°ƒä¼˜ç­–ç•¥" ["å‚æ•°è°ƒä¼˜ç­–ç•¥"]
        ParamTune -->|"æ ¹æ®é—®é¢˜é€‰æ‹©ç­–ç•¥"| HeapSize["å †å¤§å°è°ƒæ•´"]
        HeapSize -->|"Xms=Xmx+NewRatio+SurvivorRatio"| CollectorChoice["æ”¶é›†å™¨é€‰æ‹©"]
        CollectorChoice -->|"ParallelGC+G1GC+ZGC"| SpecificParams["ç‰¹å®šå‚æ•°ä¼˜åŒ–"]
        SpecificParams -->|"G1MaxGCPauseMillis+CMSInitiatingOccupancy"| TuneResult["å‚æ•°è°ƒä¼˜ç»“æœ"]
    end
    
    subgraph "ğŸ’» ä»£ç ä¼˜åŒ–æ–¹å‘" ["ä»£ç ä¼˜åŒ–æ–¹å‘"]
        CodeOpt -->|"å‡å°‘å¯¹è±¡åˆ›å»ºå¼€é”€"| ObjectOpt["å¯¹è±¡ä¼˜åŒ–"]
        ObjectOpt -->|"å¯¹è±¡æ± +StringBuilder+é¿å…ä¸´æ—¶å¯¹è±¡"| MemoryLeak["å†…å­˜æ³„æ¼é¢„é˜²"]
        MemoryLeak -->|"èµ„æºå…³é—­+é›†åˆæ¸…ç†+ç›‘å¬å™¨ç®¡ç†"| BigObject["å¤§å¯¹è±¡å¤„ç†"]
        BigObject -->|"åˆ†æ®µå¤„ç†+æµå¼å¤„ç†+å¼•ç”¨ç±»å‹é€‰æ‹©"| CodeResult["ä»£ç ä¼˜åŒ–ç»“æœ"]
    end
    
    %% æ ·å¼è®¾ç½®
    style Start fill:#E3F2FD,stroke:#1976D2,stroke-width:2px
    style Monitor fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px
    style ParamTune fill:#FFF3E0,stroke:#F57C00,stroke-width:2px
    style CodeOpt fill:#E8F5E8,stroke:#388E3C,stroke-width:2px
    style Verify fill:#FCE4EC,stroke:#C2185B,stroke-width:2px
    style Complete fill:#E0F2F1,stroke:#00695C,stroke-width:2px
```

#### GCç›‘æ§ä¸åˆ†æ

**1. å¼€å¯GCæ—¥å¿—**

```java
// å¸¸ç”¨çš„GCæ—¥å¿—å‚æ•°
JVMå‚æ•°ï¼š
-XX:+PrintGCDetails            // æ‰“å°è¯¦ç»†çš„GCæ—¥å¿—
-XX:+PrintGCDateStamps         // æ‰“å°GCæ—¶é—´æˆ³
-Xloggc:/path/to/gc.log        // æŒ‡å®šGCæ—¥å¿—æ–‡ä»¶è·¯å¾„
-XX:+UseGCLogFileRotation      // å¯ç”¨GCæ—¥å¿—æ–‡ä»¶è½®è½¬
-XX:NumberOfGCLogFiles=10      // è®¾ç½®GCæ—¥å¿—æ–‡ä»¶æ•°é‡
-XX:GCLogFileSize=10M          // è®¾ç½®GCæ—¥å¿—æ–‡ä»¶å¤§å°
```

**2. GCæ—¥å¿—åˆ†æå·¥å…·**

- **GCViewer**ï¼šå¯è§†åŒ–åˆ†æGCæ—¥å¿—
- **GCeasy**ï¼šåŸºäºç½‘ç»œçš„GCæ—¥å¿—åˆ†æå·¥å…·
- **JVisualVM**ï¼šå®æ—¶ç›‘æ§å’Œåˆ†æGCæ´»åŠ¨
- **Java Mission Control (JMC)**ï¼šä½å¼€é”€ç›‘æ§å·¥å…·

**3. GCé—®é¢˜è¯†åˆ«**

| é—®é¢˜ç±»å‹ | è¡¨ç° | å¯èƒ½åŸå›  |
| ------------ | ------------ | ------------ |
| é¢‘ç¹çš„Minor GC | æ–°ç”Ÿä»£GCé¢‘ç¹å‘ç”Ÿ | æ–°ç”Ÿä»£ç©ºé—´è¿‡å°ï¼Œå¯¹è±¡åˆ›å»ºè¿‡å¤š |
| é¢‘ç¹çš„Full GC | è€å¹´ä»£GCé¢‘ç¹å‘ç”Ÿ | å†…å­˜æ³„æ¼ã€è€å¹´ä»£ç©ºé—´è¿‡å° |
| GCåœé¡¿æ—¶é—´é•¿ | åº”ç”¨å“åº”æ—¶é—´å˜é•¿ | å †è¿‡å¤§ã€ä½¿ç”¨äº†ä¸é€‚åˆçš„æ”¶é›†å™¨ |
| å†…å­˜æ³„æ¼ | å †å†…å­˜ä½¿ç”¨é‡æŒç»­å¢é•¿ | å¯¹è±¡æœªè¢«æ­£ç¡®é‡Šæ”¾ï¼Œé™æ€é›†åˆæŒæœ‰è¿‡å¤šå¼•ç”¨ |

#### GCè°ƒä¼˜æ–¹æ³•

**1. å †å¤§å°è°ƒæ•´**

```java
// å¸¸ç”¨çš„å †å¤§å°è°ƒæ•´å‚æ•°
-Xms<size>                     // åˆå§‹å †å¤§å°ï¼Œå¦‚-Xms4g
-Xmx<size>                     // æœ€å¤§å †å¤§å°ï¼Œå¦‚-Xmx4g
-XX:NewSize=<size>             // æ–°ç”Ÿä»£åˆå§‹å¤§å°
-XX:MaxNewSize=<size>          // æ–°ç”Ÿä»£æœ€å¤§å¤§å°
-XX:NewRatio=<n>               // è€å¹´ä»£ä¸æ–°ç”Ÿä»£çš„æ¯”ä¾‹ï¼Œå¦‚-XX:NewRatio=2è¡¨ç¤º2:1
-XX:SurvivorRatio=<n>          // Edenä¸Survivorçš„æ¯”ä¾‹ï¼Œå¦‚-XX:SurvivorRatio=8è¡¨ç¤º8:1:1
```

**2. å¸¸è§GCé—®é¢˜åŠè§£å†³æ–¹æ¡ˆ**

```java
/**
 * GCä¿¡æ¯æ”¶é›†ä¸åˆ†æ
 */
public class GCMonitor {
    
    /**
     * GCä¿¡æ¯æ”¶é›†
     */
    public void collectGCInfo() {
        List<GarbageCollectorMXBean> gcBeans = ManagementFactory.getGarbageCollectorMXBeans();
        
        for (GarbageCollectorMXBean gcBean : gcBeans) {
            System.out.println("GCåç§°: " + gcBean.getName());
            System.out.println("GCæ¬¡æ•°: " + gcBean.getCollectionCount());
            System.out.println("GCæ€»æ—¶é—´: " + gcBean.getCollectionTime() + "ms");
            
            // è®¡ç®—GCé¢‘ç‡å’Œå¹³å‡æ—¶é—´
            long avgTime = gcBean.getCollectionTime() / Math.max(1, gcBean.getCollectionCount());
            System.out.println("GCå¹³å‡æ—¶é—´: " + avgTime + "ms");
        }
        
        // å†…å­˜ä½¿ç”¨æƒ…å†µ
        MemoryMXBean memoryBean = ManagementFactory.getMemoryMXBean();
        MemoryUsage heapUsage = memoryBean.getHeapMemoryUsage();
        
        System.out.println("å †å†…å­˜ä½¿ç”¨ç‡: " + 
            (heapUsage.getUsed() * 100.0 / heapUsage.getMax()) + "%");
    }
}
```

**3. å¸¸è§GCè°ƒä¼˜æ–¹æ¡ˆ**

| é—®é¢˜ | è°ƒä¼˜æ–¹æ¡ˆ | JVMå‚æ•°ç¤ºä¾‹ |
| ------------ | ------------ | ------------ |
| Minor GCé¢‘ç¹ | å¢å¤§æ–°ç”Ÿä»£ç©ºé—´ | `-XX:NewRatio=2` |
| Full GCé¢‘ç¹ | å¢å¤§è€å¹´ä»£ç©ºé—´æˆ–ä¼˜åŒ–ä»£ç  | `-Xmx4g -XX:NewRatio=3` |
| GCåœé¡¿æ—¶é—´é•¿ | é€‰æ‹©ä½åœé¡¿æ”¶é›†å™¨ | `-XX:+UseG1GC -XX:MaxGCPauseMillis=200` |
| å†…å­˜æ³„æ¼ | å¼€å¯å †è½¬å‚¨è¿›è¡Œåˆ†æ | `-XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/path/to/dump` |
| å¤§å¯¹è±¡åˆ†é…æ…¢ | é¢„ç•™å¤§å¯¹è±¡ç©ºé—´ | `-XX:G1HeapRegionSize=16m -XX:G1ReservePercent=20` |

**4. ä¸åŒæ”¶é›†å™¨çš„è°ƒä¼˜å‚æ•°**

```mermaid
flowchart TD
    subgraph "âš™ï¸ ä¸åŒæ”¶é›†å™¨è°ƒä¼˜å‚æ•°" ["ä¸åŒæ”¶é›†å™¨è°ƒä¼˜å‚æ•°"]
        CollectorParam["ğŸ”§ æ”¶é›†å™¨å‚æ•°é€‰æ‹©"] -->|"é«˜ååé‡åœºæ™¯"| Parallel["ğŸš€ Parallel GC"]
        
        CollectorParam -->|"ä½åœé¡¿æ—¶é—´åœºæ™¯"| CMS["ğŸ”„ CMS GC"]
        
        CollectorParam -->|"å¤§å†…å­˜ä½å»¶è¿Ÿåœºæ™¯"| G1["ğŸ¯ G1 GC"]
        
        CollectorParam -->|"è¶…ä½å»¶è¿Ÿåœºæ™¯"| ZGC["âš¡ ZGC"]
        
        Parallel -->|"åŸºç¡€å‚æ•°+å¹¶è¡Œçº¿ç¨‹æ•°"| ParallelParams["é»˜è®¤å‚æ•°+ParallelGCThreads"]
        
        CMS -->|"è§¦å‘é˜ˆå€¼+ç±»å¸è½½+å¢é‡æ¨¡å¼"| CMSParams["InitiatingOccupancy+ClassUnloading+InitiatingOnly"]
        
        G1 -->|"åœé¡¿ç›®æ ‡+å †åŒºå¤§å°+è§¦å‘é˜ˆå€¼"| G1Params["MaxGCPauseMillis+HeapRegionSize+InitiatingPercent"]
        
        ZGC -->|"å¹¶å‘çº¿ç¨‹+åˆ†é…çªå‘+å †å¤§å°"| ZGCParams["ConcGCThreads+AllocationSpikeTolerance+Xmx"]
    end
    
    subgraph "ğŸ”§ å…·ä½“å‚æ•°ç¤ºä¾‹" ["å…·ä½“å‚æ•°ç¤ºä¾‹"]
        ParallelParams -->|"é«˜ååé‡ä¼˜åŒ–"| ParallelExample["-XX:+UseParallelGC\n-XX:ParallelGCThreads=8\n-XX:+UseParallelOldGC"]
        
        CMSParams -->|"ä½å»¶è¿Ÿä¼˜åŒ–"| CMSExample["-XX:+UseConcMarkSweepGC\n-XX:CMSInitiatingOccupancyFraction=75\n-XX:+UseCMSInitiatingOccupancyOnly\n-XX:+CMSClassUnloadingEnabled"]
        
        G1Params -->|"å¹³è¡¡æ€§èƒ½ä¼˜åŒ–"| G1Example["-XX:+UseG1GC\n-XX:MaxGCPauseMillis=200\n-XX:G1HeapRegionSize=16m\n-XX:InitiatingHeapOccupancyPercent=45"]
        
        ZGCParams -->|"è¶…ä½å»¶è¿Ÿä¼˜åŒ–"| ZGCExample["-XX:+UseZGC\n-XX:ConcGCThreads=4\n-XX:ZAllocationSpikeTolerance=10\n-Xmx32g"]
    end
    
    subgraph "ğŸ¯ é€‰æ‹©å†³ç­–" ["é€‰æ‹©å†³ç­–"]
        Decision{"åº”ç”¨ç‰¹ç‚¹"} -->|"é«˜ååé‡+å¯æ¥å—åœé¡¿"| UseParallel["ä½¿ç”¨ Parallel GC"]
        Decision -->|"å“åº”æ—¶é—´æ•æ„Ÿ+ä¸­ç­‰å†…å­˜"| UseCMS["ä½¿ç”¨ CMS GC"]
        Decision -->|"å¤§å†…å­˜+å¯é¢„æµ‹åœé¡¿"| UseG1["ä½¿ç”¨ G1 GC"]
        Decision -->|"è¶…å¤§å†…å­˜+æä½å»¶è¿Ÿ"| UseZGC["ä½¿ç”¨ ZGC"]
    end
    
    %% æ ·å¼è®¾ç½®
    style CollectorParam fill:#E3F2FD,stroke:#1976D2,stroke-width:2px
    style Parallel fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px
    style CMS fill:#FFF3E0,stroke:#F57C00,stroke-width:2px
    style G1 fill:#E8F5E8,stroke:#388E3C,stroke-width:2px
    style ZGC fill:#FCE4EC,stroke:#C2185B,stroke-width:2px
```

**5. å¸¸è§å†…å­˜é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ**

| é—®é¢˜ | è¡¨ç° | è§£å†³æ–¹æ¡ˆ |
| ------------ | ------------ | ------------ |
| å†…å­˜æ³„æ¼ | å †å†…å­˜æŒç»­å¢é•¿ | ä½¿ç”¨MATåˆ†æå †è½¬å‚¨æ–‡ä»¶ï¼Œæ‰¾å‡ºæ³„æ¼ç‚¹ |
| åƒåœ¾å¯¹è±¡è¿‡å¤š | Minor GCé¢‘ç¹ | é¿å…çŸ­æ—¶é—´åˆ›å»ºå¤§é‡ä¸´æ—¶å¯¹è±¡ï¼Œä½¿ç”¨å¯¹è±¡æ±  |
| å¤§å¯¹è±¡å¤„ç† | Full GCé¢‘ç¹ | è°ƒæ•´å¤§å¯¹è±¡é˜ˆå€¼ï¼Œé€‰æ‹©é€‚åˆçš„æ”¶é›†å™¨ |
| æ°¸ä¹…ä»£ç©ºé—´ä¸è¶³ | é¢‘ç¹Full GCåä¾ç„¶OOM | å¢å¤§æ°¸ä¹…ä»£ç©ºé—´æˆ–å‡å°‘ç±»åŠ è½½ |
| çº¿ç¨‹æ ˆæº¢å‡º | StackOverflowError | æ£€æŸ¥é€’å½’è°ƒç”¨ï¼Œå¢åŠ çº¿ç¨‹æ ˆå¤§å° |

**GCè°ƒä¼˜æœ€ä½³å®è·µï¼š**

1. **ç›‘æ§ä¸åŸºå‡†æµ‹è¯•**ï¼šåœ¨è°ƒä¼˜å‰å»ºç«‹åŸºå‡†æŒ‡æ ‡
2. **ä¿æŒXmså’ŒXmxç›¸ç­‰**ï¼šé¿å…å †å¤§å°åŠ¨æ€è°ƒæ•´
3. **é€‰æ‹©åˆé€‚çš„æ”¶é›†å™¨**ï¼šæ ¹æ®åº”ç”¨ç‰¹ç‚¹é€‰æ‹©æ”¶é›†å™¨
4. **åˆ†ä»£æ¯”ä¾‹è°ƒæ•´**ï¼šæ ¹æ®å¯¹è±¡å­˜æ´»æ—¶é—´è°ƒæ•´æ–°ç”Ÿä»£å’Œè€å¹´ä»£æ¯”ä¾‹
5. **ä»£ç ä¼˜åŒ–**ï¼šå‡å°‘ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»ºå’Œå¼•ç”¨æŒæœ‰