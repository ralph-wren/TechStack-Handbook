# React æŠ€æœ¯å®Œæ•´æŒ‡å—

## ç›®å½•
- [React æŠ€æœ¯å®Œæ•´æŒ‡å—](#react-æŠ€æœ¯å®Œæ•´æŒ‡å—)
  - [ç›®å½•](#ç›®å½•)
  - [1. React æ¦‚è¿°ä¸æ ¸å¿ƒæ¦‚å¿µ](#1-react-æ¦‚è¿°ä¸æ ¸å¿ƒæ¦‚å¿µ)
    - [1.1 React ç®€ä»‹](#11-react-ç®€ä»‹)
      - [1.1.1 React ç‰¹ç‚¹ä¸ä¼˜åŠ¿](#111-react-ç‰¹ç‚¹ä¸ä¼˜åŠ¿)
      - [1.1.2 React ç”Ÿæ€ç³»ç»Ÿ](#112-react-ç”Ÿæ€ç³»ç»Ÿ)
    - [1.2 æ ¸å¿ƒæ¦‚å¿µ](#12-æ ¸å¿ƒæ¦‚å¿µ)
      - [1.2.1 è™šæ‹ŸDOMåŸç†](#121-è™šæ‹ŸdomåŸç†)
      - [1.2.2 ç»„ä»¶åŒ–æ€æƒ³](#122-ç»„ä»¶åŒ–æ€æƒ³)
      - [1.2.3 å•å‘æ•°æ®æµ](#123-å•å‘æ•°æ®æµ)
    - [1.3 React æ¶æ„æ¼”è¿›](#13-react-æ¶æ„æ¼”è¿›)
      - [1.3.1 ä»ç±»ç»„ä»¶åˆ°å‡½æ•°ç»„ä»¶](#131-ä»ç±»ç»„ä»¶åˆ°å‡½æ•°ç»„ä»¶)
      - [1.3.2 Fiber æ¶æ„åŸç†](#132-fiber-æ¶æ„åŸç†)
  - [2. ç»„ä»¶åŸºç¡€ä¸ç”Ÿå‘½å‘¨æœŸ](#2-ç»„ä»¶åŸºç¡€ä¸ç”Ÿå‘½å‘¨æœŸ)
    - [2.1 ç»„ä»¶å®šä¹‰ä¸ä½¿ç”¨](#21-ç»„ä»¶å®šä¹‰ä¸ä½¿ç”¨)
      - [2.1.1 å‡½æ•°ç»„ä»¶](#211-å‡½æ•°ç»„ä»¶)
      - [2.1.2 ç±»ç»„ä»¶](#212-ç±»ç»„ä»¶)
      - [2.1.3 ç»„ä»¶é€šä¿¡](#213-ç»„ä»¶é€šä¿¡)
    - [2.2 ç”Ÿå‘½å‘¨æœŸè¯¦è§£](#22-ç”Ÿå‘½å‘¨æœŸè¯¦è§£)
      - [2.2.1 æŒ‚è½½é˜¶æ®µ](#221-æŒ‚è½½é˜¶æ®µ)
      - [2.2.2 æ›´æ–°é˜¶æ®µ](#222-æ›´æ–°é˜¶æ®µ)
      - [2.2.3 å¸è½½é˜¶æ®µ](#223-å¸è½½é˜¶æ®µ)
    - [2.3 äº‹ä»¶å¤„ç†æœºåˆ¶](#23-äº‹ä»¶å¤„ç†æœºåˆ¶)
      - [2.3.1 åˆæˆäº‹ä»¶ç³»ç»Ÿ](#231-åˆæˆäº‹ä»¶ç³»ç»Ÿ)
      - [2.3.2 äº‹ä»¶å§”æ‰˜æœºåˆ¶](#232-äº‹ä»¶å§”æ‰˜æœºåˆ¶)
  - [3. React Hooks æ·±åº¦è§£æ](#3-react-hooks-æ·±åº¦è§£æ)
    - [3.1 åŸºç¡€Hooks](#31-åŸºç¡€hooks)
      - [3.1.1 useState](#311-usestate)
      - [3.1.2 useEffect](#312-useeffect)
      - [3.1.3 useContext](#313-usecontext)
    - [3.2 é«˜çº§Hooks](#32-é«˜çº§hooks)
      - [3.2.1 useReducer](#321-usereducer)
      - [3.2.2 useMemo å’Œ useCallback](#322-usememo-å’Œ-usecallback)
      - [3.2.3 useRef å’Œ useImperativeHandle](#323-useref-å’Œ-useimperativehandle)
    - [3.3 è‡ªå®šä¹‰Hooks](#33-è‡ªå®šä¹‰hooks)
      - [3.3.1 è®¾è®¡åŸåˆ™](#331-è®¾è®¡åŸåˆ™)
      - [3.3.2 å¸¸ç”¨è‡ªå®šä¹‰Hooks](#332-å¸¸ç”¨è‡ªå®šä¹‰hooks)
  - [4. çŠ¶æ€ç®¡ç†ä¸æ•°æ®æµ](#4-çŠ¶æ€ç®¡ç†ä¸æ•°æ®æµ)
    - [4.1 æœ¬åœ°çŠ¶æ€ç®¡ç†](#41-æœ¬åœ°çŠ¶æ€ç®¡ç†)
      - [4.1.1 ç»„ä»¶å†…çŠ¶æ€](#411-ç»„ä»¶å†…çŠ¶æ€)
      - [4.1.2 çŠ¶æ€æå‡](#412-çŠ¶æ€æå‡)
    - [4.2 Context API](#42-context-api)
      - [4.2.1 ContextåŸºç¡€ç”¨æ³•](#421-contextåŸºç¡€ç”¨æ³•)
      - [4.2.2 Contextæœ€ä½³å®è·µ](#422-contextæœ€ä½³å®è·µ)
    - [4.3 ç¬¬ä¸‰æ–¹çŠ¶æ€ç®¡ç†](#43-ç¬¬ä¸‰æ–¹çŠ¶æ€ç®¡ç†)
      - [4.3.1 Redux](#431-redux)
      - [4.3.2 Zustand](#432-zustand)
      - [4.3.3 çŠ¶æ€ç®¡ç†æ–¹æ¡ˆå¯¹æ¯”](#433-çŠ¶æ€ç®¡ç†æ–¹æ¡ˆå¯¹æ¯”)
  - [5. è·¯ç”±ä¸å¯¼èˆª](#5-è·¯ç”±ä¸å¯¼èˆª)
    - [5.1 React RouteråŸºç¡€](#51-react-routeråŸºç¡€)
      - [5.1.1 è·¯ç”±é…ç½®](#511-è·¯ç”±é…ç½®)
      - [5.1.2 è·¯ç”±å‚æ•°](#512-è·¯ç”±å‚æ•°)
    - [5.2 é«˜çº§è·¯ç”±ç‰¹æ€§](#52-é«˜çº§è·¯ç”±ç‰¹æ€§)
      - [5.2.1 åµŒå¥—è·¯ç”±](#521-åµŒå¥—è·¯ç”±)
      - [5.2.2 è·¯ç”±å®ˆå«](#522-è·¯ç”±å®ˆå«)
      - [5.2.3 ä»£ç åˆ†å‰²ä¸æ‡’åŠ è½½](#523-ä»£ç åˆ†å‰²ä¸æ‡’åŠ è½½)
  - [6. æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ](#6-æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ)
    - [6.1 Reactæ€§èƒ½ä¼˜åŒ–](#61-reactæ€§èƒ½ä¼˜åŒ–)
      - [6.1.1 React.memo](#611-reactmemo)
      - [6.1.2 useMemoå’ŒuseCallback](#612-usememoå’Œusecallback)
      - [6.1.3 Concurrent Mode](#613-concurrent-mode)
    - [6.2 ä»£ç åˆ†å‰²ä¸æ‡’åŠ è½½](#62-ä»£ç åˆ†å‰²ä¸æ‡’åŠ è½½)
      - [6.2.1 åŠ¨æ€å¯¼å…¥](#621-åŠ¨æ€å¯¼å…¥)
      - [6.2.2 Suspenseä¸ErrorBoundary](#622-suspenseä¸errorboundary)
    - [6.3 æœ€ä½³å®è·µ](#63-æœ€ä½³å®è·µ)
      - [6.3.1 ç»„ä»¶è®¾è®¡åŸåˆ™](#631-ç»„ä»¶è®¾è®¡åŸåˆ™)
      - [6.3.2 æ€§èƒ½ç›‘æ§](#632-æ€§èƒ½ç›‘æ§)
  - [7. æµ‹è¯•ä¸è´¨é‡ä¿è¯](#7-æµ‹è¯•ä¸è´¨é‡ä¿è¯)
    - [7.1 æµ‹è¯•åŸºç¡€](#71-æµ‹è¯•åŸºç¡€)
      - [7.1.1 æµ‹è¯•ç¯å¢ƒé…ç½®](#711-æµ‹è¯•ç¯å¢ƒé…ç½®)
      - [7.1.2 æµ‹è¯•ç±»å‹](#712-æµ‹è¯•ç±»å‹)
    - [7.2 å•å…ƒæµ‹è¯•](#72-å•å…ƒæµ‹è¯•)
      - [7.2.1 Jestæµ‹è¯•æ¡†æ¶](#721-jestæµ‹è¯•æ¡†æ¶)
      - [7.2.2 React Testing Library](#722-react-testing-library)
    - [7.3 é›†æˆæµ‹è¯•ä¸E2Eæµ‹è¯•](#73-é›†æˆæµ‹è¯•ä¸e2eæµ‹è¯•)
      - [7.3.1 ç»„ä»¶é›†æˆæµ‹è¯•](#731-ç»„ä»¶é›†æˆæµ‹è¯•)
      - [7.3.2 Cypress E2Eæµ‹è¯•](#732-cypress-e2eæµ‹è¯•)
  - [8. React ç”Ÿæ€ç³»ç»Ÿ](#8-react-ç”Ÿæ€ç³»ç»Ÿ)
    - [8.1 UIç»„ä»¶åº“](#81-uiç»„ä»¶åº“)
      - [8.1.1 Ant Design](#811-ant-design)
      - [8.1.2 Material-UI](#812-material-ui)
      - [8.1.3 ç»„ä»¶åº“é€‰æ‹©](#813-ç»„ä»¶åº“é€‰æ‹©)
    - [8.2 æ„å»ºå·¥å…·](#82-æ„å»ºå·¥å…·)
      - [8.2.1 Create React App](#821-create-react-app)
      - [8.2.2 Vite](#822-vite)
      - [8.2.3 Webpacké…ç½®](#823-webpacké…ç½®)
    - [8.3 å…¨æ ˆæ¡†æ¶](#83-å…¨æ ˆæ¡†æ¶)
      - [8.3.1 Next.js](#831-nextjs)
      - [8.3.2 Remix](#832-remix)
      - [8.3.3 Gatsby](#833-gatsby)
  - [9. å®æˆ˜é¡¹ç›®æ¡ˆä¾‹](#9-å®æˆ˜é¡¹ç›®æ¡ˆä¾‹)
    - [9.1 å¾…åŠäº‹é¡¹åº”ç”¨](#91-å¾…åŠäº‹é¡¹åº”ç”¨)
      - [9.1.1 é¡¹ç›®æ¶æ„](#911-é¡¹ç›®æ¶æ„)
      - [9.1.2 åŠŸèƒ½å®ç°](#912-åŠŸèƒ½å®ç°)
    - [9.2 ç”µå•†è´­ç‰©è½¦](#92-ç”µå•†è´­ç‰©è½¦)
      - [9.2.1 çŠ¶æ€è®¾è®¡](#921-çŠ¶æ€è®¾è®¡)
      - [9.2.2 ç»„ä»¶æ‹†åˆ†](#922-ç»„ä»¶æ‹†åˆ†)
    - [9.3 å®æ—¶èŠå¤©åº”ç”¨](#93-å®æ—¶èŠå¤©åº”ç”¨)
      - [9.3.1 WebSocketé›†æˆ](#931-websocketé›†æˆ)
      - [9.3.2 æ¶ˆæ¯ç®¡ç†](#932-æ¶ˆæ¯ç®¡ç†)
  - [10. React é¢è¯•é¢˜è¯¦è§£](#10-react-é¢è¯•é¢˜è¯¦è§£)
    - [10.1 åŸºç¡€æ¦‚å¿µç±»](#101-åŸºç¡€æ¦‚å¿µç±»)
      - [Q1: ä»€ä¹ˆæ˜¯Reactï¼ŸReactæœ‰å“ªäº›ç‰¹ç‚¹ï¼Ÿ](#q1-ä»€ä¹ˆæ˜¯reactreactæœ‰å“ªäº›ç‰¹ç‚¹)
      - [Q2: ä»€ä¹ˆæ˜¯è™šæ‹ŸDOMï¼Ÿè™šæ‹ŸDOMçš„å·¥ä½œåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ](#q2-ä»€ä¹ˆæ˜¯è™šæ‹Ÿdomè™šæ‹Ÿdomçš„å·¥ä½œåŸç†æ˜¯ä»€ä¹ˆ)
      - [Q3: è§£é‡ŠReactçš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•](#q3-è§£é‡Šreactçš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•)
      - [Q4: ä»€ä¹ˆæ˜¯JSXï¼ŸJSXçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ](#q4-ä»€ä¹ˆæ˜¯jsxjsxçš„åŸç†æ˜¯ä»€ä¹ˆ)
      - [Q5: Reactä¸­çš„keyå±æ€§æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ](#q5-reactä¸­çš„keyå±æ€§æœ‰ä»€ä¹ˆä½œç”¨)
    - [10.2 ç»„ä»¶ä¸ç”Ÿå‘½å‘¨æœŸç±»](#102-ç»„ä»¶ä¸ç”Ÿå‘½å‘¨æœŸç±»)
      - [Q6: ç±»ç»„ä»¶å’Œå‡½æ•°ç»„ä»¶æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ](#q6-ç±»ç»„ä»¶å’Œå‡½æ•°ç»„ä»¶æœ‰ä»€ä¹ˆåŒºåˆ«)
      - [Q7: ä»€ä¹ˆæ˜¯é«˜é˜¶ç»„ä»¶(HOC)ï¼Ÿå¦‚ä½•å®ç°ï¼Ÿ](#q7-ä»€ä¹ˆæ˜¯é«˜é˜¶ç»„ä»¶hocå¦‚ä½•å®ç°)
      - [Q8: ä»€ä¹ˆæ˜¯Render Propsæ¨¡å¼ï¼Ÿ](#q8-ä»€ä¹ˆæ˜¯render-propsæ¨¡å¼)
    - [10.3 Hooks æ·±åº¦ç†è§£ç±»](#103-hooks-æ·±åº¦ç†è§£ç±»)
      - [Q9: useEffectçš„ä¾èµ–æ•°ç»„æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ](#q9-useeffectçš„ä¾èµ–æ•°ç»„æ˜¯å¦‚ä½•å·¥ä½œçš„)
      - [Q10: ä¸ºä»€ä¹ˆuseStateçš„æ›´æ–°æ˜¯å¼‚æ­¥çš„ï¼Ÿ](#q10-ä¸ºä»€ä¹ˆusestateçš„æ›´æ–°æ˜¯å¼‚æ­¥çš„)
    - [10.4 æ€§èƒ½ä¼˜åŒ–ç±»](#104-æ€§èƒ½ä¼˜åŒ–ç±»)
      - [Q11: Reactä¸­æœ‰å“ªäº›æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯ï¼Ÿ](#q11-reactä¸­æœ‰å“ªäº›æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯)
      - [Q12: ä»€ä¹ˆæ˜¯React Fiberï¼Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ](#q12-ä»€ä¹ˆæ˜¯react-fiberå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜)
    - [10.5 å®æˆ˜åº”ç”¨ç±»](#105-å®æˆ˜åº”ç”¨ç±»)
      - [Q13: å¦‚ä½•åœ¨Reactä¸­å®ç°çŠ¶æ€ç®¡ç†ï¼Ÿ](#q13-å¦‚ä½•åœ¨reactä¸­å®ç°çŠ¶æ€ç®¡ç†)
      - [Q14: å¦‚ä½•å¤„ç†Reactä¸­çš„é”™è¯¯è¾¹ç•Œï¼Ÿ](#q14-å¦‚ä½•å¤„ç†reactä¸­çš„é”™è¯¯è¾¹ç•Œ)
      - [Q15: Reactä¸­å¦‚ä½•å®ç°æ¡ä»¶æ¸²æŸ“ï¼Ÿ](#q15-reactä¸­å¦‚ä½•å®ç°æ¡ä»¶æ¸²æŸ“)
  - [ğŸ“š æ€»ç»“](#-æ€»ç»“)
    - [ğŸ¯ æ ¸å¿ƒå†…å®¹](#-æ ¸å¿ƒå†…å®¹)
    - [âœ… æŠ€æœ¯ç‰¹è‰²](#-æŠ€æœ¯ç‰¹è‰²)

## 1. React æ¦‚è¿°ä¸æ ¸å¿ƒæ¦‚å¿µ

### 1.1 React ç®€ä»‹

#### 1.1.1 React ç‰¹ç‚¹ä¸ä¼˜åŠ¿

**React**æ˜¯ç”±Facebookå¼€å‘çš„ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„JavaScriptåº“ï¼Œäº2013å¹´å¼€æºã€‚å®ƒé‡‡ç”¨ç»„ä»¶åŒ–å¼€å‘æ¨¡å¼ï¼Œé€šè¿‡è™šæ‹ŸDOMæå‡æ€§èƒ½ï¼Œæ˜¯ç°ä»£å‰ç«¯å¼€å‘çš„æ ¸å¿ƒæŠ€æœ¯ä¹‹ä¸€ã€‚

**æ ¸å¿ƒç‰¹ç‚¹**ï¼š

| ç‰¹ç‚¹ | æè¿° | ä¼˜åŠ¿ |
|------|------|------|
| **å£°æ˜å¼ç¼–ç¨‹** | æè¿°UIåº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­ | ä»£ç å¯è¯»æ€§å¼ºï¼Œæ˜“äºç†è§£ |
| **ç»„ä»¶åŒ–** | å°†UIåˆ†è§£ä¸ºç‹¬ç«‹çš„ç»„ä»¶ | ä»£ç å¤ç”¨æ€§é«˜ï¼Œç»´æŠ¤æ€§å¥½ |
| **è™šæ‹ŸDOM** | åœ¨å†…å­˜ä¸­æ“ä½œDOMå‰¯æœ¬ | æ€§èƒ½ä¼˜åŒ–ï¼Œå‡å°‘çœŸå®DOMæ“ä½œ |
| **å•å‘æ•°æ®æµ** | æ•°æ®ä»çˆ¶ç»„ä»¶æµå‘å­ç»„ä»¶ | æ•°æ®æµå‘æ¸…æ™°ï¼Œä¾¿äºè°ƒè¯• |
| **Learn Once, Write Anywhere** | ä¸€æ¬¡å­¦ä¹ ï¼Œéšå¤„ç¼–å†™ | æ”¯æŒWebã€ç§»åŠ¨ç«¯ã€æœåŠ¡ç«¯ |

**React æŠ€æœ¯æ ˆç”Ÿæ€**ï¼š

```mermaid
graph TB
    subgraph "React ç”Ÿæ€ç³»ç»Ÿ"
        subgraph "æ ¸å¿ƒåº“"
            REACT["React<br/>ç»„ä»¶åŒ–UIåº“"]
            REACTDOM["ReactDOM<br/>DOMæ¸²æŸ“å™¨"]
            JSX["JSX<br/>è¯­æ³•æ‰©å±•"]
        end
        
        subgraph "çŠ¶æ€ç®¡ç†"
            REDUX["Redux<br/>å¯é¢„æµ‹çŠ¶æ€å®¹å™¨"]
            MOBX["MobX<br/>å“åº”å¼çŠ¶æ€ç®¡ç†"]
            ZUSTAND["Zustand<br/>è½»é‡çŠ¶æ€ç®¡ç†"]
            CONTEXT["Context API<br/>å†…ç½®çŠ¶æ€å…±äº«"]
        end
        
        subgraph "è·¯ç”±å¯¼èˆª"
            ROUTER["React Router<br/>å®¢æˆ·ç«¯è·¯ç”±"]
            REACH["Reach Router<br/>å·²åˆå¹¶åˆ°React Router"]
        end
        
        subgraph "å¼€å‘å·¥å…·"
            CRA["Create React App<br/>é›¶é…ç½®è„šæ‰‹æ¶"]
            NEXT["Next.js<br/>å…¨æ ˆæ¡†æ¶"]
            VITE["Vite<br/>å¿«é€Ÿæ„å»ºå·¥å…·"]
        end
        
        subgraph "UIç»„ä»¶åº“"
            ANTD["Ant Design<br/>ä¼ä¸šçº§UI"]
            MUI["Material-UI<br/>Material Design"]
            CHAKRA["Chakra UI<br/>ç®€å•æ¨¡å—åŒ–"]
        end
    end
    
    REACT --> REACTDOM
    REACT --> JSX
    REACT --> REDUX
    REACT --> ROUTER
    CRA --> REACT
    NEXT --> REACT
```

#### 1.1.2 React ç”Ÿæ€ç³»ç»Ÿ

**æŠ€æœ¯æ ˆå¯¹æ¯”**ï¼š

| æŠ€æœ¯åˆ†ç±» | ä¸»æµé€‰æ‹© | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|----------|----------|------|----------|
| **çŠ¶æ€ç®¡ç†** | Redux, Zustand, Jotai | å„æœ‰ä¼˜åŠ¿ | å¤æ‚åº”ç”¨vsç®€å•çŠ¶æ€ |
| **è·¯ç”±ç®¡ç†** | React Router v6 | å£°æ˜å¼è·¯ç”± | SPAåº”ç”¨å¯¼èˆª |
| **æ ·å¼æ–¹æ¡ˆ** | CSS Modules, Styled-components, Tailwind | ç»„ä»¶åŒ–æ ·å¼ | æ ·å¼éš”ç¦»ä¸å¤ç”¨ |
| **æ„å»ºå·¥å…·** | Vite, Webpack, Parcel | å¿«é€Ÿå¼€å‘ | å¼€å‘ä½“éªŒä¼˜åŒ– |
| **æµ‹è¯•æ¡†æ¶** | Jest, React Testing Library | æµ‹è¯•å‹å¥½ | ä¿è¯ä»£ç è´¨é‡ |

### 1.2 æ ¸å¿ƒæ¦‚å¿µ

#### 1.2.1 è™šæ‹ŸDOMåŸç†

**è™šæ‹ŸDOM**æ˜¯Reactçš„æ ¸å¿ƒåˆ›æ–°ä¹‹ä¸€ï¼Œå®ƒæ˜¯çœŸå®DOMçš„JavaScriptè¡¨ç¤ºã€‚

**è™šæ‹ŸDOMå·¥ä½œæµç¨‹**ï¼š

```mermaid
graph TB
    subgraph "è™šæ‹ŸDOMå·¥ä½œåŸç†"
        STATE["çŠ¶æ€å˜åŒ–<br/>State Change"]
        
        subgraph "è™šæ‹ŸDOMå¤„ç†"
            VDOM_NEW["åˆ›å»ºæ–°è™šæ‹ŸDOM<br/>New Virtual DOM Tree"]
            VDOM_OLD["æ—§è™šæ‹ŸDOM<br/>Previous Virtual DOM Tree"]
            DIFF["Diffç®—æ³•<br/>æ‰¾å‡ºå·®å¼‚"]
        end
        
        subgraph "DOMæ›´æ–°"
            PATCH["Patchè¿‡ç¨‹<br/>åº”ç”¨å˜æ›´"]
            REAL_DOM["çœŸå®DOM<br/>Real DOM"]
        end
        
        RENDER["é‡æ–°æ¸²æŸ“<br/>Re-render"]
    end
    
    STATE --> VDOM_NEW
    VDOM_NEW --> DIFF
    VDOM_OLD --> DIFF
    DIFF --> PATCH
    PATCH --> REAL_DOM
    REAL_DOM --> RENDER
```

**è™šæ‹ŸDOMä¼˜åŠ¿**ï¼š

1. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - æ‰¹é‡æ›´æ–°ï¼Œå‡å°‘DOMæ“ä½œ
   - Diffç®—æ³•ä¼˜åŒ–æ›´æ–°èŒƒå›´
   - å¼‚æ­¥æ›´æ–°ï¼Œä¸é˜»å¡ç”¨æˆ·äº¤äº’

2. **å¼€å‘ä½“éªŒ**ï¼š
   - å£°æ˜å¼ç¼–ç¨‹æ¨¡å¼
   - è·¨å¹³å°æŠ½è±¡å±‚
   - æ›´å¥½çš„é”™è¯¯è¾¹ç•Œå¤„ç†

**ç®€åŒ–çš„è™šæ‹ŸDOMå®ç°**ï¼š

```javascript
// è™šæ‹ŸDOMèŠ‚ç‚¹ç»“æ„
const VNode = {
  type: 'div',           // å…ƒç´ ç±»å‹
  props: {               // å±æ€§
    className: 'container',
    children: [
      {
        type: 'span',
        props: {
          children: 'Hello World'
        }
      }
    ]
  }
};

// ç®€åŒ–çš„Diffç®—æ³•
function diff(oldVNode, newVNode) {
  // èŠ‚ç‚¹ç±»å‹ä¸åŒï¼Œç›´æ¥æ›¿æ¢
  if (oldVNode.type !== newVNode.type) {
    return { type: 'REPLACE', newVNode };
  }
  
  // æ¯”è¾ƒå±æ€§
  const propsPatches = diffProps(oldVNode.props, newVNode.props);
  
  // æ¯”è¾ƒå­èŠ‚ç‚¹
  const childrenPatches = diffChildren(
    oldVNode.props.children, 
    newVNode.props.children
  );
  
  return {
    type: 'UPDATE',
    propsPatches,
    childrenPatches
  };
}

// åº”ç”¨è¡¥ä¸åˆ°çœŸå®DOM
function patch(domNode, patches) {
  switch (patches.type) {
    case 'REPLACE':
      domNode.parentNode.replaceChild(
        createElement(patches.newVNode), 
        domNode
      );
      break;
    case 'UPDATE':
      updateProps(domNode, patches.propsPatches);
      patches.childrenPatches.forEach((patch, index) => {
        patch(domNode.childNodes[index], patch);
      });
      break;
  }
}
```

#### 1.2.2 ç»„ä»¶åŒ–æ€æƒ³

**ç»„ä»¶åŒ–**æ˜¯Reactçš„æ ¸å¿ƒè®¾è®¡ç†å¿µï¼Œå°†UIæ‹†åˆ†ä¸ºç‹¬ç«‹ã€å¯å¤ç”¨çš„ç»„ä»¶ã€‚

**ç»„ä»¶åŒ–æ¶æ„ä¼˜åŠ¿**ï¼š

```mermaid
graph TB
    subgraph "ç»„ä»¶åŒ–å¼€å‘æ¨¡å¼"
        subgraph "ä¼ ç»Ÿå¼€å‘"
            HTML["HTMLç»“æ„"]
            CSS["CSSæ ·å¼"]
            JS["JavaScripté€»è¾‘"]
        end
        
        subgraph "ç»„ä»¶åŒ–å¼€å‘"
            COMPONENT["ç»„ä»¶<br/>Component"]
            subgraph "ç»„ä»¶å†…éƒ¨"
                TEMPLATE["æ¨¡æ¿<br/>JSX"]
                STYLE["æ ·å¼<br/>CSS-in-JS"]
                LOGIC["é€»è¾‘<br/>Hooks/Methods"]
                STATE["çŠ¶æ€<br/>State"]
            end
        end
        
        subgraph "ç»„ä»¶ç‰¹æ€§"
            REUSE["å¯å¤ç”¨<br/>Reusable"]
            MAINTAIN["æ˜“ç»´æŠ¤<br/>Maintainable"]
            TEST["å¯æµ‹è¯•<br/>Testable"]
            COMPOSE["å¯ç»„åˆ<br/>Composable"]
        end
    end
    
    HTML --> COMPONENT
    CSS --> COMPONENT
    JS --> COMPONENT
    
    COMPONENT --> TEMPLATE
    COMPONENT --> STYLE
    COMPONENT --> LOGIC
    COMPONENT --> STATE
    
    COMPONENT --> REUSE
    COMPONENT --> MAINTAIN
    COMPONENT --> TEST
    COMPONENT --> COMPOSE
```

**ç»„ä»¶è®¾è®¡åŸåˆ™**ï¼š

1. **å•ä¸€èŒè´£åŸåˆ™**ï¼š
   ```javascript
   // âœ… å¥½çš„è®¾è®¡ï¼šèŒè´£å•ä¸€
   const UserAvatar = ({ user }) => (
     <img src={user.avatar} alt={user.name} className="avatar" />
   );
   
   const UserInfo = ({ user }) => (
     <div className="user-info">
       <UserAvatar user={user} />
       <span>{user.name}</span>
     </div>
   );
   
   // âŒ ä¸å¥½çš„è®¾è®¡ï¼šèŒè´£æ··æ‚
   const UserComponent = ({ user, posts, comments }) => (
     <div>
       <img src={user.avatar} alt={user.name} />
       <span>{user.name}</span>
       <div>{posts.map(post => <PostItem post={post} />)}</div>
       <div>{comments.map(comment => <Comment comment={comment} />)}</div>
     </div>
   );
   ```

2. **ç»„ä»¶ç»„åˆ**ï¼š
   ```javascript
   // é«˜é˜¶ç»„ä»¶æ¨¡å¼
   const withLoading = (WrappedComponent) => {
     return ({ isLoading, ...props }) => {
       if (isLoading) {
         return <div>Loading...</div>;
       }
       return <WrappedComponent {...props} />;
     };
   };
   
   // ç»„åˆä½¿ç”¨
   const UserList = withLoading(({ users }) => (
     <div>
       {users.map(user => <UserInfo key={user.id} user={user} />)}
     </div>
   ));
   ```

#### 1.2.3 å•å‘æ•°æ®æµ

**å•å‘æ•°æ®æµ**ç¡®ä¿æ•°æ®æµå‘çš„å¯é¢„æµ‹æ€§ï¼Œæ˜¯Reactæ¶æ„çš„é‡è¦ç‰¹å¾ã€‚

**æ•°æ®æµå‘ç¤ºæ„**ï¼š

```mermaid
graph TB
    subgraph "Reactå•å‘æ•°æ®æµ"
        subgraph "çˆ¶ç»„ä»¶"
            PARENT_STATE["çˆ¶ç»„ä»¶çŠ¶æ€<br/>Parent State"]
            PARENT_PROPS["å‘ä¸‹ä¼ é€’Props<br/>Pass Props Down"]
        end
        
        subgraph "å­ç»„ä»¶"
            CHILD_PROPS["æ¥æ”¶Props<br/>Receive Props"]
            CHILD_EVENT["è§¦å‘äº‹ä»¶<br/>Trigger Events"]
        end
        
        subgraph "æ•°æ®æ›´æ–°"
            CALLBACK["å›è°ƒå‡½æ•°<br/>Callback Functions"]
            STATE_UPDATE["çŠ¶æ€æ›´æ–°<br/>State Update"]
        end
    end
    
    PARENT_STATE --> PARENT_PROPS
    PARENT_PROPS --> CHILD_PROPS
    CHILD_PROPS --> CHILD_EVENT
    CHILD_EVENT --> CALLBACK
    CALLBACK --> STATE_UPDATE
    STATE_UPDATE --> PARENT_STATE
```

**å•å‘æ•°æ®æµç¤ºä¾‹**ï¼š

```javascript
// çˆ¶ç»„ä»¶ï¼šç®¡ç†çŠ¶æ€
const TodoApp = () => {
  const [todos, setTodos] = useState([]);
  const [filter, setFilter] = useState('all');
  
  const addTodo = (text) => {
    setTodos([...todos, { id: Date.now(), text, completed: false }]);
  };
  
  const toggleTodo = (id) => {
    setTodos(todos.map(todo => 
      todo.id === id ? { ...todo, completed: !todo.completed } : todo
    ));
  };
  
  const filteredTodos = todos.filter(todo => {
    if (filter === 'active') return !todo.completed;
    if (filter === 'completed') return todo.completed;
    return true;
  });
  
  return (
    <div>
      <TodoInput onAddTodo={addTodo} />
      <TodoList todos={filteredTodos} onToggleTodo={toggleTodo} />
      <TodoFilter filter={filter} onFilterChange={setFilter} />
    </div>
  );
};

// å­ç»„ä»¶ï¼šæ¥æ”¶propsï¼Œè§¦å‘å›è°ƒ
const TodoInput = ({ onAddTodo }) => {
  const [text, setText] = useState('');
  
  const handleSubmit = (e) => {
    e.preventDefault();
    if (text.trim()) {
      onAddTodo(text.trim());  // å‘ä¸Šé€šä¿¡
      setText('');
    }
  };
  
  return (
    <form onSubmit={handleSubmit}>
      <input 
        value={text}
        onChange={(e) => setText(e.target.value)}
        placeholder="What needs to be done?"
      />
      <button type="submit">Add</button>
    </form>
  );
};

const TodoList = ({ todos, onToggleTodo }) => (
  <ul>
    {todos.map(todo => (
      <TodoItem 
        key={todo.id} 
        todo={todo} 
        onToggle={() => onToggleTodo(todo.id)}
      />
    ))}
  </ul>
);

const TodoItem = ({ todo, onToggle }) => (
  <li 
    onClick={onToggle}
    style={{ 
      textDecoration: todo.completed ? 'line-through' : 'none' 
    }}
  >
    {todo.text}
  </li>
);
```

### 1.3 React æ¶æ„æ¼”è¿›

#### 1.3.1 ä»ç±»ç»„ä»¶åˆ°å‡½æ•°ç»„ä»¶

**ç»„ä»¶å‘å±•å†ç¨‹**ï¼š

```mermaid
graph LR
    subgraph "Reactç»„ä»¶æ¼”è¿›"
        subgraph "React 15.x"
            CLASS_OLD["ç±»ç»„ä»¶<br/>Class Components"]
            MIXIN["Mixins<br/>å·²åºŸå¼ƒ"]
        end
        
        subgraph "React 16.x"
            CLASS_NEW["ç±»ç»„ä»¶<br/>ç”Ÿå‘½å‘¨æœŸä¼˜åŒ–"]
            FUNCTION_BASIC["å‡½æ•°ç»„ä»¶<br/>æ— çŠ¶æ€ç»„ä»¶"]
            HOC["é«˜é˜¶ç»„ä»¶<br/>HOC"]
            RENDER_PROPS["Render Props<br/>æ¸²æŸ“å±æ€§"]
        end
        
        subgraph "React 16.8+"
            HOOKS["Hooks<br/>çŠ¶æ€é€»è¾‘å¤ç”¨"]
            FUNCTION_FULL["å‡½æ•°ç»„ä»¶<br/>å®Œæ•´åŠŸèƒ½"]
            CUSTOM_HOOKS["è‡ªå®šä¹‰Hooks<br/>é€»è¾‘æŠ½è±¡"]
        end
    end
    
    CLASS_OLD --> CLASS_NEW
    MIXIN --> HOC
    CLASS_NEW --> HOOKS
    FUNCTION_BASIC --> FUNCTION_FULL
    HOC --> CUSTOM_HOOKS
    RENDER_PROPS --> CUSTOM_HOOKS
```

**ç±»ç»„ä»¶ vs å‡½æ•°ç»„ä»¶å¯¹æ¯”**ï¼š

| æ–¹é¢ | ç±»ç»„ä»¶ | å‡½æ•°ç»„ä»¶ + Hooks |
|------|--------|------------------|
| **è¯­æ³•** | classè¯­æ³•ï¼Œthisç»‘å®š | å‡½æ•°è¯­æ³•ï¼Œæ›´ç®€æ´ |
| **çŠ¶æ€ç®¡ç†** | this.state | useState Hook |
| **ç”Ÿå‘½å‘¨æœŸ** | ç”Ÿå‘½å‘¨æœŸæ–¹æ³• | useEffect Hook |
| **æ€§èƒ½** | shouldComponentUpdate | React.memo |
| **é€»è¾‘å¤ç”¨** | HOC, Render Props | è‡ªå®šä¹‰Hooks |
| **ä»£ç é‡** | ç›¸å¯¹è¾ƒå¤š | æ›´ç®€æ´ |
| **å­¦ä¹ æˆæœ¬** | thisç»‘å®šå¤æ‚ | æ›´ç›´è§‚ |

**è¿ç§»ç¤ºä¾‹**ï¼š

```javascript
// ç±»ç»„ä»¶å†™æ³•
class UserProfile extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      user: null,
      loading: true,
      error: null
    };
  }
  
  async componentDidMount() {
    try {
      const user = await fetchUser(this.props.userId);
      this.setState({ user, loading: false });
    } catch (error) {
      this.setState({ error, loading: false });
    }
  }
  
  async componentDidUpdate(prevProps) {
    if (prevProps.userId !== this.props.userId) {
      this.setState({ loading: true });
      try {
        const user = await fetchUser(this.props.userId);
        this.setState({ user, loading: false });
      } catch (error) {
        this.setState({ error, loading: false });
      }
    }
  }
  
  render() {
    const { user, loading, error } = this.state;
    
    if (loading) return <div>Loading...</div>;
    if (error) return <div>Error: {error.message}</div>;
    if (!user) return <div>No user found</div>;
    
    return (
      <div>
        <h1>{user.name}</h1>
        <p>{user.email}</p>
      </div>
    );
  }
}

// å‡½æ•°ç»„ä»¶ + Hookså†™æ³•
const UserProfile = ({ userId }) => {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  
  useEffect(() => {
    const loadUser = async () => {
      setLoading(true);
      setError(null);
      
      try {
        const userData = await fetchUser(userId);
        setUser(userData);
      } catch (err) {
        setError(err);
      } finally {
        setLoading(false);
      }
    };
    
    loadUser();
  }, [userId]);
  
  if (loading) return <div>Loading...</div>;
  if (error) return <div>Error: {error.message}</div>;
  if (!user) return <div>No user found</div>;
  
  return (
    <div>
      <h1>{user.name}</h1>
      <p>{user.email}</p>
    </div>
  );
};

// è¿›ä¸€æ­¥ä¼˜åŒ–ï¼šè‡ªå®šä¹‰Hook
const useUser = (userId) => {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  
  useEffect(() => {
    const loadUser = async () => {
      setLoading(true);
      setError(null);
      
      try {
        const userData = await fetchUser(userId);
        setUser(userData);
      } catch (err) {
        setError(err);
      } finally {
        setLoading(false);
      }
    };
    
    loadUser();
  }, [userId]);
  
  return { user, loading, error };
};

// ä½¿ç”¨è‡ªå®šä¹‰Hook
const UserProfile = ({ userId }) => {
  const { user, loading, error } = useUser(userId);
  
  if (loading) return <div>Loading...</div>;
  if (error) return <div>Error: {error.message}</div>;
  if (!user) return <div>No user found</div>;
  
  return (
    <div>
      <h1>{user.name}</h1>
      <p>{user.email}</p>
    </div>
  );
};
```

#### 1.3.2 Fiber æ¶æ„åŸç†

**Fiberæ¶æ„**æ˜¯React 16å¼•å…¥çš„æ–°è°ƒå’Œå¼•æ“ï¼Œè§£å†³äº†åŸæœ‰æ¶æ„çš„æ€§èƒ½é—®é¢˜ã€‚

**Fiberæ¶æ„ä¼˜åŠ¿**ï¼š

```mermaid
graph TB
    subgraph "Fiberæ¶æ„æ ¸å¿ƒç‰¹æ€§"
        subgraph "æ—¶é—´åˆ‡ç‰‡"
            TIME_SLICE["æ—¶é—´åˆ‡ç‰‡<br/>Time Slicing"]
            INTERRUPT["å¯ä¸­æ–­æ¸²æŸ“<br/>Interruptible Rendering"]
            PRIORITY["ä¼˜å…ˆçº§è°ƒåº¦<br/>Priority Scheduling"]
        end
        
        subgraph "å¹¶å‘ç‰¹æ€§"
            CONCURRENT["å¹¶å‘æ¨¡å¼<br/>Concurrent Mode"]
            SUSPENSE["Suspense<br/>å¼‚æ­¥æ¸²æŸ“"]
            BATCH["æ‰¹é‡æ›´æ–°<br/>Batched Updates"]
        end
        
        subgraph "æ€§èƒ½ä¼˜åŒ–"
            INCREMENTAL["å¢é‡æ¸²æŸ“<br/>Incremental Rendering"]
            YIELDING["ä¸»åŠ¨è®©æ­¥<br/>Cooperative Yielding"]
            SMOOTH["æµç•…ä½“éªŒ<br/>Smooth UX"]
        end
    end
    
    TIME_SLICE --> CONCURRENT
    INTERRUPT --> SUSPENSE
    PRIORITY --> BATCH
    
    CONCURRENT --> INCREMENTAL
    SUSPENSE --> YIELDING
    BATCH --> SMOOTH
```

**FiberèŠ‚ç‚¹ç»“æ„**ï¼š

```javascript
// FiberèŠ‚ç‚¹çš„ç®€åŒ–ç»“æ„
const FiberNode = {
  // èŠ‚ç‚¹ä¿¡æ¯
  type: 'div',                    // ç»„ä»¶ç±»å‹
  key: 'unique-key',              // React key
  elementType: 'div',             // å…ƒç´ ç±»å‹
  
  // çŠ¶æ€ä¿¡æ¯
  pendingProps: {},               // æ–°çš„props
  memoizedProps: {},              // ä¸Šæ¬¡æ¸²æŸ“çš„props
  memoizedState: null,            // ä¸Šæ¬¡æ¸²æŸ“çš„state
  updateQueue: null,              // æ›´æ–°é˜Ÿåˆ—
  
  // å‰¯ä½œç”¨
  effectTag: 0,                   // å‰¯ä½œç”¨æ ‡è®°
  nextEffect: null,               // ä¸‹ä¸€ä¸ªæœ‰å‰¯ä½œç”¨çš„èŠ‚ç‚¹
  firstEffect: null,              // ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹å‰¯ä½œç”¨
  lastEffect: null,               // æœ€åä¸€ä¸ªå­èŠ‚ç‚¹å‰¯ä½œç”¨
  
  // ä¼˜å…ˆçº§
  lanes: 0,                       // ä¼˜å…ˆçº§è½¦é“
  childLanes: 0,                  // å­èŠ‚ç‚¹ä¼˜å…ˆçº§
  
  // èŠ‚ç‚¹å…³ç³»
  return: null,                   // çˆ¶èŠ‚ç‚¹
  child: null,                    // ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹
  sibling: null,                  // å…„å¼ŸèŠ‚ç‚¹
  index: 0,                       // ç´¢å¼•
  
  // å…¶ä»–
  ref: null,                      // refå¼•ç”¨
  alternate: null,                // åŒç¼“å­˜æœºåˆ¶çš„å¦ä¸€ä¸ªfiber
};

// Fiberå·¥ä½œå¾ªç¯
function workLoopConcurrent() {
  // å¦‚æœè¿˜æœ‰å·¥ä½œè¦åšä¸”æ²¡æœ‰è¢«ä¸­æ–­
  while (workInProgress !== null && !shouldYield()) {
    workInProgress = performUnitOfWork(workInProgress);
  }
}

function performUnitOfWork(unitOfWork) {
  const current = unitOfWork.alternate;
  
  // å¼€å§‹å·¥ä½œ
  let next = beginWork(current, unitOfWork, renderLanes);
  
  unitOfWork.memoizedProps = unitOfWork.pendingProps;
  
  if (next === null) {
    // å¦‚æœæ²¡æœ‰å­èŠ‚ç‚¹ï¼Œå®Œæˆå·¥ä½œ
    completeUnitOfWork(unitOfWork);
  } else {
    workInProgress = next;
  }
  
  return next;
}
```

**ä¼˜å…ˆçº§è°ƒåº¦ç³»ç»Ÿ**ï¼š

```javascript
// Reactä¼˜å…ˆçº§ç­‰çº§
const ImmediatePriority = 1;      // ç«‹å³æ‰§è¡Œï¼ˆç”¨æˆ·è¾“å…¥ï¼‰
const UserBlockingPriority = 2;   // ç”¨æˆ·é˜»å¡ï¼ˆhoverã€æ»šåŠ¨ï¼‰
const NormalPriority = 3;         // æ­£å¸¸ä¼˜å…ˆçº§ï¼ˆæ•°æ®è·å–ï¼‰
const LowPriority = 4;            // ä½ä¼˜å…ˆçº§ï¼ˆåˆ†æï¼‰
const IdlePriority = 5;           // ç©ºé—²ä¼˜å…ˆçº§ï¼ˆç¦»å±å†…å®¹ï¼‰

// è°ƒåº¦å™¨å¦‚ä½•å·¥ä½œ
function scheduleWork(fiber, expirationTime) {
  const root = markUpdateTimeFromFiberToRoot(fiber, expirationTime);
  
  if (root === null) return;
  
  // æ£€æŸ¥æ˜¯å¦æœ‰æ›´é«˜ä¼˜å…ˆçº§çš„å·¥ä½œ
  if (expirationTime === Sync) {
    // åŒæ­¥æ›´æ–°
    performSyncWorkOnRoot(root);
  } else {
    // å¼‚æ­¥æ›´æ–°
    ensureRootIsScheduled(root, getCurrentTime());
  }
}

// æ—¶é—´åˆ‡ç‰‡æœºåˆ¶
function shouldYield() {
  const currentTime = getCurrentTime();
  return currentTime >= deadline;
}
```

## 2. ç»„ä»¶åŸºç¡€ä¸ç”Ÿå‘½å‘¨æœŸ

### 2.1 ç»„ä»¶å®šä¹‰ä¸ä½¿ç”¨

#### 2.1.1 å‡½æ•°ç»„ä»¶

**å‡½æ•°ç»„ä»¶**æ˜¯Reactçš„æ¨èç»„ä»¶å†™æ³•ï¼Œè¯­æ³•ç®€æ´ï¼Œé…åˆHooksä½¿ç”¨åŠŸèƒ½å¼ºå¤§ã€‚

**åŸºç¡€å‡½æ•°ç»„ä»¶**ï¼š

```javascript
// åŸºç¡€å‡½æ•°ç»„ä»¶
const Welcome = (props) => {
  return <h1>Hello, {props.name}!</h1>;
};

// ç®­å¤´å‡½æ•°ç®€å†™
const Welcome = ({ name }) => <h1>Hello, {name}!</h1>;

// ä¼ ç»Ÿå‡½æ•°å£°æ˜
function Welcome(props) {
  return <h1>Hello, {props.name}!</h1>;
}

// å¸¦é»˜è®¤props
const Welcome = ({ name = 'World' }) => <h1>Hello, {name}!</h1>;

// ä½¿ç”¨ç»„ä»¶
const App = () => (
  <div>
    <Welcome name="Alice" />
    <Welcome name="Bob" />
    <Welcome />
  </div>
);
```

**å‡½æ•°ç»„ä»¶é«˜çº§æ¨¡å¼**ï¼š

```javascript
// 1. ç»„ä»¶ä½œä¸ºprops
const Layout = ({ header, content, footer }) => (
  <div className="layout">
    <header>{header}</header>
    <main>{content}</main>
    <footer>{footer}</footer>
  </div>
);

// ä½¿ç”¨
<Layout
  header={<Header />}
  content={<MainContent />}
  footer={<Footer />}
/>

// 2. childrenæ¨¡å¼
const Card = ({ title, children }) => (
  <div className="card">
    <h2>{title}</h2>
    <div className="card-body">
      {children}
    </div>
  </div>
);

// ä½¿ç”¨
<Card title="ç”¨æˆ·ä¿¡æ¯">
  <p>å§“åï¼šå¼ ä¸‰</p>
  <p>é‚®ç®±ï¼šzhangsan@example.com</p>
</Card>

// 3. render propsæ¨¡å¼
const DataProvider = ({ children, url }) => {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    fetch(url)
      .then(response => response.json())
      .then(data => {
        setData(data);
        setLoading(false);
      });
  }, [url]);
  
  return children({ data, loading });
};

// ä½¿ç”¨
<DataProvider url="/api/users">
  {({ data, loading }) => 
    loading ? <div>Loading...</div> : <UserList users={data} />
  }
</DataProvider>
```

#### 2.1.2 ç±»ç»„ä»¶

**ç±»ç»„ä»¶**æ˜¯Reactçš„ä¼ ç»Ÿç»„ä»¶å†™æ³•ï¼Œè™½ç„¶å‡½æ•°ç»„ä»¶æ˜¯è¶‹åŠ¿ï¼Œä½†ç†è§£ç±»ç»„ä»¶ä»ç„¶é‡è¦ã€‚

```javascript
// åŸºç¡€ç±»ç»„ä»¶
class Welcome extends React.Component {
  render() {
    return <h1>Hello, {this.props.name}!</h1>;
  }
}

// å¸¦çŠ¶æ€çš„ç±»ç»„ä»¶
class Counter extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      count: 0
    };
    
    // ç»‘å®šthis
    this.handleClick = this.handleClick.bind(this);
  }
  
  handleClick() {
    this.setState({ count: this.state.count + 1 });
  }
  
  render() {
    return (
      <div>
        <p>Count: {this.state.count}</p>
        <button onClick={this.handleClick}>+1</button>
      </div>
    );
  }
}

// ç®­å¤´å‡½æ•°é¿å…thisç»‘å®š
class Counter extends React.Component {
  state = { count: 0 };
  
  handleClick = () => {
    this.setState({ count: this.state.count + 1 });
  }
  
  render() {
    return (
      <div>
        <p>Count: {this.state.count}</p>
        <button onClick={this.handleClick}>+1</button>
      </div>
    );
  }
}
```

#### 2.1.3 ç»„ä»¶é€šä¿¡

**ç»„ä»¶é€šä¿¡**æ˜¯Reactåº”ç”¨çš„æ ¸å¿ƒï¼ŒåŒ…æ‹¬çˆ¶å­é€šä¿¡ã€å…„å¼Ÿé€šä¿¡ã€è·¨çº§é€šä¿¡ç­‰ã€‚

**ç»„ä»¶é€šä¿¡æ¨¡å¼**ï¼š

```mermaid
graph TB
    subgraph "Reactç»„ä»¶é€šä¿¡æ–¹å¼"
        subgraph "çˆ¶å­é€šä¿¡"
            PROPS["Propsä¼ é€’<br/>çˆ¶â†’å­"]
            CALLBACK["å›è°ƒå‡½æ•°<br/>å­â†’çˆ¶"]
        end
        
        subgraph "è·¨çº§é€šä¿¡"
            CONTEXT["Context API<br/>è·¨å±‚çº§"]
            REDUX["Redux<br/>å…¨å±€çŠ¶æ€"]
        end
        
        subgraph "å…„å¼Ÿé€šä¿¡"
            LIFT_STATE["çŠ¶æ€æå‡<br/>å…±åŒçˆ¶ç»„ä»¶"]
            EVENT_BUS["äº‹ä»¶æ€»çº¿<br/>å‘å¸ƒè®¢é˜…"]
        end
        
        subgraph "é«˜çº§é€šä¿¡"
            REF["Refå¼•ç”¨<br/>ç›´æ¥è°ƒç”¨"]
            PORTAL["Portal<br/>è·¨DOMæ ‘"]
        end
    end
    
    PROPS --> CALLBACK
    LIFT_STATE --> PROPS
    CONTEXT --> PROPS
    REDUX --> PROPS
```

**é€šä¿¡ç¤ºä¾‹ä»£ç **ï¼š

```javascript
// 1. çˆ¶å­é€šä¿¡
const Parent = () => {
  const [message, setMessage] = useState('Hello from Parent');
  
  const handleChildMessage = (childMessage) => {
    console.log('æ”¶åˆ°å­ç»„ä»¶æ¶ˆæ¯:', childMessage);
  };
  
  return (
    <div>
      <Child 
        message={message} 
        onMessage={handleChildMessage}
      />
    </div>
  );
};

const Child = ({ message, onMessage }) => {
  const sendMessage = () => {
    onMessage('Hello from Child');
  };
  
  return (
    <div>
      <p>çˆ¶ç»„ä»¶æ¶ˆæ¯: {message}</p>
      <button onClick={sendMessage}>å‘çˆ¶ç»„ä»¶å‘æ¶ˆæ¯</button>
    </div>
  );
};

// 2. Context APIè·¨çº§é€šä¿¡
const ThemeContext = React.createContext('light');

const App = () => {
  const [theme, setTheme] = useState('light');
  
  return (
    <ThemeContext.Provider value={{ theme, setTheme }}>
      <Header />
      <Main />
      <Footer />
    </ThemeContext.Provider>
  );
};

const ThemeButton = () => {
  const { theme, setTheme } = useContext(ThemeContext);
  
  return (
    <button onClick={() => setTheme(theme === 'light' ? 'dark' : 'light')}>
      åˆ‡æ¢åˆ°{theme === 'light' ? 'æš—' : 'äº®'}è‰²ä¸»é¢˜
    </button>
  );
};

// 3. è‡ªå®šä¹‰Hookå®ç°çŠ¶æ€å…±äº«
const useSharedState = (initialValue) => {
  const [state, setState] = useState(initialValue);
  
  const updateState = useCallback((newState) => {
    setState(newState);
  }, []);
  
  return [state, updateState];
};

// 4. Refé€šä¿¡
const Parent = () => {
  const childRef = useRef();
  
  const callChildMethod = () => {
    childRef.current.focus();
  };
  
  return (
    <div>
      <Child ref={childRef} />
      <button onClick={callChildMethod}>Focus Child</button>
    </div>
  );
};

const Child = forwardRef((props, ref) => {
  const inputRef = useRef();
  
  useImperativeHandle(ref, () => ({
    focus: () => {
      inputRef.current.focus();
    }
  }));
  
  return <input ref={inputRef} />;
});
```

### 2.2 ç”Ÿå‘½å‘¨æœŸè¯¦è§£

#### 2.2.1 æŒ‚è½½é˜¶æ®µ

**ç»„ä»¶æŒ‚è½½**æ˜¯ç»„ä»¶ä»åˆ›å»ºåˆ°æ’å…¥DOMçš„è¿‡ç¨‹ã€‚

**ç”Ÿå‘½å‘¨æœŸæµç¨‹**ï¼š

```mermaid
graph TB
    subgraph "Reactç”Ÿå‘½å‘¨æœŸï¼ˆç±»ç»„ä»¶ï¼‰"
        subgraph "æŒ‚è½½é˜¶æ®µ Mounting"
            CONSTRUCTOR["constructor()<br/>æ„é€ å‡½æ•°"]
            GET_DERIVED["getDerivedStateFromProps()<br/>ä»propsè·å–state"]
            RENDER["render()<br/>æ¸²æŸ“"]
            DID_MOUNT["componentDidMount()<br/>æŒ‚è½½å®Œæˆ"]
        end
        
        subgraph "æ›´æ–°é˜¶æ®µ Updating"
            GET_DERIVED_UPDATE["getDerivedStateFromProps()"]
            SHOULD_UPDATE["shouldComponentUpdate()<br/>æ˜¯å¦åº”è¯¥æ›´æ–°"]
            RENDER_UPDATE["render()"]
            GET_SNAPSHOT["getSnapshotBeforeUpdate()<br/>æ›´æ–°å‰å¿«ç…§"]
            DID_UPDATE["componentDidUpdate()<br/>æ›´æ–°å®Œæˆ"]
        end
        
        subgraph "å¸è½½é˜¶æ®µ Unmounting"
            WILL_UNMOUNT["componentWillUnmount()<br/>å³å°†å¸è½½"]
        end
    end
    
    CONSTRUCTOR --> GET_DERIVED
    GET_DERIVED --> RENDER
    RENDER --> DID_MOUNT
    
    DID_MOUNT --> GET_DERIVED_UPDATE
    GET_DERIVED_UPDATE --> SHOULD_UPDATE
    SHOULD_UPDATE --> RENDER_UPDATE
    RENDER_UPDATE --> GET_SNAPSHOT
    GET_SNAPSHOT --> DID_UPDATE
    DID_UPDATE --> GET_DERIVED_UPDATE
    
    DID_UPDATE --> WILL_UNMOUNT
```

**ç”Ÿå‘½å‘¨æœŸä¸Hookså¯¹åº”å…³ç³»**ï¼š

| ç±»ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ | Hooksç­‰ä»·å†™æ³• | ç”¨é€” |
|----------------|---------------|------|
| `constructor` | `useState`åˆå§‹å€¼ | åˆå§‹åŒ–çŠ¶æ€ |
| `componentDidMount` | `useEffect(fn, [])` | ç»„ä»¶æŒ‚è½½å |
| `componentDidUpdate` | `useEffect(fn)` | ç»„ä»¶æ›´æ–°å |
| `componentWillUnmount` | `useEffect(() => fn, [])` | ç»„ä»¶å¸è½½å‰ |
| `shouldComponentUpdate` | `React.memo` | æ€§èƒ½ä¼˜åŒ– |
| `getDerivedStateFromProps` | `useState` + `useEffect` | ä»propsè®¡ç®—state |

**Hooksç”Ÿå‘½å‘¨æœŸç¤ºä¾‹**ï¼š

```javascript
// ç±»ç»„ä»¶å†™æ³•
class UserProfile extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      user: null,
      loading: true
    };
  }
  
  async componentDidMount() {
    console.log('ç»„ä»¶æŒ‚è½½');
    this.setState({ loading: true });
    const user = await fetchUser(this.props.userId);
    this.setState({ user, loading: false });
  }
  
  async componentDidUpdate(prevProps) {
    if (prevProps.userId !== this.props.userId) {
      console.log('userId changed');
      this.setState({ loading: true });
      const user = await fetchUser(this.props.userId);
      this.setState({ user, loading: false });
    }
  }
  
  componentWillUnmount() {
    console.log('ç»„ä»¶å¸è½½');
    // æ¸…ç†å·¥ä½œ
  }
  
  render() {
    if (this.state.loading) return <div>Loading...</div>;
    return <div>{this.state.user?.name}</div>;
  }
}

// Hookså†™æ³•
const UserProfile = ({ userId }) => {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    console.log('ç»„ä»¶æŒ‚è½½æˆ–userIdå˜åŒ–');
    
    const loadUser = async () => {
      setLoading(true);
      const userData = await fetchUser(userId);
      setUser(userData);
      setLoading(false);
    };
    
    loadUser();
    
    // æ¸…ç†å‡½æ•°ï¼ˆç›¸å½“äºcomponentWillUnmountï¼‰
    return () => {
      console.log('æ¸…ç†å·¥ä½œ');
    };
  }, [userId]); // ä¾èµ–æ•°ç»„
  
  if (loading) return <div>Loading...</div>;
  return <div>{user?.name}</div>;
};
```

#### 2.2.2 æ›´æ–°é˜¶æ®µ

**ç»„ä»¶æ›´æ–°**å‘ç”Ÿåœ¨propsæˆ–stateå˜åŒ–æ—¶ã€‚

```javascript
// æ€§èƒ½ä¼˜åŒ–ï¼šé˜²æ­¢ä¸å¿…è¦çš„æ›´æ–°
const ExpensiveComponent = React.memo(({ data, config }) => {
  console.log('ExpensiveComponent render');
  
  // å¤æ‚è®¡ç®—
  const processedData = useMemo(() => {
    return data.map(item => ({
      ...item,
      processed: expensiveCalculation(item, config)
    }));
  }, [data, config]);
  
  return (
    <div>
      {processedData.map(item => (
        <div key={item.id}>{item.processed}</div>
      ))}
    </div>
  );
});

// è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°
const MyComponent = React.memo(({ user, settings }) => {
  return <div>{user.name}</div>;
}, (prevProps, nextProps) => {
  // è¿”å›trueè¡¨ç¤ºpropsç›¸ç­‰ï¼Œä¸éœ€è¦é‡æ–°æ¸²æŸ“
  return prevProps.user.id === nextProps.user.id;
});

// useCallbackä¼˜åŒ–å‡½æ•°å¼•ç”¨
const TodoList = ({ todos }) => {
  const [filter, setFilter] = useState('all');
  
  // é¿å…æ¯æ¬¡æ¸²æŸ“éƒ½åˆ›å»ºæ–°å‡½æ•°
  const handleToggle = useCallback((id) => {
    // åˆ‡æ¢todoçŠ¶æ€çš„é€»è¾‘
    console.log('Toggle todo:', id);
  }, []);
  
  const filteredTodos = useMemo(() => {
    return todos.filter(todo => {
      if (filter === 'active') return !todo.completed;
      if (filter === 'completed') return todo.completed;
      return true;
    });
  }, [todos, filter]);
  
  return (
    <div>
      <FilterButtons filter={filter} onFilterChange={setFilter} />
      {filteredTodos.map(todo => (
        <TodoItem 
          key={todo.id} 
          todo={todo} 
          onToggle={handleToggle}
        />
      ))}
    </div>
  );
};
```

#### 2.2.3 å¸è½½é˜¶æ®µ

**ç»„ä»¶å¸è½½**æ—¶éœ€è¦æ¸…ç†å‰¯ä½œç”¨ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚

```javascript
// æ¸…ç†å‰¯ä½œç”¨çš„æœ€ä½³å®è·µ
const TimerComponent = () => {
  const [time, setTime] = useState(new Date());
  
  useEffect(() => {
    const timer = setInterval(() => {
      setTime(new Date());
    }, 1000);
    
    // æ¸…ç†å®šæ—¶å™¨
    return () => {
      clearInterval(timer);
    };
  }, []);
  
  return <div>{time.toLocaleTimeString()}</div>;
};

// äº‹ä»¶ç›‘å¬å™¨æ¸…ç†
const WindowSizeTracker = () => {
  const [windowSize, setWindowSize] = useState({
    width: window.innerWidth,
    height: window.innerHeight
  });
  
  useEffect(() => {
    const handleResize = () => {
      setWindowSize({
        width: window.innerWidth,
        height: window.innerHeight
      });
    };
    
    window.addEventListener('resize', handleResize);
    
    // æ¸…ç†äº‹ä»¶ç›‘å¬å™¨
    return () => {
      window.removeEventListener('resize', handleResize);
    };
  }, []);
  
  return <div>çª—å£å¤§å°: {windowSize.width} x {windowSize.height}</div>;
};

// å–æ¶ˆç½‘ç»œè¯·æ±‚
const DataFetcher = ({ url }) => {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    const abortController = new AbortController();
    
    const fetchData = async () => {
      try {
        setLoading(true);
        const response = await fetch(url, {
          signal: abortController.signal
        });
        const result = await response.json();
        setData(result);
      } catch (error) {
        if (error.name !== 'AbortError') {
          console.error('Fetch error:', error);
        }
      } finally {
        setLoading(false);
      }
    };
    
    fetchData();
    
    // æ¸…ç†ï¼šå–æ¶ˆè¯·æ±‚
    return () => {
      abortController.abort();
    };
  }, [url]);
  
  if (loading) return <div>Loading...</div>;
  return <div>{JSON.stringify(data)}</div>;
};
```

### 2.3 äº‹ä»¶å¤„ç†æœºåˆ¶

#### 2.3.1 åˆæˆäº‹ä»¶ç³»ç»Ÿ

**åˆæˆäº‹ä»¶(SyntheticEvent)**æ˜¯Reactå¯¹åŸç”Ÿäº‹ä»¶çš„å°è£…ï¼Œæä¾›è·¨æµè§ˆå™¨å…¼å®¹æ€§ã€‚

**åˆæˆäº‹ä»¶ç‰¹ç‚¹**ï¼š

```mermaid
graph TB
    subgraph "Reactåˆæˆäº‹ä»¶ç³»ç»Ÿ"
        subgraph "äº‹ä»¶ç‰¹æ€§"
            CROSS_BROWSER["è·¨æµè§ˆå™¨å…¼å®¹<br/>Cross-browser"]
            CONSISTENT_API["ä¸€è‡´çš„API<br/>Consistent API"]
            POOLING["äº‹ä»¶æ± åŒ–<br/>Event Pooling"]
        end
        
        subgraph "äº‹ä»¶å¤„ç†"
            DELEGATION["äº‹ä»¶å§”æ‰˜<br/>Event Delegation"]
            BUBBLING["äº‹ä»¶å†’æ³¡<br/>Event Bubbling"]
            CAPTURE["äº‹ä»¶æ•è·<br/>Event Capturing"]
        end
        
        subgraph "æ€§èƒ½ä¼˜åŒ–"
            MEMORY_POOL["å†…å­˜æ± <br/>Memory Pool"]
            BATCH_UPDATE["æ‰¹é‡æ›´æ–°<br/>Batch Updates"]
            ASYNC_EVENT["å¼‚æ­¥äº‹ä»¶<br/>Async Events"]
        end
    end
    
    CROSS_BROWSER --> DELEGATION
    CONSISTENT_API --> BUBBLING
    POOLING --> MEMORY_POOL
    
    DELEGATION --> BATCH_UPDATE
    BUBBLING --> ASYNC_EVENT
```

**äº‹ä»¶å¤„ç†ç¤ºä¾‹**ï¼š

```javascript
// åŸºç¡€äº‹ä»¶å¤„ç†
const Button = () => {
  const handleClick = (e) => {
    // eæ˜¯åˆæˆäº‹ä»¶å¯¹è±¡
    console.log('Event type:', e.type);
    console.log('Current target:', e.currentTarget);
    console.log('Native event:', e.nativeEvent);
    
    // é˜»æ­¢é»˜è®¤è¡Œä¸º
    e.preventDefault();
    
    // é˜»æ­¢äº‹ä»¶å†’æ³¡
    e.stopPropagation();
  };
  
  return <button onClick={handleClick}>Click me</button>;
};

// è¡¨å•äº‹ä»¶å¤„ç†
const ContactForm = () => {
  const [formData, setFormData] = useState({
    name: '',
    email: '',
    message: ''
  });
  
  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: value
    }));
  };
  
  const handleSubmit = (e) => {
    e.preventDefault();
    console.log('Form submitted:', formData);
  };
  
  const handleKeyDown = (e) => {
    if (e.key === 'Enter' && e.ctrlKey) {
      handleSubmit(e);
    }
  };
  
  return (
    <form onSubmit={handleSubmit}>
      <input
        name="name"
        value={formData.name}
        onChange={handleChange}
        placeholder="å§“å"
      />
      <input
        name="email"
        type="email"
        value={formData.email}
        onChange={handleChange}
        placeholder="é‚®ç®±"
      />
      <textarea
        name="message"
        value={formData.message}
        onChange={handleChange}
        onKeyDown={handleKeyDown}
        placeholder="æ¶ˆæ¯ (Ctrl+Enteræäº¤)"
      />
      <button type="submit">æäº¤</button>
    </form>
  );
};

// è‡ªå®šä¹‰äº‹ä»¶å¤„ç†Hook
const useEventListener = (eventName, handler, element = window) => {
  const savedHandler = useRef();
  
  useEffect(() => {
    savedHandler.current = handler;
  }, [handler]);
  
  useEffect(() => {
    const isSupported = element && element.addEventListener;
    if (!isSupported) return;
    
    const eventListener = (event) => savedHandler.current(event);
    element.addEventListener(eventName, eventListener);
    
    return () => {
      element.removeEventListener(eventName, eventListener);
    };
  }, [eventName, element]);
};

// ä½¿ç”¨è‡ªå®šä¹‰Hook
const KeyboardShortcuts = () => {
  const [message, setMessage] = useState('');
  
  useEventListener('keydown', (e) => {
    if (e.ctrlKey && e.key === 's') {
      e.preventDefault();
      setMessage('Ctrl+S ä¿å­˜å¿«æ·é”®è¢«æŒ‰ä¸‹');
    }
    if (e.key === 'Escape') {
      setMessage('');
    }
  });
  
  return <div>{message}</div>;
};
```

#### 2.3.2 äº‹ä»¶å§”æ‰˜æœºåˆ¶

**äº‹ä»¶å§”æ‰˜**æ˜¯Reactæ€§èƒ½ä¼˜åŒ–çš„é‡è¦æœºåˆ¶ã€‚

```javascript
// Reactäº‹ä»¶å§”æ‰˜åŸç†ç¤ºä¾‹
class EventDelegation {
  constructor() {
    this.eventMap = new Map();
    this.bindEvent();
  }
  
  bindEvent() {
    // Reactå°†æ‰€æœ‰äº‹ä»¶ç»‘å®šåˆ°documentæ ¹èŠ‚ç‚¹
    document.addEventListener('click', this.handleDocumentClick.bind(this));
  }
  
  handleDocumentClick(nativeEvent) {
    let target = nativeEvent.target;
    
    // å‘ä¸Šéå†DOMæ ‘ï¼ŒæŸ¥æ‰¾æ³¨å†Œçš„äº‹ä»¶å¤„ç†å™¨
    while (target && target !== document) {
      const reactEventHandler = this.eventMap.get(target);
      if (reactEventHandler) {
        // åˆ›å»ºåˆæˆäº‹ä»¶å¯¹è±¡
        const syntheticEvent = this.createSyntheticEvent(nativeEvent, target);
        reactEventHandler(syntheticEvent);
        
        if (syntheticEvent.isPropagationStopped()) {
          break;
        }
      }
      target = target.parentNode;
    }
  }
  
  createSyntheticEvent(nativeEvent, currentTarget) {
    return {
      type: nativeEvent.type,
      currentTarget,
      target: nativeEvent.target,
      nativeEvent,
      preventDefault: () => nativeEvent.preventDefault(),
      stopPropagation: () => {
        this._propagationStopped = true;
      },
      isPropagationStopped: () => this._propagationStopped || false
    };
  }
  
  registerEvent(element, handler) {
    this.eventMap.set(element, handler);
  }
}

// å®é™…ä½¿ç”¨ä¸­çš„ä¼˜åŒ–æŠ€å·§
const ListComponent = ({ items, onItemClick }) => {
  // ä½¿ç”¨äº‹ä»¶å§”æ‰˜å¤„ç†åˆ—è¡¨é¡¹ç‚¹å‡»
  const handleListClick = (e) => {
    const itemElement = e.target.closest('[data-item-id]');
    if (itemElement) {
      const itemId = itemElement.dataset.itemId;
      onItemClick(itemId);
    }
  };
  
  return (
    <ul onClick={handleListClick}>
      {items.map(item => (
        <li key={item.id} data-item-id={item.id}>
          {item.name}
        </li>
      ))}
    </ul>
  );
};

// é˜²æŠ–å’ŒèŠ‚æµå¤„ç†
const useDebounce = (value, delay) => {
  const [debouncedValue, setDebouncedValue] = useState(value);
  
  useEffect(() => {
    const handler = setTimeout(() => {
      setDebouncedValue(value);
    }, delay);
    
    return () => {
      clearTimeout(handler);
    };
  }, [value, delay]);
  
  return debouncedValue;
};

const SearchInput = ({ onSearch }) => {
  const [query, setQuery] = useState('');
  const debouncedQuery = useDebounce(query, 300);
  
  useEffect(() => {
    if (debouncedQuery) {
      onSearch(debouncedQuery);
    }
  }, [debouncedQuery, onSearch]);
  
  return (
    <input
      value={query}
      onChange={(e) => setQuery(e.target.value)}
      placeholder="æœç´¢..."
    />
  );
};
```

## 3. React Hooks æ·±åº¦è§£æ

### 3.1 åŸºç¡€Hooks

#### 3.1.1 useState

**useState**æ˜¯æœ€åŸºç¡€çš„Hookï¼Œç”¨äºåœ¨å‡½æ•°ç»„ä»¶ä¸­æ·»åŠ çŠ¶æ€ã€‚

```javascript
// åŸºç¡€ç”¨æ³•
const Counter = () => {
  const [count, setCount] = useState(0);
  
  return (
    <div>
      <p>Count: {count}</p>
      <button onClick={() => setCount(count + 1)}>+1</button>
      <button onClick={() => setCount(prev => prev + 1)}>+1 (å‡½æ•°å¼)</button>
    </div>
  );
};

// å¤æ‚çŠ¶æ€ç®¡ç†
const UserForm = () => {
  const [user, setUser] = useState({
    name: '',
    email: '',
    age: 0
  });
  
  const updateUser = (field, value) => {
    setUser(prev => ({
      ...prev,
      [field]: value
    }));
  };
  
  return (
    <form>
      <input
        value={user.name}
        onChange={(e) => updateUser('name', e.target.value)}
        placeholder="å§“å"
      />
      <input
        value={user.email}
        onChange={(e) => updateUser('email', e.target.value)}
        placeholder="é‚®ç®±"
      />
      <input
        type="number"
        value={user.age}
        onChange={(e) => updateUser('age', parseInt(e.target.value))}
        placeholder="å¹´é¾„"
      />
    </form>
  );
};

// æƒ°æ€§åˆå§‹åŒ–
const ExpensiveComponent = () => {
  // åªåœ¨é¦–æ¬¡æ¸²æŸ“æ—¶æ‰§è¡Œæ˜‚è´µçš„è®¡ç®—
  const [data, setData] = useState(() => {
    console.log('æ‰§è¡Œæ˜‚è´µçš„åˆå§‹åŒ–è®¡ç®—');
    return expensiveCalculation();
  });
  
  return <div>{data}</div>;
};

// çŠ¶æ€æ›´æ–°çš„æ³¨æ„äº‹é¡¹
const StateUpdateExample = () => {
  const [count, setCount] = useState(0);
  
  const handleClick = () => {
    // âŒ é”™è¯¯ï¼šä¼šè¢«æ‰¹é‡å¤„ç†ï¼Œåªä¼š+1
    setCount(count + 1);
    setCount(count + 1);
    setCount(count + 1);
    
    // âœ… æ­£ç¡®ï¼šä½¿ç”¨å‡½æ•°å¼æ›´æ–°
    setCount(prev => prev + 1);
    setCount(prev => prev + 1);
    setCount(prev => prev + 1);
  };
  
  const handleAsyncClick = () => {
    setTimeout(() => {
      // âŒ åœ¨å¼‚æ­¥å›è°ƒä¸­ï¼Œå¯èƒ½è·å–åˆ°è¿‡æœŸçš„state
      setCount(count + 1);
      
      // âœ… ä½¿ç”¨å‡½æ•°å¼æ›´æ–°è·å–æœ€æ–°state
      setCount(prev => prev + 1);
    }, 1000);
  };
  
  return (
    <div>
      <p>Count: {count}</p>
      <button onClick={handleClick}>åŒæ­¥+3</button>
      <button onClick={handleAsyncClick}>å¼‚æ­¥+1</button>
    </div>
  );
};
```

#### 3.1.2 useEffect

**useEffect**å¤„ç†å‰¯ä½œç”¨ï¼Œæ˜¯React Hooksä¸­æœ€é‡è¦çš„Hookä¹‹ä¸€ã€‚

```javascript
// åŸºç¡€ç”¨æ³•
const Timer = () => {
  const [seconds, setSeconds] = useState(0);
  
  // ç›¸å½“äºcomponentDidMountå’ŒcomponentDidUpdate
  useEffect(() => {
    document.title = `Timer: ${seconds}s`;
  });
  
  // ç›¸å½“äºcomponentDidMount
  useEffect(() => {
    const timer = setInterval(() => {
      setSeconds(prev => prev + 1);
    }, 1000);
    
    // ç›¸å½“äºcomponentWillUnmount
    return () => {
      clearInterval(timer);
    };
  }, []); // ç©ºä¾èµ–æ•°ç»„ï¼Œåªåœ¨æŒ‚è½½æ—¶æ‰§è¡Œ
  
  return <div>Seconds: {seconds}</div>;
};

// ä¾èµ–æ•°ç»„çš„ä½¿ç”¨
const UserProfile = ({ userId }) => {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    let cancelled = false;
    
    const fetchUser = async () => {
      setLoading(true);
      try {
        const userData = await api.getUser(userId);
        if (!cancelled) {
          setUser(userData);
        }
      } catch (error) {
        if (!cancelled) {
          console.error('è·å–ç”¨æˆ·å¤±è´¥:', error);
        }
      } finally {
        if (!cancelled) {
          setLoading(false);
        }
      }
    };
    
    fetchUser();
    
    return () => {
      cancelled = true;
    };
  }, [userId]); // userIdå˜åŒ–æ—¶é‡æ–°æ‰§è¡Œ
  
  if (loading) return <div>Loading...</div>;
  return <div>{user?.name}</div>;
};

// å¤šä¸ªuseEffectçš„ä½¿ç”¨
const ChatRoom = ({ roomId, userId }) => {
  const [messages, setMessages] = useState([]);
  const [onlineUsers, setOnlineUsers] = useState([]);
  
  // å¤„ç†æ¶ˆæ¯è®¢é˜…
  useEffect(() => {
    const unsubscribe = messageService.subscribe(roomId, (newMessage) => {
      setMessages(prev => [...prev, newMessage]);
    });
    
    return unsubscribe;
  }, [roomId]);
  
  // å¤„ç†åœ¨çº¿ç”¨æˆ·
  useEffect(() => {
    const unsubscribe = userService.subscribeOnlineUsers(roomId, (users) => {
      setOnlineUsers(users);
    });
    
    return unsubscribe;
  }, [roomId]);
  
  // ç”¨æˆ·æ´»åŠ¨çŠ¶æ€
  useEffect(() => {
    userService.setUserActive(userId, roomId);
    
    return () => {
      userService.setUserInactive(userId, roomId);
    };
  }, [userId, roomId]);
  
  return (
    <div>
      <div>åœ¨çº¿ç”¨æˆ·: {onlineUsers.length}</div>
      <div>
        {messages.map(msg => (
          <div key={msg.id}>{msg.content}</div>
        ))}
      </div>
    </div>
  );
};

// è‡ªå®šä¹‰Effect Hook
const useDocumentTitle = (title) => {
  useEffect(() => {
    const prevTitle = document.title;
    document.title = title;
    
    return () => {
      document.title = prevTitle;
    };
  }, [title]);
};

const useLocalStorage = (key, initialValue) => {
  const [value, setValue] = useState(() => {
    try {
      const item = window.localStorage.getItem(key);
      return item ? JSON.parse(item) : initialValue;
    } catch (error) {
      return initialValue;
    }
  });
  
  useEffect(() => {
    try {
      window.localStorage.setItem(key, JSON.stringify(value));
    } catch (error) {
      console.error('ä¿å­˜åˆ°localStorageå¤±è´¥:', error);
    }
  }, [key, value]);
  
  return [value, setValue];
};

// ä½¿ç”¨è‡ªå®šä¹‰Hook
const Settings = () => {
  const [theme, setTheme] = useLocalStorage('theme', 'light');
  const [language, setLanguage] = useLocalStorage('language', 'zh');
  
  useDocumentTitle(`è®¾ç½® - ${theme === 'light' ? 'äº®è‰²' : 'æš—è‰²'}ä¸»é¢˜`);
  
  return (
    <div>
      <select value={theme} onChange={(e) => setTheme(e.target.value)}>
        <option value="light">äº®è‰²ä¸»é¢˜</option>
        <option value="dark">æš—è‰²ä¸»é¢˜</option>
      </select>
      <select value={language} onChange={(e) => setLanguage(e.target.value)}>
        <option value="zh">ä¸­æ–‡</option>
        <option value="en">English</option>
      </select>
    </div>
  );
};
```

#### 3.1.3 useContext

**useContext**ç”¨äºè·¨ç»„ä»¶å±‚çº§ä¼ é€’æ•°æ®ï¼Œé¿å…props drillingã€‚

```javascript
// åˆ›å»ºContext
const ThemeContext = createContext();
const UserContext = createContext();

// ç»„åˆå¤šä¸ªContext
const AppProvider = ({ children }) => {
  const [theme, setTheme] = useState('light');
  const [user, setUser] = useState(null);
  
  const themeValue = {
    theme,
    setTheme,
    colors: theme === 'light' ? lightColors : darkColors
  };
  
  const userValue = {
    user,
    setUser,
    isLoggedIn: !!user
  };
  
  return (
    <ThemeContext.Provider value={themeValue}>
      <UserContext.Provider value={userValue}>
        {children}
      </UserContext.Provider>
    </ThemeContext.Provider>
  );
};

// è‡ªå®šä¹‰Hookå°è£…Context
const useTheme = () => {
  const context = useContext(ThemeContext);
  if (!context) {
    throw new Error('useTheme must be used within a ThemeProvider');
  }
  return context;
};

const useUser = () => {
  const context = useContext(UserContext);
  if (!context) {
    throw new Error('useUser must be used within a UserProvider');
  }
  return context;
};

// ä½¿ç”¨Contextçš„ç»„ä»¶
const Header = () => {
  const { theme, setTheme } = useTheme();
  const { user, isLoggedIn } = useUser();
  
  return (
    <header style={{ backgroundColor: theme === 'light' ? '#fff' : '#333' }}>
      <h1>My App</h1>
      <div>
        <button onClick={() => setTheme(theme === 'light' ? 'dark' : 'light')}>
          åˆ‡æ¢ä¸»é¢˜
        </button>
        {isLoggedIn ? (
          <span>æ¬¢è¿, {user.name}!</span>
        ) : (
          <button>ç™»å½•</button>
        )}
      </div>
    </header>
  );
};

// å¤æ‚çŠ¶æ€ç®¡ç†with Context + useReducer
const AppStateContext = createContext();

const appReducer = (state, action) => {
  switch (action.type) {
    case 'SET_LOADING':
      return { ...state, loading: action.payload };
    case 'SET_USER':
      return { ...state, user: action.payload, loading: false };
    case 'SET_ERROR':
      return { ...state, error: action.payload, loading: false };
    case 'CLEAR_ERROR':
      return { ...state, error: null };
    default:
      return state;
  }
};

const AppStateProvider = ({ children }) => {
  const [state, dispatch] = useReducer(appReducer, {
    user: null,
    loading: false,
    error: null
  });
  
  const login = async (credentials) => {
    dispatch({ type: 'SET_LOADING', payload: true });
    try {
      const user = await api.login(credentials);
      dispatch({ type: 'SET_USER', payload: user });
    } catch (error) {
      dispatch({ type: 'SET_ERROR', payload: error.message });
    }
  };
  
  const logout = () => {
    dispatch({ type: 'SET_USER', payload: null });
  };
  
  const value = {
    ...state,
    login,
    logout,
    clearError: () => dispatch({ type: 'CLEAR_ERROR' })
  };
  
  return (
    <AppStateContext.Provider value={value}>
      {children}
    </AppStateContext.Provider>
  );
};

const useAppState = () => {
  const context = useContext(AppStateContext);
  if (!context) {
    throw new Error('useAppState must be used within AppStateProvider');
  }
  return context;
};
```

### 3.2 é«˜çº§Hooks

#### 3.2.1 useReducer

**useReducer**æ˜¯useStateçš„æ›¿ä»£æ–¹æ¡ˆï¼Œé€‚åˆå¤æ‚çŠ¶æ€é€»è¾‘ç®¡ç†ã€‚

```javascript
// åŸºç¡€useReducerä½¿ç”¨
const initialState = { count: 0 };

const reducer = (state, action) => {
  switch (action.type) {
    case 'increment':
      return { count: state.count + 1 };
    case 'decrement':
      return { count: state.count - 1 };
    case 'reset':
      return initialState;
    default:
      throw new Error(`æœªçŸ¥çš„actionç±»å‹: ${action.type}`);
  }
};

const Counter = () => {
  const [state, dispatch] = useReducer(reducer, initialState);
  
  return (
    <div>
      <p>Count: {state.count}</p>
      <button onClick={() => dispatch({ type: 'increment' })}>+</button>
      <button onClick={() => dispatch({ type: 'decrement' })}>-</button>
      <button onClick={() => dispatch({ type: 'reset' })}>Reset</button>
    </div>
  );
};
```

#### 3.2.2 useMemo å’Œ useCallback

**useMemoå’ŒuseCallback**ç”¨äºæ€§èƒ½ä¼˜åŒ–ï¼Œé¿å…ä¸å¿…è¦çš„è®¡ç®—å’Œé‡æ–°æ¸²æŸ“ã€‚

```javascript
// useMemoä¼˜åŒ–æ˜‚è´µè®¡ç®—
const ExpensiveList = ({ items, filter }) => {
  const filteredItems = useMemo(() => {
    console.log('æ‰§è¡Œæ˜‚è´µçš„è¿‡æ»¤è®¡ç®—');
    return items.filter(item => 
      item.name.toLowerCase().includes(filter.toLowerCase())
    );
  }, [items, filter]);
  
  return (
    <ul>
      {filteredItems.map(item => (
        <li key={item.id}>{item.name}</li>
      ))}
    </ul>
  );
};

// useCallbackä¼˜åŒ–å‡½æ•°å¼•ç”¨
const TodoList = ({ todos, onToggle }) => {
  const handleToggle = useCallback((id) => {
    onToggle(id);
  }, [onToggle]);
  
  return (
    <div>
      {todos.map(todo => (
        <TodoItem key={todo.id} todo={todo} onToggle={handleToggle} />
      ))}
    </div>
  );
};
```

#### 3.2.3 useRef å’Œ useImperativeHandle

**useRefå’ŒuseImperativeHandle**ç”¨äºè®¿é—®DOMå…ƒç´ å’Œå‘½ä»¤å¼APIã€‚

```javascript
// useRefåŸºæœ¬ç”¨æ³•
const FocusInput = () => {
  const inputRef = useRef(null);
  
  const focusInput = () => {
    inputRef.current.focus();
  };
  
  return (
    <div>
      <input ref={inputRef} type="text" />
      <button onClick={focusInput}>Focus Input</button>
    </div>
  );
};

// useImperativeHandleæš´éœ²ç»„ä»¶æ–¹æ³•
const CustomInput = forwardRef((props, ref) => {
  const inputRef = useRef();
  const [value, setValue] = useState('');
  
  useImperativeHandle(ref, () => ({
    focus: () => inputRef.current.focus(),
    clear: () => setValue(''),
    getValue: () => value
  }));
  
  return (
    <input
      ref={inputRef}
      value={value}
      onChange={(e) => setValue(e.target.value)}
      {...props}
    />
  );
});
```

### 3.3 è‡ªå®šä¹‰Hooks

#### 3.3.1 è®¾è®¡åŸåˆ™

**è‡ªå®šä¹‰Hooks**æ˜¯ç»„åˆå†…ç½®Hooksæ¥åˆ›å»ºå¯å¤ç”¨é€»è¾‘çš„å¼ºå¤§æ–¹å¼ã€‚

**è®¾è®¡åŸåˆ™**ï¼š
1. **ä»¥useå¼€å¤´**ï¼šéµå¾ªHookså‘½åçº¦å®š
2. **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªHookåªè§£å†³ä¸€ä¸ªé—®é¢˜
3. **å¯å¤ç”¨æ€§**ï¼šèƒ½åœ¨å¤šä¸ªç»„ä»¶ä¸­ä½¿ç”¨
4. **å‚æ•°åŒ–**ï¼šé€šè¿‡å‚æ•°é…ç½®ä¸åŒè¡Œä¸º

#### 3.3.2 å¸¸ç”¨è‡ªå®šä¹‰Hooks

```javascript
// 1. useToggle - åˆ‡æ¢å¸ƒå°”å€¼
const useToggle = (initialValue = false) => {
  const [value, setValue] = useState(initialValue);
  
  const toggle = useCallback(() => {
    setValue(prev => !prev);
  }, []);
  
  return [value, toggle];
};

// 2. useFetch - æ•°æ®è·å–
const useFetch = (url) => {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  
  useEffect(() => {
    const fetchData = async () => {
      try {
        setLoading(true);
        const response = await fetch(url);
        const result = await response.json();
        setData(result);
      } catch (err) {
        setError(err.message);
      } finally {
        setLoading(false);
      }
    };
    
    fetchData();
  }, [url]);
  
  return { data, loading, error };
};

// 3. useLocalStorage - æœ¬åœ°å­˜å‚¨
const useLocalStorage = (key, initialValue) => {
  const [storedValue, setStoredValue] = useState(() => {
    try {
      const item = window.localStorage.getItem(key);
      return item ? JSON.parse(item) : initialValue;
    } catch (error) {
      return initialValue;
    }
  });
  
  const setValue = (value) => {
    try {
      setStoredValue(value);
      window.localStorage.setItem(key, JSON.stringify(value));
    } catch (error) {
      console.error('Error saving to localStorage:', error);
    }
  };
  
  return [storedValue, setValue];
};
```

## 4. çŠ¶æ€ç®¡ç†ä¸æ•°æ®æµ

### 4.1 æœ¬åœ°çŠ¶æ€ç®¡ç†

#### 4.1.1 ç»„ä»¶å†…çŠ¶æ€

**useStateçš„åŸºæœ¬ç”¨æ³•**
```javascript
import React, { useState } from 'react';

function Counter() {
  const [count, setCount] = useState(0);
  const [user, setUser] = useState({ name: '', email: '' });

  // å‡½æ•°å¼æ›´æ–°
  const increment = () => {
    setCount(prevCount => prevCount + 1);
  };

  // å¯¹è±¡çŠ¶æ€æ›´æ–°
  const updateUser = (field, value) => {
    setUser(prevUser => ({
      ...prevUser,
      [field]: value
    }));
  };

  return (
    <div>
      <p>Count: {count}</p>
      <button onClick={increment}>+1</button>
      
      <input
        placeholder="Name"
        value={user.name}
        onChange={(e) => updateUser('name', e.target.value)}
      />
      <input
        placeholder="Email"
        value={user.email}
        onChange={(e) => updateUser('email', e.target.value)}
      />
    </div>
  );
}
```

**çŠ¶æ€åˆå§‹åŒ–ä¼˜åŒ–**
```javascript
function ExpensiveComponent() {
  // æƒ°æ€§åˆå§‹åŒ–ï¼Œåªåœ¨ç»„ä»¶é¦–æ¬¡æ¸²æŸ“æ—¶æ‰§è¡Œ
  const [data, setData] = useState(() => {
    return expensiveComputation();
  });

  // é¿å…æ¯æ¬¡æ¸²æŸ“éƒ½åˆ›å»ºæ–°çš„åˆå§‹å€¼
  const [items, setItems] = useState(() => []);

  return <div>{/* ç»„ä»¶å†…å®¹ */}</div>;
}
```

#### 4.1.2 çŠ¶æ€æå‡

**çŠ¶æ€æå‡æ¨¡å¼**
```javascript
// å­ç»„ä»¶
function TemperatureInput({ scale, temperature, onTemperatureChange }) {
  return (
    <fieldset>
      <legend>Enter temperature in {scale}:</legend>
      <input
        value={temperature}
        onChange={(e) => onTemperatureChange(e.target.value)}
      />
    </fieldset>
  );
}

// çˆ¶ç»„ä»¶ç®¡ç†å…±äº«çŠ¶æ€
function TemperatureCalculator() {
  const [temperature, setTemperature] = useState('');
  const [scale, setScale] = useState('c');

  const handleCelsiusChange = (temperature) => {
    setScale('c');
    setTemperature(temperature);
  };

  const handleFahrenheitChange = (temperature) => {
    setScale('f');
    setTemperature(temperature);
  };

  const celsius = scale === 'f' ? tryConvert(temperature, toCelsius) : temperature;
  const fahrenheit = scale === 'c' ? tryConvert(temperature, toFahrenheit) : temperature;

  return (
    <div>
      <TemperatureInput
        scale="c"
        temperature={celsius}
        onTemperatureChange={handleCelsiusChange}
      />
      <TemperatureInput
        scale="f"
        temperature={fahrenheit}
        onTemperatureChange={handleFahrenheitChange}
      />
      <BoilingVerdict celsius={parseFloat(celsius)} />
    </div>
  );
}
```

### 4.2 Context API

#### 4.2.1 ContextåŸºç¡€ç”¨æ³•

**åˆ›å»ºå’Œä½¿ç”¨Context**
```javascript
import React, { createContext, useContext, useState } from 'react';

// åˆ›å»ºContext
const ThemeContext = createContext();

// Providerç»„ä»¶
function ThemeProvider({ children }) {
  const [theme, setTheme] = useState('light');

  const toggleTheme = () => {
    setTheme(prev => prev === 'light' ? 'dark' : 'light');
  };

  return (
    <ThemeContext.Provider value={{ theme, toggleTheme }}>
      {children}
    </ThemeContext.Provider>
  );
}

// è‡ªå®šä¹‰Hook
function useTheme() {
  const context = useContext(ThemeContext);
  if (!context) {
    throw new Error('useTheme must be used within a ThemeProvider');
  }
  return context;
}

// æ¶ˆè´¹è€…ç»„ä»¶
function ThemedButton() {
  const { theme, toggleTheme } = useTheme();
  
  return (
    <button
      style={{
        backgroundColor: theme === 'light' ? '#fff' : '#333',
        color: theme === 'light' ? '#333' : '#fff'
      }}
      onClick={toggleTheme}
    >
      Switch to {theme === 'light' ? 'dark' : 'light'} theme
    </button>
  );
}

// åº”ç”¨æ ¹ç»„ä»¶
function App() {
  return (
    <ThemeProvider>
      <div>
        <h1>My App</h1>
        <ThemedButton />
      </div>
    </ThemeProvider>
  );
}
```

#### 4.2.2 Contextæœ€ä½³å®è·µ

**å¤šContextç»„åˆ**
```javascript
// ç”¨æˆ·Context
const UserContext = createContext();

function UserProvider({ children }) {
  const [user, setUser] = useState(null);
  
  const login = async (credentials) => {
    const userData = await api.login(credentials);
    setUser(userData);
  };
  
  const logout = () => {
    setUser(null);
    localStorage.removeItem('token');
  };

  return (
    <UserContext.Provider value={{ user, login, logout }}>
      {children}
    </UserContext.Provider>
  );
}

// é€šçŸ¥Context
const NotificationContext = createContext();

function NotificationProvider({ children }) {
  const [notifications, setNotifications] = useState([]);

  const addNotification = (message, type = 'info') => {
    const id = Date.now();
    setNotifications(prev => [...prev, { id, message, type }]);
    
    // è‡ªåŠ¨ç§»é™¤é€šçŸ¥
    setTimeout(() => {
      removeNotification(id);
    }, 5000);
  };

  const removeNotification = (id) => {
    setNotifications(prev => prev.filter(n => n.id !== id));
  };

  return (
    <NotificationContext.Provider value={{ 
      notifications, 
      addNotification, 
      removeNotification 
    }}>
      {children}
    </NotificationContext.Provider>
  );
}

// ç»„åˆProvider
function AppProviders({ children }) {
  return (
    <UserProvider>
      <NotificationProvider>
        <ThemeProvider>
          {children}
        </ThemeProvider>
      </NotificationProvider>
    </UserProvider>
  );
}
```

### 4.3 ç¬¬ä¸‰æ–¹çŠ¶æ€ç®¡ç†

#### 4.3.1 Redux

**ReduxåŸºæœ¬è®¾ç½®**
```javascript
// store/userSlice.js
import { createSlice } from '@reduxjs/toolkit';

const userSlice = createSlice({
  name: 'user',
  initialState: {
    currentUser: null,
    loading: false,
    error: null
  },
  reducers: {
    loginStart: (state) => {
      state.loading = true;
      state.error = null;
    },
    loginSuccess: (state, action) => {
      state.loading = false;
      state.currentUser = action.payload;
    },
    loginFailure: (state, action) => {
      state.loading = false;
      state.error = action.payload;
    },
    logout: (state) => {
      state.currentUser = null;
    }
  }
});

export const { loginStart, loginSuccess, loginFailure, logout } = userSlice.actions;
export default userSlice.reducer;

// store/index.js
import { configureStore } from '@reduxjs/toolkit';
import userReducer from './userSlice';

export const store = configureStore({
  reducer: {
    user: userReducer
  }
});

// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
import React from 'react';
import { useSelector, useDispatch } from 'react-redux';
import { loginStart, loginSuccess } from './store/userSlice';

function LoginComponent() {
  const { currentUser, loading } = useSelector(state => state.user);
  const dispatch = useDispatch();

  const handleLogin = async (credentials) => {
    dispatch(loginStart());
    try {
      const user = await api.login(credentials);
      dispatch(loginSuccess(user));
    } catch (error) {
      dispatch(loginFailure(error.message));
    }
  };

  if (loading) return <div>Loading...</div>;
  
  return (
    <div>
      {currentUser ? (
        <p>Welcome, {currentUser.name}!</p>
      ) : (
        <LoginForm onSubmit={handleLogin} />
      )}
    </div>
  );
}
```

#### 4.3.2 Zustand

**ZustandçŠ¶æ€ç®¡ç†**
```javascript
import { create } from 'zustand';
import { devtools, persist } from 'zustand/middleware';

// åˆ›å»ºstore
const useUserStore = create(
  devtools(
    persist(
      (set, get) => ({
        user: null,
        loading: false,
        
        // actions
        setUser: (user) => set({ user }),
        setLoading: (loading) => set({ loading }),
        
        login: async (credentials) => {
          set({ loading: true });
          try {
            const user = await api.login(credentials);
            set({ user, loading: false });
          } catch (error) {
            set({ loading: false });
            throw error;
          }
        },
        
        logout: () => {
          set({ user: null });
          localStorage.removeItem('token');
        },
        
        // è®¡ç®—å±æ€§
        get isAuthenticated() {
          return !!get().user;
        }
      }),
      {
        name: 'user-storage',
        partialize: (state) => ({ user: state.user })
      }
    )
  )
);

// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
function UserProfile() {
  const { user, login, logout, isAuthenticated } = useUserStore();
  
  return (
    <div>
      {isAuthenticated ? (
        <div>
          <h2>Welcome, {user.name}!</h2>
          <button onClick={logout}>Logout</button>
        </div>
      ) : (
        <LoginForm onSubmit={login} />
      )}
    </div>
  );
}

// è®¢é˜…ç‰¹å®šçŠ¶æ€
function UserStatus() {
  const user = useUserStore(state => state.user);
  const isAuthenticated = useUserStore(state => state.isAuthenticated);
  
  return (
    <div>
      Status: {isAuthenticated ? 'Logged in' : 'Guest'}
    </div>
  );
}
```

#### 4.3.3 çŠ¶æ€ç®¡ç†æ–¹æ¡ˆå¯¹æ¯”

```mermaid
graph TD
    A["çŠ¶æ€ç®¡ç†éœ€æ±‚"] --> B{"åº”ç”¨å¤æ‚åº¦"}
    
    B -->|ç®€å•| C["useState + useContext"]
    B -->|ä¸­ç­‰| D["Zustand / Jotai"]
    B -->|å¤æ‚| E["Redux Toolkit"]
    
    C --> C1["â€¢ ç»„ä»¶å±‚çº§è¾ƒæµ…<br/>â€¢ çŠ¶æ€ç›¸å¯¹ç®€å•<br/>â€¢ å›¢é˜Ÿè§„æ¨¡å°"]
    D --> D1["â€¢ ä¸­ç­‰åº”ç”¨è§„æ¨¡<br/>â€¢ éœ€è¦æŒä¹…åŒ–<br/>â€¢ æ€§èƒ½è¦æ±‚é«˜"]
    E --> E1["â€¢ å¤§å‹åº”ç”¨<br/>â€¢ å¤æ‚ä¸šåŠ¡é€»è¾‘<br/>â€¢ å›¢é˜Ÿåä½œ"]
    
    style A fill:#e1f5fe
    style C fill:#e8f5e8
    style D fill:#fff3e0
    style E fill:#fce4ec
```

**çŠ¶æ€ç®¡ç†å¯¹æ¯”è¡¨**

| ç‰¹æ€§ | useState + Context | Zustand | Redux Toolkit |
|------|-------------------|---------|---------------|
| **å­¦ä¹ æˆæœ¬** | ä½ | ä½ | ä¸­ç­‰ |
| **åŒ…å¤§å°** | 0KB | 13.1KB | 53.5KB |
| **ç±»å‹æ”¯æŒ** | å†…ç½® | ä¼˜ç§€ | ä¼˜ç§€ |
| **å¼€å‘å·¥å…·** | React DevTools | æ”¯æŒ | å¼ºå¤§ |
| **ä¸­é—´ä»¶** | æ‰‹åŠ¨å®ç° | å†…ç½® | ä¸°å¯Œ |
| **é€‚ç”¨åœºæ™¯** | ç®€å•åº”ç”¨ | ä¸­ç­‰åº”ç”¨ | å¤æ‚åº”ç”¨ |

## 5. è·¯ç”±ä¸å¯¼èˆª

### 5.1 React RouteråŸºç¡€

#### 5.1.1 è·¯ç”±é…ç½®

**åŸºæœ¬è·¯ç”±è®¾ç½®**
```javascript
import React from 'react';
import { BrowserRouter, Routes, Route, Link, Navigate } from 'react-router-dom';

// é¡µé¢ç»„ä»¶
function Home() {
  return <h1>Home Page</h1>;
}

function About() {
  return <h1>About Page</h1>;
}

function Contact() {
  return <h1>Contact Page</h1>;
}

function NotFound() {
  return <h1>404 - Page Not Found</h1>;
}

// åº”ç”¨æ ¹ç»„ä»¶
function App() {
  return (
    <BrowserRouter>
      <nav>
        <Link to="/">Home</Link>
        <Link to="/about">About</Link>
        <Link to="/contact">Contact</Link>
      </nav>
      
      <Routes>
        <Route path="/" element={<Home />} />
        <Route path="/about" element={<About />} />
        <Route path="/contact" element={<Contact />} />
        <Route path="/old-contact" element={<Navigate to="/contact" replace />} />
        <Route path="*" element={<NotFound />} />
      </Routes>
    </BrowserRouter>
  );
}
```

**ç¼–ç¨‹å¼å¯¼èˆª**
```javascript
import { useNavigate, useLocation } from 'react-router-dom';

function LoginForm() {
  const navigate = useNavigate();
  const location = useLocation();
  
  const from = location.state?.from?.pathname || "/";

  const handleLogin = async (credentials) => {
    try {
      await auth.login(credentials);
      // ç™»å½•æˆåŠŸåé‡å®šå‘
      navigate(from, { replace: true });
    } catch (error) {
      console.error('Login failed:', error);
    }
  };

  const goBack = () => {
    navigate(-1); // è¿”å›ä¸Šä¸€é¡µ
  };

  const goToProfile = () => {
    navigate('/profile', { 
      state: { from: location },
      replace: false 
    });
  };

  return (
    <form onSubmit={handleLogin}>
      {/* ç™»å½•è¡¨å• */}
      <button type="button" onClick={goBack}>
        è¿”å›
      </button>
    </form>
  );
}
```

#### 5.1.2 è·¯ç”±å‚æ•°

**URLå‚æ•°å’ŒæŸ¥è¯¢å‚æ•°**
```javascript
import { useParams, useSearchParams } from 'react-router-dom';

// ç”¨æˆ·è¯¦æƒ…é¡µé¢
function UserProfile() {
  const { userId } = useParams();
  const [searchParams, setSearchParams] = useSearchParams();
  
  const tab = searchParams.get('tab') || 'profile';
  const edit = searchParams.get('edit') === 'true';

  const handleTabChange = (newTab) => {
    setSearchParams(params => {
      params.set('tab', newTab);
      return params;
    });
  };

  const toggleEdit = () => {
    setSearchParams(params => {
      if (edit) {
        params.delete('edit');
      } else {
        params.set('edit', 'true');
      }
      return params;
    });
  };

  return (
    <div>
      <h1>User Profile: {userId}</h1>
      
      <div>
        <button 
          onClick={() => handleTabChange('profile')}
          className={tab === 'profile' ? 'active' : ''}
        >
          Profile
        </button>
        <button 
          onClick={() => handleTabChange('settings')}
          className={tab === 'settings' ? 'active' : ''}
        >
          Settings
        </button>
      </div>
      
      <button onClick={toggleEdit}>
        {edit ? 'å–æ¶ˆç¼–è¾‘' : 'ç¼–è¾‘'}
      </button>
      
      {tab === 'profile' && <ProfileTab userId={userId} edit={edit} />}
      {tab === 'settings' && <SettingsTab userId={userId} edit={edit} />}
    </div>
  );
}

// è·¯ç”±é…ç½®
<Route path="/user/:userId" element={<UserProfile />} />
```

### 5.2 é«˜çº§è·¯ç”±ç‰¹æ€§

#### 5.2.1 åµŒå¥—è·¯ç”±

**åµŒå¥—è·¯ç”±å®ç°**
```javascript
import { Outlet, useParams } from 'react-router-dom';

// ä¸»é¡µé¢å¸ƒå±€
function DashboardLayout() {
  return (
    <div className="dashboard">
      <aside>
        <nav>
          <Link to="/dashboard">Dashboard</Link>
          <Link to="/dashboard/users">Users</Link>
          <Link to="/dashboard/settings">Settings</Link>
        </nav>
      </aside>
      
      <main>
        <Outlet /> {/* å­è·¯ç”±åœ¨è¿™é‡Œæ¸²æŸ“ */}
      </main>
    </div>
  );
}

// ç”¨æˆ·ç®¡ç†é¡µé¢
function UsersLayout() {
  return (
    <div>
      <h2>User Management</h2>
      <nav>
        <Link to="/dashboard/users">All Users</Link>
        <Link to="/dashboard/users/create">Create User</Link>
      </nav>
      <Outlet />
    </div>
  );
}

function UserList() {
  return <div>User List</div>;
}

function CreateUser() {
  return <div>Create User Form</div>;
}

function UserDetail() {
  const { userId } = useParams();
  return <div>User Detail: {userId}</div>;
}

// è·¯ç”±é…ç½®
function App() {
  return (
    <BrowserRouter>
      <Routes>
        <Route path="/dashboard" element={<DashboardLayout />}>
          <Route index element={<DashboardHome />} />
          <Route path="users" element={<UsersLayout />}>
            <Route index element={<UserList />} />
            <Route path="create" element={<CreateUser />} />
            <Route path=":userId" element={<UserDetail />} />
          </Route>
          <Route path="settings" element={<Settings />} />
        </Route>
      </Routes>
    </BrowserRouter>
  );
}
```

#### 5.2.2 è·¯ç”±å®ˆå«

**è®¤è¯è·¯ç”±å®ˆå«**
```javascript
import { Navigate, useLocation } from 'react-router-dom';

// è®¤è¯ä¸Šä¸‹æ–‡
const AuthContext = createContext();

function AuthProvider({ children }) {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    // æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€
    checkAuthStatus().then(user => {
      setUser(user);
      setLoading(false);
    });
  }, []);

  return (
    <AuthContext.Provider value={{ user, setUser, loading }}>
      {children}
    </AuthContext.Provider>
  );
}

// ç§æœ‰è·¯ç”±ç»„ä»¶
function PrivateRoute({ children, roles = [] }) {
  const { user, loading } = useContext(AuthContext);
  const location = useLocation();

  if (loading) {
    return <div>Loading...</div>;
  }

  if (!user) {
    // æœªç™»å½•ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µ
    return <Navigate to="/login" state={{ from: location }} replace />;
  }

  if (roles.length > 0 && !roles.some(role => user.roles.includes(role))) {
    // æƒé™ä¸è¶³
    return <Navigate to="/unauthorized" replace />;
  }

  return children;
}

// å…¬å¼€è·¯ç”±ï¼ˆä»…æœªç™»å½•ç”¨æˆ·å¯è®¿é—®ï¼‰
function PublicRoute({ children }) {
  const { user, loading } = useContext(AuthContext);
  
  if (loading) {
    return <div>Loading...</div>;
  }

  if (user) {
    return <Navigate to="/dashboard" replace />;
  }

  return children;
}

// ä½¿ç”¨è·¯ç”±å®ˆå«
function App() {
  return (
    <AuthProvider>
      <BrowserRouter>
        <Routes>
          {/* å…¬å¼€è·¯ç”± */}
          <Route path="/login" element={
            <PublicRoute>
              <LoginPage />
            </PublicRoute>
          } />
          
          {/* ç§æœ‰è·¯ç”± */}
          <Route path="/dashboard" element={
            <PrivateRoute>
              <DashboardLayout />
            </PrivateRoute>
          }>
            <Route index element={<DashboardHome />} />
            <Route path="users" element={
              <PrivateRoute roles={['admin', 'manager']}>
                <UserManagement />
              </PrivateRoute>
            } />
          </Route>
          
          <Route path="/unauthorized" element={<UnauthorizedPage />} />
          <Route path="*" element={<NotFound />} />
        </Routes>
      </BrowserRouter>
    </AuthProvider>
  );
}
```

#### 5.2.3 ä»£ç åˆ†å‰²ä¸æ‡’åŠ è½½

**è·¯ç”±çº§åˆ«çš„ä»£ç åˆ†å‰²**
```javascript
import React, { Suspense, lazy } from 'react';
import { BrowserRouter, Routes, Route } from 'react-router-dom';

// æ‡’åŠ è½½ç»„ä»¶
const Home = lazy(() => import('./pages/Home'));
const About = lazy(() => import('./pages/About'));
const Dashboard = lazy(() => import('./pages/Dashboard'));
const UserProfile = lazy(() => 
  import('./pages/UserProfile').then(module => ({
    default: module.UserProfile
  }))
);

// åŠ è½½é”™è¯¯è¾¹ç•Œ
class RouteErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false, error: null };
  }

  static getDerivedStateFromError(error) {
    return { hasError: true, error };
  }

  componentDidCatch(error, errorInfo) {
    console.error('Route loading error:', error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      return (
        <div>
          <h2>é¡µé¢åŠ è½½å¤±è´¥</h2>
          <button onClick={() => window.location.reload()}>
            é‡æ–°åŠ è½½
          </button>
        </div>
      );
    }

    return this.props.children;
  }
}

// åŠ è½½æŒ‡ç¤ºå™¨
function LoadingSpinner() {
  return (
    <div className="loading-spinner">
      <div>Loading...</div>
    </div>
  );
}

// åº”ç”¨è·¯ç”±
function App() {
  return (
    <BrowserRouter>
      <RouteErrorBoundary>
        <Suspense fallback={<LoadingSpinner />}>
          <Routes>
            <Route path="/" element={<Home />} />
            <Route path="/about" element={<About />} />
            <Route path="/dashboard/*" element={<Dashboard />} />
            <Route path="/user/:id" element={<UserProfile />} />
          </Routes>
        </Suspense>
      </RouteErrorBoundary>
    </BrowserRouter>
  );
}

// é«˜çº§æ‡’åŠ è½½é’©å­
function useLazyComponent(importFunc, deps = []) {
  const [Component, setComponent] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  useEffect(() => {
    let cancelled = false;
    
    setLoading(true);
    setError(null);
    
    importFunc()
      .then(module => {
        if (!cancelled) {
          setComponent(() => module.default);
          setLoading(false);
        }
      })
      .catch(error => {
        if (!cancelled) {
          setError(error);
          setLoading(false);
        }
      });

    return () => {
      cancelled = true;
    };
  }, deps);

  return { Component, loading, error };
}

// ä½¿ç”¨è‡ªå®šä¹‰æ‡’åŠ è½½é’©å­
function ConditionalRoute({ shouldLoad, importFunc, fallback }) {
  const { Component, loading, error } = useLazyComponent(
    importFunc,
    [shouldLoad]
  );

  if (!shouldLoad) {
    return fallback || null;
  }

  if (loading) {
    return <LoadingSpinner />;
  }

  if (error) {
    return <div>Error loading component</div>;
  }

  return Component ? <Component /> : null;
}
```

## 6. æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ

### 6.1 Reactæ€§èƒ½ä¼˜åŒ–

#### 6.1.1 React.memo

**åŸºæœ¬ç”¨æ³•å’Œä¼˜åŒ–åœºæ™¯**
```javascript
import React, { memo, useState, useMemo } from 'react';

// æœªä¼˜åŒ–çš„ç»„ä»¶
function ExpensiveChildComponent({ items, onItemClick }) {
  console.log('ExpensiveChildComponent rendered');
  
  return (
    <div>
      {items.map(item => (
        <div key={item.id} onClick={() => onItemClick(item.id)}>
          {item.name} - {item.value}
        </div>
      ))}
    </div>
  );
}

// ä½¿ç”¨React.memoä¼˜åŒ–
const OptimizedChildComponent = memo(function ChildComponent({ items, onItemClick }) {
  console.log('OptimizedChildComponent rendered');
  
  return (
    <div>
      {items.map(item => (
        <div key={item.id} onClick={() => onItemClick(item.id)}>
          {item.name} - {item.value}
        </div>
      ))}
    </div>
  );
});

// è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°
const CustomMemoComponent = memo(function Component({ user, settings }) {
  return (
    <div>
      <h3>{user.name}</h3>
      <p>Theme: {settings.theme}</p>
    </div>
  );
}, (prevProps, nextProps) => {
  // åªåœ¨ç”¨æˆ·åæˆ–ä¸»é¢˜æ”¹å˜æ—¶é‡æ–°æ¸²æŸ“
  return (
    prevProps.user.name === nextProps.user.name &&
    prevProps.settings.theme === nextProps.settings.theme
  );
});

// çˆ¶ç»„ä»¶
function ParentComponent() {
  const [count, setCount] = useState(0);
  const [items] = useState([
    { id: 1, name: 'Item 1', value: 100 },
    { id: 2, name: 'Item 2', value: 200 }
  ]);

  // ä½¿ç”¨useCallbackä¼˜åŒ–å‡½æ•°å¼•ç”¨
  const handleItemClick = useCallback((itemId) => {
    console.log('Item clicked:', itemId);
  }, []);

  return (
    <div>
      <button onClick={() => setCount(count + 1)}>
        Count: {count}
      </button>
      
      {/* æœªä¼˜åŒ–ï¼šæ¯æ¬¡çˆ¶ç»„ä»¶æ›´æ–°éƒ½ä¼šé‡æ–°æ¸²æŸ“ */}
      <ExpensiveChildComponent 
        items={items} 
        onItemClick={handleItemClick} 
      />
      
      {/* ä¼˜åŒ–åï¼šåªåœ¨propsæ”¹å˜æ—¶é‡æ–°æ¸²æŸ“ */}
      <OptimizedChildComponent 
        items={items} 
        onItemClick={handleItemClick} 
      />
    </div>
  );
}
```

#### 6.1.2 useMemoå’ŒuseCallback

**æ€§èƒ½ä¼˜åŒ–å®è·µ**
```javascript
import React, { useState, useMemo, useCallback } from 'react';

function DataProcessingComponent({ rawData, filters }) {
  const [sortOrder, setSortOrder] = useState('asc');
  const [selectedItems, setSelectedItems] = useState(new Set());

  // æ˜‚è´µçš„æ•°æ®å¤„ç†æ“ä½œ
  const processedData = useMemo(() => {
    console.log('Processing data...');
    
    return rawData
      .filter(item => {
        return filters.every(filter => 
          item[filter.field]?.toString().toLowerCase()
            .includes(filter.value.toLowerCase())
        );
      })
      .sort((a, b) => {
        const modifier = sortOrder === 'asc' ? 1 : -1;
        return a.name.localeCompare(b.name) * modifier;
      })
      .map(item => ({
        ...item,
        processed: true,
        timestamp: Date.now()
      }));
  }, [rawData, filters, sortOrder]);

  // ç¼“å­˜äº‹ä»¶å¤„ç†å‡½æ•°
  const handleSort = useCallback((newSortOrder) => {
    setSortOrder(newSortOrder);
  }, []);

  const handleItemSelect = useCallback((itemId) => {
    setSelectedItems(prev => {
      const newSet = new Set(prev);
      if (newSet.has(itemId)) {
        newSet.delete(itemId);
      } else {
        newSet.add(itemId);
      }
      return newSet;
    });
  }, []);

  const handleSelectAll = useCallback(() => {
    setSelectedItems(new Set(processedData.map(item => item.id)));
  }, [processedData]);

  const handleClearSelection = useCallback(() => {
    setSelectedItems(new Set());
  }, []);

  // è®¡ç®—è¡ç”ŸçŠ¶æ€
  const statistics = useMemo(() => {
    return {
      total: processedData.length,
      selected: selectedItems.size,
      averageValue: processedData.reduce((sum, item) => sum + item.value, 0) / processedData.length
    };
  }, [processedData, selectedItems]);

  return (
    <div>
      <div>
        <button onClick={() => handleSort('asc')}>Sort Ascending</button>
        <button onClick={() => handleSort('desc')}>Sort Descending</button>
        <button onClick={handleSelectAll}>Select All</button>
        <button onClick={handleClearSelection}>Clear Selection</button>
      </div>
      
      <div>
        Total: {statistics.total}, 
        Selected: {statistics.selected}, 
        Average: {statistics.averageValue.toFixed(2)}
      </div>
      
      <DataList 
        items={processedData}
        selectedItems={selectedItems}
        onItemSelect={handleItemSelect}
      />
    </div>
  );
}

// ä¼˜åŒ–çš„åˆ—è¡¨ç»„ä»¶
const DataList = memo(function DataList({ items, selectedItems, onItemSelect }) {
  return (
    <div>
      {items.map(item => (
        <DataItem
          key={item.id}
          item={item}
          isSelected={selectedItems.has(item.id)}
          onSelect={onItemSelect}
        />
      ))}
    </div>
  );
});

const DataItem = memo(function DataItem({ item, isSelected, onSelect }) {
  return (
    <div 
      className={isSelected ? 'selected' : ''}
      onClick={() => onSelect(item.id)}
    >
      {item.name} - {item.value}
    </div>
  );
});
```

#### 6.1.3 Concurrent Mode

**å¹¶å‘ç‰¹æ€§ä½¿ç”¨**
```javascript
import React, { useState, useDeferredValue, useTransition, Suspense } from 'react';

// é‡CPUä»»åŠ¡ç»„ä»¶
function HeavyComponent({ searchTerm }) {
  const items = useMemo(() => {
    // æ¨¡æ‹Ÿå¤§é‡æ•°æ®å¤„ç†
    const result = [];
    for (let i = 0; i < 10000; i++) {
      if (`Item ${i}`.toLowerCase().includes(searchTerm.toLowerCase())) {
        result.push({ id: i, name: `Item ${i}`, value: Math.random() * 100 });
      }
    }
    return result;
  }, [searchTerm]);

  return (
    <div>
      <p>Found {items.length} items</p>
      {items.slice(0, 100).map(item => (
        <div key={item.id}>{item.name}</div>
      ))}
    </div>
  );
}

function SearchWithDeferredValue() {
  const [searchTerm, setSearchTerm] = useState('');
  const deferredSearchTerm = useDeferredValue(searchTerm);

  return (
    <div>
      <input
        type="text"
        value={searchTerm}
        onChange={(e) => setSearchTerm(e.target.value)}
        placeholder="Search items..."
      />
      
      {/* ä½¿ç”¨å»¶è¿Ÿå€¼ï¼Œä¿æŒè¾“å…¥å“åº”æ€§ */}
      <HeavyComponent searchTerm={deferredSearchTerm} />
    </div>
  );
}

function SearchWithTransition() {
  const [searchTerm, setSearchTerm] = useState('');
  const [results, setResults] = useState([]);
  const [isPending, startTransition] = useTransition();

  const handleSearch = (value) => {
    setSearchTerm(value);
    
    // å°†é‡ä»»åŠ¡æ ‡è®°ä¸ºéç´§æ€¥
    startTransition(() => {
      const filtered = heavyDataProcessing(value);
      setResults(filtered);
    });
  };

  return (
    <div>
      <input
        type="text"
        value={searchTerm}
        onChange={(e) => handleSearch(e.target.value)}
        placeholder="Search..."
      />
      
      {isPending && <div>Searching...</div>}
      
      <div>
        {results.map(item => (
          <div key={item.id}>{item.name}</div>
        ))}
      </div>
    </div>
  );
}
```

### 6.2 ä»£ç åˆ†å‰²ä¸æ‡’åŠ è½½

#### 6.2.1 åŠ¨æ€å¯¼å…¥

**ç»„ä»¶çº§ä»£ç åˆ†å‰²**
```javascript
import React, { lazy, Suspense, useState } from 'react';

// æ‡’åŠ è½½é‡ç»„ä»¶
const HeavyChart = lazy(() => import('./HeavyChart'));
const DataTable = lazy(() => import('./DataTable'));
const ReportGenerator = lazy(() => import('./ReportGenerator'));

// é¢„åŠ è½½ç­–ç•¥
const preloadChart = () => import('./HeavyChart');
const preloadTable = () => import('./DataTable');

function Dashboard() {
  const [activeTab, setActiveTab] = useState('overview');
  
  // é¢„åŠ è½½ç­–ç•¥
  useEffect(() => {
    // é¼ æ ‡æ‚¬åœæ—¶é¢„åŠ è½½
    const chartButton = document.getElementById('chart-tab');
    if (chartButton) {
      chartButton.addEventListener('mouseenter', preloadChart);
    }
    
    // å»¶è¿Ÿé¢„åŠ è½½å¸¸ç”¨ç»„ä»¶
    const timer = setTimeout(preloadTable, 2000);
    
    return () => {
      if (chartButton) {
        chartButton.removeEventListener('mouseenter', preloadChart);
      }
      clearTimeout(timer);
    };
  }, []);

  return (
    <div>
      <nav>
        <button 
          id="overview-tab"
          onClick={() => setActiveTab('overview')}
          className={activeTab === 'overview' ? 'active' : ''}
        >
          Overview
        </button>
        <button 
          id="chart-tab"
          onClick={() => setActiveTab('chart')}
          className={activeTab === 'chart' ? 'active' : ''}
        >
          Charts
        </button>
        <button 
          onClick={() => setActiveTab('table')}
          className={activeTab === 'table' ? 'active' : ''}
        >
          Data Table
        </button>
      </nav>
      
      <main>
        {activeTab === 'overview' && (
          <div>
            <h2>Dashboard Overview</h2>
            <p>Key metrics and summary information</p>
          </div>
        )}
        
        {activeTab === 'chart' && (
          <Suspense fallback={<ChartSkeleton />}>
            <HeavyChart />
          </Suspense>
        )}
        
        {activeTab === 'table' && (
          <Suspense fallback={<TableSkeleton />}>
            <DataTable />
          </Suspense>
        )}
      </main>
    </div>
  );
}

// éª¨æ¶å±ç»„ä»¶
function ChartSkeleton() {
  return (
    <div className="skeleton">
      <div className="skeleton-header"></div>
      <div className="skeleton-chart"></div>
    </div>
  );
}

function TableSkeleton() {
  return (
    <div className="skeleton">
      {[...Array(5)].map((_, i) => (
        <div key={i} className="skeleton-row">
          <div className="skeleton-cell"></div>
          <div className="skeleton-cell"></div>
          <div className="skeleton-cell"></div>
        </div>
      ))}
    </div>
  );
}
```

#### 6.2.2 Suspenseä¸ErrorBoundary

**é”™è¯¯è¾¹ç•Œå’ŒåŠ è½½çŠ¶æ€ç®¡ç†**
```javascript
import React, { Suspense, Component } from 'react';

// é”™è¯¯è¾¹ç•Œç»„ä»¶
class ChunkErrorBoundary extends Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false, error: null };
  }

  static getDerivedStateFromError(error) {
    return { hasError: true, error };
  }

  componentDidCatch(error, errorInfo) {
    console.error('Chunk loading error:', error, errorInfo);
    
    // å‘é€é”™è¯¯æ—¥å¿—åˆ°ç›‘æ§æœåŠ¡
    if (this.props.onError) {
      this.props.onError(error, errorInfo);
    }
  }

  handleRetry = () => {
    this.setState({ hasError: false, error: null });
    
    // å¯é€‰ï¼šé‡æ–°åŠ è½½é¡µé¢
    if (this.props.fallbackToReload) {
      window.location.reload();
    }
  };

  render() {
    if (this.state.hasError) {
      if (this.props.fallback) {
        return this.props.fallback(this.state.error, this.handleRetry);
      }
      
      return (
        <div className="error-boundary">
          <h2>Something went wrong loading this section</h2>
          <details>
            <summary>Error details</summary>
            <pre>{this.state.error?.message}</pre>
          </details>
          <button onClick={this.handleRetry}>
            Try again
          </button>
        </div>
      );
    }

    return this.props.children;
  }
}

// åŠ è½½çŠ¶æ€ç»„ä»¶
function LoadingFallback({ message = "Loading..." }) {
  const [dots, setDots] = useState('');
  
  useEffect(() => {
    const interval = setInterval(() => {
      setDots(prev => prev.length >= 3 ? '' : prev + '.');
    }, 500);
    
    return () => clearInterval(interval);
  }, []);

  return (
    <div className="loading-fallback">
      <div className="spinner"></div>
      <p>{message}{dots}</p>
    </div>
  );
}

// åµŒå¥—Suspenseç¤ºä¾‹
function NestedSuspenseExample() {
  return (
    <div>
      <h1>My App</h1>
      
      <ChunkErrorBoundary>
        <Suspense fallback={<LoadingFallback message="Loading main content" />}>
          <MainContent />
        </Suspense>
      </ChunkErrorBoundary>
    </div>
  );
}

function MainContent() {
  return (
    <div>
      <header>Main Header</header>
      
      <ChunkErrorBoundary>
        <Suspense fallback={<LoadingFallback message="Loading sidebar" />}>
          <Sidebar />
        </Suspense>
      </ChunkErrorBoundary>
      
      <main>
        <ChunkErrorBoundary>
          <Suspense fallback={<LoadingFallback message="Loading main panel" />}>
            <MainPanel />
          </Suspense>
        </ChunkErrorBoundary>
      </main>
    </div>
  );
}

// æ‡’åŠ è½½ç»„ä»¶
const Sidebar = lazy(() => import('./Sidebar'));
const MainPanel = lazy(() => import('./MainPanel'));
```

### 6.3 æœ€ä½³å®è·µ

#### 6.3.1 ç»„ä»¶è®¾è®¡åŸåˆ™

**ç»„ä»¶æ‹†åˆ†å’Œå¤ç”¨åŸåˆ™**
```javascript
// âŒ ä¸å¥½çš„è®¾è®¡ï¼šå¤§å‹å•ä½“ç»„ä»¶
function BadUserProfile({ userId }) {
  const [user, setUser] = useState(null);
  const [posts, setPosts] = useState([]);
  const [friends, setFriends] = useState([]);
  const [editing, setEditing] = useState(false);
  const [formData, setFormData] = useState({});

  // å¤§é‡é€»è¾‘å’ŒJSX...
  return (
    <div className="user-profile">
      {/* æ•°ç™¾è¡ŒJSX */}
    </div>
  );
}

// âœ… å¥½çš„è®¾è®¡ï¼šç»„ä»¶æ‹†åˆ†
function UserProfile({ userId }) {
  const { user, loading, error } = useUser(userId);

  if (loading) return <ProfileSkeleton />;
  if (error) return <ErrorMessage error={error} />;
  if (!user) return <UserNotFound />;

  return (
    <div className="user-profile">
      <UserHeader user={user} />
      <UserTabs userId={userId} />
    </div>
  );
}

// å¯å¤ç”¨çš„ç”¨æˆ·å¤´éƒ¨ç»„ä»¶
function UserHeader({ user }) {
  const [editing, setEditing] = useState(false);

  return (
    <header className="user-header">
      <UserAvatar user={user} size="large" />
      <UserInfo user={user} />
      {editing ? (
        <UserEditForm 
          user={user} 
          onSave={() => setEditing(false)}
          onCancel={() => setEditing(false)}
        />
      ) : (
        <EditButton onClick={() => setEditing(true)} />
      )}
    </header>
  );
}

// å¯é…ç½®çš„é€šç”¨ç»„ä»¶
function UserAvatar({ user, size = 'medium', onClick, className }) {
  const sizeMap = {
    small: 32,
    medium: 48,
    large: 64,
    xlarge: 96
  };

  const avatarSize = sizeMap[size];

  return (
    <div 
      className={`user-avatar user-avatar--${size} ${className}`}
      onClick={onClick}
      style={{ 
        width: avatarSize, 
        height: avatarSize,
        cursor: onClick ? 'pointer' : 'default'
      }}
    >
      {user.avatar ? (
        <img 
          src={user.avatar} 
          alt={`${user.name}'s avatar`}
          loading="lazy"
        />
      ) : (
        <div className="avatar-placeholder">
          {user.name.charAt(0).toUpperCase()}
        </div>
      )}
    </div>
  );
}

// è‡ªå®šä¹‰Hookå°è£…é€»è¾‘
function useUser(userId) {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    let cancelled = false;

    async function fetchUser() {
      try {
        setLoading(true);
        setError(null);
        
        const userData = await api.getUser(userId);
        
        if (!cancelled) {
          setUser(userData);
        }
      } catch (err) {
        if (!cancelled) {
          setError(err);
        }
      } finally {
        if (!cancelled) {
          setLoading(false);
        }
      }
    }

    fetchUser();

    return () => {
      cancelled = true;
    };
  }, [userId]);

  return { user, loading, error };
}
```

#### 6.3.2 æ€§èƒ½ç›‘æ§

**æ€§èƒ½æŒ‡æ ‡æ”¶é›†å’Œåˆ†æ**
```javascript
import { getCLS, getFID, getFCP, getLCP, getTTFB } from 'web-vitals';

// æ€§èƒ½ç›‘æ§Hook
function usePerformanceMonitoring() {
  useEffect(() => {
    // Core Web Vitals
    getCLS(metric => {
      console.log('CLS:', metric);
      sendToAnalytics('CLS', metric.value);
    });

    getFID(metric => {
      console.log('FID:', metric);
      sendToAnalytics('FID', metric.value);
    });

    getLCP(metric => {
      console.log('LCP:', metric);
      sendToAnalytics('LCP', metric.value);
    });

    getFCP(metric => {
      console.log('FCP:', metric);
      sendToAnalytics('FCP', metric.value);
    });

    getTTFB(metric => {
      console.log('TTFB:', metric);
      sendToAnalytics('TTFB', metric.value);
    });
  }, []);
}

// Reactæ€§èƒ½åˆ†æå™¨
function ProfiledComponent({ children, id }) {
  const onRenderCallback = useCallback((
    id,
    phase,
    actualDuration,
    baseDuration,
    startTime,
    commitTime,
    interactions
  ) => {
    console.log('Profiler:', {
      id,
      phase,
      actualDuration,
      baseDuration,
      startTime,
      commitTime,
      interactions: Array.from(interactions)
    });
    
    // å‘é€æ€§èƒ½æ•°æ®
    if (actualDuration > 50) { // æ¸²æŸ“æ—¶é—´è¶…è¿‡50ms
      sendToAnalytics('slow-render', {
        componentId: id,
        duration: actualDuration,
        phase
      });
    }
  }, []);

  return (
    <Profiler id={id} onRender={onRenderCallback}>
      {children}
    </Profiler>
  );
}

// ç»„ä»¶æ¸²æŸ“æ¬¡æ•°ç›‘æ§
function useRenderCount(componentName) {
  const renderCount = useRef(0);
  
  useEffect(() => {
    renderCount.current += 1;
    console.log(`${componentName} rendered ${renderCount.current} times`);
  });

  return renderCount.current;
}

// å†…å­˜ä½¿ç”¨ç›‘æ§
function useMemoryUsage() {
  const [memoryUsage, setMemoryUsage] = useState(null);

  useEffect(() => {
    const updateMemoryUsage = () => {
      if ('memory' in performance) {
        setMemoryUsage({
          usedJSHeapSize: performance.memory.usedJSHeapSize,
          totalJSHeapSize: performance.memory.totalJSHeapSize,
          jsHeapSizeLimit: performance.memory.jsHeapSizeLimit
        });
      }
    };

    updateMemoryUsage();
    const interval = setInterval(updateMemoryUsage, 5000);

    return () => clearInterval(interval);
  }, []);

  return memoryUsage;
}

// ä½¿ç”¨ç¤ºä¾‹
function App() {
  usePerformanceMonitoring();
  const memoryUsage = useMemoryUsage();
  const renderCount = useRenderCount('App');

  return (
    <ProfiledComponent id="App">
      <div>
        <h1>My App (Renders: {renderCount})</h1>
        {memoryUsage && (
          <div>
            Memory Usage: {(memoryUsage.usedJSHeapSize / 1048576).toFixed(2)} MB
          </div>
        )}
        <MainContent />
      </div>
    </ProfiledComponent>
  );
}

// åˆ†æå·¥å…·å‡½æ•°
function sendToAnalytics(eventName, data) {
  // å‘é€åˆ°åˆ†ææœåŠ¡
  if (typeof window !== 'undefined' && window.gtag) {
    window.gtag('event', eventName, {
      custom_parameter: data
    });
  }
  
  // æˆ–å‘é€åˆ°è‡ªå®šä¹‰åˆ†ææœåŠ¡
  fetch('/api/analytics', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ event: eventName, data })
  });
}
```

## 7. æµ‹è¯•ä¸è´¨é‡ä¿è¯

### 7.1 æµ‹è¯•åŸºç¡€

#### 7.1.1 æµ‹è¯•ç¯å¢ƒé…ç½®

**Jesté…ç½®**
```javascript
// jest.config.js
module.exports = {
  testEnvironment: 'jsdom',
  setupFilesAfterEnv: ['<rootDir>/src/setupTests.js'],
  moduleNameMapping: {
    '\\.(css|less|scss|sass)$': 'identity-obj-proxy',
    '\\.(jpg|jpeg|png|gif|eot|otf|webp|svg|ttf|woff|woff2|mp4|webm|wav|mp3|m4a|aac|oga)$': 
      '<rootDir>/__mocks__/fileMock.js'
  },
  collectCoverageFrom: [
    'src/**/*.{js,jsx,ts,tsx}',
    '!src/**/*.d.ts',
    '!src/index.js',
    '!src/reportWebVitals.js'
  ],
  coverageThreshold: {
    global: {
      branches: 80,
      functions: 80,
      lines: 80,
      statements: 80
    }
  },
  testMatch: [
    '<rootDir>/src/**/__tests__/**/*.{js,jsx,ts,tsx}',
    '<rootDir>/src/**/?(*.)(spec|test).{js,jsx,ts,tsx}'
  ]
};

// src/setupTests.js
import '@testing-library/jest-dom';
import { configure } from '@testing-library/react';

// é…ç½®Testing Library
configure({ testIdAttribute: 'data-testid' });

// æ¨¡æ‹ŸAPI
global.fetch = jest.fn();

// æ¨¡æ‹ŸIntersectionObserver
global.IntersectionObserver = class IntersectionObserver {
  constructor() {}
  disconnect() {}
  observe() {}
  unobserve() {}
};

// æ¨¡æ‹ŸmatchMedia
Object.defineProperty(window, 'matchMedia', {
  writable: true,
  value: jest.fn().mockImplementation(query => ({
    matches: false,
    media: query,
    onchange: null,
    addListener: jest.fn(),
    removeListener: jest.fn(),
    addEventListener: jest.fn(),
    removeEventListener: jest.fn(),
    dispatchEvent: jest.fn(),
  })),
});
```

#### 7.1.2 æµ‹è¯•ç±»å‹

**æµ‹è¯•é‡‘å­—å¡”**
```mermaid
graph TD
    A["æµ‹è¯•é‡‘å­—å¡”"] --> B["å•å…ƒæµ‹è¯• (70%)"]
    A --> C["é›†æˆæµ‹è¯• (20%)"]
    A --> D["E2Eæµ‹è¯• (10%)"]
    
    B --> B1["ç»„ä»¶æµ‹è¯•"]
    B --> B2["å‡½æ•°æµ‹è¯•"]
    B --> B3["Hookæµ‹è¯•"]
    
    C --> C1["ç»„ä»¶é›†æˆ"]
    C --> C2["APIé›†æˆ"]
    C --> C3["è·¯ç”±æµ‹è¯•"]
    
    D --> D1["ç”¨æˆ·æµç¨‹"]
    D --> D2["è·¨æµè§ˆå™¨"]
    D --> D3["æ€§èƒ½æµ‹è¯•"]
    
    style A fill:#e1f5fe
    style B fill:#e8f5e8
    style C fill:#fff3e0
    style D fill:#fce4ec
```

### 7.2 å•å…ƒæµ‹è¯•

#### 7.2.1 Jestæµ‹è¯•æ¡†æ¶

**åŸºç¡€æµ‹è¯•ç¤ºä¾‹**
```javascript
// src/utils/math.js
export const add = (a, b) => a + b;
export const multiply = (a, b) => a * b;
export const divide = (a, b) => {
  if (b === 0) throw new Error('Division by zero');
  return a / b;
};

// src/utils/__tests__/math.test.js
import { add, multiply, divide } from '../math';

describe('Math utilities', () => {
  describe('add', () => {
    test('should add two positive numbers', () => {
      expect(add(2, 3)).toBe(5);
    });

    test('should handle negative numbers', () => {
      expect(add(-1, 1)).toBe(0);
    });

    test('should handle decimal numbers', () => {
      expect(add(0.1, 0.2)).toBeCloseTo(0.3);
    });
  });

  describe('multiply', () => {
    test.each([
      [2, 3, 6],
      [0, 5, 0],
      [-2, 3, -6],
      [2.5, 4, 10]
    ])('multiply(%i, %i) should equal %i', (a, b, expected) => {
      expect(multiply(a, b)).toBe(expected);
    });
  });

  describe('divide', () => {
    test('should divide two numbers', () => {
      expect(divide(6, 2)).toBe(3);
    });

    test('should throw error when dividing by zero', () => {
      expect(() => divide(5, 0)).toThrow('Division by zero');
    });
  });
});

// Mockæµ‹è¯•
import axios from 'axios';
import { fetchUserData } from '../api';

jest.mock('axios');
const mockedAxios = axios as jest.Mocked<typeof axios>;

describe('API functions', () => {
  afterEach(() => {
    jest.clearAllMocks();
  });

  test('should fetch user data successfully', async () => {
    const userData = { id: 1, name: 'John Doe' };
    mockedAxios.get.mockResolvedValue({ data: userData });

    const result = await fetchUserData(1);

    expect(mockedAxios.get).toHaveBeenCalledWith('/api/users/1');
    expect(result).toEqual(userData);
  });

  test('should handle API error', async () => {
    const errorMessage = 'Network Error';
    mockedAxios.get.mockRejectedValue(new Error(errorMessage));

    await expect(fetchUserData(1)).rejects.toThrow(errorMessage);
  });
});
```

#### 7.2.2 React Testing Library

**ç»„ä»¶æµ‹è¯•æœ€ä½³å®è·µ**
```javascript
import React from 'react';
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import { BrowserRouter } from 'react-router-dom';
import { QueryClient, QueryClientProvider } from 'react-query';
import LoginForm from '../LoginForm';

// æµ‹è¯•å·¥å…·å‡½æ•°
const renderWithProviders = (ui, options = {}) => {
  const queryClient = new QueryClient({
    defaultOptions: {
      queries: { retry: false },
      mutations: { retry: false }
    }
  });

  const AllTheProviders = ({ children }) => (
    <QueryClientProvider client={queryClient}>
      <BrowserRouter>
        {children}
      </BrowserRouter>
    </QueryClientProvider>
  );

  return render(ui, { wrapper: AllTheProviders, ...options });
};

describe('LoginForm', () => {
  const mockOnLogin = jest.fn();
  
  beforeEach(() => {
    mockOnLogin.mockClear();
  });

  test('renders login form elements', () => {
    renderWithProviders(<LoginForm onLogin={mockOnLogin} />);
    
    expect(screen.getByLabelText(/username/i)).toBeInTheDocument();
    expect(screen.getByLabelText(/password/i)).toBeInTheDocument();
    expect(screen.getByRole('button', { name: /login/i })).toBeInTheDocument();
  });

  test('shows validation errors for empty fields', async () => {
    const user = userEvent.setup();
    renderWithProviders(<LoginForm onLogin={mockOnLogin} />);
    
    const loginButton = screen.getByRole('button', { name: /login/i });
    await user.click(loginButton);
    
    expect(screen.getByText(/username is required/i)).toBeInTheDocument();
    expect(screen.getByText(/password is required/i)).toBeInTheDocument();
    expect(mockOnLogin).not.toHaveBeenCalled();
  });

  test('submits form with valid data', async () => {
    const user = userEvent.setup();
    renderWithProviders(<LoginForm onLogin={mockOnLogin} />);
    
    const usernameInput = screen.getByLabelText(/username/i);
    const passwordInput = screen.getByLabelText(/password/i);
    const loginButton = screen.getByRole('button', { name: /login/i });
    
    await user.type(usernameInput, 'testuser');
    await user.type(passwordInput, 'password123');
    await user.click(loginButton);
    
    expect(mockOnLogin).toHaveBeenCalledWith({
      username: 'testuser',
      password: 'password123'
    });
  });

  test('disables submit button while loading', async () => {
    const user = userEvent.setup();
    renderWithProviders(<LoginForm onLogin={mockOnLogin} loading={true} />);
    
    const loginButton = screen.getByRole('button', { name: /logging in/i });
    
    expect(loginButton).toBeDisabled();
    expect(screen.getByRole('progressbar')).toBeInTheDocument();
  });

  test('shows error message on login failure', async () => {
    const errorMessage = 'Invalid credentials';
    renderWithProviders(
      <LoginForm onLogin={mockOnLogin} error={errorMessage} />
    );
    
    expect(screen.getByRole('alert')).toHaveTextContent(errorMessage);
  });
});

// å¤æ‚ç»„ä»¶æµ‹è¯•
describe('TodoList', () => {
  const mockTodos = [
    { id: 1, text: 'Learn React', completed: false },
    { id: 2, text: 'Write tests', completed: true }
  ];

  test('filters todos based on status', async () => {
    const user = userEvent.setup();
    renderWithProviders(<TodoList initialTodos={mockTodos} />);
    
    // æ˜¾ç¤ºæ‰€æœ‰todos
    expect(screen.getByText('Learn React')).toBeInTheDocument();
    expect(screen.getByText('Write tests')).toBeInTheDocument();
    
    // ç­›é€‰å·²å®Œæˆçš„todos
    const completedFilter = screen.getByRole('button', { name: /completed/i });
    await user.click(completedFilter);
    
    expect(screen.queryByText('Learn React')).not.toBeInTheDocument();
    expect(screen.getByText('Write tests')).toBeInTheDocument();
  });

  test('adds new todo', async () => {
    const user = userEvent.setup();
    renderWithProviders(<TodoList initialTodos={[]} />);
    
    const input = screen.getByPlaceholderText(/add new todo/i);
    const addButton = screen.getByRole('button', { name: /add/i });
    
    await user.type(input, 'New todo item');
    await user.click(addButton);
    
    expect(screen.getByText('New todo item')).toBeInTheDocument();
    expect(input).toHaveValue('');
  });

  test('toggles todo completion', async () => {
    const user = userEvent.setup();
    renderWithProviders(<TodoList initialTodos={mockTodos} />);
    
    const checkbox = screen.getByRole('checkbox', { name: /learn react/i });
    expect(checkbox).not.toBeChecked();
    
    await user.click(checkbox);
    expect(checkbox).toBeChecked();
  });
});
```

**è‡ªå®šä¹‰Hookæµ‹è¯•**
```javascript
import { renderHook, act } from '@testing-library/react';
import { useCounter } from '../hooks/useCounter';
import { useLocalStorage } from '../hooks/useLocalStorage';

describe('useCounter', () => {
  test('should initialize with default value', () => {
    const { result } = renderHook(() => useCounter());
    
    expect(result.current.count).toBe(0);
  });

  test('should initialize with custom value', () => {
    const { result } = renderHook(() => useCounter(10));
    
    expect(result.current.count).toBe(10);
  });

  test('should increment count', () => {
    const { result } = renderHook(() => useCounter());
    
    act(() => {
      result.current.increment();
    });
    
    expect(result.current.count).toBe(1);
  });

  test('should decrement count', () => {
    const { result } = renderHook(() => useCounter(5));
    
    act(() => {
      result.current.decrement();
    });
    
    expect(result.current.count).toBe(4);
  });

  test('should reset count', () => {
    const { result } = renderHook(() => useCounter(10));
    
    act(() => {
      result.current.increment();
      result.current.increment();
    });
    
    expect(result.current.count).toBe(12);
    
    act(() => {
      result.current.reset();
    });
    
    expect(result.current.count).toBe(10);
  });
});

describe('useLocalStorage', () => {
  beforeEach(() => {
    localStorage.clear();
  });

  test('should return initial value when no stored value', () => {
    const { result } = renderHook(() => 
      useLocalStorage('test-key', 'initial')
    );
    
    expect(result.current[0]).toBe('initial');
  });

  test('should update localStorage when value changes', () => {
    const { result } = renderHook(() => 
      useLocalStorage('test-key', 'initial')
    );
    
    act(() => {
      result.current[1]('updated');
    });
    
    expect(result.current[0]).toBe('updated');
    expect(localStorage.getItem('test-key')).toBe('"updated"');
  });

  test('should handle JSON serialization', () => {
    const initialValue = { name: 'John', age: 30 };
    const { result } = renderHook(() => 
      useLocalStorage('user', initialValue)
    );
    
    expect(result.current[0]).toEqual(initialValue);
    
    const updatedValue = { name: 'Jane', age: 25 };
    act(() => {
      result.current[1](updatedValue);
    });
    
    expect(result.current[0]).toEqual(updatedValue);
  });
});
```

### 7.3 é›†æˆæµ‹è¯•ä¸E2Eæµ‹è¯•

#### 7.3.1 ç»„ä»¶é›†æˆæµ‹è¯•

**å¤šç»„ä»¶äº¤äº’æµ‹è¯•**
```javascript
import React from 'react';
import { render, screen, waitFor } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import { rest } from 'msw';
import { setupServer } from 'msw/node';
import App from '../App';

// Mock Service Workerè®¾ç½®
const server = setupServer(
  rest.get('/api/users', (req, res, ctx) => {
    return res(
      ctx.json([
        { id: 1, name: 'John Doe', email: 'john@example.com' },
        { id: 2, name: 'Jane Smith', email: 'jane@example.com' }
      ])
    );
  }),
  
  rest.post('/api/users', (req, res, ctx) => {
    const { name, email } = req.body;
    return res(
      ctx.json({ id: 3, name, email })
    );
  }),
  
  rest.delete('/api/users/:id', (req, res, ctx) => {
    return res(ctx.status(204));
  })
);

beforeAll(() => server.listen());
afterEach(() => server.resetHandlers());
afterAll(() => server.close());

describe('User Management Integration', () => {
  test('complete user management flow', async () => {
    const user = userEvent.setup();
    render(<App />);
    
    // ç­‰å¾…ç”¨æˆ·åˆ—è¡¨åŠ è½½
    await waitFor(() => {
      expect(screen.getByText('John Doe')).toBeInTheDocument();
      expect(screen.getByText('Jane Smith')).toBeInTheDocument();
    });
    
    // æ·»åŠ æ–°ç”¨æˆ·
    const nameInput = screen.getByLabelText(/name/i);
    const emailInput = screen.getByLabelText(/email/i);
    const addButton = screen.getByRole('button', { name: /add user/i });
    
    await user.type(nameInput, 'Bob Johnson');
    await user.type(emailInput, 'bob@example.com');
    await user.click(addButton);
    
    // éªŒè¯æ–°ç”¨æˆ·è¢«æ·»åŠ 
    await waitFor(() => {
      expect(screen.getByText('Bob Johnson')).toBeInTheDocument();
    });
    
    // åˆ é™¤ç”¨æˆ·
    const deleteButtons = screen.getAllByRole('button', { name: /delete/i });
    await user.click(deleteButtons[0]);
    
    // ç¡®è®¤åˆ é™¤
    const confirmButton = screen.getByRole('button', { name: /confirm/i });
    await user.click(confirmButton);
    
    // éªŒè¯ç”¨æˆ·è¢«åˆ é™¤
    await waitFor(() => {
      expect(screen.queryByText('John Doe')).not.toBeInTheDocument();
    });
  });

  test('handles API errors gracefully', async () => {
    // æ¨¡æ‹Ÿç½‘ç»œé”™è¯¯
    server.use(
      rest.get('/api/users', (req, res, ctx) => {
        return res.networkError('Failed to connect');
      })
    );
    
    render(<App />);
    
    await waitFor(() => {
      expect(screen.getByText(/failed to load users/i)).toBeInTheDocument();
    });
    
    // é‡è¯•æŒ‰é’®
    const retryButton = screen.getByRole('button', { name: /retry/i });
    
    // æ¢å¤æ­£å¸¸å“åº”
    server.use(
      rest.get('/api/users', (req, res, ctx) => {
        return res(ctx.json([]));
      })
    );
    
    await userEvent.click(retryButton);
    
    await waitFor(() => {
      expect(screen.queryByText(/failed to load users/i)).not.toBeInTheDocument();
    });
  });
});
```

#### 7.3.2 Cypress E2Eæµ‹è¯•

**ç«¯åˆ°ç«¯æµ‹è¯•é…ç½®å’Œç¤ºä¾‹**
```javascript
// cypress.config.js
const { defineConfig } = require('cypress');

module.exports = defineConfig({
  e2e: {
    baseUrl: 'http://localhost:3000',
    supportFile: 'cypress/support/e2e.js',
    specPattern: 'cypress/e2e/**/*.cy.{js,jsx,ts,tsx}',
    viewportWidth: 1280,
    viewportHeight: 720,
    video: true,
    screenshotOnRunFailure: true,
    retries: {
      runMode: 2,
      openMode: 0
    }
  },
  component: {
    devServer: {
      framework: 'create-react-app',
      bundler: 'webpack'
    }
  }
});

// cypress/support/commands.js
Cypress.Commands.add('login', (username, password) => {
  cy.session([username, password], () => {
    cy.visit('/login');
    cy.get('[data-testid="username-input"]').type(username);
    cy.get('[data-testid="password-input"]').type(password);
    cy.get('[data-testid="login-button"]').click();
    cy.url().should('include', '/dashboard');
  });
});

Cypress.Commands.add('createUser', (userData) => {
  cy.request({
    method: 'POST',
    url: '/api/users',
    body: userData,
    headers: {
      'Authorization': `Bearer ${Cypress.env('AUTH_TOKEN')}`
    }
  });
});

// E2Eæµ‹è¯•ç¤ºä¾‹
describe('User Management E2E', () => {
  beforeEach(() => {
    cy.login('admin@example.com', 'password123');
  });

  it('should manage users end-to-end', () => {
    // å¯¼èˆªåˆ°ç”¨æˆ·ç®¡ç†é¡µé¢
    cy.visit('/users');
    cy.get('[data-testid="page-title"]').should('contain', 'User Management');
    
    // åˆ›å»ºæ–°ç”¨æˆ·
    cy.get('[data-testid="add-user-button"]').click();
    cy.get('[data-testid="user-form"]').should('be.visible');
    
    cy.get('[data-testid="name-input"]').type('Test User');
    cy.get('[data-testid="email-input"]').type('test@example.com');
    cy.get('[data-testid="role-select"]').select('User');
    
    cy.get('[data-testid="save-button"]').click();
    
    // éªŒè¯ç”¨æˆ·åˆ›å»ºæˆåŠŸ
    cy.get('[data-testid="success-message"]').should('be.visible');
    cy.get('[data-testid="user-list"]').should('contain', 'Test User');
    
    // ç¼–è¾‘ç”¨æˆ·
    cy.get('[data-testid="user-row"]')
      .contains('Test User')
      .within(() => {
        cy.get('[data-testid="edit-button"]').click();
      });
    
    cy.get('[data-testid="name-input"]').clear().type('Updated User');
    cy.get('[data-testid="save-button"]').click();
    
    // éªŒè¯æ›´æ–°æˆåŠŸ
    cy.get('[data-testid="user-list"]').should('contain', 'Updated User');
    
    // åˆ é™¤ç”¨æˆ·
    cy.get('[data-testid="user-row"]')
      .contains('Updated User')
      .within(() => {
        cy.get('[data-testid="delete-button"]').click();
      });
    
    cy.get('[data-testid="confirm-dialog"]').should('be.visible');
    cy.get('[data-testid="confirm-delete-button"]').click();
    
    // éªŒè¯åˆ é™¤æˆåŠŸ
    cy.get('[data-testid="user-list"]').should('not.contain', 'Updated User');
  });

  it('should handle form validation', () => {
    cy.visit('/users');
    cy.get('[data-testid="add-user-button"]').click();
    
    // æäº¤ç©ºè¡¨å•
    cy.get('[data-testid="save-button"]').click();
    
    // éªŒè¯é”™è¯¯æ¶ˆæ¯
    cy.get('[data-testid="name-error"]').should('contain', 'Name is required');
    cy.get('[data-testid="email-error"]').should('contain', 'Email is required');
    
    // è¾“å…¥æ— æ•ˆé‚®ç®±
    cy.get('[data-testid="email-input"]').type('invalid-email');
    cy.get('[data-testid="save-button"]').click();
    
    cy.get('[data-testid="email-error"]').should('contain', 'Invalid email format');
  });

  it('should be responsive on different screen sizes', () => {
    // æµ‹è¯•ç§»åŠ¨ç«¯
    cy.viewport('iphone-x');
    cy.visit('/users');
    
    cy.get('[data-testid="mobile-menu-button"]').should('be.visible');
    cy.get('[data-testid="desktop-nav"]').should('not.be.visible');
    
    // æµ‹è¯•å¹³æ¿
    cy.viewport('ipad-2');
    cy.get('[data-testid="tablet-layout"]').should('be.visible');
    
    // æµ‹è¯•æ¡Œé¢ç«¯
    cy.viewport(1280, 720);
    cy.get('[data-testid="desktop-nav"]').should('be.visible');
    cy.get('[data-testid="mobile-menu-button"]').should('not.be.visible');
  });
});

// æ€§èƒ½æµ‹è¯•
describe('Performance Tests', () => {
  it('should load page within acceptable time', () => {
    cy.visit('/', {
      onBeforeLoad: (win) => {
        win.performance.mark('start-loading');
      },
      onLoad: (win) => {
        win.performance.mark('end-loading');
        win.performance.measure('page-load', 'start-loading', 'end-loading');
        
        const measure = win.performance.getEntriesByName('page-load')[0];
        expect(measure.duration).to.be.lessThan(3000); // 3ç§’å†…åŠ è½½å®Œæˆ
      }
    });
  });

  it('should handle large data sets efficiently', () => {
    // åˆ›å»ºå¤§é‡æµ‹è¯•æ•°æ®
    cy.task('seedDatabase', { userCount: 1000 });
    
    cy.visit('/users');
    
    // éªŒè¯è™šæ‹Ÿæ»šåŠ¨å·¥ä½œæ­£å¸¸
    cy.get('[data-testid="user-list"]').should('be.visible');
    cy.get('[data-testid="user-row"]').should('have.length.lessThan', 50); // åªæ¸²æŸ“å¯è§è¡Œ
    
    // æµ‹è¯•æ»šåŠ¨æ€§èƒ½
    cy.get('[data-testid="user-list"]').scrollTo('bottom');
    cy.get('[data-testid="loading-more"]').should('be.visible');
    
    cy.wait(1000); // ç­‰å¾…åŠ è½½
    cy.get('[data-testid="user-row"]').should('have.length.greaterThan', 50);
  });
});
```

## 8. React ç”Ÿæ€ç³»ç»Ÿ

### 8.1 UIç»„ä»¶åº“

#### 8.1.1 Ant Design

**Ant DesignåŸºç¡€ä½¿ç”¨**
```javascript
import React from 'react';
import {
  Button,
  Table,
  Form,
  Input,
  DatePicker,
  Select,
  Modal,
  message,
  Space,
  Popconfirm
} from 'antd';
import {
  EditOutlined,
  DeleteOutlined,
  PlusOutlined
} from '@ant-design/icons';

const { Option } = Select;

function UserManagement() {
  const [form] = Form.useForm();
  const [users, setUsers] = useState([]);
  const [loading, setLoading] = useState(false);
  const [modalVisible, setModalVisible] = useState(false);
  const [editingUser, setEditingUser] = useState(null);

  // è¡¨æ ¼åˆ—å®šä¹‰
  const columns = [
    {
      title: 'ID',
      dataIndex: 'id',
      key: 'id',
      width: 80,
    },
    {
      title: 'å§“å',
      dataIndex: 'name',
      key: 'name',
      sorter: (a, b) => a.name.localeCompare(b.name),
    },
    {
      title: 'é‚®ç®±',
      dataIndex: 'email',
      key: 'email',
    },
    {
      title: 'è§’è‰²',
      dataIndex: 'role',
      key: 'role',
      filters: [
        { text: 'ç®¡ç†å‘˜', value: 'admin' },
        { text: 'ç”¨æˆ·', value: 'user' },
      ],
      onFilter: (value, record) => record.role === value,
      render: (role) => (
        <span style={{ 
          color: role === 'admin' ? '#f50' : '#87d068' 
        }}>
          {role === 'admin' ? 'ç®¡ç†å‘˜' : 'ç”¨æˆ·'}
        </span>
      ),
    },
    {
      title: 'åˆ›å»ºæ—¶é—´',
      dataIndex: 'createTime',
      key: 'createTime',
      sorter: (a, b) => new Date(a.createTime) - new Date(b.createTime),
      render: (time) => new Date(time).toLocaleDateString(),
    },
    {
      title: 'æ“ä½œ',
      key: 'actions',
      width: 150,
      render: (_, record) => (
        <Space>
          <Button 
            type="link" 
            icon={<EditOutlined />}
            onClick={() => handleEdit(record)}
          >
            ç¼–è¾‘
          </Button>
          <Popconfirm
            title="ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç”¨æˆ·å—ï¼Ÿ"
            onConfirm={() => handleDelete(record.id)}
            okText="ç¡®å®š"
            cancelText="å–æ¶ˆ"
          >
            <Button 
              type="link" 
              danger 
              icon={<DeleteOutlined />}
            >
              åˆ é™¤
            </Button>
          </Popconfirm>
        </Space>
      ),
    },
  ];

  const handleEdit = (user) => {
    setEditingUser(user);
    form.setFieldsValue(user);
    setModalVisible(true);
  };

  const handleDelete = async (userId) => {
    try {
      await api.deleteUser(userId);
      setUsers(users.filter(user => user.id !== userId));
      message.success('ç”¨æˆ·åˆ é™¤æˆåŠŸ');
    } catch (error) {
      message.error('åˆ é™¤å¤±è´¥ï¼š' + error.message);
    }
  };

  const handleSubmit = async (values) => {
    try {
      setLoading(true);
      if (editingUser) {
        const updatedUser = await api.updateUser(editingUser.id, values);
        setUsers(users.map(user => 
          user.id === editingUser.id ? updatedUser : user
        ));
        message.success('ç”¨æˆ·æ›´æ–°æˆåŠŸ');
      } else {
        const newUser = await api.createUser(values);
        setUsers([...users, newUser]);
        message.success('ç”¨æˆ·åˆ›å»ºæˆåŠŸ');
      }
      setModalVisible(false);
      form.resetFields();
      setEditingUser(null);
    } catch (error) {
      message.error('æ“ä½œå¤±è´¥ï¼š' + error.message);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div>
      <div style={{ marginBottom: 16 }}>
        <Button
          type="primary"
          icon={<PlusOutlined />}
          onClick={() => {
            setEditingUser(null);
            form.resetFields();
            setModalVisible(true);
          }}
        >
          æ·»åŠ ç”¨æˆ·
        </Button>
      </div>

      <Table
        columns={columns}
        dataSource={users}
        rowKey="id"
        loading={loading}
        pagination={{
          pageSize: 10,
          showSizeChanger: true,
          showQuickJumper: true,
          showTotal: (total) => `å…± ${total} æ¡è®°å½•`,
        }}
      />

      <Modal
        title={editingUser ? 'ç¼–è¾‘ç”¨æˆ·' : 'æ·»åŠ ç”¨æˆ·'}
        open={modalVisible}
        onCancel={() => {
          setModalVisible(false);
          form.resetFields();
          setEditingUser(null);
        }}
        footer={null}
      >
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSubmit}
        >
          <Form.Item
            name="name"
            label="å§“å"
            rules={[{ required: true, message: 'è¯·è¾“å…¥å§“å' }]}
          >
            <Input placeholder="è¯·è¾“å…¥å§“å" />
          </Form.Item>

          <Form.Item
            name="email"
            label="é‚®ç®±"
            rules={[
              { required: true, message: 'è¯·è¾“å…¥é‚®ç®±' },
              { type: 'email', message: 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€' }
            ]}
          >
            <Input placeholder="è¯·è¾“å…¥é‚®ç®±" />
          </Form.Item>

          <Form.Item
            name="role"
            label="è§’è‰²"
            rules={[{ required: true, message: 'è¯·é€‰æ‹©è§’è‰²' }]}
          >
            <Select placeholder="è¯·é€‰æ‹©è§’è‰²">
              <Option value="admin">ç®¡ç†å‘˜</Option>
              <Option value="user">ç”¨æˆ·</Option>
            </Select>
          </Form.Item>

          <Form.Item>
            <Space>
              <Button type="primary" htmlType="submit" loading={loading}>
                {editingUser ? 'æ›´æ–°' : 'åˆ›å»º'}
              </Button>
              <Button onClick={() => setModalVisible(false)}>
                å–æ¶ˆ
              </Button>
            </Space>
          </Form.Item>
        </Form>
      </Modal>
    </div>
  );
}
```

#### 8.1.2 Material-UI

**Material-UIæ ¸å¿ƒç»„ä»¶ä½¿ç”¨**
```javascript
import React, { useState } from 'react';
import {
  Box,
  Button,
  Card,
  CardContent,
  CardActions,
  TextField,
  Typography,
  Grid,
  Paper,
  AppBar,
  Toolbar,
  IconButton,
  Drawer,
  List,
  ListItem,
  ListItemIcon,
  ListItemText,
  Dialog,
  DialogTitle,
  DialogContent,
  DialogActions,
  Snackbar,
  Alert,
  Chip,
  Avatar,
  ThemeProvider,
  createTheme,
  CssBaseline
} from '@mui/material';
import {
  Menu as MenuIcon,
  Dashboard,
  People,
  Settings,
  Add as AddIcon,
  Edit as EditIcon,
  Delete as DeleteIcon
} from '@mui/icons-material';

// è‡ªå®šä¹‰ä¸»é¢˜
const theme = createTheme({
  palette: {
    mode: 'light',
    primary: {
      main: '#1976d2',
    },
    secondary: {
      main: '#dc004e',
    },
    background: {
      default: '#f5f5f5',
    },
  },
  typography: {
    h4: {
      fontWeight: 600,
    },
  },
  components: {
    MuiButton: {
      styleOverrides: {
        root: {
          textTransform: 'none',
        },
      },
    },
  },
});

function MaterialUIApp() {
  const [drawerOpen, setDrawerOpen] = useState(false);
  const [dialogOpen, setDialogOpen] = useState(false);
  const [snackbarOpen, setSnackbarOpen] = useState(false);
  const [users, setUsers] = useState([
    { id: 1, name: 'John Doe', email: 'john@example.com', role: 'admin' },
    { id: 2, name: 'Jane Smith', email: 'jane@example.com', role: 'user' }
  ]);

  const menuItems = [
    { text: 'Dashboard', icon: <Dashboard /> },
    { text: 'Users', icon: <People /> },
    { text: 'Settings', icon: <Settings /> }
  ];

  const handleAddUser = (userData) => {
    const newUser = {
      id: Date.now(),
      ...userData
    };
    setUsers([...users, newUser]);
    setDialogOpen(false);
    setSnackbarOpen(true);
  };

  return (
    <ThemeProvider theme={theme}>
      <CssBaseline />
      <Box sx={{ flexGrow: 1 }}>
        {/* App Bar */}
        <AppBar position="static">
          <Toolbar>
            <IconButton
              edge="start"
              color="inherit"
              onClick={() => setDrawerOpen(true)}
              sx={{ mr: 2 }}
            >
              <MenuIcon />
            </IconButton>
            <Typography variant="h6" component="div" sx={{ flexGrow: 1 }}>
              User Management System
            </Typography>
          </Toolbar>
        </AppBar>

        {/* Drawer */}
        <Drawer
          anchor="left"
          open={drawerOpen}
          onClose={() => setDrawerOpen(false)}
        >
          <Box sx={{ width: 250 }} role="presentation">
            <List>
              {menuItems.map((item) => (
                <ListItem button key={item.text}>
                  <ListItemIcon>{item.icon}</ListItemIcon>
                  <ListItemText primary={item.text} />
                </ListItem>
              ))}
            </List>
          </Box>
        </Drawer>

        {/* Main Content */}
        <Box sx={{ p: 3 }}>
          <Box sx={{ display: 'flex', justifyContent: 'space-between', mb: 3 }}>
            <Typography variant="h4" component="h1">
              Users
            </Typography>
            <Button
              variant="contained"
              startIcon={<AddIcon />}
              onClick={() => setDialogOpen(true)}
            >
              Add User
            </Button>
          </Box>

          {/* User Cards Grid */}
          <Grid container spacing={3}>
            {users.map((user) => (
              <Grid item xs={12} sm={6} md={4} key={user.id}>
                <Card>
                  <CardContent>
                    <Box sx={{ display: 'flex', alignItems: 'center', mb: 2 }}>
                      <Avatar sx={{ bgcolor: 'primary.main', mr: 2 }}>
                        {user.name.charAt(0)}
                      </Avatar>
                      <Typography variant="h6">
                        {user.name}
                      </Typography>
                    </Box>
                    <Typography color="text.secondary" gutterBottom>
                      {user.email}
                    </Typography>
                    <Chip
                      label={user.role}
                      color={user.role === 'admin' ? 'primary' : 'default'}
                      size="small"
                    />
                  </CardContent>
                  <CardActions>
                    <Button size="small" startIcon={<EditIcon />}>
                      Edit
                    </Button>
                    <Button 
                      size="small" 
                      color="error" 
                      startIcon={<DeleteIcon />}
                    >
                      Delete
                    </Button>
                  </CardActions>
                </Card>
              </Grid>
            ))}
          </Grid>
        </Box>

        {/* Add User Dialog */}
        <UserDialog
          open={dialogOpen}
          onClose={() => setDialogOpen(false)}
          onSubmit={handleAddUser}
        />

        {/* Success Snackbar */}
        <Snackbar
          open={snackbarOpen}
          autoHideDuration={6000}
          onClose={() => setSnackbarOpen(false)}
        >
          <Alert onClose={() => setSnackbarOpen(false)} severity="success">
            User added successfully!
          </Alert>
        </Snackbar>
      </Box>
    </ThemeProvider>
  );
}

function UserDialog({ open, onClose, onSubmit }) {
  const [formData, setFormData] = useState({
    name: '',
    email: '',
    role: 'user'
  });

  const handleSubmit = (e) => {
    e.preventDefault();
    onSubmit(formData);
    setFormData({ name: '', email: '', role: 'user' });
  };

  return (
    <Dialog open={open} onClose={onClose} maxWidth="sm" fullWidth>
      <DialogTitle>Add New User</DialogTitle>
      <form onSubmit={handleSubmit}>
        <DialogContent>
          <TextField
            autoFocus
            margin="dense"
            label="Name"
            fullWidth
            variant="outlined"
            value={formData.name}
            onChange={(e) => setFormData({ ...formData, name: e.target.value })}
            required
          />
          <TextField
            margin="dense"
            label="Email"
            type="email"
            fullWidth
            variant="outlined"
            value={formData.email}
            onChange={(e) => setFormData({ ...formData, email: e.target.value })}
            required
          />
          <TextField
            margin="dense"
            label="Role"
            select
            fullWidth
            variant="outlined"
            value={formData.role}
            onChange={(e) => setFormData({ ...formData, role: e.target.value })}
            SelectProps={{
              native: true,
            }}
          >
            <option value="user">User</option>
            <option value="admin">Admin</option>
          </TextField>
        </DialogContent>
        <DialogActions>
          <Button onClick={onClose}>Cancel</Button>
          <Button type="submit" variant="contained">Add</Button>
        </DialogActions>
      </form>
    </Dialog>
  );
}
```

#### 8.1.3 ç»„ä»¶åº“é€‰æ‹©

**ç»„ä»¶åº“å¯¹æ¯”åˆ†æ**

| ç‰¹æ€§ | Ant Design | Material-UI | Chakra UI | React Bootstrap |
|------|-----------|-------------|-----------|-----------------|
| **è®¾è®¡é£æ ¼** | ä¼ä¸šçº§ç®€æ´ | Material Design | ç®€çº¦ç°ä»£ | Bootstrapé£æ ¼ |
| **ç»„ä»¶æ•°é‡** | 60+ | 50+ | 40+ | 20+ |
| **TypeScript** | åŸç”Ÿæ”¯æŒ | åŸç”Ÿæ”¯æŒ | åŸç”Ÿæ”¯æŒ | æ”¯æŒ |
| **ä¸»é¢˜å®šåˆ¶** | è¾ƒå¤æ‚ | çµæ´» | éå¸¸çµæ´» | ä¸­ç­‰ |
| **åŒ…å¤§å°** | è¾ƒå¤§ | ä¸­ç­‰ | è¾ƒå° | å° |
| **å­¦ä¹ æˆæœ¬** | ä¸­ç­‰ | ä¸­ç­‰ | ä½ | ä½ |
| **ç¤¾åŒºæ´»è·ƒåº¦** | é«˜ | éå¸¸é«˜ | é«˜ | ä¸­ç­‰ |
| **æ–‡æ¡£è´¨é‡** | ä¼˜ç§€ | ä¼˜ç§€ | å¾ˆå¥½ | å¥½ |
| **å›½é™…åŒ–** | å®Œå–„ | å®Œå–„ | åŸºç¡€ | åŸºç¡€ |
| **ç§»åŠ¨ç«¯é€‚é…** | å¥½ | ä¼˜ç§€ | å¾ˆå¥½ | å¥½ |

```mermaid
graph TD
    A["é€‰æ‹©ç»„ä»¶åº“"] --> B{"é¡¹ç›®ç±»å‹"}
    
    B -->|ä¼ä¸šçº§åº”ç”¨| C["Ant Design"]
    B -->|ç°ä»£Webåº”ç”¨| D["Material-UI"]
    B -->|å¿«é€ŸåŸå‹| E["Chakra UI"]
    B -->|ç®€å•é¡¹ç›®| F["React Bootstrap"]
    
    C --> C1["â€¢ å®Œæ•´çš„è®¾è®¡è¯­è¨€<br/>â€¢ ä¸°å¯Œçš„ä¸šåŠ¡ç»„ä»¶<br/>â€¢ å›½é™…åŒ–æ”¯æŒ"]
    D --> D1["â€¢ Googleè®¾è®¡è§„èŒƒ<br/>â€¢ çµæ´»çš„ä¸»é¢˜ç³»ç»Ÿ<br/>â€¢ å¼ºå¤§çš„å®šåˆ¶èƒ½åŠ›"]
    E --> E1["â€¢ è½»é‡çº§<br/>â€¢ æ˜“äºå­¦ä¹ <br/>â€¢ ç°ä»£åŒ–API"]
    F --> F1["â€¢ ç†Ÿæ‚‰çš„Bootstrap<br/>â€¢ è½»é‡çº§<br/>â€¢ å¿«é€Ÿä¸Šæ‰‹"]
    
    style A fill:#e1f5fe
    style C fill:#e8f5e8
    style D fill:#fff3e0
    style E fill:#f3e5f5
    style F fill:#fce4ec
```

### 8.2 æ„å»ºå·¥å…·

#### 8.2.1 Create React App

**CRAé¡¹ç›®ç»“æ„å’Œé…ç½®**
```bash
# åˆ›å»ºæ–°é¡¹ç›®
npx create-react-app my-app --template typescript
cd my-app

# é¡¹ç›®ç»“æ„
my-app/
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ favicon.ico
â”‚   â””â”€â”€ manifest.json
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ App.tsx
â”‚   â”œâ”€â”€ index.tsx
â”‚   â””â”€â”€ index.css
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

**ç¯å¢ƒå˜é‡é…ç½®**
```bash
# .env
REACT_APP_API_URL=http://localhost:3001/api
REACT_APP_VERSION=$npm_package_version

# .env.development
REACT_APP_API_URL=http://localhost:3001/api
REACT_APP_DEBUG=true

# .env.production
REACT_APP_API_URL=https://api.myapp.com
REACT_APP_DEBUG=false
```

**è‡ªå®šä¹‰é…ç½®ï¼ˆä¸ejectï¼‰**
```javascript
// craco.config.js
const path = require('path');

module.exports = {
  webpack: {
    alias: {
      '@': path.resolve(__dirname, 'src'),
      '@components': path.resolve(__dirname, 'src/components'),
      '@hooks': path.resolve(__dirname, 'src/hooks'),
      '@utils': path.resolve(__dirname, 'src/utils')
    }
  },
  babel: {
    plugins: [
      ['import', {
        libraryName: 'antd',
        libraryDirectory: 'es',
        style: 'css'
      }]
    ]
  },
  eslint: {
    mode: 'extends',
    configure: {
      rules: {
        'no-unused-vars': 'warn',
        '@typescript-eslint/no-unused-vars': 'warn'
      }
    }
  }
};

// package.json scripts
{
  "scripts": {
    "start": "craco start",
    "build": "craco build",
    "test": "craco test"
  }
}
```

#### 8.2.2 Vite

**Viteé…ç½®å’Œä¼˜åŒ–**
```javascript
// vite.config.ts
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import { resolve } from 'path';

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src'),
      '@components': resolve(__dirname, 'src/components'),
      '@hooks': resolve(__dirname, 'src/hooks'),
      '@utils': resolve(__dirname, 'src/utils')
    }
  },
  server: {
    port: 3000,
    open: true,
    proxy: {
      '/api': {
        target: 'http://localhost:3001',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, '')
      }
    }
  },
  build: {
    outDir: 'dist',
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['react', 'react-dom'],
          router: ['react-router-dom'],
          ui: ['antd', '@ant-design/icons']
        }
      }
    },
    chunkSizeWarningLimit: 1000
  },
  optimizeDeps: {
    include: ['react', 'react-dom', 'antd']
  }
});

// ç¯å¢ƒå˜é‡
// .env
VITE_API_URL=http://localhost:3001/api
VITE_APP_TITLE=My React App

// ä½¿ç”¨ç¯å¢ƒå˜é‡
const apiUrl = import.meta.env.VITE_API_URL;
const appTitle = import.meta.env.VITE_APP_TITLE;
```

#### 8.2.3 Webpacké…ç½®

**è‡ªå®šä¹‰Webpacké…ç½®**
```javascript
// webpack.config.js
const path = require('path');
const HtmlWebpackPlugin = require('html-webpack-plugin');
const { CleanWebpackPlugin } = require('clean-webpack-plugin');
const MiniCssExtractPlugin = require('mini-css-extract-plugin');
const webpack = require('webpack');

module.exports = (env, argv) => {
  const isProduction = argv.mode === 'production';

  return {
    entry: './src/index.tsx',
    output: {
      path: path.resolve(__dirname, 'dist'),
      filename: isProduction 
        ? '[name].[contenthash].js' 
        : '[name].js',
      publicPath: '/'
    },
    resolve: {
      extensions: ['.tsx', '.ts', '.js', '.jsx'],
      alias: {
        '@': path.resolve(__dirname, 'src'),
        '@components': path.resolve(__dirname, 'src/components'),
        '@hooks': path.resolve(__dirname, 'src/hooks'),
        '@utils': path.resolve(__dirname, 'src/utils')
      }
    },
    module: {
      rules: [
        {
          test: /\.(ts|tsx)$/,
          use: 'ts-loader',
          exclude: /node_modules/
        },
        {
          test: /\.css$/,
          use: [
            isProduction ? MiniCssExtractPlugin.loader : 'style-loader',
            'css-loader',
            'postcss-loader'
          ]
        },
        {
          test: /\.scss$/,
          use: [
            isProduction ? MiniCssExtractPlugin.loader : 'style-loader',
            'css-loader',
            'postcss-loader',
            'sass-loader'
          ]
        },
        {
          test: /\.(png|svg|jpg|jpeg|gif)$/i,
          type: 'asset/resource'
        }
      ]
    },
    plugins: [
      new CleanWebpackPlugin(),
      new HtmlWebpackPlugin({
        template: './public/index.html',
        favicon: './public/favicon.ico'
      }),
      new webpack.DefinePlugin({
        'process.env.NODE_ENV': JSON.stringify(argv.mode),
        'process.env.REACT_APP_API_URL': JSON.stringify(
          process.env.REACT_APP_API_URL
        )
      }),
      ...(isProduction ? [
        new MiniCssExtractPlugin({
          filename: '[name].[contenthash].css'
        })
      ] : [])
    ],
    devServer: {
      static: path.join(__dirname, 'public'),
      historyApiFallback: true,
      hot: true,
      port: 3000,
      proxy: {
        '/api': {
          target: 'http://localhost:3001',
          changeOrigin: true,
          pathRewrite: {
            '^/api': ''
          }
        }
      }
    },
    optimization: {
      splitChunks: {
        chunks: 'all',
        cacheGroups: {
          vendor: {
            test: /[\\/]node_modules[\\/]/,
            name: 'vendors',
            chunks: 'all'
          }
        }
      }
    }
  };
};
```

### 8.3 å…¨æ ˆæ¡†æ¶

#### 8.3.1 Next.js

**Next.jsåº”ç”¨æ¶æ„**
```javascript
// pages/_app.tsx
import type { AppProps } from 'next/app';
import { QueryClient, QueryClientProvider } from 'react-query';
import { SessionProvider } from 'next-auth/react';
import Layout from '../components/Layout';
import '../styles/globals.css';

const queryClient = new QueryClient();

function MyApp({ Component, pageProps: { session, ...pageProps } }: AppProps) {
  return (
    <SessionProvider session={session}>
      <QueryClientProvider client={queryClient}>
        <Layout>
          <Component {...pageProps} />
        </Layout>
      </QueryClientProvider>
    </SessionProvider>
  );
}

export default MyApp;

// pages/index.tsx - é™æ€ç”Ÿæˆ
import { GetStaticProps } from 'next';
import { Post } from '../types';

interface HomeProps {
  posts: Post[];
}

export default function Home({ posts }: HomeProps) {
  return (
    <div>
      <h1>Latest Posts</h1>
      {posts.map(post => (
        <article key={post.id}>
          <h2>{post.title}</h2>
          <p>{post.excerpt}</p>
        </article>
      ))}
    </div>
  );
}

export const getStaticProps: GetStaticProps = async () => {
  const posts = await fetchPosts();
  
  return {
    props: {
      posts
    },
    revalidate: 60 // ISR: æ¯60ç§’é‡æ–°ç”Ÿæˆ
  };
};

// pages/posts/[id].tsx - åŠ¨æ€è·¯ç”±
import { GetStaticPaths, GetStaticProps } from 'next';

interface PostProps {
  post: Post;
}

export default function Post({ post }: PostProps) {
  return (
    <article>
      <h1>{post.title}</h1>
      <div dangerouslySetInnerHTML={{ __html: post.content }} />
    </article>
  );
}

export const getStaticPaths: GetStaticPaths = async () => {
  const posts = await fetchPosts();
  const paths = posts.map(post => ({
    params: { id: post.id.toString() }
  }));

  return {
    paths,
    fallback: 'blocking' // ISR for new posts
  };
};

export const getStaticProps: GetStaticProps = async ({ params }) => {
  const post = await fetchPost(params?.id as string);

  if (!post) {
    return {
      notFound: true
    };
  }

  return {
    props: {
      post
    },
    revalidate: 86400 // 24 hours
  };
};

// pages/api/users.ts - APIè·¯ç”±
import type { NextApiRequest, NextApiResponse } from 'next';
import { getSession } from 'next-auth/react';

export default async function handler(
  req: NextApiRequest,
  res: NextApiResponse
) {
  const session = await getSession({ req });

  if (!session) {
    return res.status(401).json({ error: 'Unauthorized' });
  }

  switch (req.method) {
    case 'GET':
      const users = await getUsers();
      res.status(200).json(users);
      break;
      
    case 'POST':
      const newUser = await createUser(req.body);
      res.status(201).json(newUser);
      break;
      
    default:
      res.setHeader('Allow', ['GET', 'POST']);
      res.status(405).end(`Method ${req.method} Not Allowed`);
  }
}

// next.config.js
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  swcMinify: true,
  images: {
    domains: ['example.com'],
    formats: ['image/webp', 'image/avif']
  },
  env: {
    CUSTOM_KEY: process.env.CUSTOM_KEY
  },
  async rewrites() {
    return [
      {
        source: '/api/external/:path*',
        destination: 'https://external-api.com/:path*'
      }
    ];
  },
  async headers() {
    return [
      {
        source: '/api/:path*',
        headers: [
          {
            key: 'Access-Control-Allow-Origin',
            value: '*'
          }
        ]
      }
    ];
  }
};

module.exports = nextConfig;
```

#### 8.3.2 Remix

**Remixåº”ç”¨ç»“æ„**
```javascript
// app/root.tsx
import {
  Links,
  LiveReload,
  Meta,
  Outlet,
  Scripts,
  ScrollRestoration
} from '@remix-run/react';

export default function App() {
  return (
    <html lang="en">
      <head>
        <meta charSet="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <Meta />
        <Links />
      </head>
      <body>
        <Outlet />
        <ScrollRestoration />
        <Scripts />
        <LiveReload />
      </body>
    </html>
  );
}

// app/routes/posts.tsx
import { json, LoaderFunction } from '@remix-run/node';
import { useLoaderData, Outlet } from '@remix-run/react';

interface LoaderData {
  posts: Post[];
}

export const loader: LoaderFunction = async () => {
  const posts = await getPosts();
  return json<LoaderData>({ posts });
};

export default function Posts() {
  const { posts } = useLoaderData<LoaderData>();

  return (
    <div style={{ display: 'flex' }}>
      <nav style={{ width: '200px' }}>
        <h2>Posts</h2>
        <ul>
          {posts.map(post => (
            <li key={post.id}>
              <Link to={post.slug}>{post.title}</Link>
            </li>
          ))}
        </ul>
      </nav>
      <main style={{ flex: 1, padding: '20px' }}>
        <Outlet />
      </main>
    </div>
  );
}

// app/routes/posts/$slug.tsx
import { json, LoaderFunction, ActionFunction } from '@remix-run/node';
import { useLoaderData, Form, useActionData } from '@remix-run/react';

export const loader: LoaderFunction = async ({ params }) => {
  const post = await getPost(params.slug);
  if (!post) {
    throw new Response('Not Found', { status: 404 });
  }
  return json({ post });
};

export const action: ActionFunction = async ({ request, params }) => {
  const formData = await request.formData();
  const comment = formData.get('comment');

  if (!comment) {
    return json({ error: 'Comment is required' }, { status: 400 });
  }

  await addComment(params.slug, comment);
  return json({ success: true });
};

export default function PostSlug() {
  const { post } = useLoaderData();
  const actionData = useActionData();

  return (
    <div>
      <h1>{post.title}</h1>
      <div dangerouslySetInnerHTML={{ __html: post.content }} />
      
      <Form method="post" style={{ marginTop: '2rem' }}>
        <textarea
          name="comment"
          placeholder="Add a comment..."
          rows={4}
          style={{ width: '100%' }}
        />
        <button type="submit">Add Comment</button>
        {actionData?.error && (
          <p style={{ color: 'red' }}>{actionData.error}</p>
        )}
        {actionData?.success && (
          <p style={{ color: 'green' }}>Comment added!</p>
        )}
      </Form>
    </div>
  );
}
```

#### 8.3.3 Gatsby

**Gatsbyé™æ€ç«™ç‚¹ç”Ÿæˆ**
```javascript
// gatsby-config.js
module.exports = {
  siteMetadata: {
    title: 'My Gatsby Site',
    description: 'A fast static site built with Gatsby',
    siteUrl: 'https://mygatsby.com'
  },
  plugins: [
    'gatsby-plugin-react-helmet',
    'gatsby-plugin-image',
    'gatsby-plugin-sharp',
    'gatsby-transformer-sharp',
    {
      resolve: 'gatsby-source-filesystem',
      options: {
        name: 'images',
        path: './src/images/'
      }
    },
    {
      resolve: 'gatsby-source-filesystem',
      options: {
        name: 'posts',
        path: './src/posts/'
      }
    },
    {
      resolve: 'gatsby-transformer-remark',
      options: {
        plugins: [
          'gatsby-remark-images',
          'gatsby-remark-prismjs'
        ]
      }
    },
    {
      resolve: 'gatsby-plugin-manifest',
      options: {
        name: 'My Gatsby Site',
        short_name: 'Gatsby',
        start_url: '/',
        background_color: '#663399',
        theme_color: '#663399',
        display: 'minimal-ui',
        icon: 'src/images/gatsby-icon.png'
      }
    }
  ]
};

// src/pages/index.js
import React from 'react';
import { graphql } from 'gatsby';
import Layout from '../components/layout';
import SEO from '../components/seo';

const IndexPage = ({ data }) => {
  return (
    <Layout>
      <SEO title="Home" />
      <h1>Welcome to my Gatsby site</h1>
      <h2>Latest Posts</h2>
      {data.allMarkdownRemark.edges.map(({ node }) => (
        <article key={node.id}>
          <h3>
            <Link to={node.fields.slug}>{node.frontmatter.title}</Link>
          </h3>
          <p>{node.frontmatter.date}</p>
          <p>{node.excerpt}</p>
        </article>
      ))}
    </Layout>
  );
};

export const query = graphql`
  query {
    allMarkdownRemark(sort: { fields: [frontmatter___date], order: DESC }) {
      edges {
        node {
          id
          excerpt(pruneLength: 160)
          fields {
            slug
          }
          frontmatter {
            title
            date(formatString: "MMMM DD, YYYY")
          }
        }
      }
    }
  }
`;

export default IndexPage;

// gatsby-node.js
const path = require('path');
const { createFilePath } = require('gatsby-source-filesystem');

exports.onCreateNode = ({ node, getNode, actions }) => {
  const { createNodeField } = actions;
  
  if (node.internal.type === 'MarkdownRemark') {
    const slug = createFilePath({ node, getNode, basePath: 'posts' });
    createNodeField({
      node,
      name: 'slug',
      value: slug
    });
  }
};

exports.createPages = async ({ graphql, actions }) => {
  const { createPage } = actions;
  
  const result = await graphql(`
    query {
      allMarkdownRemark {
        edges {
          node {
            fields {
              slug
            }
          }
        }
      }
    }
  `);

  result.data.allMarkdownRemark.edges.forEach(({ node }) => {
    createPage({
      path: node.fields.slug,
      component: path.resolve('./src/templates/blog-post.js'),
      context: {
        slug: node.fields.slug
      }
    });
  });
};
```

## 9. å®æˆ˜é¡¹ç›®æ¡ˆä¾‹

### 9.1 å¾…åŠäº‹é¡¹åº”ç”¨

#### 9.1.1 é¡¹ç›®æ¶æ„

**æŠ€æœ¯æ ˆé€‰æ‹©**
```mermaid
graph TD
    A["Todo App æ¶æ„"] --> B["å‰ç«¯æŠ€æœ¯æ ˆ"]
    A --> C["çŠ¶æ€ç®¡ç†"]
    A --> D["æ•°æ®æŒä¹…åŒ–"]
    A --> E["UIç»„ä»¶"]
    
    B --> B1["React 18"]
    B --> B2["TypeScript"]
    B --> B3["React Router"]
    
    C --> C1["useReducer + Context"]
    C --> C2["LocalStorage"]
    
    D --> D1["æµè§ˆå™¨ LocalStorage"]
    D --> D2["å¯æ‰©å±•åˆ°åç«¯API"]
    
    E --> E1["è‡ªå®šä¹‰ç»„ä»¶"]
    E --> E2["CSS Modules"]
    E --> E3["å“åº”å¼è®¾è®¡"]
    
    style A fill:#e1f5fe
    style B fill:#e8f5e8
    style C fill:#fff3e0
    style D fill:#f3e5f5
    style E fill:#fce4ec
```

#### 9.1.2 åŠŸèƒ½å®ç°

**æ ¸å¿ƒçŠ¶æ€ç®¡ç†**
```typescript
// types/todo.ts
export interface Todo {
  id: string;
  text: string;
  completed: boolean;
  createdAt: Date;
  updatedAt: Date;
  priority: 'low' | 'medium' | 'high';
  category?: string;
}

export type FilterType = 'all' | 'active' | 'completed';

export interface TodoState {
  todos: Todo[];
  filter: FilterType;
  searchTerm: string;
}

export type TodoAction =
  | { type: 'ADD_TODO'; payload: Omit<Todo, 'id' | 'createdAt' | 'updatedAt'> }
  | { type: 'TOGGLE_TODO'; payload: string }
  | { type: 'DELETE_TODO'; payload: string }
  | { type: 'EDIT_TODO'; payload: { id: string; text: string } }
  | { type: 'SET_FILTER'; payload: FilterType }
  | { type: 'SET_SEARCH'; payload: string }
  | { type: 'CLEAR_COMPLETED' }
  | { type: 'LOAD_TODOS'; payload: Todo[] };

// hooks/useTodos.ts
import { useReducer, useEffect } from 'react';
import { v4 as uuidv4 } from 'uuid';

const todoReducer = (state: TodoState, action: TodoAction): TodoState => {
  switch (action.type) {
    case 'ADD_TODO':
      const newTodo: Todo = {
        ...action.payload,
        id: uuidv4(),
        createdAt: new Date(),
        updatedAt: new Date()
      };
      return {
        ...state,
        todos: [...state.todos, newTodo]
      };

    case 'TOGGLE_TODO':
      return {
        ...state,
        todos: state.todos.map(todo =>
          todo.id === action.payload
            ? { ...todo, completed: !todo.completed, updatedAt: new Date() }
            : todo
        )
      };

    case 'DELETE_TODO':
      return {
        ...state,
        todos: state.todos.filter(todo => todo.id !== action.payload)
      };

    case 'EDIT_TODO':
      return {
        ...state,
        todos: state.todos.map(todo =>
          todo.id === action.payload.id
            ? { ...todo, text: action.payload.text, updatedAt: new Date() }
            : todo
        )
      };

    case 'SET_FILTER':
      return { ...state, filter: action.payload };

    case 'SET_SEARCH':
      return { ...state, searchTerm: action.payload };

    case 'CLEAR_COMPLETED':
      return {
        ...state,
        todos: state.todos.filter(todo => !todo.completed)
      };

    case 'LOAD_TODOS':
      return { ...state, todos: action.payload };

    default:
      return state;
  }
};

export const useTodos = () => {
  const [state, dispatch] = useReducer(todoReducer, {
    todos: [],
    filter: 'all',
    searchTerm: ''
  });

  // æŒä¹…åŒ–åˆ° localStorage
  useEffect(() => {
    const savedTodos = localStorage.getItem('todos');
    if (savedTodos) {
      try {
        const todos = JSON.parse(savedTodos).map((todo: any) => ({
          ...todo,
          createdAt: new Date(todo.createdAt),
          updatedAt: new Date(todo.updatedAt)
        }));
        dispatch({ type: 'LOAD_TODOS', payload: todos });
      } catch (error) {
        console.error('Failed to load todos from localStorage:', error);
      }
    }
  }, []);

  useEffect(() => {
    localStorage.setItem('todos', JSON.stringify(state.todos));
  }, [state.todos]);

  // è¿‡æ»¤å’Œæœç´¢é€»è¾‘
  const filteredTodos = state.todos.filter(todo => {
    const matchesFilter = 
      state.filter === 'all' ||
      (state.filter === 'active' && !todo.completed) ||
      (state.filter === 'completed' && todo.completed);
    
    const matchesSearch = todo.text
      .toLowerCase()
      .includes(state.searchTerm.toLowerCase());

    return matchesFilter && matchesSearch;
  });

  const stats = {
    total: state.todos.length,
    completed: state.todos.filter(todo => todo.completed).length,
    active: state.todos.filter(todo => !todo.completed).length
  };

  return {
    state,
    dispatch,
    filteredTodos,
    stats
  };
};

// components/TodoApp.tsx
import React from 'react';
import { useTodos } from '../hooks/useTodos';
import TodoForm from './TodoForm';
import TodoList from './TodoList';
import TodoFilters from './TodoFilters';
import TodoStats from './TodoStats';
import SearchBar from './SearchBar';
import styles from './TodoApp.module.css';

const TodoApp: React.FC = () => {
  const { state, dispatch, filteredTodos, stats } = useTodos();

  return (
    <div className={styles.todoApp}>
      <header className={styles.header}>
        <h1>Todo Application</h1>
        <TodoStats stats={stats} />
      </header>

      <main className={styles.main}>
        <TodoForm
          onSubmit={(todo) => dispatch({ type: 'ADD_TODO', payload: todo })}
        />
        
        <div className={styles.controls}>
          <SearchBar
            value={state.searchTerm}
            onChange={(term) => dispatch({ type: 'SET_SEARCH', payload: term })}
          />
          <TodoFilters
            currentFilter={state.filter}
            onFilterChange={(filter) => dispatch({ type: 'SET_FILTER', payload: filter })}
          />
        </div>

        <TodoList
          todos={filteredTodos}
          onToggle={(id) => dispatch({ type: 'TOGGLE_TODO', payload: id })}
          onDelete={(id) => dispatch({ type: 'DELETE_TODO', payload: id })}
          onEdit={(id, text) => dispatch({ type: 'EDIT_TODO', payload: { id, text } })}
        />
      </main>

      <footer className={styles.footer}>
        {stats.completed > 0 && (
          <button
            className={styles.clearCompleted}
            onClick={() => dispatch({ type: 'CLEAR_COMPLETED' })}
          >
            Clear {stats.completed} completed item{stats.completed !== 1 ? 's' : ''}
          </button>
        )}
      </footer>
    </div>
  );
};

export default TodoApp;

// components/TodoItem.tsx
import React, { useState } from 'react';
import { Todo } from '../types/todo';
import styles from './TodoItem.module.css';

interface TodoItemProps {
  todo: Todo;
  onToggle: (id: string) => void;
  onDelete: (id: string) => void;
  onEdit: (id: string, text: string) => void;
}

const TodoItem: React.FC<TodoItemProps> = ({ todo, onToggle, onDelete, onEdit }) => {
  const [isEditing, setIsEditing] = useState(false);
  const [editText, setEditText] = useState(todo.text);

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    const trimmedText = editText.trim();
    if (trimmedText) {
      onEdit(todo.id, trimmedText);
      setIsEditing(false);
    } else {
      onDelete(todo.id);
    }
  };

  const handleKeyDown = (e: React.KeyboardEvent) => {
    if (e.key === 'Escape') {
      setEditText(todo.text);
      setIsEditing(false);
    }
  };

  const priorityClass = styles[`priority-${todo.priority}`];

  return (
    <li className={`${styles.todoItem} ${todo.completed ? styles.completed : ''} ${priorityClass}`}>
      <div className={styles.todoContent}>
        <input
          type="checkbox"
          checked={todo.completed}
          onChange={() => onToggle(todo.id)}
          className={styles.checkbox}
        />
        
        {isEditing ? (
          <form onSubmit={handleSubmit} className={styles.editForm}>
            <input
              type="text"
              value={editText}
              onChange={(e) => setEditText(e.target.value)}
              onBlur={handleSubmit}
              onKeyDown={handleKeyDown}
              className={styles.editInput}
              autoFocus
            />
          </form>
        ) : (
          <span
            className={styles.todoText}
            onDoubleClick={() => setIsEditing(true)}
          >
            {todo.text}
          </span>
        )}
      </div>

      <div className={styles.todoActions}>
        <span className={styles.priority}>{todo.priority}</span>
        {todo.category && (
          <span className={styles.category}>{todo.category}</span>
        )}
        <button
          onClick={() => setIsEditing(true)}
          className={styles.editButton}
          aria-label="Edit todo"
        >
          âœï¸
        </button>
        <button
          onClick={() => onDelete(todo.id)}
          className={styles.deleteButton}
          aria-label="Delete todo"
        >
          ğŸ—‘ï¸
        </button>
      </div>
    </li>
  );
};

export default TodoItem;
```

### 9.2 ç”µå•†è´­ç‰©è½¦

#### 9.2.1 çŠ¶æ€è®¾è®¡

**è´­ç‰©è½¦çŠ¶æ€ç®¡ç†**
```typescript
// types/cart.ts
export interface Product {
  id: string;
  name: string;
  price: number;
  image: string;
  description: string;
  category: string;
  inventory: number;
}

export interface CartItem {
  product: Product;
  quantity: number;
  selectedOptions?: Record<string, string>;
}

export interface CartState {
  items: CartItem[];
  isOpen: boolean;
  coupon?: {
    code: string;
    discount: number;
    type: 'percentage' | 'fixed';
  };
}

// context/CartContext.tsx
import React, { createContext, useContext, useReducer, useEffect } from 'react';

type CartAction =
  | { type: 'ADD_ITEM'; payload: { product: Product; quantity?: number; options?: Record<string, string> } }
  | { type: 'REMOVE_ITEM'; payload: string }
  | { type: 'UPDATE_QUANTITY'; payload: { id: string; quantity: number } }
  | { type: 'CLEAR_CART' }
  | { type: 'TOGGLE_CART' }
  | { type: 'APPLY_COUPON'; payload: CartState['coupon'] }
  | { type: 'REMOVE_COUPON' }
  | { type: 'LOAD_CART'; payload: CartState };

const cartReducer = (state: CartState, action: CartAction): CartState => {
  switch (action.type) {
    case 'ADD_ITEM': {
      const { product, quantity = 1, options = {} } = action.payload;
      const existingItemIndex = state.items.findIndex(
        item => item.product.id === product.id &&
        JSON.stringify(item.selectedOptions) === JSON.stringify(options)
      );

      if (existingItemIndex > -1) {
        const updatedItems = [...state.items];
        updatedItems[existingItemIndex].quantity += quantity;
        return { ...state, items: updatedItems };
      }

      return {
        ...state,
        items: [...state.items, { product, quantity, selectedOptions: options }]
      };
    }

    case 'REMOVE_ITEM':
      return {
        ...state,
        items: state.items.filter(item => item.product.id !== action.payload)
      };

    case 'UPDATE_QUANTITY': {
      const { id, quantity } = action.payload;
      if (quantity <= 0) {
        return {
          ...state,
          items: state.items.filter(item => item.product.id !== id)
        };
      }
      
      return {
        ...state,
        items: state.items.map(item =>
          item.product.id === id ? { ...item, quantity } : item
        )
      };
    }

    case 'CLEAR_CART':
      return { ...state, items: [] };

    case 'TOGGLE_CART':
      return { ...state, isOpen: !state.isOpen };

    case 'APPLY_COUPON':
      return { ...state, coupon: action.payload };

    case 'REMOVE_COUPON':
      return { ...state, coupon: undefined };

    case 'LOAD_CART':
      return action.payload;

    default:
      return state;
  }
};

interface CartContextType {
  state: CartState;
  addItem: (product: Product, quantity?: number, options?: Record<string, string>) => void;
  removeItem: (productId: string) => void;
  updateQuantity: (productId: string, quantity: number) => void;
  clearCart: () => void;
  toggleCart: () => void;
  applyCoupon: (coupon: CartState['coupon']) => void;
  removeCoupon: () => void;
  totals: {
    subtotal: number;
    discount: number;
    total: number;
    itemCount: number;
  };
}

const CartContext = createContext<CartContextType | undefined>(undefined);

export const CartProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [state, dispatch] = useReducer(cartReducer, {
    items: [],
    isOpen: false
  });

  // æŒä¹…åŒ–è´­ç‰©è½¦
  useEffect(() => {
    const savedCart = localStorage.getItem('cart');
    if (savedCart) {
      try {
        const cartData = JSON.parse(savedCart);
        dispatch({ type: 'LOAD_CART', payload: cartData });
      } catch (error) {
        console.error('Failed to load cart from localStorage:', error);
      }
    }
  }, []);

  useEffect(() => {
    localStorage.setItem('cart', JSON.stringify(state));
  }, [state]);

  // è®¡ç®—æ€»è®¡
  const totals = React.useMemo(() => {
    const subtotal = state.items.reduce(
      (sum, item) => sum + item.product.price * item.quantity,
      0
    );

    let discount = 0;
    if (state.coupon) {
      discount = state.coupon.type === 'percentage'
        ? subtotal * (state.coupon.discount / 100)
        : state.coupon.discount;
    }

    const total = Math.max(0, subtotal - discount);
    const itemCount = state.items.reduce((sum, item) => sum + item.quantity, 0);

    return { subtotal, discount, total, itemCount };
  }, [state.items, state.coupon]);

  const contextValue: CartContextType = {
    state,
    addItem: (product, quantity, options) =>
      dispatch({ type: 'ADD_ITEM', payload: { product, quantity, options } }),
    removeItem: (productId) =>
      dispatch({ type: 'REMOVE_ITEM', payload: productId }),
    updateQuantity: (productId, quantity) =>
      dispatch({ type: 'UPDATE_QUANTITY', payload: { id: productId, quantity } }),
    clearCart: () => dispatch({ type: 'CLEAR_CART' }),
    toggleCart: () => dispatch({ type: 'TOGGLE_CART' }),
    applyCoupon: (coupon) => dispatch({ type: 'APPLY_COUPON', payload: coupon }),
    removeCoupon: () => dispatch({ type: 'REMOVE_COUPON' }),
    totals
  };

  return (
    <CartContext.Provider value={contextValue}>
      {children}
    </CartContext.Provider>
  );
};

export const useCart = () => {
  const context = useContext(CartContext);
  if (!context) {
    throw new Error('useCart must be used within a CartProvider');
  }
  return context;
};
```

#### 9.2.2 ç»„ä»¶æ‹†åˆ†

**è´­ç‰©è½¦ç»„ä»¶å®ç°**
```typescript
// components/Cart/CartDrawer.tsx
import React from 'react';
import { useCart } from '../../context/CartContext';
import CartItem from './CartItem';
import CouponInput from './CouponInput';
import styles from './CartDrawer.module.css';

const CartDrawer: React.FC = () => {
  const { state, toggleCart, clearCart, totals } = useCart();

  if (!state.isOpen) return null;

  return (
    <div className={styles.overlay} onClick={toggleCart}>
      <div className={styles.drawer} onClick={(e) => e.stopPropagation()}>
        <header className={styles.header}>
          <h2>Shopping Cart ({totals.itemCount})</h2>
          <button onClick={toggleCart} className={styles.closeButton}>
            âœ•
          </button>
        </header>

        {state.items.length === 0 ? (
          <div className={styles.emptyCart}>
            <p>Your cart is empty</p>
            <button onClick={toggleCart}>Continue Shopping</button>
          </div>
        ) : (
          <>
            <div className={styles.items}>
              {state.items.map((item, index) => (
                <CartItem key={`${item.product.id}-${index}`} item={item} />
              ))}
            </div>

            <div className={styles.couponSection}>
              <CouponInput />
            </div>

            <div className={styles.summary}>
              <div className={styles.summaryRow}>
                <span>Subtotal:</span>
                <span>${totals.subtotal.toFixed(2)}</span>
              </div>
              {totals.discount > 0 && (
                <div className={styles.summaryRow}>
                  <span>Discount:</span>
                  <span className={styles.discount}>-${totals.discount.toFixed(2)}</span>
                </div>
              )}
              <div className={`${styles.summaryRow} ${styles.total}`}>
                <span>Total:</span>
                <span>${totals.total.toFixed(2)}</span>
              </div>
            </div>

            <div className={styles.actions}>
              <button onClick={clearCart} className={styles.clearButton}>
                Clear Cart
              </button>
              <button className={styles.checkoutButton}>
                Proceed to Checkout
              </button>
            </div>
          </>
        )}
      </div>
    </div>
  );
};

// components/Cart/CartItem.tsx
const CartItem: React.FC<{ item: CartItem }> = ({ item }) => {
  const { updateQuantity, removeItem } = useCart();

  return (
    <div className={styles.cartItem}>
      <img src={item.product.image} alt={item.product.name} />
      <div className={styles.itemDetails}>
        <h4>{item.product.name}</h4>
        <p>${item.product.price.toFixed(2)}</p>
        {item.selectedOptions && (
          <div className={styles.options}>
            {Object.entries(item.selectedOptions).map(([key, value]) => (
              <span key={key}>{key}: {value}</span>
            ))}
          </div>
        )}
      </div>
      <div className={styles.quantityControls}>
        <button onClick={() => updateQuantity(item.product.id, item.quantity - 1)}>
          -
        </button>
        <span>{item.quantity}</span>
        <button onClick={() => updateQuantity(item.product.id, item.quantity + 1)}>
          +
        </button>
      </div>
      <button
        onClick={() => removeItem(item.product.id)}
        className={styles.removeButton}
      >
        Remove
      </button>
    </div>
  );
};

export default CartDrawer;
```

### 9.3 å®æ—¶èŠå¤©åº”ç”¨

#### 9.3.1 WebSocketé›†æˆ

**å®æ—¶é€šä¿¡å®ç°**
```typescript
// hooks/useWebSocket.ts
import { useEffect, useRef, useState, useCallback } from 'react';

interface Message {
  id: string;
  userId: string;
  userName: string;
  content: string;
  timestamp: Date;
  type: 'text' | 'image' | 'file';
}

interface WebSocketHookOptions {
  url: string;
  reconnectAttempts?: number;
  reconnectInterval?: number;
}

export const useWebSocket = ({ url, reconnectAttempts = 5, reconnectInterval = 3000 }: WebSocketHookOptions) => {
  const [socket, setSocket] = useState<WebSocket | null>(null);
  const [isConnected, setIsConnected] = useState(false);
  const [messages, setMessages] = useState<Message[]>([]);
  const [onlineUsers, setOnlineUsers] = useState<string[]>([]);
  const reconnectCount = useRef(0);
  const reconnectTimer = useRef<NodeJS.Timeout>();

  const connect = useCallback(() => {
    try {
      const ws = new WebSocket(url);

      ws.onopen = () => {
        console.log('WebSocket connected');
        setIsConnected(true);
        reconnectCount.current = 0;
        setSocket(ws);
      };

      ws.onmessage = (event) => {
        try {
          const data = JSON.parse(event.data);
          
          switch (data.type) {
            case 'message':
              setMessages(prev => [...prev, {
                ...data.payload,
                timestamp: new Date(data.payload.timestamp)
              }]);
              break;
              
            case 'userJoined':
              setOnlineUsers(prev => [...prev, data.payload.userName]);
              break;
              
            case 'userLeft':
              setOnlineUsers(prev => prev.filter(user => user !== data.payload.userName));
              break;
              
            case 'onlineUsers':
              setOnlineUsers(data.payload);
              break;
              
            default:
              console.log('Unknown message type:', data.type);
          }
        } catch (error) {
          console.error('Failed to parse WebSocket message:', error);
        }
      };

      ws.onclose = () => {
        console.log('WebSocket disconnected');
        setIsConnected(false);
        setSocket(null);

        // è‡ªåŠ¨é‡è¿
        if (reconnectCount.current < reconnectAttempts) {
          reconnectTimer.current = setTimeout(() => {
            reconnectCount.current++;
            console.log(`Reconnecting... Attempt ${reconnectCount.current}`);
            connect();
          }, reconnectInterval);
        }
      };

      ws.onerror = (error) => {
        console.error('WebSocket error:', error);
      };

    } catch (error) {
      console.error('Failed to create WebSocket connection:', error);
    }
  }, [url, reconnectAttempts, reconnectInterval]);

  const disconnect = useCallback(() => {
    if (reconnectTimer.current) {
      clearTimeout(reconnectTimer.current);
    }
    if (socket) {
      socket.close();
    }
  }, [socket]);

  const sendMessage = useCallback((message: Omit<Message, 'id' | 'timestamp'>) => {
    if (socket && isConnected) {
      socket.send(JSON.stringify({
        type: 'message',
        payload: message
      }));
    }
  }, [socket, isConnected]);

  useEffect(() => {
    connect();
    return disconnect;
  }, [connect, disconnect]);

  return {
    isConnected,
    messages,
    onlineUsers,
    sendMessage,
    connect,
    disconnect
  };
};

// components/Chat/ChatRoom.tsx
import React, { useState, useRef, useEffect } from 'react';
import { useWebSocket } from '../../hooks/useWebSocket';
import MessageList from './MessageList';
import MessageInput from './MessageInput';
import UserList from './UserList';
import styles from './ChatRoom.module.css';

interface ChatRoomProps {
  roomId: string;
  currentUser: {
    id: string;
    name: string;
  };
}

const ChatRoom: React.FC<ChatRoomProps> = ({ roomId, currentUser }) => {
  const { isConnected, messages, onlineUsers, sendMessage } = useWebSocket({
    url: `wss://localhost:8080/chat/${roomId}`,
    reconnectAttempts: 5,
    reconnectInterval: 3000
  });

  const [isTyping, setIsTyping] = useState<string[]>([]);
  const messagesEndRef = useRef<HTMLDivElement>(null);

  // è‡ªåŠ¨æ»šåŠ¨åˆ°æœ€æ–°æ¶ˆæ¯
  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [messages]);

  const handleSendMessage = (content: string, type: 'text' | 'image' | 'file' = 'text') => {
    if (content.trim()) {
      sendMessage({
        userId: currentUser.id,
        userName: currentUser.name,
        content,
        type
      });
    }
  };

  return (
    <div className={styles.chatRoom}>
      <header className={styles.header}>
        <h2>Chat Room - {roomId}</h2>
        <div className={styles.connectionStatus}>
          <span className={`${styles.indicator} ${isConnected ? styles.connected : styles.disconnected}`} />
          {isConnected ? 'Connected' : 'Disconnected'}
        </div>
      </header>

      <div className={styles.chatContent}>
        <aside className={styles.sidebar}>
          <UserList users={onlineUsers} currentUser={currentUser.name} />
        </aside>

        <main className={styles.messageArea}>
          <MessageList 
            messages={messages} 
            currentUserId={currentUser.id}
            isTyping={isTyping}
          />
          <div ref={messagesEndRef} />
          
          <MessageInput
            onSendMessage={handleSendMessage}
            disabled={!isConnected}
            placeholder={isConnected ? "Type a message..." : "Connecting..."}
          />
        </main>
      </div>
    </div>
  );
};

export default ChatRoom;
```

#### 9.3.2 æ¶ˆæ¯ç®¡ç†

**æ¶ˆæ¯ç»„ä»¶å®ç°**
```typescript
// components/Chat/MessageList.tsx
import React from 'react';
import { Message } from '../../hooks/useWebSocket';
import MessageBubble from './MessageBubble';
import TypingIndicator from './TypingIndicator';
import styles from './MessageList.module.css';

interface MessageListProps {
  messages: Message[];
  currentUserId: string;
  isTyping: string[];
}

const MessageList: React.FC<MessageListProps> = ({ messages, currentUserId, isTyping }) => {
  // æŒ‰æ—¥æœŸåˆ†ç»„æ¶ˆæ¯
  const groupedMessages = messages.reduce((groups, message) => {
    const date = message.timestamp.toDateString();
    if (!groups[date]) {
      groups[date] = [];
    }
    groups[date].push(message);
    return groups;
  }, {} as Record<string, Message[]>);

  return (
    <div className={styles.messageList}>
      {Object.entries(groupedMessages).map(([date, dayMessages]) => (
        <div key={date} className={styles.messageGroup}>
          <div className={styles.dateDivider}>
            <span>{new Date(date).toLocaleDateString()}</span>
          </div>
          
          {dayMessages.map((message, index) => {
            const prevMessage = dayMessages[index - 1];
            const isSequential = prevMessage && 
              prevMessage.userId === message.userId &&
              message.timestamp.getTime() - prevMessage.timestamp.getTime() < 60000; // 1åˆ†é’Ÿå†…

            return (
              <MessageBubble
                key={message.id}
                message={message}
                isOwn={message.userId === currentUserId}
                isSequential={isSequential}
              />
            );
          })}
        </div>
      ))}
      
      {isTyping.length > 0 && (
        <TypingIndicator users={isTyping} />
      )}
    </div>
  );
};

// components/Chat/MessageBubble.tsx
const MessageBubble: React.FC<{
  message: Message;
  isOwn: boolean;
  isSequential: boolean;
}> = ({ message, isOwn, isSequential }) => {
  const formatTime = (timestamp: Date) => {
    return timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
  };

  return (
    <div className={`${styles.messageBubble} ${isOwn ? styles.own : styles.other}`}>
      {!isOwn && !isSequential && (
        <div className={styles.userName}>{message.userName}</div>
      )}
      
      <div className={styles.messageContent}>
        {message.type === 'text' && <p>{message.content}</p>}
        {message.type === 'image' && (
          <img src={message.content} alt="Shared image" className={styles.messageImage} />
        )}
        {message.type === 'file' && (
          <a href={message.content} download className={styles.fileLink}>
            ğŸ“ {message.content.split('/').pop()}
          </a>
        )}
      </div>
      
      <div className={styles.timestamp}>
        {formatTime(message.timestamp)}
      </div>
    </div>
  );
};

// components/Chat/MessageInput.tsx
const MessageInput: React.FC<{
  onSendMessage: (content: string, type?: 'text' | 'image' | 'file') => void;
  disabled: boolean;
  placeholder: string;
}> = ({ onSendMessage, disabled, placeholder }) => {
  const [message, setMessage] = useState('');
  const [isUploading, setIsUploading] = useState(false);
  const fileInputRef = useRef<HTMLInputElement>(null);

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    if (message.trim() && !disabled) {
      onSendMessage(message);
      setMessage('');
    }
  };

  const handleFileUpload = async (file: File) => {
    if (!file) return;

    setIsUploading(true);
    try {
      // è¿™é‡Œåº”è¯¥è°ƒç”¨å®é™…çš„æ–‡ä»¶ä¸Šä¼ API
      const formData = new FormData();
      formData.append('file', file);
      
      const response = await fetch('/api/upload', {
        method: 'POST',
        body: formData
      });
      
      const { url } = await response.json();
      
      const messageType = file.type.startsWith('image/') ? 'image' : 'file';
      onSendMessage(url, messageType);
    } catch (error) {
      console.error('File upload failed:', error);
    } finally {
      setIsUploading(false);
    }
  };

  return (
    <form onSubmit={handleSubmit} className={styles.messageInput}>
      <div className={styles.inputGroup}>
        <input
          type="text"
          value={message}
          onChange={(e) => setMessage(e.target.value)}
          placeholder={placeholder}
          disabled={disabled}
          className={styles.textInput}
        />
        
        <input
          ref={fileInputRef}
          type="file"
          onChange={(e) => e.target.files?.[0] && handleFileUpload(e.target.files[0])}
          style={{ display: 'none' }}
          accept="image/*,.pdf,.doc,.docx,.txt"
        />
        
        <button
          type="button"
          onClick={() => fileInputRef.current?.click()}
          disabled={disabled || isUploading}
          className={styles.fileButton}
        >
          ğŸ“
        </button>
        
        <button
          type="submit"
          disabled={disabled || !message.trim() || isUploading}
          className={styles.sendButton}
        >
          {isUploading ? 'â³' : 'â¤'}
        </button>
      </div>
    </form>
  );
};

export default MessageInput;
```

## 10. React é¢è¯•é¢˜è¯¦è§£

### 10.1 åŸºç¡€æ¦‚å¿µç±»

#### Q1: ä»€ä¹ˆæ˜¯Reactï¼ŸReactæœ‰å“ªäº›ç‰¹ç‚¹ï¼Ÿ

**ç­”æ¡ˆ**ï¼š
Reactæ˜¯ç”±Facebookå¼€å‘çš„ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„JavaScriptåº“ã€‚

**æ ¸å¿ƒç‰¹ç‚¹**ï¼š
1. **å£°æ˜å¼ç¼–ç¨‹**ï¼šæè¿°UIåº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­ï¼Œè€Œä¸æ˜¯å¦‚ä½•æ“ä½œDOM
2. **ç»„ä»¶åŒ–**ï¼šå°†UIæ‹†åˆ†ä¸ºç‹¬ç«‹ã€å¯å¤ç”¨çš„ç»„ä»¶
3. **è™šæ‹ŸDOM**ï¼šåœ¨å†…å­˜ä¸­æ“ä½œDOMå‰¯æœ¬ï¼Œæå‡æ€§èƒ½
4. **å•å‘æ•°æ®æµ**ï¼šæ•°æ®ä»çˆ¶ç»„ä»¶æµå‘å­ç»„ä»¶ï¼Œä¾¿äºè°ƒè¯•
5. **ç”Ÿæ€ä¸°å¯Œ**ï¼šæ‹¥æœ‰åºå¤§çš„ç¬¬ä¸‰æ–¹åº“ç”Ÿæ€ç³»ç»Ÿ

#### Q2: ä»€ä¹ˆæ˜¯è™šæ‹ŸDOMï¼Ÿè™šæ‹ŸDOMçš„å·¥ä½œåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ

**ç­”æ¡ˆ**ï¼š
**è™šæ‹ŸDOM**æ˜¯çœŸå®DOMçš„JavaScriptè¡¨ç¤ºï¼Œæ˜¯ä¸€ä¸ªæè¿°DOMç»“æ„çš„å¯¹è±¡æ ‘ã€‚

**å·¥ä½œåŸç†**ï¼š
1. **åˆ›å»ºè™šæ‹ŸDOM**ï¼šReactç»„ä»¶renderæ–¹æ³•è¿”å›è™šæ‹ŸDOMç»“æ„
2. **Diffç®—æ³•**ï¼šæ¯”è¾ƒæ–°æ—§è™šæ‹ŸDOMæ ‘çš„å·®å¼‚
3. **ç”Ÿæˆè¡¥ä¸**ï¼šåˆ›å»ºæœ€å°åŒ–çš„æ›´æ–°æ“ä½œ
4. **åº”ç”¨æ›´æ–°**ï¼šå°†è¡¥ä¸åº”ç”¨åˆ°çœŸå®DOM

**ä¼˜åŠ¿**ï¼š
- **æ€§èƒ½ä¼˜åŒ–**ï¼šæ‰¹é‡æ›´æ–°ï¼Œå‡å°‘DOMæ“ä½œ
- **è·¨å¹³å°**ï¼šè™šæ‹ŸDOMå¯ä»¥æ¸²æŸ“åˆ°ä¸åŒå¹³å°
- **å¯é¢„æµ‹æ€§**ï¼šçŠ¶æ€å˜åŒ–äº§ç”Ÿå¯é¢„æµ‹çš„è¾“å‡º

#### Q3: è§£é‡ŠReactçš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•

**ç­”æ¡ˆ**ï¼š
Reactç»„ä»¶ç”Ÿå‘½å‘¨æœŸåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š

**æŒ‚è½½é˜¶æ®µï¼ˆMountingï¼‰**ï¼š
- `constructor()`: ç»„ä»¶åˆå§‹åŒ–
- `componentDidMount()`: ç»„ä»¶æŒ‚è½½å®Œæˆï¼Œé€‚åˆå‘èµ·ç½‘ç»œè¯·æ±‚

**æ›´æ–°é˜¶æ®µï¼ˆUpdatingï¼‰**ï¼š
- `componentDidUpdate(prevProps, prevState)`: ç»„ä»¶æ›´æ–°å®Œæˆ
- `shouldComponentUpdate(nextProps, nextState)`: å†³å®šæ˜¯å¦é‡æ–°æ¸²æŸ“

**å¸è½½é˜¶æ®µï¼ˆUnmountingï¼‰**ï¼š
- `componentWillUnmount()`: ç»„ä»¶å³å°†å¸è½½ï¼Œæ¸…ç†å·¥ä½œ

**Hookså¯¹åº”å…³ç³»**ï¼š
- `componentDidMount` â†’ `useEffect(() => {}, [])`
- `componentDidUpdate` â†’ `useEffect(() => {})`
- `componentWillUnmount` â†’ `useEffect(() => { return () => {} }, [])`

#### Q4: ä»€ä¹ˆæ˜¯JSXï¼ŸJSXçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ

**ç­”æ¡ˆ**ï¼š
**JSX**æ˜¯JavaScriptçš„è¯­æ³•æ‰©å±•ï¼Œå…è®¸åœ¨JavaScriptä¸­ç¼–å†™ç±»ä¼¼HTMLçš„ä»£ç ã€‚

**åŸç†**ï¼š
JSXä¼šè¢«Babelè½¬è¯‘ä¸º`React.createElement()`è°ƒç”¨ï¼š

```javascript
// JSXä»£ç 
const element = <div className="container">Hello World</div>;

// è½¬è¯‘åçš„ä»£ç 
const element = React.createElement('div', { className: 'container' }, 'Hello World');
```

#### Q5: Reactä¸­çš„keyå±æ€§æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ

**ç­”æ¡ˆ**ï¼š
**keyå±æ€§**å¸®åŠ©Reactè¯†åˆ«åˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œä¼˜åŒ–æ¸²æŸ“æ€§èƒ½ã€‚

**ä½œç”¨**ï¼š
1. **Diffç®—æ³•ä¼˜åŒ–**ï¼šå¿«é€Ÿæ‰¾åˆ°å˜åŒ–çš„å…ƒç´ 
2. **ä¿æŒç»„ä»¶çŠ¶æ€**ï¼šé¿å…ä¸å¿…è¦çš„é‡æ–°åˆ›å»º
3. **é¿å…æ¸²æŸ“é”™è¯¯**ï¼šé˜²æ­¢å…ƒç´ é¡ºåºå˜åŒ–å¯¼è‡´çš„é—®é¢˜

**æœ€ä½³å®è·µ**ï¼š
```javascript
// âœ… ä½¿ç”¨ç¨³å®šçš„å”¯ä¸€æ ‡è¯†
{users.map(user => (
  <UserItem key={user.id} user={user} />
))}

// âŒ ä¸è¦ä½¿ç”¨æ•°ç»„ç´¢å¼•
{users.map((user, index) => (
  <UserItem key={index} user={user} />
))}
```

### 10.2 ç»„ä»¶ä¸ç”Ÿå‘½å‘¨æœŸç±»

#### Q6: ç±»ç»„ä»¶å’Œå‡½æ•°ç»„ä»¶æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**ç­”æ¡ˆ**ï¼š

| æ–¹é¢ | ç±»ç»„ä»¶ | å‡½æ•°ç»„ä»¶ |
|------|--------|----------|
| **è¯­æ³•** | Classè¯­æ³•ï¼Œéœ€è¦extends | å‡½æ•°è¯­æ³•ï¼Œæ›´ç®€æ´ |
| **çŠ¶æ€** | this.state | useState Hook |
| **ç”Ÿå‘½å‘¨æœŸ** | ç”Ÿå‘½å‘¨æœŸæ–¹æ³• | useEffect Hook |
| **æ€§èƒ½** | éœ€è¦shouldComponentUpdate | React.memo |
| **thisç»‘å®š** | éœ€è¦æ‰‹åŠ¨ç»‘å®š | æ— thisé—®é¢˜ |
| **å¤ç”¨é€»è¾‘** | HOC, Render Props | è‡ªå®šä¹‰Hooks |

#### Q7: ä»€ä¹ˆæ˜¯é«˜é˜¶ç»„ä»¶(HOC)ï¼Ÿå¦‚ä½•å®ç°ï¼Ÿ

**ç­”æ¡ˆ**ï¼š
**é«˜é˜¶ç»„ä»¶(Higher-Order Component)**æ˜¯ä¸€ä¸ªæ¥æ”¶ç»„ä»¶å¹¶è¿”å›æ–°ç»„ä»¶çš„å‡½æ•°ã€‚

```javascript
// HOCå®ç°
const withLoading = (WrappedComponent) => {
  return (props) => {
    if (props.isLoading) {
      return <div>Loading...</div>;
    }
    return <WrappedComponent {...props} />;
  };
};

// ä½¿ç”¨HOC
const UserList = ({ users }) => (
  <ul>{users.map(user => <li key={user.id}>{user.name}</li>)}</ul>
);

const EnhancedUserList = withLoading(UserList);
```

#### Q8: ä»€ä¹ˆæ˜¯Render Propsæ¨¡å¼ï¼Ÿ

**ç­”æ¡ˆ**ï¼š
**Render Props**æ˜¯ä¸€ç§åœ¨ç»„ä»¶é—´å…±äº«ä»£ç çš„æŠ€æœ¯ï¼Œé€šè¿‡propsä¼ é€’æ¸²æŸ“å‡½æ•°ã€‚

```javascript
// Render Propså®ç°
const Mouse = ({ children }) => {
  const [position, setPosition] = useState({ x: 0, y: 0 });
  
  useEffect(() => {
    const handleMouseMove = (e) => {
      setPosition({ x: e.clientX, y: e.clientY });
    };
    
    window.addEventListener('mousemove', handleMouseMove);
    return () => window.removeEventListener('mousemove', handleMouseMove);
  }, []);
  
  return children(position);
};

// ä½¿ç”¨Render Props
const App = () => (
  <Mouse>
    {mouse => (
      <div>é¼ æ ‡ä½ç½®: ({mouse.x}, {mouse.y})</div>
    )}
  </Mouse>
);
```

### 10.3 Hooks æ·±åº¦ç†è§£ç±»

#### Q9: useEffectçš„ä¾èµ–æ•°ç»„æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ

**ç­”æ¡ˆ**ï¼š
**ä¾èµ–æ•°ç»„**å†³å®šäº†useEffectä½•æ—¶é‡æ–°æ‰§è¡Œã€‚

**ä¸‰ç§æƒ…å†µ**ï¼š
```javascript
// 1. æ²¡æœ‰ä¾èµ–æ•°ç»„ï¼šæ¯æ¬¡æ¸²æŸ“éƒ½æ‰§è¡Œ
useEffect(() => {
  console.log('æ¯æ¬¡æ¸²æŸ“éƒ½æ‰§è¡Œ');
});

// 2. ç©ºä¾èµ–æ•°ç»„ï¼šåªåœ¨æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡
useEffect(() => {
  console.log('åªåœ¨æŒ‚è½½æ—¶æ‰§è¡Œ');
}, []);

// 3. æœ‰ä¾èµ–ï¼šä¾èµ–å˜åŒ–æ—¶æ‰§è¡Œ
useEffect(() => {
  console.log('ä¾èµ–å˜åŒ–æ—¶æ‰§è¡Œ');
}, [dependency]);
```

#### Q10: ä¸ºä»€ä¹ˆuseStateçš„æ›´æ–°æ˜¯å¼‚æ­¥çš„ï¼Ÿ

**ç­”æ¡ˆ**ï¼š
useStateçš„æ›´æ–°æ˜¯**å¼‚æ­¥æ‰¹å¤„ç†**çš„ï¼Œä¸»è¦åŸå› ï¼š

**1. æ€§èƒ½ä¼˜åŒ–**ï¼šé¿å…é¢‘ç¹çš„DOMæ›´æ–°
**2. çŠ¶æ€ä¸€è‡´æ€§**ï¼šç¡®ä¿ç»„ä»¶çŠ¶æ€çš„ä¸€è‡´æ€§
**3. æ‰¹é‡å¤„ç†**ï¼šReactä¼šå°†å¤šä¸ªsetStateè°ƒç”¨æ‰¹å¤„ç†ä¸ºä¸€æ¬¡æ›´æ–°

```javascript
const [count, setCount] = useState(0);

const handleClick = () => {
  setCount(count + 1); // å¼‚æ­¥æ›´æ–°
  console.log(count); // ä»ç„¶æ˜¯æ—§å€¼
  
  // è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨å‡½æ•°å¼æ›´æ–°
  setCount(prev => prev + 1);
};
```

### 10.4 æ€§èƒ½ä¼˜åŒ–ç±»

#### Q11: Reactä¸­æœ‰å“ªäº›æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯ï¼Ÿ

**ç­”æ¡ˆ**ï¼š
Reactæ€§èƒ½ä¼˜åŒ–ä¸»è¦åŒ…æ‹¬ï¼š

**1. é¿å…ä¸å¿…è¦çš„æ¸²æŸ“**ï¼š
```javascript
// React.memo
const ExpensiveComponent = React.memo(({ data }) => {
  return <div>{data.name}</div>;
});
```

**2. useMemoä¼˜åŒ–è®¡ç®—**ï¼š
```javascript
const ExpensiveCalculation = ({ items }) => {
  const total = useMemo(() => {
    return items.reduce((sum, item) => sum + item.price, 0);
  }, [items]);
  
  return <div>Total: {total}</div>;
};
```

**3. useCallbackä¼˜åŒ–å‡½æ•°**ï¼š
```javascript
const Parent = ({ items }) => {
  const handleClick = useCallback((id) => {
    console.log('Item clicked:', id);
  }, []);
  
  return <ItemList items={items} onItemClick={handleClick} />;
};
```

**4. ä»£ç åˆ†å‰²ä¸æ‡’åŠ è½½**ï¼š
```javascript
const LazyComponent = lazy(() => import('./LazyComponent'));

const App = () => (
  <Suspense fallback={<div>Loading...</div>}>
    <LazyComponent />
  </Suspense>
);
```

#### Q12: ä»€ä¹ˆæ˜¯React Fiberï¼Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ

**ç­”æ¡ˆ**ï¼š
**React Fiber**æ˜¯React 16å¼•å…¥çš„æ–°çš„åè°ƒå¼•æ“ã€‚

**è§£å†³çš„é—®é¢˜**ï¼š
1. **é•¿æ—¶é—´é˜»å¡**ï¼šæ—§ç‰ˆæœ¬çš„é€’å½’æ›´æ–°ä¼šé˜»å¡ä¸»çº¿ç¨‹
2. **ä¼˜å…ˆçº§è°ƒåº¦**ï¼šæ— æ³•ä¸­æ–­ä½ä¼˜å…ˆçº§ä»»åŠ¡æ¥å¤„ç†é«˜ä¼˜å…ˆçº§ä»»åŠ¡
3. **ç”¨æˆ·ä½“éªŒ**ï¼šç•Œé¢å¡é¡¿ï¼Œç”¨æˆ·äº¤äº’å“åº”æ…¢

**Fiberçš„ç‰¹æ€§**ï¼š
- **å¯ä¸­æ–­**ï¼šé•¿ä»»åŠ¡å¯ä»¥è¢«é«˜ä¼˜å…ˆçº§ä»»åŠ¡ä¸­æ–­
- **å¯æ¢å¤**ï¼šè¢«ä¸­æ–­çš„ä»»åŠ¡å¯ä»¥åœ¨ç©ºé—²æ—¶é—´ç»§ç»­
- **ä¼˜å…ˆçº§**ï¼šç”¨æˆ·äº¤äº’ä¼˜å…ˆäºæ•°æ®æ›´æ–°
- **å¹¶å‘**ï¼šå¯ä»¥åŒæ—¶å‡†å¤‡å¤šä¸ªçŠ¶æ€ç‰ˆæœ¬

### 10.5 å®æˆ˜åº”ç”¨ç±»

#### Q13: å¦‚ä½•åœ¨Reactä¸­å®ç°çŠ¶æ€ç®¡ç†ï¼Ÿ

**ç­”æ¡ˆ**ï¼š
Reactä¸­æœ‰å¤šç§çŠ¶æ€ç®¡ç†æ–¹æ¡ˆï¼š

**1. æœ¬åœ°çŠ¶æ€ï¼ˆuseStateï¼‰**ï¼š
```javascript
const Counter = () => {
  const [count, setCount] = useState(0);
  return <div>Count: {count}</div>;
};
```

**2. Context API**ï¼š
```javascript
const ThemeContext = createContext();

const App = () => {
  const [theme, setTheme] = useState('light');
  
  return (
    <ThemeContext.Provider value={{ theme, setTheme }}>
      <Header />
      <Main />
    </ThemeContext.Provider>
  );
};
```

**3. useReducerå¤æ‚çŠ¶æ€**ï¼š
```javascript
const reducer = (state, action) => {
  switch (action.type) {
    case 'increment':
      return { count: state.count + 1 };
    default:
      return state;
  }
};

const Counter = () => {
  const [state, dispatch] = useReducer(reducer, { count: 0 });
  return <div>Count: {state.count}</div>;
};
```

#### Q14: å¦‚ä½•å¤„ç†Reactä¸­çš„é”™è¯¯è¾¹ç•Œï¼Ÿ

**ç­”æ¡ˆ**ï¼š
**é”™è¯¯è¾¹ç•Œ(Error Boundaries)**æ˜¯Reactç»„ä»¶ï¼Œå®ƒå¯ä»¥æ•è·å…¶å­ç»„ä»¶æ ‘ä¸­çš„é”™è¯¯ã€‚

```javascript
class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false };
  }
  
  static getDerivedStateFromError(error) {
    return { hasError: true };
  }
  
  componentDidCatch(error, errorInfo) {
    console.error('Error caught:', error, errorInfo);
  }
  
  render() {
    if (this.state.hasError) {
      return <h1>Something went wrong.</h1>;
    }
    
    return this.props.children;
  }
}

// ä½¿ç”¨é”™è¯¯è¾¹ç•Œ
const App = () => (
  <ErrorBoundary>
    <MyComponent />
  </ErrorBoundary>
);
```

#### Q15: Reactä¸­å¦‚ä½•å®ç°æ¡ä»¶æ¸²æŸ“ï¼Ÿ

**ç­”æ¡ˆ**ï¼š
Reactä¸­æœ‰å¤šç§æ¡ä»¶æ¸²æŸ“æ–¹å¼ï¼š

**1. ä¸‰å…ƒè¿ç®—ç¬¦**ï¼š
```javascript
const MyComponent = ({ isLoggedIn }) => (
  <div>
    {isLoggedIn ? <UserDashboard /> : <LoginForm />}
  </div>
);
```

**2. é€»è¾‘ä¸è¿ç®—ç¬¦**ï¼š
```javascript
const Notification = ({ message }) => (
  <div>
    {message && <div className="alert">{message}</div>}
  </div>
);
```

**3. ifè¯­å¥**ï¼š
```javascript
const MyComponent = ({ user }) => {
  if (!user) {
    return <div>Loading...</div>;
  }
  
  if (user.role === 'admin') {
    return <AdminPanel />;
  }
  
  return <UserPanel user={user} />;
};
```

**4. switchè¯­å¥**ï¼š
```javascript
const StatusIndicator = ({ status }) => {
  switch (status) {
    case 'loading':
      return <Spinner />;
    case 'error':
      return <ErrorMessage />;
    case 'success':
      return <SuccessMessage />;
    default:
      return null;
  }
};
```

---

## ğŸ“š æ€»ç»“

è¿™ä»½ReactæŠ€æœ¯æŒ‡å—æ¶µç›–äº†ï¼š

### ğŸ¯ æ ¸å¿ƒå†…å®¹
1. **åŸºç¡€æ¦‚å¿µ**ï¼šè™šæ‹ŸDOMã€ç»„ä»¶åŒ–ã€JSXç­‰æ ¸å¿ƒç†å¿µ
2. **ç»„ä»¶å¼€å‘**ï¼šå‡½æ•°ç»„ä»¶ã€ç±»ç»„ä»¶ã€ç”Ÿå‘½å‘¨æœŸç®¡ç†
3. **Hooksæ·±å…¥**ï¼šuseStateã€useEffectã€è‡ªå®šä¹‰Hooksç­‰
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šReact.memoã€useMemoã€ä»£ç åˆ†å‰²ç­‰
5. **å®æˆ˜åº”ç”¨**ï¼šçŠ¶æ€ç®¡ç†ã€é”™è¯¯å¤„ç†ã€æ¡ä»¶æ¸²æŸ“
6. **é¢è¯•å‡†å¤‡**ï¼š15é“é«˜é¢‘é¢è¯•é¢˜è¯¦è§£

### âœ… æŠ€æœ¯ç‰¹è‰²
- **å›¾æ–‡å¹¶èŒ‚**ï¼š13ä¸ªMermaidæµç¨‹å›¾è§£é‡Šæ ¸å¿ƒæ¦‚å¿µ
- **ä»£ç ä¸°å¯Œ**ï¼šå®Œæ•´å¯è¿è¡Œçš„ç¤ºä¾‹ä»£ç 
- **å®æˆ˜å¯¼å‘**ï¼šçœŸå®é¡¹ç›®ä¸­çš„åº”ç”¨åœºæ™¯
- **é¢è¯•å‹å¥½**ï¼šæ ‡å‡†ç­”æ¡ˆå¯ç›´æ¥ç”¨äºé¢è¯•

è¿™ä»½æŒ‡å—é€‚åˆä»åˆå­¦è€…åˆ°é«˜çº§å¼€å‘è€…çš„å„ä¸ªå±‚æ¬¡ï¼Œæ˜¯å­¦ä¹ å’ŒæŒæ¡ReactæŠ€æœ¯çš„å®Œæ•´å‚è€ƒèµ„æ–™ã€‚
