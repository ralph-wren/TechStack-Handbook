# 网络基础知识

---

## 目录
- 网络基础知识
  - 目录
  - 常见网络设备
    - 光猫（ONU/ONT）
    - 路由器
    - 光猫与路由器的关系
  - IP 基础知识
    - IP（Internet Protocol）
    - IPv4 地址
      - IP 段与子网掩码
    - IPv6 地址
      - IPv6 示例解析
    - 城域网IP与公网IP
  - 常用网络命令
  - 网关基础知识
    - 网关（Gateway）
  - Wi-Fi 基础知识
    - Wi-Fi（Wireless Fidelity）
  - Wi-Fi与网关基础
    - Wi-Fi（无线局域网）
    - 网关（Gateway）
  - 局域网IP与公网IP关系
    - 局域网IP（私有IP）
    - 公网IP
    - 关系与原理
  - IP冲突相关问题
  - DHCP相关知识
  - VPN相关知识
  - 翻墙（科学上网）原理补充

---

## 常见网络设备

### 光猫（ONU/ONT）
- **定义**：光纤调制解调器（Optical Network Unit/Optical Network Terminal），是光纤到户（FTTH）方案中的核心设备，将运营商的光信号转换为家庭/企业可用的以太网信号。
- **主要功能**：
  - 信号转换（光→电）：实现光纤信号与以太网信号的互通。
  - 宽带拨号（PPPoE）：部分光猫支持直接拨号上网。
  - 电话功能：部分型号集成语音端口，支持固话接入。
  - 简单 Wi-Fi：部分光猫自带基础无线功能，但信号覆盖和性能有限。
- **进阶知识**：
  - 光猫分为桥接模式（Bridge）和路由模式（Router），桥接模式下需外接路由器拨号，路由模式下光猫自身拨号并分配IP。
  - 部分运营商会对光猫进行定制和管理，用户更换或重置需注意兼容性和认证问题。
- **常见问题**：
  - 光猫故障会导致全网断网，常见表现为PON灯异常、LOS灯闪烁。
  - 光猫性能瓶颈可能影响带宽利用率，建议高带宽场景选用高性能路由器分流。

### 路由器
- **定义**：路由器是连接不同网络、转发数据包的网络设备，家庭和企业网络的核心。
- **主要功能**：
  - 设备连接管理：支持多终端有线/无线接入。
  - Wi-Fi覆盖：提供无线网络接入，支持多频段、多SSID。
  - 网络优化与安全：如QoS带宽管理、家长控制、防火墙、VPN、访客网络等。
  - NAT转换：实现私有IP与公网IP的转换，支持端口映射、UPnP等。
- **进阶知识**：
  - 支持多种工作模式：路由、AP、桥接、中继、Mesh组网等。
  - 企业级路由器支持VLAN、静态/动态路由、ACL访问控制等高级功能。
- **常见问题**：
  - 路由器过载会导致掉线、卡顿，建议定期重启或升级固件。
  - 信号死角可通过Mesh、信号放大器等方式优化。

### 光猫与路由器的关系
- **网络结构**：光猫负责接入运营商网络，路由器负责内部网络管理和分发。
- **连接方式**：光纤→光猫→（网线）→路由器WAN口→家庭/企业终端。
- **一体机与分体机**：一体机集成光猫和路由器功能，适合简单场景；分体机便于灵活扩展和升级。
- **进阶知识**：
  - 桥接模式下，光猫仅做信号转换，路由器负责拨号和分配IP，便于网络管理和安全隔离。
  - 路由模式下，光猫和路由器均可分配IP，易出现双重NAT，影响端口映射和远程访问。
- **实际案例**：
  - 家庭宽带升级千兆后，建议光猫桥接+千兆路由器，充分发挥带宽优势。

---

## IP 基础知识

### IP（Internet Protocol）
- **定义**：IP是互联网协议族的核心协议，负责网络层寻址和数据包转发。
- **作用**：为每台联网设备分配唯一地址，实现全球范围内的设备互联。
- **进阶知识**：
  - IP协议分为IPv4和IPv6，分别对应32位和128位地址空间。
  - IP协议支持分片、重组、TTL（生存时间）、校验和等机制，保障数据可靠传输。

### IPv4 地址
- **结构**：32位二进制，通常以点分十进制表示（如192.168.1.1）。
- **地址分类**：A类（1.0.0.0-126.255.255.255）、B类、C类、D类（多播）、E类（保留）。
- **私有地址段**：仅限局域网使用，不能在公网路由。
- **公网地址**：全球唯一，由IANA和各地区RIR分配。
- **地址耗尽**：IPv4地址有限，已基本分配完毕，推动IPv6普及。
- **进阶知识**：
  - 子网划分（CIDR）：灵活分配IP资源，提高地址利用率。
  - DHCP动态分配与静态分配的区别与应用场景。

#### IP 段与子网掩码
- **子网掩码**：用于区分网络号和主机号，决定同一网段内哪些设备可直接通信。
- **CIDR表示法**：如192.168.1.0/24，表示前24位为网络号。
- **广播地址**：用于同一网段内所有主机的广播通信。
- **实际案例**：
  - 企业网络常用子网划分实现部门隔离和安全控制。

### IPv6 地址
- **结构**：128位，十六进制冒号分隔（如2001:0db8:85a3:0000:0000:8a2e:0370:7334）。
- **主要类型**：
  - 全局单播地址：可在互联网路由，类似IPv4公网IP。
  - 链路本地地址：仅限本地链路通信，自动分配，前缀fe80::/10。
  - 回环地址（::1）：本机自测。
  - 多播地址：一对多通信。
- **IPv6优势**：
  - 地址空间极大，支持物联网、5G等大规模接入。
  - 支持IPsec加密、自动配置、无NAT直连等特性。
- **进阶知识**：
  - IPv6过渡技术（如双栈、隧道、NAT64等）。
  - SLAAC自动地址配置与DHCPv6的区别。

#### IPv6 示例解析
- **fe80::26da:33ff:fec7:924b%wlan0**：链路本地地址，%wlan0为接口标识。
- **应用场景**：本地网段设备自动发现、无须手动配置。
- **注意事项**：链路本地地址不可用于互联网通信。

### 城域网IP与公网IP

| 特性         | 城域网IP（私网）                | 公网IP                |
| ------------ | ------------------------------ | --------------------- |
| 地址类型     | 私网IP（如10.x.x.x,192.168.x.x） | 全球唯一公网IP        |
| 是否直连互联网 | 否（需NAT转换）                 | 是                    |
| 分配范围     | 城市/区域内部                   | 全球                  |
| 典型用途     | 家庭宽带、企业内网              | 网站、服务器对外服务  |

- **城域网IP**：运营商在城市范围内分配的IP，通常为私网IP，通过NAT共享公网出口。
- **公网IP**：全球唯一，可直接访问互联网。

---

## 常用网络命令

- `arp -a`：查看本地ARP缓存，排查IP与MAC绑定冲突。
- `ipconfig`/`ifconfig`：查看和配置本机网络参数，常用于排查IP冲突、网关异常。
- `ping`：测试网络连通性和延迟，判断丢包、延迟等问题。
- `traceroute`/`tracert`：追踪数据包经过的路由路径，定位网络瓶颈和故障节点。
- `netstat -an`：查看端口占用、连接状态，排查异常连接和端口冲突。
- `nslookup`：DNS解析测试，排查域名无法访问等问题。
- **进阶命令**：
  - `route`/`ip route`：查看和配置路由表。
  - `tcpdump`/`wireshark`：抓包分析网络流量。
  - `nmap`：端口扫描与安全检测。

---

## 网关基础知识

### 网关（Gateway）
- **定义**：网关是网络层与更高层之间的协议转换设备，连接不同网络，实现数据转发和协议适配。
- **主要作用**：
  - 协议转换：如IPv4与IPv6、TCP与UDP、HTTP与HTTPS等。
  - 网络隔离与安全控制：防火墙、NAT、访问控制列表（ACL）。
  - 路由转发：实现不同网段、不同协议间的数据互通。
- **类型**：
  - 默认网关：局域网设备访问外部网络的出口。
  - 应用层网关（如代理服务器、API网关）：实现应用协议转换和安全控制。
- **进阶知识**：
  - 支持静态路由、动态路由（RIP、OSPF、BGP等）协议。
  - 企业级网关支持负载均衡、冗余备份（VRRP）、多出口策略等。
- **实际案例**：
  - 家庭宽带路由器的WAN口即为默认网关。
  - 企业部署多出口网关实现链路备份和负载均衡。

---

## Wi-Fi 基础知识

### Wi-Fi（Wireless Fidelity）
- **定义**：基于IEEE 802.11标准的无线局域网技术，实现终端设备与网络的无线通信。
- **主要组成**：
  - 无线路由器/无线AP（Access Point，接入点）：负责无线信号发射与接入。
  - 无线终端：如手机、电脑、平板、智能家居等。
- **常见术语**：
  - SSID：无线网络名称，可隐藏或广播。
  - 加密方式：WPA2、WPA3（推荐）、WEP（已淘汰）。
  - 频段：2.4GHz（穿透力强，易干扰）、5GHz（速率高，覆盖近）、6GHz（Wi-Fi 6E）。
- **基础原理**：
  - 终端通过Wi-Fi连接到AP，AP通过有线方式连接到路由器/网关，实现互联网访问。
  - 支持漫游、Mesh组网、QoS等高级特性。
- **进阶知识**：
  - Wi-Fi 5/6/6E/7标准的区别与优势。
  - MU-MIMO、OFDMA等提升并发和效率的技术。
  - 信道干扰与自动信道选择。
- **常见问题排查**：
  - 信号弱：优化AP布局、减少障碍物、升级天线。
  - 无法连接：检查SSID、密码、加密方式、黑名单设置。
  - 频段干扰：切换信道、使用5G频段、避开微波炉等干扰源。
  - 速率慢：排查带宽瓶颈、终端兼容性、邻居Wi-Fi干扰。

---

## Wi-Fi与网关基础

### Wi-Fi（无线局域网）
- **定义**：无线局域网通过AP实现无线接入，终端无需布线即可联网。
- **主要组成**：无线路由器/无线AP、无线终端。
- **工作原理**：终端通过Wi-Fi连接AP，AP通过有线方式连接路由器/网关，最终访问互联网。
- **进阶知识**：
  - Mesh组网可实现无缝漫游和大范围覆盖。
  - 企业级Wi-Fi支持VLAN隔离、访客网络、AP集中管理。
- **常见问题排查**：同上。

### 网关（Gateway）
- **定义**：连接不同网络的协议转换设备，是局域网与外网的桥梁。
- **作用**：协议转换、网络隔离、安全控制、路由转发。
- **进阶知识**：
  - 支持多WAN、负载均衡、策略路由。
  - 可集成防火墙、IDS/IPS、VPN等安全功能。
- **实际案例**：企业多出口网关、家庭智能路由器。

---

## 局域网IP与公网IP关系

### 局域网IP（私有IP）
- **定义**：仅在本地网络有效的IP地址，不能直接在互联网中路由。
- **常见地址段**：10.0.0.0/8、172.16.0.0/12、192.168.0.0/16。
- **作用**：内部通信、节省公网IP、提升安全性。
- **分配方式**：DHCP自动分配或手动指定。
- **访问限制**：外部无法直接访问，需端口映射或VPN。
- **进阶知识**：
  - 支持多级子网划分，便于大规模网络管理。
  - 可结合VLAN实现逻辑隔离。
- **实际案例**：家庭、企业、校园网、数据中心内网。

### 公网IP
- **定义**：全球唯一、可直接在互联网中路由的IP地址。
- **作用**：实现全球互联。
- **分配方式**：由ISP或云服务商分配。
- **访问特性**：可被全球访问，易受攻击，需加强安全防护。
- **进阶知识**：
  - IPv4公网IP稀缺，IPv6公网IP充足。
  - 支持静态和动态分配，动态公网IP常见于家庭宽带。
- **实际案例**：网站服务器、云主机、远程办公等。

### NAT（网络地址转换）与端口映射
- **NAT原理**：路由器将多个私有IP映射到一个公网IP，实现地址复用。
- **类型**：
  - 静态NAT：一一映射，常用于服务器。
  - 动态NAT：多对多映射，适合大规模用户。
  - PAT（端口地址转换）：多对一映射，最常见。
- **端口映射**：将公网IP的特定端口转发到内网指定设备，实现外部访问。
- **进阶知识**：
  - UPnP自动端口映射，便于P2P、游戏等应用。
  - NAT穿透技术（如STUN、TURN、Hole Punching）解决P2P通信难题。
- **实际案例**：远程桌面、NAS、摄像头、游戏主机等。

### 关系与通信流程
- **出网流程**：
  1. 终端用私有IP与网关通信。
  2. 路由器NAT转换为公网IP，数据包发往互联网。
  3. 返回数据包由路由器转发给对应终端。
- **入网流程**：
  1. 默认公网无法直接访问内网。
  2. 需端口映射、DMZ、VPN等方式实现。
- **进阶知识**：
  - CGNAT（运营商级NAT）进一步复用公网IP，影响P2P、端口映射。
  - IPv6下无需NAT，终端可获全球唯一地址。
- **实际案例**：家庭宽带、企业内网、云主机公网访问。

### 典型应用场景
- 家庭/公司设备通过路由器分配私有IP，共享公网IP上网。
- 远程办公、监控、游戏等需公网访问内网设备时，配置端口映射或VPN。
- 云服务器直接分配公网IP，适合对外服务。

### 安全注意事项
- 局域网IP具备天然安全性，公网IP需防火墙、入侵检测等保护。
- 端口映射易被扫描攻击，建议关闭不必要端口，使用强密码和加密。
- VPN可安全访问内网资源，推荐企业和远程办公场景。

---

## IP冲突相关问题

### 什么是IP冲突？
- IP冲突是指同一局域网内有两台或多台设备被分配了相同的IP地址，导致网络通信异常。

### 产生原因
- 多台设备手动设置了相同的静态IP。
- DHCP服务器分配的IP与某台设备的静态IP重复。
- 网络中存在多个DHCP服务器，分配了重叠的地址池。
- 设备休眠/断网后IP未及时释放，重新上线时被其他设备占用。

### 常见表现
- 设备无法正常上网或频繁掉线。
- 局域网内部分设备无法互相访问。
- 系统提示“IP地址冲突”或“有另一台设备使用了本机IP”。
- ping本机IP时出现多台设备响应。

### 排查与解决方法
- 检查路由器DHCP设置，确保地址池不与静态IP冲突。
- 局域网内设备尽量采用自动获取IP（DHCP），如需静态IP应避开DHCP分配范围。
- 使用`arp -a`、`ping`等命令查找冲突设备的MAC地址。
- 逐台排查手动设置静态IP的设备，调整为唯一IP。
- 重启路由器和所有终端，释放并重新分配IP。

### 进阶知识
- 大型企业网络可采用IP地址管理（IPAM）系统自动分配和监控IP，避免冲突。
- IPv6由于地址空间极大，几乎不会出现IP冲突。

---

## DHCP相关知识

### 什么是DHCP？
- DHCP（Dynamic Host Configuration Protocol，动态主机配置协议）是一种网络协议，用于自动为局域网内的设备分配IP地址、子网掩码、网关、DNS等网络参数。

### 工作原理
- 设备（客户端）接入网络时，自动向DHCP服务器发送请求。
- DHCP服务器从地址池中分配可用IP及相关参数，并下发给客户端。
- 客户端获得IP后可正常通信，租约到期后可续租或重新分配。
- 支持手动绑定（MAC-IP绑定）、地址池划分、租约管理等功能。

### 主要优势
- 自动化：简化网络管理，避免手动配置错误。
- 灵活性：支持动态分配、静态分配、保留地址等多种模式。
- 可扩展性：适用于家庭、企业、数据中心等各种规模网络。

### 常见应用场景
- 家庭和企业路由器默认启用DHCP，自动为终端分配IP。
- 大型企业通过集中式DHCP服务器统一管理全网IP。
- 数据中心、云平台通过DHCP实现虚拟机、容器的自动网络配置。

### 进阶知识
- 支持DHCP Option参数扩展（如PXE网络启动、VoIP配置等）。
- 支持DHCP中继（Relay），跨网段分配IP。
- DHCP与静态IP共存时需避免地址池重叠，防止IP冲突。
- IPv6环境下有DHCPv6协议，支持无状态自动配置（SLAAC）和有状态分配。

### 常见问题与排查
- 设备无法获取IP：检查DHCP服务是否开启、地址池是否耗尽、网络连通性。
- 出现IP冲突：排查静态IP与DHCP池是否重叠，检查是否有多个DHCP服务器。
- DHCP租约异常：可尝试释放/续租IP，或重启DHCP服务。

---

## VPN相关知识

### 什么是VPN？
- VPN（Virtual Private Network，虚拟专用网络）是一种通过公用网络（如互联网）建立加密“隧道”，实现远程安全访问内网资源的技术。

### 工作原理
- 通过加密协议（如IPSec、SSL、L2TP、PPTP、WireGuard等）在用户设备与VPN服务器之间建立安全连接。
- 所有数据在“隧道”中传输，防止被窃听、篡改。
- 连接VPN后，用户设备可获得目标内网的访问权限，仿佛身处本地网络。

### 主要用途
- 远程办公：员工在外地通过VPN安全访问公司内网、OA、文件服务器等。
- 数据加密：保护公共Wi-Fi环境下的数据安全，防止中间人攻击。
- 匿名访问：隐藏真实IP，突破地理限制访问特定网站或服务。
- 多分支互联：企业各地分支通过VPN组网，统一管理和资源共享。

### 常见类型
- 远程接入VPN（Remote Access VPN）：个人设备通过VPN客户端连接企业/学校等内网。
- 站点到站点VPN（Site-to-Site VPN）：两个或多个局域网通过VPN网关互联，常用于企业分支互通。
- SSL VPN：基于浏览器或专用客户端，适合灵活远程接入。
- IPSec VPN：基于IP层，安全性高，适合企业级应用。
- WireGuard：新一代高性能、易配置的VPN协议。

### 进阶知识
- 支持多种认证方式（用户名密码、证书、双因子等）。
- 可与防火墙、IDS/IPS、访问控制策略结合，提升安全性。
- 支持分流（Split Tunneling），可选择哪些流量走VPN，哪些直连互联网。
- VPN服务器可自建（如OpenVPN、StrongSwan、WireGuard）或使用云服务（如阿里云、AWS VPN等）。

### 常见问题与排查
- 无法连接VPN：检查网络连通性、账号权限、防火墙端口、协议兼容性。
- 连接后无法访问内网：排查路由配置、访问控制、DNS设置。
- 速度慢/掉线：检查带宽、服务器负载、加密算法、网络质量。
- 被封锁：尝试更换协议、端口或使用混淆插件。

### 安全注意事项
- VPN账号和证书需妥善保管，防止泄露。
- 建议启用强加密和多因子认证。
- 定期更新VPN服务器和客户端，修补安全漏洞。

---

## 翻墙（科学上网）原理补充

### 从中国翻墙到国外
- **背景**：由于中国大陆存在网络防火墙（GFW），部分国外网站和服务（如Google、YouTube、Twitter等）被屏蔽，用户需通过“翻墙”技术访问。
- **常见原理**：
  - **VPN**：通过加密隧道将本地流量转发到国外VPN服务器，由服务器代理访问被屏蔽网站。
  - **代理（如Shadowsocks、V2Ray、Trojan等）**：本地客户端将流量加密后转发到国外代理服务器，再由服务器访问目标网站。
  - **隧道协议**：如SSH隧道、WireGuard、OpenVPN等，均可实现加密转发和流量伪装。
  - **CDN/域前置**：利用内容分发网络或第三方平台中转流量，绕过封锁。
- **流量混淆与伪装**：为防止被GFW识别和封锁，常用TLS加密、WebSocket、HTTP/2、TLS指纹伪装等技术。
- **常见问题**：
  - 服务器IP被封锁、端口被阻断、协议被识别。
  - 需定期更换服务器、协议或使用多重混淆。

### 从国外翻墙到国内
- **背景**：部分在海外的用户（如留学生、外企员工）需访问中国大陆的内网或仅限中国大陆访问的服务（如部分政务、教育、视频平台等）。
- **常见原理**：
  - **反向VPN/代理**：在中国大陆部署VPN或代理服务器，海外用户连接后流量通过该服务器访问国内资源。
  - **远程桌面/堡垒机**：通过远程桌面、堡垒机等方式间接访问内网。
  - **企业专线/SD-WAN**：企业通过专线或SD-WAN技术实现全球分支互联，保障国内资源访问。
- **常见协议**：OpenVPN、IPSec、WireGuard、Shadowsocks、V2Ray等。
- **注意事项**：
  - 国内服务器需有公网IP并开放相应端口。
  - 需遵守当地法律法规，合理合规使用。

### 安全与合规风险
- **加密通信**可提升隐私和安全，但部分国家/地区对VPN和代理有法律限制。
- **企业/个人应遵守当地网络管理政策，合理使用科学上网工具。**

---

> 本文档适合网络基础学习、日常排查与面试参考。

