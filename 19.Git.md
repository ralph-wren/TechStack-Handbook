# Git 使用指南

## 目录
- [Git 简介](#git-简介)
- [基本概念](#基本概念)
- [安装与配置](#安装与配置)
  - [基本配置](#基本配置)
  - [代理配置](#代理配置)
- [基本操作](#基本操作)
  - [创建仓库](#创建仓库)
  - [提交更改](#提交更改)
  - [查看历史](#查看历史)
  - [撤销更改](#撤销更改)
- [分支管理](#分支管理)
  - [创建与切换分支](#创建与切换分支)
  - [合并分支](#合并分支)
  - [解决冲突](#解决冲突)
- [远程操作](#远程操作)
  - [克隆仓库](#克隆仓库)
  - [推送更改](#推送更改)
  - [拉取更改](#拉取更改)
  - [远程分支管理](#远程分支管理)
- [高级操作](#高级操作)
  - [标签管理](#标签管理)
  - [子模块](#子模块)
  - [Cherry-Pick](#cherry-pick)
  - [变基](#变基)
  - [储藏](#储藏)
- [Git 工作流](#git-工作流)
  - [集中式工作流](#集中式工作流)
  - [功能分支工作流](#功能分支工作流)
  - [Gitflow 工作流](#gitflow-工作流)
  - [Forking 工作流](#forking-工作流)
- [最佳实践](#最佳实践)
  - [提交规范](#提交规范)
  - [分支命名规范](#分支命名规范)
  - [Git Hooks](#git-hooks)
- [常见问题与解决](#常见问题与解决)
  - [冲突解决](#冲突解决)
  - [撤销操作](#撤销操作)
  - [性能优化](#性能优化)

## Git 简介

Git 是一个开源的分布式版本控制系统，由 Linus Torvalds（Linux 内核的创始人）在 2005 年创建，用于管理 Linux 内核的开发。Git 的设计目标是速度、数据完整性和对分布式工作流的支持。

### 主要特点

- **分布式系统**：每个开发者都拥有完整的代码仓库副本
- **强大的分支管理**：创建、合并和删除分支的操作非常快速和简单
- **数据完整性**：Git 使用 SHA-1 哈希算法确保数据完整性
- **高性能**：即使对于大型项目，Git 也能保持高效运行
- **开源免费**：Git 是在 GNU 通用公共许可证下发布的开源软件

## 基本概念

Git 的工作流程涉及以下几个关键区域：

```mermaid
graph TD
    A[工作区] -->|git add| B[暂存区]
    B -->|git commit| C[本地仓库]
    C -->|git push| D[远程仓库]
    D -->|git fetch| C
    C -->|git checkout| A
    D -->|git pull| A
```

- **工作区（Working Directory）**：你实际编辑文件的地方
- **暂存区（Staging Area/Index）**：临时存储你的更改
- **本地仓库（Local Repository）**：存储提交历史的地方
- **远程仓库（Remote Repository）**：托管在服务器上的仓库

## 安装与配置

### 安装 Git

**Linux (Debian/Ubuntu)**
```bash
sudo apt-get update
sudo apt-get install git
```

**Linux (Fedora)**
```bash
sudo dnf install git
```

**macOS**
```bash
# 使用 Homebrew
brew install git

# 或下载安装包
# https://git-scm.com/download/mac
```

**Windows**
- 下载并安装 Git for Windows：https://git-scm.com/download/win

### 基本配置

设置用户信息：
```bash
git config --global user.name "Your Name"
git config --global user.email "your.email@example.com"
```

设置默认编辑器：
```bash
git config --global core.editor "vim"  # 或其他编辑器
```

查看配置：
```bash
git config --list
```

### 代理配置

在某些网络环境下，可能需要配置代理才能正常访问远程仓库。

**HTTP/HTTPS 代理**
```bash
# 设置 HTTP 代理
git config --global http.proxy http://proxyuser:proxypassword@proxy.server.com:port

# 设置 HTTPS 代理
git config --global https.proxy https://proxyuser:proxypassword@proxy.server.com:port

# 如果代理不需要认证
git config --global http.proxy http://proxy.server.com:port
git config --global https.proxy https://proxy.server.com:port
```

**SSH 代理**

在 `~/.ssh/config` 文件中添加：
```
Host github.com
    User git
    ProxyCommand nc -X connect -x proxy.server.com:port %h %p
```

**取消代理**
```bash
# 取消 HTTP 代理
git config --global --unset http.proxy

# 取消 HTTPS 代理
git config --global --unset https.proxy
```

**仅为特定域名设置代理**
```bash
# 仅为 github.com 设置代理
git config --global http.https://github.com.proxy http://proxy.server.com:port
```

**检查当前代理设置**
```bash
git config --global --get http.proxy
git config --global --get https.proxy
```

## 基本操作

### 创建仓库

**初始化新仓库**
```bash
git init
```

**克隆现有仓库**
```bash
git clone https://github.com/username/repository.git
```

### 提交更改

**查看状态**
```bash
git status
```

**添加文件到暂存区**
```bash
# 添加单个文件
git add filename

# 添加所有更改
git add .
```

**提交更改**
```bash
git commit -m "提交说明"

# 跳过暂存区直接提交
git commit -a -m "提交说明"
```

### 查看历史

**查看提交历史**
```bash
# 基本日志
git log

# 简洁日志
git log --oneline

# 图形化显示
git log --graph --oneline --decorate

# 查看特定文件的历史
git log -- filename
```

**查看文件差异**
```bash
# 工作区与暂存区的差异
git diff

# 暂存区与最后一次提交的差异
git diff --staged

# 两次提交之间的差异
git diff commit1 commit2
```

### 撤销更改

**撤销工作区修改**
```bash
git checkout -- filename
```

**撤销暂存区修改**
```bash
git reset HEAD filename
```

**修改最后一次提交**
```bash
git commit --amend
```

**回退到之前的提交**
```bash
# 保留工作区更改
git reset --soft HEAD~1

# 丢弃工作区更改
git reset --hard HEAD~1
```

## 分支管理

分支是 Git 的核心功能之一，允许开发者在不影响主代码库的情况下进行开发。

```mermaid
graph LR
    A[master] -->|git branch feature| B[feature]
    B -->|开发| C[feature修改]
    C -->|git checkout master| A
    C -->|git merge feature| D[合并后master]
```

### 创建与切换分支

**列出所有分支**
```bash
git branch
```

**创建新分支**
```bash
git branch branch-name
```

**切换分支**
```bash
git checkout branch-name

# 创建并切换到新分支
git checkout -b branch-name
```

**使用 switch 切换分支（Git 2.23+）**
```bash
git switch branch-name

# 创建并切换到新分支
git switch -c branch-name
```

### 合并分支

**合并分支**
```bash
# 切换到目标分支
git checkout master

# 合并其他分支到当前分支
git merge branch-name
```

**使用 --no-ff 创建合并提交**
```bash
git merge --no-ff branch-name
```

### 解决冲突

当合并分支时，如果两个分支修改了同一个文件的同一部分，Git 无法自动合并，会产生冲突。

**解决冲突步骤**
1. Git 会在冲突文件中标记冲突区域
   ```
   <<<<<<< HEAD
   当前分支的修改
   =======
   要合并分支的修改
   >>>>>>> branch-name
   ```
2. 手动编辑文件解决冲突
3. 添加解决后的文件到暂存区
   ```bash
   git add filename
   ```
4. 完成合并提交
   ```bash
   git commit
   ```

## 远程操作

### 克隆仓库

```bash
git clone https://github.com/username/repository.git

# 指定本地目录名
git clone https://github.com/username/repository.git local-dir

# 克隆特定分支
git clone -b branch-name https://github.com/username/repository.git
```

### 推送更改

**添加远程仓库**
```bash
git remote add origin https://github.com/username/repository.git
```

**查看远程仓库**
```bash
git remote -v
```

**推送到远程仓库**
```bash
# 推送到 origin 的 master 分支
git push origin master

# 设置上游分支并推送
git push -u origin master

# 强制推送（慎用）
git push --force origin master
```

### 拉取更改

**获取远程更新**
```bash
# 只获取更新，不合并
git fetch origin

# 获取所有分支的更新
git fetch --all
```

**拉取并合并远程更新**
```bash
git pull origin master

# 相当于 git fetch + git merge
```

**使用变基方式拉取**
```bash
git pull --rebase origin master
```

### 远程分支管理

**查看远程分支**
```bash
git branch -r
```

**查看所有分支（本地和远程）**
```bash
git branch -a
```

**创建跟踪远程分支的本地分支**
```bash
git checkout -b local-branch origin/remote-branch

# 或使用 Git 2.23+ 的新命令
git switch -c local-branch origin/remote-branch
```

**删除远程分支**
```bash
git push origin --delete branch-name
```

## 高级操作

### 标签管理

标签通常用于标记重要的提交点，如发布版本。

**创建标签**
```bash
# 轻量标签
git tag v1.0.0

# 附注标签
git tag -a v1.0.0 -m "Version 1.0.0"

# 为特定提交创建标签
git tag -a v1.0.0 -m "Version 1.0.0" commit-id
```

**查看标签**
```bash
# 列出所有标签
git tag

# 查看标签详情
git show v1.0.0
```

**推送标签到远程**
```bash
# 推送特定标签
git push origin v1.0.0

# 推送所有标签
git push origin --tags
```

**删除标签**
```bash
# 删除本地标签
git tag -d v1.0.0

# 删除远程标签
git push origin :refs/tags/v1.0.0
```

### 子模块

子模块允许你在一个 Git 仓库中包含其他 Git 仓库作为子目录。

**添加子模块**
```bash
git submodule add https://github.com/username/repository.git path/to/submodule
```

**初始化子模块**
```bash
git submodule init
```

**更新子模块**
```bash
git submodule update

# 初始化并更新所有子模块
git submodule update --init --recursive
```

### Cherry-Pick

Cherry-pick 允许你选择特定的提交并应用到当前分支。

```bash
git cherry-pick commit-id
```

### 变基

变基（Rebase）是一种整合来自不同分支工作的方式，通过修改提交历史使其更加线性。

```bash
# 在 feature 分支上变基到 master
git checkout feature
git rebase master

# 交互式变基
git rebase -i HEAD~3  # 修改最近3次提交
```

### 储藏

储藏（Stash）可以暂时保存未提交的更改，以便你可以切换到其他任务。

```bash
# 储藏当前更改
git stash

# 储藏时添加说明
git stash save "WIP: 功能开发中"

# 查看储藏列表
git stash list

# 应用最近的储藏
git stash apply

# 应用特定的储藏
git stash apply stash@{2}

# 应用并删除最近的储藏
git stash pop

# 删除特定的储藏
git stash drop stash@{2}

# 清除所有储藏
git stash clear
```

## Git 工作流

### 集中式工作流

所有开发者直接在 master 分支上工作，类似于 SVN 的工作方式。

**优点**：简单易懂
**缺点**：容易产生冲突，不适合大型项目

### 功能分支工作流

每个新功能都在专门的分支上开发，完成后合并到 master。

**流程**：
1. 从 master 创建功能分支
2. 在功能分支上开发
3. 提交到远程功能分支
4. 创建 Pull Request
5. 代码审查后合并到 master

### Gitflow 工作流

一个更加严格的分支模型，适合有计划发布周期的项目。

**主要分支**：
- `master`：存储官方发布历史
- `develop`：集成开发分支
- `feature/*`：新功能开发
- `release/*`：发布准备
- `hotfix/*`：生产环境紧急修复

**流程**：
1. 从 `develop` 创建 `feature` 分支
2. 完成功能后合并回 `develop`
3. 从 `develop` 创建 `release` 分支
4. 测试和修复 bug 后合并到 `master` 和 `develop`
5. 如需紧急修复，从 `master` 创建 `hotfix` 分支
6. 修复后合并回 `master` 和 `develop`

### Forking 工作流

适合开源项目，每个开发者都有自己的服务器端仓库副本。

**流程**：
1. 开发者 fork 主仓库
2. 克隆个人 fork 到本地
3. 添加原始仓库为远程仓库（upstream）
4. 创建功能分支
5. 提交到个人 fork
6. 创建 Pull Request 到主仓库
7. 项目维护者审查并合并更改

## 最佳实践

### 提交规范

**提交信息格式**
```
<类型>(<范围>): <主题>

<正文>

<页脚>
```

**常用类型**：
- `feat`：新功能
- `fix`：修复 bug
- `docs`：文档更改
- `style`：不影响代码含义的更改（空格、格式化等）
- `refactor`：既不修复 bug 也不添加功能的代码更改
- `perf`：性能优化
- `test`：添加或修正测试
- `chore`：对构建过程或辅助工具的更改

**示例**：
```
feat(auth): 添加用户认证功能

实现了基于JWT的用户认证系统，包括登录、注册和密码重置功能。

Closes #123
```

### 分支命名规范

- `feature/<feature-name>`：新功能
- `bugfix/<bug-name>`：Bug 修复
- `hotfix/<fix-name>`：紧急修复
- `release/<version>`：发布准备
- `docs/<doc-name>`：文档更新
- `refactor/<refactor-name>`：代码重构

### Git Hooks

Git Hooks 是在特定 Git 事件发生时自动执行的脚本。

**常用 Hooks**：
- `pre-commit`：提交前执行，可用于代码检查
- `commit-msg`：检查提交信息
- `pre-push`：推送前执行，可用于运行测试

**使用 Husky 管理 Hooks**：
```bash
# 安装 Husky
npm install husky --save-dev

# 配置 package.json
{
  "husky": {
    "hooks": {
      "pre-commit": "lint-staged",
      "commit-msg": "commitlint -E HUSKY_GIT_PARAMS"
    }
  }
}
```

## 常见问题与解决

### 冲突解决

**使用图形化工具**
```bash
git mergetool
```

**放弃合并**
```bash
git merge --abort
```

**使用 `--ours` 或 `--theirs` 选择一方的更改**
```bash
git checkout --ours filename
git checkout --theirs filename
```

### 撤销操作

**撤销公共提交**

创建一个新的提交来撤销之前的更改：
```bash
git revert commit-id
```

**修改提交历史**

如果提交尚未推送到远程：
```bash
# 修改最后一次提交
git commit --amend

# 重写多个提交
git rebase -i HEAD~3
```

**恢复已删除的分支**
```bash
# 查找分支指向的提交
git reflog

# 基于该提交创建新分支
git branch branch-name commit-id
```

### 性能优化

**大型仓库优化**
```bash
# 压缩仓库
git gc

# 清理不必要的文件
git prune

# 验证仓库完整性
git fsck
```

**使用浅克隆**
```bash
# 只获取最近的历史
git clone --depth=1 repository-url
```

**部分克隆**
```bash
# 只克隆特定目录
git clone --filter=blob:none --sparse repository-url
cd repository
git sparse-checkout set dir1 dir2
```

**配置 Git LFS**

对于大型二进制文件，使用 Git Large File Storage：
```bash
# 安装 Git LFS
git lfs install

# 跟踪大文件
git lfs track "*.psd"

# 确保 .gitattributes 被提交
git add .gitattributes
``` 